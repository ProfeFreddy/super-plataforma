var k6=Object.defineProperty;var d2=n=>{throw TypeError(n)};var D6=(n,e,t)=>e in n?k6(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ge=(n,e,t)=>D6(n,typeof e!="symbol"?e+"":e,t),A1=(n,e,t)=>e.has(n)||d2("Cannot "+t);var d=(n,e,t)=>(A1(n,e,"read from private field"),t?t.call(n):e.get(n)),O=(n,e,t)=>e.has(n)?d2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),R=(n,e,t,r)=>(A1(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),F=(n,e,t)=>(A1(n,e,"access private method"),t);var Si=(n,e,t,r)=>({set _(i){R(n,e,i,t)},get _(){return d(n,e,r)}});function M6(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var h2={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AO=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},N6=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],o=n[t++],a=n[t++],l=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},TO={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,l=i+2<n.length,c=l?n[i+2]:0,u=s>>2,h=(s&3)<<4|a>>4;let f=(a&15)<<2|c>>6,v=c&63;l||(v=64,o||(f=64)),r.push(t[u],t[h],t[f],t[v])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(AO(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):N6(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const c=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||a==null||c==null||h==null)throw new L6;const f=s<<2|a>>4;if(r.push(f),c!==64){const v=a<<4&240|c>>2;if(r.push(v),h!==64){const w=c<<6&192|h;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class L6 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const O6=function(n){const e=AO(n);return TO.encodeByteArray(e,!0)},b_=function(n){return O6(n).replace(/\./g,"")},IO=function(n){try{return TO.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F6(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V6=()=>F6().__FIREBASE_DEFAULTS__,U6=()=>{if(typeof process>"u"||typeof h2>"u")return;const n=h2.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},B6=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&IO(n[1]);return e&&JSON.parse(e)},QS=()=>{try{return V6()||U6()||B6()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},xO=n=>{var e,t;return(t=(e=QS())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},CO=n=>{const e=xO(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},PO=()=>{var n;return(n=QS())===null||n===void 0?void 0:n.config},RO=n=>{var e;return(e=QS())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $6{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j6(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[b_(JSON.stringify(t)),b_(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ar(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function z6(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ar())}function H6(){var n;const e=(n=QS())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function G6(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function WC(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function W6(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function q6(){const n=Ar();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function kO(){return!H6()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function XS(){try{return typeof indexedDB=="object"}catch{return!1}}function qC(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}function DO(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K6="FirebaseError";class wo extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=K6,Object.setPrototypeOf(this,wo.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,gf.prototype.create)}}class gf{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?Y6(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new wo(i,a,r)}}function Y6(n,e){return n.replace(Q6,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const Q6=/\{\$([^}]+)}/g;function X6(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Bm(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(f2(s)&&f2(o)){if(!Bm(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function f2(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I0(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function cy(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function uy(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function J6(n,e){const t=new Z6(n,e);return t.subscribe.bind(t)}class Z6{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");ez(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=T1),i.error===void 0&&(i.error=T1),i.complete===void 0&&(i.complete=T1);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ez(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function T1(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tz=1e3,nz=2,rz=4*60*60*1e3,iz=.5;function p2(n,e=tz,t=nz){const r=e*Math.pow(t,n),i=Math.round(iz*r*(Math.random()-.5)*2);return Math.min(rz,r+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sn(n){return n&&n._delegate?n._delegate:n}class po{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wd="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sz{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new $6;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(az(e))try{this.getOrInitializeService({instanceIdentifier:wd})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=wd){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=wd){return this.instances.has(e)}getOptions(e=wd){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:oz(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=wd){return this.component?this.component.multipleInstances?e:wd:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function oz(n){return n===wd?void 0:n}function az(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lz{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new sz(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Lt||(Lt={}));const cz={debug:Lt.DEBUG,verbose:Lt.VERBOSE,info:Lt.INFO,warn:Lt.WARN,error:Lt.ERROR,silent:Lt.SILENT},uz=Lt.INFO,dz={[Lt.DEBUG]:"log",[Lt.VERBOSE]:"log",[Lt.INFO]:"info",[Lt.WARN]:"warn",[Lt.ERROR]:"error"},hz=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=dz[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class JS{constructor(e){this.name=e,this._logLevel=uz,this._logHandler=hz,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Lt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?cz[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Lt.DEBUG,...e),this._logHandler(this,Lt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Lt.VERBOSE,...e),this._logHandler(this,Lt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Lt.INFO,...e),this._logHandler(this,Lt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Lt.WARN,...e),this._logHandler(this,Lt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Lt.ERROR,...e),this._logHandler(this,Lt.ERROR,...e)}}const fz=(n,e)=>e.some(t=>n instanceof t);let m2,g2;function pz(){return m2||(m2=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function mz(){return g2||(g2=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const MO=new WeakMap,zT=new WeakMap,NO=new WeakMap,I1=new WeakMap,KC=new WeakMap;function gz(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(xu(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&MO.set(t,n)}).catch(()=>{}),KC.set(e,n),e}function yz(n){if(zT.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});zT.set(n,e)}let HT={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return zT.get(n);if(e==="objectStoreNames")return n.objectStoreNames||NO.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return xu(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function vz(n){HT=n(HT)}function wz(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(x1(this),e,...t);return NO.set(r,e.sort?e.sort():[e]),xu(r)}:mz().includes(n)?function(...e){return n.apply(x1(this),e),xu(MO.get(this))}:function(...e){return xu(n.apply(x1(this),e))}}function Ez(n){return typeof n=="function"?wz(n):(n instanceof IDBTransaction&&yz(n),fz(n,pz())?new Proxy(n,HT):n)}function xu(n){if(n instanceof IDBRequest)return gz(n);if(I1.has(n))return I1.get(n);const e=Ez(n);return e!==n&&(I1.set(n,e),KC.set(e,n)),e}const x1=n=>KC.get(n);function LO(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=xu(o);return r&&o.addEventListener("upgradeneeded",l=>{r(xu(o.result),l.oldVersion,l.newVersion,xu(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const bz=["get","getKey","getAll","getAllKeys","count"],_z=["put","add","delete","clear"],C1=new Map;function y2(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(C1.get(e))return C1.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=_z.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||bz.includes(t)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),i&&l.done]))[0]};return C1.set(e,s),s}vz(n=>({...n,get:(e,t,r)=>y2(e,t)||n.get(e,t,r),has:(e,t)=>!!y2(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sz{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Az(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Az(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const GT="@firebase/app",v2="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xl=new JS("@firebase/app"),Tz="@firebase/app-compat",Iz="@firebase/analytics-compat",xz="@firebase/analytics",Cz="@firebase/app-check-compat",Pz="@firebase/app-check",Rz="@firebase/auth",kz="@firebase/auth-compat",Dz="@firebase/database",Mz="@firebase/data-connect",Nz="@firebase/database-compat",Lz="@firebase/functions",Oz="@firebase/functions-compat",Fz="@firebase/installations",Vz="@firebase/installations-compat",Uz="@firebase/messaging",Bz="@firebase/messaging-compat",$z="@firebase/performance",jz="@firebase/performance-compat",zz="@firebase/remote-config",Hz="@firebase/remote-config-compat",Gz="@firebase/storage",Wz="@firebase/storage-compat",qz="@firebase/firestore",Kz="@firebase/vertexai-preview",Yz="@firebase/firestore-compat",Qz="firebase",Xz="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WT="[DEFAULT]",Jz={[GT]:"fire-core",[Tz]:"fire-core-compat",[xz]:"fire-analytics",[Iz]:"fire-analytics-compat",[Pz]:"fire-app-check",[Cz]:"fire-app-check-compat",[Rz]:"fire-auth",[kz]:"fire-auth-compat",[Dz]:"fire-rtdb",[Mz]:"fire-data-connect",[Nz]:"fire-rtdb-compat",[Lz]:"fire-fn",[Oz]:"fire-fn-compat",[Fz]:"fire-iid",[Vz]:"fire-iid-compat",[Uz]:"fire-fcm",[Bz]:"fire-fcm-compat",[$z]:"fire-perf",[jz]:"fire-perf-compat",[zz]:"fire-rc",[Hz]:"fire-rc-compat",[Gz]:"fire-gcs",[Wz]:"fire-gcs-compat",[qz]:"fire-fst",[Yz]:"fire-fst-compat",[Kz]:"fire-vertex","fire-js":"fire-js",[Qz]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uv=new Map,Zz=new Map,qT=new Map;function w2(n,e){try{n.container.addComponent(e)}catch(t){Xl.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function qo(n){const e=n.name;if(qT.has(e))return Xl.debug(`There were multiple attempts to register component ${e}.`),!1;qT.set(e,n);for(const t of uv.values())w2(t,n);for(const t of Zz.values())w2(t,n);return!0}function cc(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function zo(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eH={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Cu=new gf("app","Firebase",eH);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tH{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new po("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Cu.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pg=Xz;function OO(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:WT,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Cu.create("bad-app-name",{appName:String(i)});if(t||(t=PO()),!t)throw Cu.create("no-options");const s=uv.get(i);if(s){if(Bm(t,s.options)&&Bm(r,s.config))return s;throw Cu.create("duplicate-app",{appName:i})}const o=new lz(i);for(const l of qT.values())o.addComponent(l);const a=new tH(t,r,o);return uv.set(i,a),a}function Bu(n=WT){const e=uv.get(n);if(!e&&n===WT&&PO())return OO();if(!e)throw Cu.create("no-app",{appName:n});return e}function nH(){return Array.from(uv.values())}function ts(n,e,t){var r;let i=(r=Jz[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Xl.warn(a.join(" "));return}qo(new po(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rH="firebase-heartbeat-database",iH=1,dv="firebase-heartbeat-store";let P1=null;function FO(){return P1||(P1=LO(rH,iH,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(dv)}catch(t){console.warn(t)}}}}).catch(n=>{throw Cu.create("idb-open",{originalErrorMessage:n.message})})),P1}async function sH(n){try{const t=(await FO()).transaction(dv),r=await t.objectStore(dv).get(VO(n));return await t.done,r}catch(e){if(e instanceof wo)Xl.warn(e.message);else{const t=Cu.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Xl.warn(t.message)}}}async function E2(n,e){try{const r=(await FO()).transaction(dv,"readwrite");await r.objectStore(dv).put(e,VO(n)),await r.done}catch(t){if(t instanceof wo)Xl.warn(t.message);else{const r=Cu.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Xl.warn(r.message)}}}function VO(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oH=1024,aH=30*24*60*60*1e3;class lH{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new uH(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=b2();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=aH}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Xl.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=b2(),{heartbeatsToSend:r,unsentEntries:i}=cH(this._heartbeatsCache.heartbeats),s=b_(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Xl.warn(t),""}}}function b2(){return new Date().toISOString().substring(0,10)}function cH(n,e=oH){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),_2(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),_2(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class uH{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return XS()?qC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await sH(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return E2(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return E2(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function _2(n){return b_(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dH(n){qo(new po("platform-logger",e=>new Sz(e),"PRIVATE")),qo(new po("heartbeat",e=>new lH(e),"PRIVATE")),ts(GT,v2,n),ts(GT,v2,"esm2017"),ts("fire-js","")}dH("");var hH="firebase",fH="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ts(hH,fH,"app");function YC(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function UO(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const pH=UO,BO=new gf("auth","Firebase",UO());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const __=new JS("@firebase/auth");function mH(n,...e){__.logLevel<=Lt.WARN&&__.warn(`Auth (${pg}): ${n}`,...e)}function hb(n,...e){__.logLevel<=Lt.ERROR&&__.error(`Auth (${pg}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ko(n,...e){throw QC(n,...e)}function Va(n,...e){return QC(n,...e)}function $O(n,e,t){const r=Object.assign(Object.assign({},pH()),{[e]:t});return new gf("auth","Firebase",r).create(e,{appName:n.name})}function Ua(n){return $O(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function QC(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return BO.create(n,...e)}function ct(n,e,...t){if(!n)throw QC(e,...t)}function jl(n){const e="INTERNAL ASSERTION FAILED: "+n;throw hb(e),new Error(e)}function Jl(n,e){n||jl(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function jO(){return S2()==="http:"||S2()==="https:"}function S2(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gH(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(jO()||WC()||"connection"in navigator)?navigator.onLine:!0}function yH(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(e,t){this.shortDelay=e,this.longDelay=t,Jl(t>e,"Short delay should be less than long delay!"),this.isMobile=z6()||W6()}get(){return gH()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XC(n,e){Jl(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zO{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;jl("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;jl("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;jl("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vH={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wH=new x0(3e4,6e4);function qa(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Jo(n,e,t,r,i={}){return HO(n,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});const a=I0(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:l},s);return G6()||(c.referrerPolicy="no-referrer"),zO.fetch()(GO(n,n.config.apiHost,t,a),c)})}async function HO(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},vH),e);try{const i=new bH(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw EE(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw EE(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw EE(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw EE(n,"user-disabled",o);const u=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw $O(n,u,c);Ko(n,u)}}catch(i){if(i instanceof wo)throw i;Ko(n,"network-request-failed",{message:String(i)})}}async function C0(n,e,t,r,i={}){const s=await Jo(n,e,t,r,i);return"mfaPendingCredential"in s&&Ko(n,"multi-factor-auth-required",{_serverResponse:s}),s}function GO(n,e,t,r){const i=`${e}${t}?${r}`;return n.config.emulator?XC(n.config,i):`${n.config.apiScheme}://${i}`}function EH(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class bH{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Va(this.auth,"network-request-failed")),wH.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function EE(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=Va(n,e,r);return i.customData._tokenResponse=t,i}function A2(n){return n!==void 0&&n.enterprise!==void 0}class _H{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return EH(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function SH(n,e){return Jo(n,"GET","/v2/recaptchaConfig",qa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AH(n,e){return Jo(n,"POST","/v1/accounts:delete",e)}async function WO(n,e){return Jo(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hy(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function TH(n,e=!1){const t=sn(n),r=await t.getIdToken(e),i=JC(r);ct(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Hy(R1(i.auth_time)),issuedAtTime:Hy(R1(i.iat)),expirationTime:Hy(R1(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function R1(n){return Number(n)*1e3}function JC(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return hb("JWT malformed, contained fewer than 3 sections"),null;try{const i=IO(t);return i?JSON.parse(i):(hb("Failed to decode base64 JWT payload"),null)}catch(i){return hb("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function T2(n){const e=JC(n);return ct(e,"internal-error"),ct(typeof e.exp<"u","internal-error"),ct(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $m(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof wo&&IH(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function IH({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xH{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Hy(this.lastLoginAt),this.creationTime=Hy(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A_(n){var e;const t=n.auth,r=await n.getIdToken(),i=await $m(n,WO(t,{idToken:r}));ct(i==null?void 0:i.users.length,t,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?qO(s.providerUserInfo):[],a=PH(n.providerData,o),l=n.isAnonymous,c=!(n.email&&s.passwordHash)&&!(a!=null&&a.length),u=l?c:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new KT(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function CH(n){const e=sn(n);await A_(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function PH(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function qO(n){return n.map(e=>{var{providerId:t}=e,r=YC(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RH(n,e){const t=await HO(n,{},async()=>{const r=I0({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=GO(n,i,"/v1/token",`key=${s}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",zO.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function kH(n,e){return Jo(n,"POST","/v2/accounts:revokeToken",qa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ep{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ct(e.idToken,"internal-error"),ct(typeof e.idToken<"u","internal-error"),ct(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):T2(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ct(e.length!==0,"internal-error");const t=T2(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(ct(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:s}=await RH(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new Ep;return r&&(ct(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(ct(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(ct(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ep,this.toJSON())}_performRefresh(){return jl("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gc(n,e){ct(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class zl{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=YC(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new xH(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new KT(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await $m(this,this.stsTokenManager.getToken(this.auth,e));return ct(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return TH(this,e)}reload(){return CH(this)}_assign(e){this!==e&&(ct(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new zl(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ct(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await A_(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(zo(this.auth.app))return Promise.reject(Ua(this.auth));const e=await this.getIdToken();return await $m(this,AH(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,a,l,c,u;const h=(r=t.displayName)!==null&&r!==void 0?r:void 0,f=(i=t.email)!==null&&i!==void 0?i:void 0,v=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,w=(o=t.photoURL)!==null&&o!==void 0?o:void 0,E=(a=t.tenantId)!==null&&a!==void 0?a:void 0,A=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,T=(c=t.createdAt)!==null&&c!==void 0?c:void 0,_=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:b,emailVerified:g,isAnonymous:y,providerData:x,stsTokenManager:S}=t;ct(b&&S,e,"internal-error");const I=Ep.fromJSON(this.name,S);ct(typeof b=="string",e,"internal-error"),gc(h,e.name),gc(f,e.name),ct(typeof g=="boolean",e,"internal-error"),ct(typeof y=="boolean",e,"internal-error"),gc(v,e.name),gc(w,e.name),gc(E,e.name),gc(A,e.name),gc(T,e.name),gc(_,e.name);const P=new zl({uid:b,auth:e,email:f,emailVerified:g,displayName:h,isAnonymous:y,photoURL:w,phoneNumber:v,tenantId:E,stsTokenManager:I,createdAt:T,lastLoginAt:_});return x&&Array.isArray(x)&&(P.providerData=x.map(N=>Object.assign({},N))),A&&(P._redirectEventId=A),P}static async _fromIdTokenResponse(e,t,r=!1){const i=new Ep;i.updateFromServerResponse(t);const s=new zl({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await A_(s),s}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];ct(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?qO(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),a=new Ep;a.updateFromIdToken(r);const l=new zl({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new KT(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I2=new Map;function Hl(n){Jl(n instanceof Function,"Expected a class definition");let e=I2.get(n);return e?(Jl(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,I2.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KO{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}KO.type="NONE";const x2=KO;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fb(n,e,t){return`firebase:${n}:${e}:${t}`}class bp{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=fb(this.userKey,i.apiKey,s),this.fullPersistenceKey=fb("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?zl._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new bp(Hl(x2),e,r);const i=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let s=i[0]||Hl(x2);const o=fb(r,e.config.apiKey,e.name);let a=null;for(const c of t)try{const u=await c._get(o);if(u){const h=zl._fromJSON(e,u);c!==s&&(a=h),s=c;break}}catch{}const l=i.filter(c=>c._shouldAllowMigration);return!s._shouldAllowMigration||!l.length?new bp(s,e,r):(s=l[0],a&&await s._set(o,a.toJSON()),await Promise.all(t.map(async c=>{if(c!==s)try{await c._remove(o)}catch{}})),new bp(s,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C2(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(JO(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(YO(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(eF(e))return"Blackberry";if(tF(e))return"Webos";if(QO(e))return"Safari";if((e.includes("chrome/")||XO(e))&&!e.includes("edge/"))return"Chrome";if(ZO(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function YO(n=Ar()){return/firefox\//i.test(n)}function QO(n=Ar()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function XO(n=Ar()){return/crios\//i.test(n)}function JO(n=Ar()){return/iemobile/i.test(n)}function ZO(n=Ar()){return/android/i.test(n)}function eF(n=Ar()){return/blackberry/i.test(n)}function tF(n=Ar()){return/webos/i.test(n)}function ZC(n=Ar()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function DH(n=Ar()){var e;return ZC(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function MH(){return q6()&&document.documentMode===10}function nF(n=Ar()){return ZC(n)||ZO(n)||tF(n)||eF(n)||/windows phone/i.test(n)||JO(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rF(n,e=[]){let t;switch(n){case"Browser":t=C2(Ar());break;case"Worker":t=`${C2(Ar())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${pg}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NH{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((o,a)=>{try{const l=e(s);o(l)}catch(l){a(l)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LH(n,e={}){return Jo(n,"GET","/v2/passwordPolicy",qa(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OH=6;class FH{constructor(e){var t,r,i,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:OH,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(i=l.containsLowercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsUppercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VH{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new P2(this),this.idTokenSubscription=new P2(this),this.beforeStateQueue=new NH(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=BO,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Hl(t)),this._initializationPromise=this.queue(async()=>{var r,i;if(!this._deleted&&(this.persistenceManager=await bp.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await WO(this,{idToken:e}),r=await zl._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(zo(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=i==null?void 0:i._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(i=l.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return ct(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await A_(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=yH()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(zo(this.app))return Promise.reject(Ua(this));const t=e?sn(e):null;return t&&ct(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ct(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return zo(this.app)?Promise.reject(Ua(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return zo(this.app)?Promise.reject(Ua(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Hl(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await LH(this),t=new FH(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new gf("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await kH(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Hl(e)||this._popupRedirectResolver;ct(t,this,"argument-error"),this.redirectPersistenceManager=await bp.create(this,[Hl(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ct(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){const l=e.addObserver(t,r,i);return()=>{o=!0,l()}}else{const l=e.addObserver(t);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ct(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=rF(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&mH(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Ju(n){return sn(n)}class P2{constructor(e){this.auth=e,this.observer=null,this.addObserver=J6(t=>this.observer=t)}get next(){return ct(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ZS={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function UH(n){ZS=n}function iF(n){return ZS.loadJS(n)}function BH(){return ZS.recaptchaEnterpriseScript}function $H(){return ZS.gapiScript}function jH(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const zH="recaptcha-enterprise",HH="NO_RECAPTCHA";class GH{constructor(e){this.type=zH,this.auth=Ju(e)}async verify(e="verify",t=!1){async function r(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(o,a)=>{SH(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new _H(l);return s.tenantId==null?s._agentRecaptchaConfig=c:s._tenantRecaptchaConfigs[s.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function i(s,o,a){const l=window.grecaptcha;A2(l)?l.enterprise.ready(()=>{l.enterprise.execute(s,{action:e}).then(c=>{o(c)}).catch(()=>{o(HH)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,o)=>{r(this.auth).then(a=>{if(!t&&A2(window.grecaptcha))i(a,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=BH();l.length!==0&&(l+=a),iF(l).then(()=>{i(a,s,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function R2(n,e,t,r=!1){const i=new GH(n);let s;try{s=await i.verify(t)}catch{s=await i.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function YT(n,e,t,r){var i;if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await R2(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await R2(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(s)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WH(n,e){const t=cc(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),s=t.getOptions();if(Bm(s,e??{}))return i;Ko(i,"already-initialized")}return t.initialize({options:e})}function qH(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Hl);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function KH(n,e,t){const r=Ju(n);ct(r._canInitEmulator,r,"emulator-config-failed"),ct(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=sF(e),{host:o,port:a}=YH(e),l=a===null?"":`:${a}`;r.config.emulator={url:`${s}//${o}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),QH()}function sF(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function YH(n){const e=sF(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:k2(r.substr(s.length+1))}}else{const[s,o]=r.split(":");return{host:s,port:k2(o)}}}function k2(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function QH(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eP{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return jl("not implemented")}_getIdTokenResponse(e){return jl("not implemented")}_linkToIdToken(e,t){return jl("not implemented")}_getReauthenticationResolver(e){return jl("not implemented")}}async function XH(n,e){return Jo(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JH(n,e){return C0(n,"POST","/v1/accounts:signInWithPassword",qa(n,e))}async function ZH(n,e){return Jo(n,"POST","/v1/accounts:sendOobCode",qa(n,e))}async function e8(n,e){return ZH(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t8(n,e){return C0(n,"POST","/v1/accounts:signInWithEmailLink",qa(n,e))}async function n8(n,e){return C0(n,"POST","/v1/accounts:signInWithEmailLink",qa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv extends eP{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new hv(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new hv(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return YT(e,t,"signInWithPassword",JH);case"emailLink":return t8(e,{email:this._email,oobCode:this._password});default:Ko(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return YT(e,r,"signUpPassword",XH);case"emailLink":return n8(e,{idToken:t,email:this._email,oobCode:this._password});default:Ko(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _p(n,e){return C0(n,"POST","/v1/accounts:signInWithIdp",qa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r8="http://localhost";class Qh extends eP{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Qh(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ko("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=YC(t,["providerId","signInMethod"]);if(!r||!i)return null;const o=new Qh(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return _p(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,_p(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_p(e,t)}buildRequest(){const e={requestUri:r8,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=I0(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i8(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function s8(n){const e=cy(uy(n)).link,t=e?cy(uy(e)).deep_link_id:null,r=cy(uy(n)).deep_link_id;return(r?cy(uy(r)).link:null)||r||t||e||n}class tP{constructor(e){var t,r,i,s,o,a;const l=cy(uy(e)),c=(t=l.apiKey)!==null&&t!==void 0?t:null,u=(r=l.oobCode)!==null&&r!==void 0?r:null,h=i8((i=l.mode)!==null&&i!==void 0?i:null);ct(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=(s=l.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=l.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=l.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=s8(e);try{return new tP(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{constructor(){this.providerId=mg.PROVIDER_ID}static credential(e,t){return hv._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=tP.parseLink(t);return ct(r,"argument-error"),hv._fromEmailAndCode(e,r.code,r.tenantId)}}mg.PROVIDER_ID="password";mg.EMAIL_PASSWORD_SIGN_IN_METHOD="password";mg.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oF{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0 extends oF{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc extends P0{constructor(){super("facebook.com")}static credential(e){return Qh._fromParams({providerId:kc.PROVIDER_ID,signInMethod:kc.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return kc.credentialFromTaggedObject(e)}static credentialFromError(e){return kc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return kc.credential(e.oauthAccessToken)}catch{return null}}}kc.FACEBOOK_SIGN_IN_METHOD="facebook.com";kc.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc extends P0{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Qh._fromParams({providerId:Dc.PROVIDER_ID,signInMethod:Dc.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Dc.credentialFromTaggedObject(e)}static credentialFromError(e){return Dc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Dc.credential(t,r)}catch{return null}}}Dc.GOOGLE_SIGN_IN_METHOD="google.com";Dc.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc extends P0{constructor(){super("github.com")}static credential(e){return Qh._fromParams({providerId:Mc.PROVIDER_ID,signInMethod:Mc.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Mc.credentialFromTaggedObject(e)}static credentialFromError(e){return Mc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Mc.credential(e.oauthAccessToken)}catch{return null}}}Mc.GITHUB_SIGN_IN_METHOD="github.com";Mc.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc extends P0{constructor(){super("twitter.com")}static credential(e,t){return Qh._fromParams({providerId:Nc.PROVIDER_ID,signInMethod:Nc.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Nc.credentialFromTaggedObject(e)}static credentialFromError(e){return Nc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Nc.credential(t,r)}catch{return null}}}Nc.TWITTER_SIGN_IN_METHOD="twitter.com";Nc.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aF(n,e){return C0(n,"POST","/v1/accounts:signUp",qa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const s=await zl._fromIdTokenResponse(e,r,i),o=D2(r);return new Zl({user:s,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=D2(r);return new Zl({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function D2(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mo(n){var e;if(zo(n.app))return Promise.reject(Ua(n));const t=Ju(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Zl({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await aF(t,{returnSecureToken:!0}),i=await Zl._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(i.user),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T_ extends wo{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,T_.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new T_(e,t,r,i)}}function lF(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?T_._fromErrorAndOperation(n,s,e,r):s})}async function o8(n,e,t=!1){const r=await $m(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Zl._forOperation(n,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a8(n,e,t=!1){const{auth:r}=n;if(zo(r.app))return Promise.reject(Ua(r));const i="reauthenticate";try{const s=await $m(n,lF(r,i,e,n),t);ct(s.idToken,r,"internal-error");const o=JC(s.idToken);ct(o,r,"internal-error");const{sub:a}=o;return ct(n.uid===a,r,"user-mismatch"),Zl._forOperation(n,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Ko(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cF(n,e,t=!1){if(zo(n.app))return Promise.reject(Ua(n));const r="signIn",i=await lF(n,r,e),s=await Zl._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}async function l8(n,e){return cF(Ju(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uF(n){const e=Ju(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function c8(n,e,t){if(zo(n.app))return Promise.reject(Ua(n));const r=Ju(n),o=await YT(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",aF).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&uF(n),l}),a=await Zl._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function u8(n,e,t){return zo(n.app)?Promise.reject(Ua(n)):l8(sn(n),mg.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&uF(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d8(n,e){return Jo(n,"POST","/v1/accounts:createAuthUri",qa(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h8(n,e){const t=jO()?S_():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:i}=await d8(sn(n),r);return i||[]}async function f8(n,e){const t=sn(n),i={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:s}=await e8(t.auth,i);s!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p8(n,e){return Jo(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m8(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=sn(n),s={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await $m(r,p8(r.auth,s));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g8(n,e){return sn(n).setPersistence(e)}function y8(n,e,t,r){return sn(n).onIdTokenChanged(e,t,r)}function v8(n,e,t){return sn(n).beforeAuthStateChanged(e,t)}function ls(n,e,t,r){return sn(n).onAuthStateChanged(e,t,r)}const I_="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dF{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(I_,"1"),this.storage.removeItem(I_),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w8=1e3,E8=10;class hF extends dF{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nF(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);MH()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,E8):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},w8)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}hF.type="LOCAL";const b8=hF;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fF extends dF{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}fF.type="SESSION";const nP=fF;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _8(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eA{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new eA(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:s}=t.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(async c=>c(t.origin,s)),l=await _8(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:l})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}eA.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rP(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S8{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,l)=>{const c=rP("",20);i.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(h){const f=h;if(f.data.eventId===c)switch(f.data.status){case"ack":clearTimeout(u),s=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(f.data.response);break;default:clearTimeout(u),clearTimeout(s),l(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ba(){return window}function A8(n){Ba().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pF(){return typeof Ba().WorkerGlobalScope<"u"&&typeof Ba().importScripts=="function"}async function T8(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function I8(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function x8(){return pF()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mF="firebaseLocalStorageDb",C8=1,x_="firebaseLocalStorage",gF="fbase_key";class R0{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function tA(n,e){return n.transaction([x_],e?"readwrite":"readonly").objectStore(x_)}function P8(){const n=indexedDB.deleteDatabase(mF);return new R0(n).toPromise()}function QT(){const n=indexedDB.open(mF,C8);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(x_,{keyPath:gF})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(x_)?e(r):(r.close(),await P8(),e(await QT()))})})}async function M2(n,e,t){const r=tA(n,!0).put({[gF]:e,value:t});return new R0(r).toPromise()}async function R8(n,e){const t=tA(n,!1).get(e),r=await new R0(t).toPromise();return r===void 0?null:r.value}function N2(n,e){const t=tA(n,!0).delete(e);return new R0(t).toPromise()}const k8=800,D8=3;class yF{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await QT(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>D8)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return pF()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=eA._getInstance(x8()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await T8(),!this.activeServiceWorker)return;this.sender=new S8(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||I8()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await QT();return await M2(e,I_,"1"),await N2(e,I_),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>M2(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>R8(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>N2(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=tA(i,!1).getAll();return new R0(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),k8)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}yF.type="LOCAL";const M8=yF;new x0(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N8(n,e){return e?Hl(e):(ct(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP extends eP{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _p(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _p(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _p(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function L8(n){return cF(n.auth,new iP(n),n.bypassAuthState)}function O8(n){const{auth:e,user:t}=n;return ct(t,e,"internal-error"),a8(t,new iP(n),n.bypassAuthState)}async function F8(n){const{auth:e,user:t}=n;return ct(t,e,"internal-error"),o8(t,new iP(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vF{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return L8;case"linkViaPopup":case"linkViaRedirect":return F8;case"reauthViaPopup":case"reauthViaRedirect":return O8;default:Ko(this.auth,"internal-error")}}resolve(e){Jl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Jl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V8=new x0(2e3,1e4);class ep extends vF{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,ep.currentPopupAction&&ep.currentPopupAction.cancel(),ep.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ct(e,this.auth,"internal-error"),e}async onExecution(){Jl(this.filter.length===1,"Popup operations only handle one event");const e=rP();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Va(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Va(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ep.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Va(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,V8.get())};e()}}ep.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U8="pendingRedirect",pb=new Map;class B8 extends vF{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=pb.get(this.auth._key());if(!e){try{const r=await $8(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}pb.set(this.auth._key(),e)}return this.bypassAuthState||pb.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function $8(n,e){const t=H8(e),r=z8(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}function j8(n,e){pb.set(n._key(),e)}function z8(n){return Hl(n._redirectPersistence)}function H8(n){return fb(U8,n.config.apiKey,n.name)}async function G8(n,e,t=!1){if(zo(n.app))return Promise.reject(Ua(n));const r=Ju(n),i=N8(r,e),o=await new B8(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W8=10*60*1e3;class q8{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!K8(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!wF(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Va(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=W8&&this.cachedEventUids.clear(),this.cachedEventUids.has(L2(e))}saveEventToCache(e){this.cachedEventUids.add(L2(e)),this.lastProcessedEventTime=Date.now()}}function L2(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function wF({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function K8(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return wF(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y8(n,e={}){return Jo(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q8=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,X8=/^https?/;async function J8(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Y8(n);for(const t of e)try{if(Z8(t))return}catch{}Ko(n,"unauthorized-domain")}function Z8(n){const e=S_(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!X8.test(t))return!1;if(Q8.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eG=new x0(3e4,6e4);function O2(){const n=Ba().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function tG(n){return new Promise((e,t)=>{var r,i,s;function o(){O2(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{O2(),t(Va(n,"network-request-failed"))},timeout:eG.get()})}if(!((i=(r=Ba().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Ba().gapi)===null||s===void 0)&&s.load)o();else{const a=jH("iframefcb");return Ba()[a]=()=>{gapi.load?o():t(Va(n,"network-request-failed"))},iF(`${$H()}?onload=${a}`).catch(l=>t(l))}}).catch(e=>{throw mb=null,e})}let mb=null;function nG(n){return mb=mb||tG(n),mb}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rG=new x0(5e3,15e3),iG="__/auth/iframe",sG="emulator/auth/iframe",oG={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},aG=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function lG(n){const e=n.config;ct(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?XC(e,sG):`https://${n.config.authDomain}/${iG}`,r={apiKey:e.apiKey,appName:n.name,v:pg},i=aG.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${I0(r).slice(1)}`}async function cG(n){const e=await nG(n),t=Ba().gapi;return ct(t,n,"internal-error"),e.open({where:document.body,url:lG(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:oG,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const o=Va(n,"network-request-failed"),a=Ba().setTimeout(()=>{s(o)},rG.get());function l(){Ba().clearTimeout(a),i(r)}r.ping(l).then(l,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uG={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},dG=500,hG=600,fG="_blank",pG="http://localhost";class F2{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function mG(n,e,t,r=dG,i=hG){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l=Object.assign(Object.assign({},uG),{width:r.toString(),height:i.toString(),top:s,left:o}),c=Ar().toLowerCase();t&&(a=XO(c)?fG:t),YO(c)&&(e=e||pG,l.scrollbars="yes");const u=Object.entries(l).reduce((f,[v,w])=>`${f}${v}=${w},`,"");if(DH(c)&&a!=="_self")return gG(e||"",a),new F2(null);const h=window.open(e||"",a,u);ct(h,n,"popup-blocked");try{h.focus()}catch{}return new F2(h)}function gG(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yG="__/auth/handler",vG="emulator/auth/handler",wG=encodeURIComponent("fac");async function V2(n,e,t,r,i,s){ct(n.config.authDomain,n,"auth-domain-config-required"),ct(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:pg,eventId:i};if(e instanceof oF){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",X6(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof P0){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const u of Object.keys(a))a[u]===void 0&&delete a[u];const l=await n._getAppCheckToken(),c=l?`#${wG}=${encodeURIComponent(l)}`:"";return`${EG(n)}?${I0(a).slice(1)}${c}`}function EG({config:n}){return n.emulator?XC(n,vG):`https://${n.authDomain}/${yG}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k1="webStorageSupport";class bG{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=nP,this._completeRedirectFn=G8,this._overrideRedirectResult=j8}async _openPopup(e,t,r,i){var s;Jl((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await V2(e,t,r,S_(),i);return mG(e,o,rP())}async _openRedirect(e,t,r,i){await this._originValidation(e);const s=await V2(e,t,r,S_(),i);return A8(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Jl(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await cG(e),r=new q8(e);return t.register("authEvent",i=>(ct(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(k1,{type:k1},i=>{var s;const o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[k1];o!==void 0&&t(!!o),Ko(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=J8(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return nF()||QO()||ZC()}}const _G=bG;var U2="@firebase/auth",B2="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SG{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ct(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AG(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function TG(n){qo(new po("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;ct(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rF(n)},c=new VH(r,i,s,l);return qH(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),qo(new po("auth-internal",e=>{const t=Ju(e.getProvider("auth").getImmediate());return(r=>new SG(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ts(U2,B2,AG(n)),ts(U2,B2,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IG=5*60,xG=RO("authIdTokenMaxAge")||IG;let $2=null;const CG=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>xG)return;const i=t==null?void 0:t.token;$2!==i&&($2=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function PG(n=Bu()){const e=cc(n,"auth");if(e.isInitialized())return e.getImmediate();const t=WH(n,{popupRedirectResolver:_G,persistence:[M8,b8,nP]}),r=RO("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const o=CG(s.toString());v8(t,o,()=>o(t.currentUser)),y8(t,a=>o(a))}}const i=xO("auth");return i&&KH(t,`http://${i}`),t}function RG(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}UH({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=Va("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",RG().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});TG("Browser");var j2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Gh,EF;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(S,I){function P(){}P.prototype=I.prototype,S.D=I.prototype,S.prototype=new P,S.prototype.constructor=S,S.C=function(N,M,V){for(var L=Array(arguments.length-2),j=2;j<arguments.length;j++)L[j-2]=arguments[j];return I.prototype[M].apply(N,L)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(S,I,P){P||(P=0);var N=Array(16);if(typeof I=="string")for(var M=0;16>M;++M)N[M]=I.charCodeAt(P++)|I.charCodeAt(P++)<<8|I.charCodeAt(P++)<<16|I.charCodeAt(P++)<<24;else for(M=0;16>M;++M)N[M]=I[P++]|I[P++]<<8|I[P++]<<16|I[P++]<<24;I=S.g[0],P=S.g[1],M=S.g[2];var V=S.g[3],L=I+(V^P&(M^V))+N[0]+3614090360&4294967295;I=P+(L<<7&4294967295|L>>>25),L=V+(M^I&(P^M))+N[1]+3905402710&4294967295,V=I+(L<<12&4294967295|L>>>20),L=M+(P^V&(I^P))+N[2]+606105819&4294967295,M=V+(L<<17&4294967295|L>>>15),L=P+(I^M&(V^I))+N[3]+3250441966&4294967295,P=M+(L<<22&4294967295|L>>>10),L=I+(V^P&(M^V))+N[4]+4118548399&4294967295,I=P+(L<<7&4294967295|L>>>25),L=V+(M^I&(P^M))+N[5]+1200080426&4294967295,V=I+(L<<12&4294967295|L>>>20),L=M+(P^V&(I^P))+N[6]+2821735955&4294967295,M=V+(L<<17&4294967295|L>>>15),L=P+(I^M&(V^I))+N[7]+4249261313&4294967295,P=M+(L<<22&4294967295|L>>>10),L=I+(V^P&(M^V))+N[8]+1770035416&4294967295,I=P+(L<<7&4294967295|L>>>25),L=V+(M^I&(P^M))+N[9]+2336552879&4294967295,V=I+(L<<12&4294967295|L>>>20),L=M+(P^V&(I^P))+N[10]+4294925233&4294967295,M=V+(L<<17&4294967295|L>>>15),L=P+(I^M&(V^I))+N[11]+2304563134&4294967295,P=M+(L<<22&4294967295|L>>>10),L=I+(V^P&(M^V))+N[12]+1804603682&4294967295,I=P+(L<<7&4294967295|L>>>25),L=V+(M^I&(P^M))+N[13]+4254626195&4294967295,V=I+(L<<12&4294967295|L>>>20),L=M+(P^V&(I^P))+N[14]+2792965006&4294967295,M=V+(L<<17&4294967295|L>>>15),L=P+(I^M&(V^I))+N[15]+1236535329&4294967295,P=M+(L<<22&4294967295|L>>>10),L=I+(M^V&(P^M))+N[1]+4129170786&4294967295,I=P+(L<<5&4294967295|L>>>27),L=V+(P^M&(I^P))+N[6]+3225465664&4294967295,V=I+(L<<9&4294967295|L>>>23),L=M+(I^P&(V^I))+N[11]+643717713&4294967295,M=V+(L<<14&4294967295|L>>>18),L=P+(V^I&(M^V))+N[0]+3921069994&4294967295,P=M+(L<<20&4294967295|L>>>12),L=I+(M^V&(P^M))+N[5]+3593408605&4294967295,I=P+(L<<5&4294967295|L>>>27),L=V+(P^M&(I^P))+N[10]+38016083&4294967295,V=I+(L<<9&4294967295|L>>>23),L=M+(I^P&(V^I))+N[15]+3634488961&4294967295,M=V+(L<<14&4294967295|L>>>18),L=P+(V^I&(M^V))+N[4]+3889429448&4294967295,P=M+(L<<20&4294967295|L>>>12),L=I+(M^V&(P^M))+N[9]+568446438&4294967295,I=P+(L<<5&4294967295|L>>>27),L=V+(P^M&(I^P))+N[14]+3275163606&4294967295,V=I+(L<<9&4294967295|L>>>23),L=M+(I^P&(V^I))+N[3]+4107603335&4294967295,M=V+(L<<14&4294967295|L>>>18),L=P+(V^I&(M^V))+N[8]+1163531501&4294967295,P=M+(L<<20&4294967295|L>>>12),L=I+(M^V&(P^M))+N[13]+2850285829&4294967295,I=P+(L<<5&4294967295|L>>>27),L=V+(P^M&(I^P))+N[2]+4243563512&4294967295,V=I+(L<<9&4294967295|L>>>23),L=M+(I^P&(V^I))+N[7]+1735328473&4294967295,M=V+(L<<14&4294967295|L>>>18),L=P+(V^I&(M^V))+N[12]+2368359562&4294967295,P=M+(L<<20&4294967295|L>>>12),L=I+(P^M^V)+N[5]+4294588738&4294967295,I=P+(L<<4&4294967295|L>>>28),L=V+(I^P^M)+N[8]+2272392833&4294967295,V=I+(L<<11&4294967295|L>>>21),L=M+(V^I^P)+N[11]+1839030562&4294967295,M=V+(L<<16&4294967295|L>>>16),L=P+(M^V^I)+N[14]+4259657740&4294967295,P=M+(L<<23&4294967295|L>>>9),L=I+(P^M^V)+N[1]+2763975236&4294967295,I=P+(L<<4&4294967295|L>>>28),L=V+(I^P^M)+N[4]+1272893353&4294967295,V=I+(L<<11&4294967295|L>>>21),L=M+(V^I^P)+N[7]+4139469664&4294967295,M=V+(L<<16&4294967295|L>>>16),L=P+(M^V^I)+N[10]+3200236656&4294967295,P=M+(L<<23&4294967295|L>>>9),L=I+(P^M^V)+N[13]+681279174&4294967295,I=P+(L<<4&4294967295|L>>>28),L=V+(I^P^M)+N[0]+3936430074&4294967295,V=I+(L<<11&4294967295|L>>>21),L=M+(V^I^P)+N[3]+3572445317&4294967295,M=V+(L<<16&4294967295|L>>>16),L=P+(M^V^I)+N[6]+76029189&4294967295,P=M+(L<<23&4294967295|L>>>9),L=I+(P^M^V)+N[9]+3654602809&4294967295,I=P+(L<<4&4294967295|L>>>28),L=V+(I^P^M)+N[12]+3873151461&4294967295,V=I+(L<<11&4294967295|L>>>21),L=M+(V^I^P)+N[15]+530742520&4294967295,M=V+(L<<16&4294967295|L>>>16),L=P+(M^V^I)+N[2]+3299628645&4294967295,P=M+(L<<23&4294967295|L>>>9),L=I+(M^(P|~V))+N[0]+4096336452&4294967295,I=P+(L<<6&4294967295|L>>>26),L=V+(P^(I|~M))+N[7]+1126891415&4294967295,V=I+(L<<10&4294967295|L>>>22),L=M+(I^(V|~P))+N[14]+2878612391&4294967295,M=V+(L<<15&4294967295|L>>>17),L=P+(V^(M|~I))+N[5]+4237533241&4294967295,P=M+(L<<21&4294967295|L>>>11),L=I+(M^(P|~V))+N[12]+1700485571&4294967295,I=P+(L<<6&4294967295|L>>>26),L=V+(P^(I|~M))+N[3]+2399980690&4294967295,V=I+(L<<10&4294967295|L>>>22),L=M+(I^(V|~P))+N[10]+4293915773&4294967295,M=V+(L<<15&4294967295|L>>>17),L=P+(V^(M|~I))+N[1]+2240044497&4294967295,P=M+(L<<21&4294967295|L>>>11),L=I+(M^(P|~V))+N[8]+1873313359&4294967295,I=P+(L<<6&4294967295|L>>>26),L=V+(P^(I|~M))+N[15]+4264355552&4294967295,V=I+(L<<10&4294967295|L>>>22),L=M+(I^(V|~P))+N[6]+2734768916&4294967295,M=V+(L<<15&4294967295|L>>>17),L=P+(V^(M|~I))+N[13]+1309151649&4294967295,P=M+(L<<21&4294967295|L>>>11),L=I+(M^(P|~V))+N[4]+4149444226&4294967295,I=P+(L<<6&4294967295|L>>>26),L=V+(P^(I|~M))+N[11]+3174756917&4294967295,V=I+(L<<10&4294967295|L>>>22),L=M+(I^(V|~P))+N[2]+718787259&4294967295,M=V+(L<<15&4294967295|L>>>17),L=P+(V^(M|~I))+N[9]+3951481745&4294967295,S.g[0]=S.g[0]+I&4294967295,S.g[1]=S.g[1]+(M+(L<<21&4294967295|L>>>11))&4294967295,S.g[2]=S.g[2]+M&4294967295,S.g[3]=S.g[3]+V&4294967295}r.prototype.u=function(S,I){I===void 0&&(I=S.length);for(var P=I-this.blockSize,N=this.B,M=this.h,V=0;V<I;){if(M==0)for(;V<=P;)i(this,S,V),V+=this.blockSize;if(typeof S=="string"){for(;V<I;)if(N[M++]=S.charCodeAt(V++),M==this.blockSize){i(this,N),M=0;break}}else for(;V<I;)if(N[M++]=S[V++],M==this.blockSize){i(this,N),M=0;break}}this.h=M,this.o+=I},r.prototype.v=function(){var S=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);S[0]=128;for(var I=1;I<S.length-8;++I)S[I]=0;var P=8*this.o;for(I=S.length-8;I<S.length;++I)S[I]=P&255,P/=256;for(this.u(S),S=Array(16),I=P=0;4>I;++I)for(var N=0;32>N;N+=8)S[P++]=this.g[I]>>>N&255;return S};function s(S,I){var P=a;return Object.prototype.hasOwnProperty.call(P,S)?P[S]:P[S]=I(S)}function o(S,I){this.h=I;for(var P=[],N=!0,M=S.length-1;0<=M;M--){var V=S[M]|0;N&&V==I||(P[M]=V,N=!1)}this.g=P}var a={};function l(S){return-128<=S&&128>S?s(S,function(I){return new o([I|0],0>I?-1:0)}):new o([S|0],0>S?-1:0)}function c(S){if(isNaN(S)||!isFinite(S))return h;if(0>S)return A(c(-S));for(var I=[],P=1,N=0;S>=P;N++)I[N]=S/P|0,P*=4294967296;return new o(I,0)}function u(S,I){if(S.length==0)throw Error("number format error: empty string");if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(S.charAt(0)=="-")return A(u(S.substring(1),I));if(0<=S.indexOf("-"))throw Error('number format error: interior "-" character');for(var P=c(Math.pow(I,8)),N=h,M=0;M<S.length;M+=8){var V=Math.min(8,S.length-M),L=parseInt(S.substring(M,M+V),I);8>V?(V=c(Math.pow(I,V)),N=N.j(V).add(c(L))):(N=N.j(P),N=N.add(c(L)))}return N}var h=l(0),f=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(E(this))return-A(this).m();for(var S=0,I=1,P=0;P<this.g.length;P++){var N=this.i(P);S+=(0<=N?N:4294967296+N)*I,I*=4294967296}return S},n.toString=function(S){if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(w(this))return"0";if(E(this))return"-"+A(this).toString(S);for(var I=c(Math.pow(S,6)),P=this,N="";;){var M=g(P,I).g;P=T(P,M.j(I));var V=((0<P.g.length?P.g[0]:P.h)>>>0).toString(S);if(P=M,w(P))return V+N;for(;6>V.length;)V="0"+V;N=V+N}},n.i=function(S){return 0>S?0:S<this.g.length?this.g[S]:this.h};function w(S){if(S.h!=0)return!1;for(var I=0;I<S.g.length;I++)if(S.g[I]!=0)return!1;return!0}function E(S){return S.h==-1}n.l=function(S){return S=T(this,S),E(S)?-1:w(S)?0:1};function A(S){for(var I=S.g.length,P=[],N=0;N<I;N++)P[N]=~S.g[N];return new o(P,~S.h).add(f)}n.abs=function(){return E(this)?A(this):this},n.add=function(S){for(var I=Math.max(this.g.length,S.g.length),P=[],N=0,M=0;M<=I;M++){var V=N+(this.i(M)&65535)+(S.i(M)&65535),L=(V>>>16)+(this.i(M)>>>16)+(S.i(M)>>>16);N=L>>>16,V&=65535,L&=65535,P[M]=L<<16|V}return new o(P,P[P.length-1]&-2147483648?-1:0)};function T(S,I){return S.add(A(I))}n.j=function(S){if(w(this)||w(S))return h;if(E(this))return E(S)?A(this).j(A(S)):A(A(this).j(S));if(E(S))return A(this.j(A(S)));if(0>this.l(v)&&0>S.l(v))return c(this.m()*S.m());for(var I=this.g.length+S.g.length,P=[],N=0;N<2*I;N++)P[N]=0;for(N=0;N<this.g.length;N++)for(var M=0;M<S.g.length;M++){var V=this.i(N)>>>16,L=this.i(N)&65535,j=S.i(M)>>>16,oe=S.i(M)&65535;P[2*N+2*M]+=L*oe,_(P,2*N+2*M),P[2*N+2*M+1]+=V*oe,_(P,2*N+2*M+1),P[2*N+2*M+1]+=L*j,_(P,2*N+2*M+1),P[2*N+2*M+2]+=V*j,_(P,2*N+2*M+2)}for(N=0;N<I;N++)P[N]=P[2*N+1]<<16|P[2*N];for(N=I;N<2*I;N++)P[N]=0;return new o(P,0)};function _(S,I){for(;(S[I]&65535)!=S[I];)S[I+1]+=S[I]>>>16,S[I]&=65535,I++}function b(S,I){this.g=S,this.h=I}function g(S,I){if(w(I))throw Error("division by zero");if(w(S))return new b(h,h);if(E(S))return I=g(A(S),I),new b(A(I.g),A(I.h));if(E(I))return I=g(S,A(I)),new b(A(I.g),I.h);if(30<S.g.length){if(E(S)||E(I))throw Error("slowDivide_ only works with positive integers.");for(var P=f,N=I;0>=N.l(S);)P=y(P),N=y(N);var M=x(P,1),V=x(N,1);for(N=x(N,2),P=x(P,2);!w(N);){var L=V.add(N);0>=L.l(S)&&(M=M.add(P),V=L),N=x(N,1),P=x(P,1)}return I=T(S,M.j(I)),new b(M,I)}for(M=h;0<=S.l(I);){for(P=Math.max(1,Math.floor(S.m()/I.m())),N=Math.ceil(Math.log(P)/Math.LN2),N=48>=N?1:Math.pow(2,N-48),V=c(P),L=V.j(I);E(L)||0<L.l(S);)P-=N,V=c(P),L=V.j(I);w(V)&&(V=f),M=M.add(V),S=T(S,L)}return new b(M,S)}n.A=function(S){return g(this,S).h},n.and=function(S){for(var I=Math.max(this.g.length,S.g.length),P=[],N=0;N<I;N++)P[N]=this.i(N)&S.i(N);return new o(P,this.h&S.h)},n.or=function(S){for(var I=Math.max(this.g.length,S.g.length),P=[],N=0;N<I;N++)P[N]=this.i(N)|S.i(N);return new o(P,this.h|S.h)},n.xor=function(S){for(var I=Math.max(this.g.length,S.g.length),P=[],N=0;N<I;N++)P[N]=this.i(N)^S.i(N);return new o(P,this.h^S.h)};function y(S){for(var I=S.g.length+1,P=[],N=0;N<I;N++)P[N]=S.i(N)<<1|S.i(N-1)>>>31;return new o(P,S.h)}function x(S,I){var P=I>>5;I%=32;for(var N=S.g.length-P,M=[],V=0;V<N;V++)M[V]=0<I?S.i(V+P)>>>I|S.i(V+P+1)<<32-I:S.i(V+P);return new o(M,S.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,EF=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,Gh=o}).apply(typeof j2<"u"?j2:typeof self<"u"?self:typeof window<"u"?window:{});var bE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var bF,dy,_F,gb,XT,SF,AF,TF;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(p,C,k){return p==Array.prototype||p==Object.prototype||(p[C]=k.value),p};function t(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof bE=="object"&&bE];for(var C=0;C<p.length;++C){var k=p[C];if(k&&k.Math==Math)return k}throw Error("Cannot find global object")}var r=t(this);function i(p,C){if(C)e:{var k=r;p=p.split(".");for(var U=0;U<p.length-1;U++){var q=p[U];if(!(q in k))break e;k=k[q]}p=p[p.length-1],U=k[p],C=C(U),C!=U&&C!=null&&e(k,p,{configurable:!0,writable:!0,value:C})}}function s(p,C){p instanceof String&&(p+="");var k=0,U=!1,q={next:function(){if(!U&&k<p.length){var J=k++;return{value:C(J,p[J]),done:!1}}return U=!0,{done:!0,value:void 0}}};return q[Symbol.iterator]=function(){return q},q}i("Array.prototype.values",function(p){return p||function(){return s(this,function(C,k){return k})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(p){var C=typeof p;return C=C!="object"?C:p?Array.isArray(p)?"array":C:"null",C=="array"||C=="object"&&typeof p.length=="number"}function c(p){var C=typeof p;return C=="object"&&p!=null||C=="function"}function u(p,C,k){return p.call.apply(p.bind,arguments)}function h(p,C,k){if(!p)throw Error();if(2<arguments.length){var U=Array.prototype.slice.call(arguments,2);return function(){var q=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(q,U),p.apply(C,q)}}return function(){return p.apply(C,arguments)}}function f(p,C,k){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?u:h,f.apply(null,arguments)}function v(p,C){var k=Array.prototype.slice.call(arguments,1);return function(){var U=k.slice();return U.push.apply(U,arguments),p.apply(this,U)}}function w(p,C){function k(){}k.prototype=C.prototype,p.aa=C.prototype,p.prototype=new k,p.prototype.constructor=p,p.Qb=function(U,q,J){for(var Ae=Array(arguments.length-2),wn=2;wn<arguments.length;wn++)Ae[wn-2]=arguments[wn];return C.prototype[q].apply(U,Ae)}}function E(p){const C=p.length;if(0<C){const k=Array(C);for(let U=0;U<C;U++)k[U]=p[U];return k}return[]}function A(p,C){for(let k=1;k<arguments.length;k++){const U=arguments[k];if(l(U)){const q=p.length||0,J=U.length||0;p.length=q+J;for(let Ae=0;Ae<J;Ae++)p[q+Ae]=U[Ae]}else p.push(U)}}class T{constructor(C,k){this.i=C,this.j=k,this.h=0,this.g=null}get(){let C;return 0<this.h?(this.h--,C=this.g,this.g=C.next,C.next=null):C=this.i(),C}}function _(p){return/^[\s\xa0]*$/.test(p)}function b(){var p=a.navigator;return p&&(p=p.userAgent)?p:""}function g(p){return g[" "](p),p}g[" "]=function(){};var y=b().indexOf("Gecko")!=-1&&!(b().toLowerCase().indexOf("webkit")!=-1&&b().indexOf("Edge")==-1)&&!(b().indexOf("Trident")!=-1||b().indexOf("MSIE")!=-1)&&b().indexOf("Edge")==-1;function x(p,C,k){for(const U in p)C.call(k,p[U],U,p)}function S(p,C){for(const k in p)C.call(void 0,p[k],k,p)}function I(p){const C={};for(const k in p)C[k]=p[k];return C}const P="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(p,C){let k,U;for(let q=1;q<arguments.length;q++){U=arguments[q];for(k in U)p[k]=U[k];for(let J=0;J<P.length;J++)k=P[J],Object.prototype.hasOwnProperty.call(U,k)&&(p[k]=U[k])}}function M(p){var C=1;p=p.split(":");const k=[];for(;0<C&&p.length;)k.push(p.shift()),C--;return p.length&&k.push(p.join(":")),k}function V(p){a.setTimeout(()=>{throw p},0)}function L(){var p=Z;let C=null;return p.g&&(C=p.g,p.g=p.g.next,p.g||(p.h=null),C.next=null),C}class j{constructor(){this.h=this.g=null}add(C,k){const U=oe.get();U.set(C,k),this.h?this.h.next=U:this.g=U,this.h=U}}var oe=new T(()=>new $,p=>p.reset());class ${constructor(){this.next=this.g=this.h=null}set(C,k){this.h=C,this.g=k,this.next=null}reset(){this.next=this.g=this.h=null}}let B,G=!1,Z=new j,ee=()=>{const p=a.Promise.resolve(void 0);B=()=>{p.then(fe)}};var fe=()=>{for(var p;p=L();){try{p.h.call(p.g)}catch(k){V(k)}var C=oe;C.j(p),100>C.h&&(C.h++,p.next=C.g,C.g=p)}G=!1};function ae(){this.s=this.s,this.C=this.C}ae.prototype.s=!1,ae.prototype.ma=function(){this.s||(this.s=!0,this.N())},ae.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function _e(p,C){this.type=p,this.g=this.target=C,this.defaultPrevented=!1}_e.prototype.h=function(){this.defaultPrevented=!0};var Qe=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var p=!1,C=Object.defineProperty({},"passive",{get:function(){p=!0}});try{const k=()=>{};a.addEventListener("test",k,C),a.removeEventListener("test",k,C)}catch{}return p}();function Ye(p,C){if(_e.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p){var k=this.type=p.type,U=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;if(this.target=p.target||p.srcElement,this.g=C,C=p.relatedTarget){if(y){e:{try{g(C.nodeName);var q=!0;break e}catch{}q=!1}q||(C=null)}}else k=="mouseover"?C=p.fromElement:k=="mouseout"&&(C=p.toElement);this.relatedTarget=C,U?(this.clientX=U.clientX!==void 0?U.clientX:U.pageX,this.clientY=U.clientY!==void 0?U.clientY:U.pageY,this.screenX=U.screenX||0,this.screenY=U.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=typeof p.pointerType=="string"?p.pointerType:gt[p.pointerType]||"",this.state=p.state,this.i=p,p.defaultPrevented&&Ye.aa.h.call(this)}}w(Ye,_e);var gt={2:"touch",3:"pen",4:"mouse"};Ye.prototype.h=function(){Ye.aa.h.call(this);var p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var ie="closure_listenable_"+(1e6*Math.random()|0),ot=0;function et(p,C,k,U,q){this.listener=p,this.proxy=null,this.src=C,this.type=k,this.capture=!!U,this.ha=q,this.key=++ot,this.da=this.fa=!1}function ze(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function tt(p){this.src=p,this.g={},this.h=0}tt.prototype.add=function(p,C,k,U,q){var J=p.toString();p=this.g[J],p||(p=this.g[J]=[],this.h++);var Ae=Je(p,C,U,q);return-1<Ae?(C=p[Ae],k||(C.fa=!1)):(C=new et(C,this.src,J,!!U,q),C.fa=k,p.push(C)),C};function Xe(p,C){var k=C.type;if(k in p.g){var U=p.g[k],q=Array.prototype.indexOf.call(U,C,void 0),J;(J=0<=q)&&Array.prototype.splice.call(U,q,1),J&&(ze(C),p.g[k].length==0&&(delete p.g[k],p.h--))}}function Je(p,C,k,U){for(var q=0;q<p.length;++q){var J=p[q];if(!J.da&&J.listener==C&&J.capture==!!k&&J.ha==U)return q}return-1}var dt="closure_lm_"+(1e6*Math.random()|0),Ct={};function Ut(p,C,k,U,q){if(Array.isArray(C)){for(var J=0;J<C.length;J++)Ut(p,C[J],k,U,q);return null}return k=Bt(k),p&&p[ie]?p.K(C,k,c(U)?!!U.capture:!1,q):Ir(p,C,k,!1,U,q)}function Ir(p,C,k,U,q,J){if(!C)throw Error("Invalid event type");var Ae=c(q)?!!q.capture:!!q,wn=Be(p);if(wn||(p[dt]=wn=new tt(p)),k=wn.add(C,k,U,Ae,J),k.proxy)return k;if(U=ue(),k.proxy=U,U.src=p,U.listener=k,p.addEventListener)Qe||(q=Ae),q===void 0&&(q=!1),p.addEventListener(C.toString(),U,q);else if(p.attachEvent)p.attachEvent(Tt(C.toString()),U);else if(p.addListener&&p.removeListener)p.addListener(U);else throw Error("addEventListener and attachEvent are unavailable.");return k}function ue(){function p(k){return C.call(p.src,p.listener,k)}const C=Se;return p}function ye(p,C,k,U,q){if(Array.isArray(C))for(var J=0;J<C.length;J++)ye(p,C[J],k,U,q);else U=c(U)?!!U.capture:!!U,k=Bt(k),p&&p[ie]?(p=p.i,C=String(C).toString(),C in p.g&&(J=p.g[C],k=Je(J,k,U,q),-1<k&&(ze(J[k]),Array.prototype.splice.call(J,k,1),J.length==0&&(delete p.g[C],p.h--)))):p&&(p=Be(p))&&(C=p.g[C.toString()],p=-1,C&&(p=Je(C,k,U,q)),(k=-1<p?C[p]:null)&&De(k))}function De(p){if(typeof p!="number"&&p&&!p.da){var C=p.src;if(C&&C[ie])Xe(C.i,p);else{var k=p.type,U=p.proxy;C.removeEventListener?C.removeEventListener(k,U,p.capture):C.detachEvent?C.detachEvent(Tt(k),U):C.addListener&&C.removeListener&&C.removeListener(U),(k=Be(C))?(Xe(k,p),k.h==0&&(k.src=null,C[dt]=null)):ze(p)}}}function Tt(p){return p in Ct?Ct[p]:Ct[p]="on"+p}function Se(p,C){if(p.da)p=!0;else{C=new Ye(C,this);var k=p.listener,U=p.ha||p.src;p.fa&&De(p),p=k.call(U,C)}return p}function Be(p){return p=p[dt],p instanceof tt?p:null}var kt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Bt(p){return typeof p=="function"?p:(p[kt]||(p[kt]=function(C){return p.handleEvent(C)}),p[kt])}function W(){ae.call(this),this.i=new tt(this),this.M=this,this.F=null}w(W,ae),W.prototype[ie]=!0,W.prototype.removeEventListener=function(p,C,k,U){ye(this,p,C,k,U)};function z(p,C){var k,U=p.F;if(U)for(k=[];U;U=U.F)k.push(U);if(p=p.M,U=C.type||C,typeof C=="string")C=new _e(C,p);else if(C instanceof _e)C.target=C.target||p;else{var q=C;C=new _e(U,p),N(C,q)}if(q=!0,k)for(var J=k.length-1;0<=J;J--){var Ae=C.g=k[J];q=le(Ae,U,!0,C)&&q}if(Ae=C.g=p,q=le(Ae,U,!0,C)&&q,q=le(Ae,U,!1,C)&&q,k)for(J=0;J<k.length;J++)Ae=C.g=k[J],q=le(Ae,U,!1,C)&&q}W.prototype.N=function(){if(W.aa.N.call(this),this.i){var p=this.i,C;for(C in p.g){for(var k=p.g[C],U=0;U<k.length;U++)ze(k[U]);delete p.g[C],p.h--}}this.F=null},W.prototype.K=function(p,C,k,U){return this.i.add(String(p),C,!1,k,U)},W.prototype.L=function(p,C,k,U){return this.i.add(String(p),C,!0,k,U)};function le(p,C,k,U){if(C=p.i.g[String(C)],!C)return!0;C=C.concat();for(var q=!0,J=0;J<C.length;++J){var Ae=C[J];if(Ae&&!Ae.da&&Ae.capture==k){var wn=Ae.listener,$r=Ae.ha||Ae.src;Ae.fa&&Xe(p.i,Ae),q=wn.call($r,U)!==!1&&q}}return q&&!U.defaultPrevented}function te(p,C,k){if(typeof p=="function")k&&(p=f(p,k));else if(p&&typeof p.handleEvent=="function")p=f(p.handleEvent,p);else throw Error("Invalid listener argument");return 2147483647<Number(C)?-1:a.setTimeout(p,C||0)}function Ee(p){p.g=te(()=>{p.g=null,p.i&&(p.i=!1,Ee(p))},p.l);const C=p.h;p.h=null,p.m.apply(null,C)}class Et extends ae{constructor(C,k){super(),this.m=C,this.l=k,this.h=null,this.i=!1,this.g=null}j(C){this.h=arguments,this.g?this.i=!0:Ee(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function We(p){ae.call(this),this.h=p,this.g={}}w(We,ae);var de=[];function nt(p){x(p.g,function(C,k){this.g.hasOwnProperty(k)&&De(C)},p),p.g={}}We.prototype.N=function(){We.aa.N.call(this),nt(this)},We.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var At=a.JSON.stringify,it=a.JSON.parse,Nt=class{stringify(p){return a.JSON.stringify(p,void 0)}parse(p){return a.JSON.parse(p,void 0)}};function at(){}at.prototype.h=null;function bt(p){return p.h||(p.h=p.i())}function lt(){}var ft={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function bi(){_e.call(this,"d")}w(bi,_e);function Kt(){_e.call(this,"c")}w(Kt,_e);var gn={},Y=null;function re(){return Y=Y||new W}gn.La="serverreachability";function pe(p){_e.call(this,gn.La,p)}w(pe,_e);function Te(p){const C=re();z(C,new pe(C))}gn.STAT_EVENT="statevent";function yt(p,C){_e.call(this,gn.STAT_EVENT,p),this.stat=C}w(yt,_e);function xe(p){const C=re();z(C,new yt(C,p))}gn.Ma="timingevent";function Ze(p,C){_e.call(this,gn.Ma,p),this.size=C}w(Ze,_e);function $e(p,C){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){p()},C)}function Ce(){this.g=!0}Ce.prototype.xa=function(){this.g=!1};function Ve(p,C,k,U,q,J){p.info(function(){if(p.g)if(J)for(var Ae="",wn=J.split("&"),$r=0;$r<wn.length;$r++){var qt=wn[$r].split("=");if(1<qt.length){var ni=qt[0];qt=qt[1];var ri=ni.split("_");Ae=2<=ri.length&&ri[1]=="type"?Ae+(ni+"="+qt+"&"):Ae+(ni+"=redacted&")}}else Ae=null;else Ae=J;return"XMLHTTP REQ ("+U+") [attempt "+q+"]: "+C+`
`+k+`
`+Ae})}function He(p,C,k,U,q,J,Ae){p.info(function(){return"XMLHTTP RESP ("+U+") [ attempt "+q+"]: "+C+`
`+k+`
`+J+" "+Ae})}function ve(p,C,k,U){p.info(function(){return"XMLHTTP TEXT ("+C+"): "+Vt(p,k)+(U?" "+U:"")})}function an(p,C){p.info(function(){return"TIMEOUT: "+C})}Ce.prototype.info=function(){};function Vt(p,C){if(!p.g)return C;if(!C)return null;try{var k=JSON.parse(C);if(k){for(p=0;p<k.length;p++)if(Array.isArray(k[p])){var U=k[p];if(!(2>U.length)){var q=U[1];if(Array.isArray(q)&&!(1>q.length)){var J=q[0];if(J!="noop"&&J!="stop"&&J!="close")for(var Ae=1;Ae<q.length;Ae++)q[Ae]=""}}}}return At(k)}catch{return C}}var yn={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ar={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Hn;function vn(){}w(vn,at),vn.prototype.g=function(){return new XMLHttpRequest},vn.prototype.i=function(){return{}},Hn=new vn;function qs(p,C,k,U){this.j=p,this.i=C,this.l=k,this.R=U||1,this.U=new We(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ks}function Ks(){this.i=null,this.g="",this.h=!1}var Ya={},Tf={};function ld(p,C,k){p.L=1,p.v=Eo(ln(C)),p.m=k,p.P=!0,cd(p,null)}function cd(p,C){p.F=Date.now(),If(p),p.A=ln(p.v);var k=p.A,U=p.R;Array.isArray(U)||(U=[String(U)]),Qt(k.i,"t",U),p.C=0,k=p.j.J,p.h=new Ks,p.g=a2(p.j,k?C:null,!p.m),0<p.O&&(p.M=new Et(f(p.Y,p,p.g),p.O)),C=p.U,k=p.g,U=p.ca;var q="readystatechange";Array.isArray(q)||(q&&(de[0]=q.toString()),q=de);for(var J=0;J<q.length;J++){var Ae=Ut(k,q[J],U||C.handleEvent,!1,C.h||C);if(!Ae)break;C.g[Ae.key]=Ae}C=p.H?I(p.H):{},p.m?(p.u||(p.u="POST"),C["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.A,p.u,p.m,C)):(p.u="GET",p.g.ea(p.A,p.u,null,C)),Te(),Ve(p.i,p.u,p.A,p.l,p.R,p.m)}qs.prototype.ca=function(p){p=p.target;const C=this.M;C&&Xa(p)==3?C.j():this.Y(p)},qs.prototype.Y=function(p){try{if(p==this.g)e:{const ri=Xa(this.g);var C=this.g.Ba();const Df=this.g.Z();if(!(3>ri)&&(ri!=3||this.g&&(this.h.h||this.g.oa()||Qk(this.g)))){this.J||ri!=4||C==7||(C==8||0>=Df?Te(3):Te(2)),Mg(this);var k=this.g.Z();this.X=k;t:if(fc(this)){var U=Qk(this.g);p="";var q=U.length,J=Xa(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ea(this),Qa(this);var Ae="";break t}this.h.i=new a.TextDecoder}for(C=0;C<q;C++)this.h.h=!0,p+=this.h.i.decode(U[C],{stream:!(J&&C==q-1)});U.length=0,this.h.g+=p,this.C=0,Ae=this.h.g}else Ae=this.g.oa();if(this.o=k==200,He(this.i,this.u,this.A,this.l,this.R,ri,k),this.o){if(this.T&&!this.K){t:{if(this.g){var wn,$r=this.g;if((wn=$r.g?$r.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(wn)){var qt=wn;break t}}qt=null}if(k=qt)ve(this.i,this.l,k,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,xf(this,k);else{this.o=!1,this.s=3,xe(12),ea(this),Qa(this);break e}}if(this.P){k=!0;let _o;for(;!this.J&&this.C<Ae.length;)if(_o=m1(this,Ae),_o==Tf){ri==4&&(this.s=4,xe(14),k=!1),ve(this.i,this.l,null,"[Incomplete Response]");break}else if(_o==Ya){this.s=4,xe(15),ve(this.i,this.l,Ae,"[Invalid Chunk]"),k=!1;break}else ve(this.i,this.l,_o,null),xf(this,_o);if(fc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ri!=4||Ae.length!=0||this.h.h||(this.s=1,xe(16),k=!1),this.o=this.o&&k,!k)ve(this.i,this.l,Ae,"[Invalid Chunked Response]"),ea(this),Qa(this);else if(0<Ae.length&&!this.W){this.W=!0;var ni=this.j;ni.g==this&&ni.ba&&!ni.M&&(ni.j.info("Great, no buffering proxy detected. Bytes received: "+Ae.length),_1(ni),ni.M=!0,xe(11))}}else ve(this.i,this.l,Ae,null),xf(this,Ae);ri==4&&ea(this),this.o&&!this.J&&(ri==4?r2(this.j,this):(this.o=!1,If(this)))}else P6(this.g),k==400&&0<Ae.indexOf("Unknown SID")?(this.s=3,xe(12)):(this.s=0,xe(13)),ea(this),Qa(this)}}}catch{}finally{}};function fc(p){return p.g?p.u=="GET"&&p.L!=2&&p.j.Ca:!1}function m1(p,C){var k=p.C,U=C.indexOf(`
`,k);return U==-1?Tf:(k=Number(C.substring(k,U)),isNaN(k)?Ya:(U+=1,U+k>C.length?Tf:(C=C.slice(U,U+k),p.C=U+k,C)))}qs.prototype.cancel=function(){this.J=!0,ea(this)};function If(p){p.S=Date.now()+p.I,cE(p,p.I)}function cE(p,C){if(p.B!=null)throw Error("WatchDog timer not null");p.B=$e(f(p.ba,p),C)}function Mg(p){p.B&&(a.clearTimeout(p.B),p.B=null)}qs.prototype.ba=function(){this.B=null;const p=Date.now();0<=p-this.S?(an(this.i,this.A),this.L!=2&&(Te(),xe(17)),ea(this),this.s=2,Qa(this)):cE(this,this.S-p)};function Qa(p){p.j.G==0||p.J||r2(p.j,p)}function ea(p){Mg(p);var C=p.M;C&&typeof C.ma=="function"&&C.ma(),p.M=null,nt(p.U),p.g&&(C=p.g,p.g=null,C.abort(),C.ma())}function xf(p,C){try{var k=p.j;if(k.G!=0&&(k.g==p||Ng(k.h,p))){if(!p.K&&Ng(k.h,p)&&k.G==3){try{var U=k.Da.g.parse(C)}catch{U=null}if(Array.isArray(U)&&U.length==3){var q=U;if(q[0]==0){e:if(!k.u){if(k.g)if(k.g.F+3e3<p.F)yE(k),mE(k);else break e;b1(k),xe(18)}}else k.za=q[1],0<k.za-k.T&&37500>q[2]&&k.F&&k.v==0&&!k.C&&(k.C=$e(f(k.Za,k),6e3));if(1>=Cf(k.h)&&k.ca){try{k.ca()}catch{}k.ca=void 0}}else fd(k,11)}else if((p.K||k.g==p)&&yE(k),!_(C))for(q=k.Da.g.parse(C),C=0;C<q.length;C++){let qt=q[C];if(k.T=qt[0],qt=qt[1],k.G==2)if(qt[0]=="c"){k.K=qt[1],k.ia=qt[2];const ni=qt[3];ni!=null&&(k.la=ni,k.j.info("VER="+k.la));const ri=qt[4];ri!=null&&(k.Aa=ri,k.j.info("SVER="+k.Aa));const Df=qt[5];Df!=null&&typeof Df=="number"&&0<Df&&(U=1.5*Df,k.L=U,k.j.info("backChannelRequestTimeoutMs_="+U)),U=k;const _o=p.g;if(_o){const wE=_o.g?_o.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(wE){var J=U.h;J.g||wE.indexOf("spdy")==-1&&wE.indexOf("quic")==-1&&wE.indexOf("h2")==-1||(J.j=J.l,J.g=new Set,J.h&&(Lg(J,J.h),J.h=null))}if(U.D){const S1=_o.g?_o.g.getResponseHeader("X-HTTP-Session-Id"):null;S1&&(U.ya=S1,Wt(U.I,U.D,S1))}}k.G=3,k.l&&k.l.ua(),k.ba&&(k.R=Date.now()-p.F,k.j.info("Handshake RTT: "+k.R+"ms")),U=k;var Ae=p;if(U.qa=o2(U,U.J?U.ia:null,U.W),Ae.K){Og(U.h,Ae);var wn=Ae,$r=U.L;$r&&(wn.I=$r),wn.B&&(Mg(wn),If(wn)),U.g=Ae}else t2(U);0<k.i.length&&gE(k)}else qt[0]!="stop"&&qt[0]!="close"||fd(k,7);else k.G==3&&(qt[0]=="stop"||qt[0]=="close"?qt[0]=="stop"?fd(k,7):E1(k):qt[0]!="noop"&&k.l&&k.l.ta(qt),k.v=0)}}Te(4)}catch{}}var g1=class{constructor(p,C){this.g=p,this.map=C}};function ud(p){this.l=p||10,a.PerformanceNavigationTiming?(p=a.performance.getEntriesByType("navigation"),p=0<p.length&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function uE(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function Cf(p){return p.h?1:p.g?p.g.size:0}function Ng(p,C){return p.h?p.h==C:p.g?p.g.has(C):!1}function Lg(p,C){p.g?p.g.add(C):p.h=C}function Og(p,C){p.h&&p.h==C?p.h=null:p.g&&p.g.has(C)&&p.g.delete(C)}ud.prototype.cancel=function(){if(this.i=dE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const p of this.g.values())p.cancel();this.g.clear()}};function dE(p){if(p.h!=null)return p.i.concat(p.h.D);if(p.g!=null&&p.g.size!==0){let C=p.i;for(const k of p.g.values())C=C.concat(k.D);return C}return E(p.i)}function hE(p){if(p.V&&typeof p.V=="function")return p.V();if(typeof Map<"u"&&p instanceof Map||typeof Set<"u"&&p instanceof Set)return Array.from(p.values());if(typeof p=="string")return p.split("");if(l(p)){for(var C=[],k=p.length,U=0;U<k;U++)C.push(p[U]);return C}C=[],k=0;for(U in p)C[k++]=p[U];return C}function fE(p){if(p.na&&typeof p.na=="function")return p.na();if(!p.V||typeof p.V!="function"){if(typeof Map<"u"&&p instanceof Map)return Array.from(p.keys());if(!(typeof Set<"u"&&p instanceof Set)){if(l(p)||typeof p=="string"){var C=[];p=p.length;for(var k=0;k<p;k++)C.push(k);return C}C=[],k=0;for(const U in p)C[k++]=U;return C}}}function H(p,C){if(p.forEach&&typeof p.forEach=="function")p.forEach(C,void 0);else if(l(p)||typeof p=="string")Array.prototype.forEach.call(p,C,void 0);else for(var k=fE(p),U=hE(p),q=U.length,J=0;J<q;J++)C.call(void 0,U[J],k&&k[J],p)}var me=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ke(p,C){if(p){p=p.split("&");for(var k=0;k<p.length;k++){var U=p[k].indexOf("="),q=null;if(0<=U){var J=p[k].substring(0,U);q=p[k].substring(U+1)}else J=p[k];C(J,q?decodeURIComponent(q.replace(/\+/g," ")):"")}}}function Pe(p){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,p instanceof Pe){this.h=p.h,lr(this,p.j),this.o=p.o,this.g=p.g,cs(this,p.s),this.l=p.l;var C=p.i,k=new dd;k.i=C.i,C.g&&(k.g=new Map(C.g),k.h=C.h),ta(this,k),this.m=p.m}else p&&(C=String(p).match(me))?(this.h=!1,lr(this,C[1]||"",!0),this.o=us(C[2]||""),this.g=us(C[3]||"",!0),cs(this,C[4]),this.l=us(C[5]||"",!0),ta(this,C[6]||"",!0),this.m=us(C[7]||"")):(this.h=!1,this.i=new dd(null,this.h))}Pe.prototype.toString=function(){var p=[],C=this.j;C&&p.push(Xn(C,pc,!0),":");var k=this.g;return(k||C=="file")&&(p.push("//"),(C=this.o)&&p.push(Xn(C,pc,!0),"@"),p.push(encodeURIComponent(String(k)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),k=this.s,k!=null&&p.push(":",String(k))),(k=this.l)&&(this.g&&k.charAt(0)!="/"&&p.push("/"),p.push(Xn(k,k.charAt(0)=="/"?xr:_i,!0))),(k=this.i.toString())&&p.push("?",k),(k=this.m)&&p.push("#",Xn(k,Pf)),p.join("")};function ln(p){return new Pe(p)}function lr(p,C,k){p.j=k?us(C,!0):C,p.j&&(p.j=p.j.replace(/:$/,""))}function cs(p,C){if(C){if(C=Number(C),isNaN(C)||0>C)throw Error("Bad port number "+C);p.s=C}else p.s=null}function ta(p,C,k){C instanceof dd?(p.i=C,mr(p.i,p.h)):(k||(C=Xn(C,mc)),p.i=new dd(C,p.h))}function Wt(p,C,k){p.i.set(C,k)}function Eo(p){return Wt(p,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),p}function us(p,C){return p?C?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function Xn(p,C,k){return typeof p=="string"?(p=encodeURI(p).replace(C,Ys),k&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function Ys(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var pc=/[#\/\?@]/g,_i=/[#\?:]/g,xr=/[#\?]/g,mc=/[#\?@]/g,Pf=/#/g;function dd(p,C){this.h=this.g=null,this.i=p||null,this.j=!!C}function na(p){p.g||(p.g=new Map,p.h=0,p.i&&ke(p.i,function(C,k){p.add(decodeURIComponent(C.replace(/\+/g," ")),k)}))}n=dd.prototype,n.add=function(p,C){na(this),this.i=null,p=pt(this,p);var k=this.g.get(p);return k||this.g.set(p,k=[]),k.push(C),this.h+=1,this};function ht(p,C){na(p),C=pt(p,C),p.g.has(C)&&(p.i=null,p.h-=p.g.get(C).length,p.g.delete(C))}function ti(p,C){return na(p),C=pt(p,C),p.g.has(C)}n.forEach=function(p,C){na(this),this.g.forEach(function(k,U){k.forEach(function(q){p.call(C,q,U,this)},this)},this)},n.na=function(){na(this);const p=Array.from(this.g.values()),C=Array.from(this.g.keys()),k=[];for(let U=0;U<C.length;U++){const q=p[U];for(let J=0;J<q.length;J++)k.push(C[U])}return k},n.V=function(p){na(this);let C=[];if(typeof p=="string")ti(this,p)&&(C=C.concat(this.g.get(pt(this,p))));else{p=Array.from(this.g.values());for(let k=0;k<p.length;k++)C=C.concat(p[k])}return C},n.set=function(p,C){return na(this),this.i=null,p=pt(this,p),ti(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[C]),this.h+=1,this},n.get=function(p,C){return p?(p=this.V(p),0<p.length?String(p[0]):C):C};function Qt(p,C,k){ht(p,C),0<k.length&&(p.i=null,p.g.set(pt(p,C),E(k)),p.h+=k.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const p=[],C=Array.from(this.g.keys());for(var k=0;k<C.length;k++){var U=C[k];const J=encodeURIComponent(String(U)),Ae=this.V(U);for(U=0;U<Ae.length;U++){var q=J;Ae[U]!==""&&(q+="="+encodeURIComponent(String(Ae[U]))),p.push(q)}}return this.i=p.join("&")};function pt(p,C){return C=String(C),p.j&&(C=C.toLowerCase()),C}function mr(p,C){C&&!p.j&&(na(p),p.i=null,p.g.forEach(function(k,U){var q=U.toLowerCase();U!=q&&(ht(this,U),Qt(this,q,k))},p)),p.j=C}function ra(p,C){const k=new Ce;if(a.Image){const U=new Image;U.onload=v(ia,k,"TestLoadImage: loaded",!0,C,U),U.onerror=v(ia,k,"TestLoadImage: error",!1,C,U),U.onabort=v(ia,k,"TestLoadImage: abort",!1,C,U),U.ontimeout=v(ia,k,"TestLoadImage: timeout",!1,C,U),a.setTimeout(function(){U.ontimeout&&U.ontimeout()},1e4),U.src=p}else C(!1)}function Fg(p,C){const k=new Ce,U=new AbortController,q=setTimeout(()=>{U.abort(),ia(k,"TestPingServer: timeout",!1,C)},1e4);fetch(p,{signal:U.signal}).then(J=>{clearTimeout(q),J.ok?ia(k,"TestPingServer: ok",!0,C):ia(k,"TestPingServer: server error",!1,C)}).catch(()=>{clearTimeout(q),ia(k,"TestPingServer: error",!1,C)})}function ia(p,C,k,U,q){try{q&&(q.onload=null,q.onerror=null,q.onabort=null,q.ontimeout=null),U(k)}catch{}}function y1(){this.g=new Nt}function v1(p,C,k){const U=k||"";try{H(p,function(q,J){let Ae=q;c(q)&&(Ae=At(q)),C.push(U+J+"="+encodeURIComponent(Ae))})}catch(q){throw C.push(U+"type="+encodeURIComponent("_badmap")),q}}function Rf(p){this.l=p.Ub||null,this.j=p.eb||!1}w(Rf,at),Rf.prototype.g=function(){return new hd(this.l,this.j)},Rf.prototype.i=function(p){return function(){return p}}({});function hd(p,C){W.call(this),this.D=p,this.o=C,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(hd,W),n=hd.prototype,n.open=function(p,C){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=p,this.A=C,this.readyState=1,Vg(this)},n.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const C={headers:this.u,method:this.B,credentials:this.m,cache:void 0};p&&(C.body=p),(this.D||a).fetch(new Request(this.A,C)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,bo(this)),this.readyState=0},n.Sa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,Vg(this)),this.g&&(this.readyState=3,Vg(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ds(this)}else p.text().then(this.Ra.bind(this),this.ga.bind(this))};function ds(p){p.j.read().then(p.Pa.bind(p)).catch(p.ga.bind(p))}n.Pa=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var C=p.value?p.value:new Uint8Array(0);(C=this.v.decode(C,{stream:!p.done}))&&(this.response=this.responseText+=C)}p.done?bo(this):Vg(this),this.readyState==3&&ds(this)}},n.Ra=function(p){this.g&&(this.response=this.responseText=p,bo(this))},n.Qa=function(p){this.g&&(this.response=p,bo(this))},n.ga=function(){this.g&&bo(this)};function bo(p){p.readyState=4,p.l=null,p.j=null,p.v=null,Vg(p)}n.setRequestHeader=function(p,C){this.u.append(p,C)},n.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const p=[],C=this.h.entries();for(var k=C.next();!k.done;)k=k.value,p.push(k[0]+": "+k[1]),k=C.next();return p.join(`\r
`)};function Vg(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(hd.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function Gk(p){let C="";return x(p,function(k,U){C+=U,C+=":",C+=k,C+=`\r
`}),C}function w1(p,C,k){e:{for(U in k){var U=!1;break e}U=!0}U||(k=Gk(k),typeof p=="string"?k!=null&&encodeURIComponent(String(k)):Wt(p,C,k))}function Gn(p){W.call(this),this.headers=new Map,this.o=p||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(Gn,W);var x6=/^https?$/i,C6=["POST","PUT"];n=Gn.prototype,n.Ha=function(p){this.J=p},n.ea=function(p,C,k,U){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);C=C?C.toUpperCase():"GET",this.D=p,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Hn.g(),this.v=this.o?bt(this.o):bt(Hn),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(C,String(p),!0),this.B=!1}catch(J){Wk(this,J);return}if(p=k||"",k=new Map(this.headers),U)if(Object.getPrototypeOf(U)===Object.prototype)for(var q in U)k.set(q,U[q]);else if(typeof U.keys=="function"&&typeof U.get=="function")for(const J of U.keys())k.set(J,U.get(J));else throw Error("Unknown input type for opt_headers: "+String(U));U=Array.from(k.keys()).find(J=>J.toLowerCase()=="content-type"),q=a.FormData&&p instanceof a.FormData,!(0<=Array.prototype.indexOf.call(C6,C,void 0))||U||q||k.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[J,Ae]of k)this.g.setRequestHeader(J,Ae);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Yk(this),this.u=!0,this.g.send(p),this.u=!1}catch(J){Wk(this,J)}};function Wk(p,C){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=C,p.m=5,qk(p),pE(p)}function qk(p){p.A||(p.A=!0,z(p,"complete"),z(p,"error"))}n.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=p||7,z(this,"complete"),z(this,"abort"),pE(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),pE(this,!0)),Gn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Kk(this):this.bb())},n.bb=function(){Kk(this)};function Kk(p){if(p.h&&typeof o<"u"&&(!p.v[1]||Xa(p)!=4||p.Z()!=2)){if(p.u&&Xa(p)==4)te(p.Ea,0,p);else if(z(p,"readystatechange"),Xa(p)==4){p.h=!1;try{const Ae=p.Z();e:switch(Ae){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var C=!0;break e;default:C=!1}var k;if(!(k=C)){var U;if(U=Ae===0){var q=String(p.D).match(me)[1]||null;!q&&a.self&&a.self.location&&(q=a.self.location.protocol.slice(0,-1)),U=!x6.test(q?q.toLowerCase():"")}k=U}if(k)z(p,"complete"),z(p,"success");else{p.m=6;try{var J=2<Xa(p)?p.g.statusText:""}catch{J=""}p.l=J+" ["+p.Z()+"]",qk(p)}}finally{pE(p)}}}}function pE(p,C){if(p.g){Yk(p);const k=p.g,U=p.v[0]?()=>{}:null;p.g=null,p.v=null,C||z(p,"ready");try{k.onreadystatechange=U}catch{}}}function Yk(p){p.I&&(a.clearTimeout(p.I),p.I=null)}n.isActive=function(){return!!this.g};function Xa(p){return p.g?p.g.readyState:0}n.Z=function(){try{return 2<Xa(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(p){if(this.g){var C=this.g.responseText;return p&&C.indexOf(p)==0&&(C=C.substring(p.length)),it(C)}};function Qk(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.H){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function P6(p){const C={};p=(p.g&&2<=Xa(p)&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let U=0;U<p.length;U++){if(_(p[U]))continue;var k=M(p[U]);const q=k[0];if(k=k[1],typeof k!="string")continue;k=k.trim();const J=C[q]||[];C[q]=J,J.push(k)}S(C,function(U){return U.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ug(p,C,k){return k&&k.internalChannelParams&&k.internalChannelParams[p]||C}function Xk(p){this.Aa=0,this.i=[],this.j=new Ce,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ug("failFast",!1,p),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ug("baseRetryDelayMs",5e3,p),this.cb=Ug("retryDelaySeedMs",1e4,p),this.Wa=Ug("forwardChannelMaxRetries",2,p),this.wa=Ug("forwardChannelRequestTimeoutMs",2e4,p),this.pa=p&&p.xmlHttpFactory||void 0,this.Xa=p&&p.Tb||void 0,this.Ca=p&&p.useFetchStreams||!1,this.L=void 0,this.J=p&&p.supportsCrossDomainXhr||!1,this.K="",this.h=new ud(p&&p.concurrentRequestLimit),this.Da=new y1,this.P=p&&p.fastHandshake||!1,this.O=p&&p.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=p&&p.Rb||!1,p&&p.xa&&this.j.xa(),p&&p.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&p&&p.detectBufferingProxy||!1,this.ja=void 0,p&&p.longPollingTimeout&&0<p.longPollingTimeout&&(this.ja=p.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Xk.prototype,n.la=8,n.G=1,n.connect=function(p,C,k,U){xe(0),this.W=p,this.H=C||{},k&&U!==void 0&&(this.H.OSID=k,this.H.OAID=U),this.F=this.X,this.I=o2(this,null,this.W),gE(this)};function E1(p){if(Jk(p),p.G==3){var C=p.U++,k=ln(p.I);if(Wt(k,"SID",p.K),Wt(k,"RID",C),Wt(k,"TYPE","terminate"),Bg(p,k),C=new qs(p,p.j,C),C.L=2,C.v=Eo(ln(k)),k=!1,a.navigator&&a.navigator.sendBeacon)try{k=a.navigator.sendBeacon(C.v.toString(),"")}catch{}!k&&a.Image&&(new Image().src=C.v,k=!0),k||(C.g=a2(C.j,null),C.g.ea(C.v)),C.F=Date.now(),If(C)}s2(p)}function mE(p){p.g&&(_1(p),p.g.cancel(),p.g=null)}function Jk(p){mE(p),p.u&&(a.clearTimeout(p.u),p.u=null),yE(p),p.h.cancel(),p.s&&(typeof p.s=="number"&&a.clearTimeout(p.s),p.s=null)}function gE(p){if(!uE(p.h)&&!p.s){p.s=!0;var C=p.Ga;B||ee(),G||(B(),G=!0),Z.add(C,p),p.B=0}}function R6(p,C){return Cf(p.h)>=p.h.j-(p.s?1:0)?!1:p.s?(p.i=C.D.concat(p.i),!0):p.G==1||p.G==2||p.B>=(p.Va?0:p.Wa)?!1:(p.s=$e(f(p.Ga,p,C),i2(p,p.B)),p.B++,!0)}n.Ga=function(p){if(this.s)if(this.s=null,this.G==1){if(!p){this.U=Math.floor(1e5*Math.random()),p=this.U++;const q=new qs(this,this.j,p);let J=this.o;if(this.S&&(J?(J=I(J),N(J,this.S)):J=this.S),this.m!==null||this.O||(q.H=J,J=null),this.P)e:{for(var C=0,k=0;k<this.i.length;k++){t:{var U=this.i[k];if("__data__"in U.map&&(U=U.map.__data__,typeof U=="string")){U=U.length;break t}U=void 0}if(U===void 0)break;if(C+=U,4096<C){C=k;break e}if(C===4096||k===this.i.length-1){C=k+1;break e}}C=1e3}else C=1e3;C=e2(this,q,C),k=ln(this.I),Wt(k,"RID",p),Wt(k,"CVER",22),this.D&&Wt(k,"X-HTTP-Session-Id",this.D),Bg(this,k),J&&(this.O?C="headers="+encodeURIComponent(String(Gk(J)))+"&"+C:this.m&&w1(k,this.m,J)),Lg(this.h,q),this.Ua&&Wt(k,"TYPE","init"),this.P?(Wt(k,"$req",C),Wt(k,"SID","null"),q.T=!0,ld(q,k,null)):ld(q,k,C),this.G=2}}else this.G==3&&(p?Zk(this,p):this.i.length==0||uE(this.h)||Zk(this))};function Zk(p,C){var k;C?k=C.l:k=p.U++;const U=ln(p.I);Wt(U,"SID",p.K),Wt(U,"RID",k),Wt(U,"AID",p.T),Bg(p,U),p.m&&p.o&&w1(U,p.m,p.o),k=new qs(p,p.j,k,p.B+1),p.m===null&&(k.H=p.o),C&&(p.i=C.D.concat(p.i)),C=e2(p,k,1e3),k.I=Math.round(.5*p.wa)+Math.round(.5*p.wa*Math.random()),Lg(p.h,k),ld(k,U,C)}function Bg(p,C){p.H&&x(p.H,function(k,U){Wt(C,U,k)}),p.l&&H({},function(k,U){Wt(C,U,k)})}function e2(p,C,k){k=Math.min(p.i.length,k);var U=p.l?f(p.l.Na,p.l,p):null;e:{var q=p.i;let J=-1;for(;;){const Ae=["count="+k];J==-1?0<k?(J=q[0].g,Ae.push("ofs="+J)):J=0:Ae.push("ofs="+J);let wn=!0;for(let $r=0;$r<k;$r++){let qt=q[$r].g;const ni=q[$r].map;if(qt-=J,0>qt)J=Math.max(0,q[$r].g-100),wn=!1;else try{v1(ni,Ae,"req"+qt+"_")}catch{U&&U(ni)}}if(wn){U=Ae.join("&");break e}}}return p=p.i.splice(0,k),C.D=p,U}function t2(p){if(!p.g&&!p.u){p.Y=1;var C=p.Fa;B||ee(),G||(B(),G=!0),Z.add(C,p),p.v=0}}function b1(p){return p.g||p.u||3<=p.v?!1:(p.Y++,p.u=$e(f(p.Fa,p),i2(p,p.v)),p.v++,!0)}n.Fa=function(){if(this.u=null,n2(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var p=2*this.R;this.j.info("BP detection timer enabled: "+p),this.A=$e(f(this.ab,this),p)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,xe(10),mE(this),n2(this))};function _1(p){p.A!=null&&(a.clearTimeout(p.A),p.A=null)}function n2(p){p.g=new qs(p,p.j,"rpc",p.Y),p.m===null&&(p.g.H=p.o),p.g.O=0;var C=ln(p.qa);Wt(C,"RID","rpc"),Wt(C,"SID",p.K),Wt(C,"AID",p.T),Wt(C,"CI",p.F?"0":"1"),!p.F&&p.ja&&Wt(C,"TO",p.ja),Wt(C,"TYPE","xmlhttp"),Bg(p,C),p.m&&p.o&&w1(C,p.m,p.o),p.L&&(p.g.I=p.L);var k=p.g;p=p.ia,k.L=1,k.v=Eo(ln(C)),k.m=null,k.P=!0,cd(k,p)}n.Za=function(){this.C!=null&&(this.C=null,mE(this),b1(this),xe(19))};function yE(p){p.C!=null&&(a.clearTimeout(p.C),p.C=null)}function r2(p,C){var k=null;if(p.g==C){yE(p),_1(p),p.g=null;var U=2}else if(Ng(p.h,C))k=C.D,Og(p.h,C),U=1;else return;if(p.G!=0){if(C.o)if(U==1){k=C.m?C.m.length:0,C=Date.now()-C.F;var q=p.B;U=re(),z(U,new Ze(U,k)),gE(p)}else t2(p);else if(q=C.s,q==3||q==0&&0<C.X||!(U==1&&R6(p,C)||U==2&&b1(p)))switch(k&&0<k.length&&(C=p.h,C.i=C.i.concat(k)),q){case 1:fd(p,5);break;case 4:fd(p,10);break;case 3:fd(p,6);break;default:fd(p,2)}}}function i2(p,C){let k=p.Ta+Math.floor(Math.random()*p.cb);return p.isActive()||(k*=2),k*C}function fd(p,C){if(p.j.info("Error code "+C),C==2){var k=f(p.fb,p),U=p.Xa;const q=!U;U=new Pe(U||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||lr(U,"https"),Eo(U),q?ra(U.toString(),k):Fg(U.toString(),k)}else xe(2);p.G=0,p.l&&p.l.sa(C),s2(p),Jk(p)}n.fb=function(p){p?(this.j.info("Successfully pinged google.com"),xe(2)):(this.j.info("Failed to ping google.com"),xe(1))};function s2(p){if(p.G=0,p.ka=[],p.l){const C=dE(p.h);(C.length!=0||p.i.length!=0)&&(A(p.ka,C),A(p.ka,p.i),p.h.i.length=0,E(p.i),p.i.length=0),p.l.ra()}}function o2(p,C,k){var U=k instanceof Pe?ln(k):new Pe(k);if(U.g!="")C&&(U.g=C+"."+U.g),cs(U,U.s);else{var q=a.location;U=q.protocol,C=C?C+"."+q.hostname:q.hostname,q=+q.port;var J=new Pe(null);U&&lr(J,U),C&&(J.g=C),q&&cs(J,q),k&&(J.l=k),U=J}return k=p.D,C=p.ya,k&&C&&Wt(U,k,C),Wt(U,"VER",p.la),Bg(p,U),U}function a2(p,C,k){if(C&&!p.J)throw Error("Can't create secondary domain capable XhrIo object.");return C=p.Ca&&!p.pa?new Gn(new Rf({eb:k})):new Gn(p.pa),C.Ha(p.J),C}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function l2(){}n=l2.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function vE(){}vE.prototype.g=function(p,C){return new hs(p,C)};function hs(p,C){W.call(this),this.g=new Xk(C),this.l=p,this.h=C&&C.messageUrlParams||null,p=C&&C.messageHeaders||null,C&&C.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=C&&C.initMessageHeaders||null,C&&C.messageContentType&&(p?p["X-WebChannel-Content-Type"]=C.messageContentType:p={"X-WebChannel-Content-Type":C.messageContentType}),C&&C.va&&(p?p["X-WebChannel-Client-Profile"]=C.va:p={"X-WebChannel-Client-Profile":C.va}),this.g.S=p,(p=C&&C.Sb)&&!_(p)&&(this.g.m=p),this.v=C&&C.supportsCrossDomainXhr||!1,this.u=C&&C.sendRawJson||!1,(C=C&&C.httpSessionIdParam)&&!_(C)&&(this.g.D=C,p=this.h,p!==null&&C in p&&(p=this.h,C in p&&delete p[C])),this.j=new kf(this)}w(hs,W),hs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},hs.prototype.close=function(){E1(this.g)},hs.prototype.o=function(p){var C=this.g;if(typeof p=="string"){var k={};k.__data__=p,p=k}else this.u&&(k={},k.__data__=At(p),p=k);C.i.push(new g1(C.Ya++,p)),C.G==3&&gE(C)},hs.prototype.N=function(){this.g.l=null,delete this.j,E1(this.g),delete this.g,hs.aa.N.call(this)};function c2(p){bi.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var C=p.__sm__;if(C){e:{for(const k in C){p=k;break e}p=void 0}(this.i=p)&&(p=this.i,C=C!==null&&p in C?C[p]:void 0),this.data=C}else this.data=p}w(c2,bi);function u2(){Kt.call(this),this.status=1}w(u2,Kt);function kf(p){this.g=p}w(kf,l2),kf.prototype.ua=function(){z(this.g,"a")},kf.prototype.ta=function(p){z(this.g,new c2(p))},kf.prototype.sa=function(p){z(this.g,new u2)},kf.prototype.ra=function(){z(this.g,"b")},vE.prototype.createWebChannel=vE.prototype.g,hs.prototype.send=hs.prototype.o,hs.prototype.open=hs.prototype.m,hs.prototype.close=hs.prototype.close,TF=function(){return new vE},AF=function(){return re()},SF=gn,XT={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},yn.NO_ERROR=0,yn.TIMEOUT=8,yn.HTTP_ERROR=6,gb=yn,ar.COMPLETE="complete",_F=ar,lt.EventType=ft,ft.OPEN="a",ft.CLOSE="b",ft.ERROR="c",ft.MESSAGE="d",W.prototype.listen=W.prototype.K,dy=lt,Gn.prototype.listenOnce=Gn.prototype.L,Gn.prototype.getLastError=Gn.prototype.Ka,Gn.prototype.getLastErrorCode=Gn.prototype.Ba,Gn.prototype.getStatus=Gn.prototype.Z,Gn.prototype.getResponseJson=Gn.prototype.Oa,Gn.prototype.getResponseText=Gn.prototype.oa,Gn.prototype.send=Gn.prototype.ea,Gn.prototype.setWithCredentials=Gn.prototype.Ha,bF=Gn}).apply(typeof bE<"u"?bE:typeof self<"u"?self:typeof window<"u"?window:{});const z2="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Or.UNAUTHENTICATED=new Or(null),Or.GOOGLE_CREDENTIALS=new Or("google-credentials-uid"),Or.FIRST_PARTY=new Or("first-party-uid"),Or.MOCK_USER=new Or("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gg="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xh=new JS("@firebase/firestore");function jf(){return Xh.logLevel}function ce(n,...e){if(Xh.logLevel<=Lt.DEBUG){const t=e.map(sP);Xh.debug(`Firestore (${gg}): ${n}`,...t)}}function rr(n,...e){if(Xh.logLevel<=Lt.ERROR){const t=e.map(sP);Xh.error(`Firestore (${gg}): ${n}`,...t)}}function jm(n,...e){if(Xh.logLevel<=Lt.WARN){const t=e.map(sP);Xh.warn(`Firestore (${gg}): ${n}`,...t)}}function sP(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ue(n="Unexpected state"){const e=`FIRESTORE (${gg}) INTERNAL ASSERTION FAILED: `+n;throw rr(e),new Error(e)}function qe(n,e){n||Ue()}function je(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ne={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class be extends wo{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IF{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class kG{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Or.UNAUTHENTICATED))}shutdown(){}}class DG{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class MG{constructor(e){this.t=e,this.currentUser=Or.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){qe(this.o===void 0);let r=this.i;const i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve();let s=new $a;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new $a,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},a=l=>{ce("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ce("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new $a)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(ce("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(qe(typeof r.accessToken=="string"),new IF(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return qe(e===null||typeof e=="string"),new Or(e)}}class NG{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Or.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class LG{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new NG(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Or.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class OG{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class FG{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){qe(this.o===void 0);const r=s=>{s.error!=null&&ce("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,ce("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{ce("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):ce("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(qe(typeof t.token=="string"),this.R=t.token,new OG(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VG(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xF{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=VG(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function vt(n,e){return n<e?-1:n>e?1:0}function zm(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function CF(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new be(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new be(ne.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new be(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new be(ne.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return xn.fromMillis(Date.now())}static fromDate(e){return xn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new xn(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?vt(this.nanoseconds,e.nanoseconds):vt(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt{constructor(e){this.timestamp=e}static fromTimestamp(e){return new rt(e)}static min(){return new rt(new xn(0,0))}static max(){return new rt(new xn(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ue(),r===void 0?r=e.length-t:r>e.length-t&&Ue(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return fv.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof fv?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Xt extends fv{construct(e,t,r){return new Xt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new be(ne.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new Xt(t)}static emptyPath(){return new Xt([])}}const UG=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bn extends fv{construct(e,t,r){return new Bn(e,t,r)}static isValidIdentifier(e){return UG.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Bn(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new be(ne.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new be(ne.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new be(ne.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new be(ne.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Bn(t)}static emptyPath(){return new Bn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.path=e}static fromPath(e){return new Re(Xt.fromString(e))}static fromName(e){return new Re(Xt.fromString(e).popFirst(5))}static empty(){return new Re(Xt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Xt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Xt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Re(new Xt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function JT(n){return n.fields.find(e=>e.kind===2)}function Ed(n){return n.fields.filter(e=>e.kind!==2)}C_.UNKNOWN_ID=-1;class yb{constructor(e,t){this.fieldPath=e,this.kind=t}}class pv{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new pv(0,Us.min())}}function PF(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=rt.fromTimestamp(r===1e9?new xn(t+1,0):new xn(t,r));return new Us(i,Re.empty(),e)}function RF(n){return new Us(n.readTime,n.key,-1)}class Us{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Us(rt.min(),Re.empty(),-1)}static max(){return new Us(rt.max(),Re.empty(),-1)}}function oP(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Re.comparator(n.documentKey,e.documentKey),t!==0?t:vt(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kF="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class DF{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zu(n){if(n.code!==ne.FAILED_PRECONDITION||n.message!==kF)throw n;ce("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ue(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new K((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof K?t:K.resolve(t)}catch(t){return K.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):K.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):K.reject(t)}static resolve(e){return new K((t,r)=>{t(e)})}static reject(e){return new K((t,r)=>{r(e)})}static waitFor(e){return new K((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=K.resolve(!1);for(const r of e)t=t.next(i=>i?K.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new K((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let l=0;l<s;l++){const c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new K((r,i)=>{const s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nA{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new $a,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Gy(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=aP(r.target.error);this.V.reject(new Gy(e,i))}}static open(e,t,r,i){try{return new nA(t,e.transaction(i,r))}catch(s){throw new Gy(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(ce("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new $G(t)}}class Pu{constructor(e,t,r){this.name=e,this.version=t,this.p=r,Pu.S(Ar())===12.2&&rr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ce("SimpleDb","Removing database:",e),Id(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!XS())return!1;if(Pu.v())return!0;const e=Ar(),t=Pu.S(e),r=0<t&&t<10,i=MF(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(ce("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{const o=s.target.result;t(o)},i.onblocked=()=>{r(new Gy(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{const o=s.target.error;o.name==="VersionError"?r(new be(ne.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new be(ne.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Gy(e,o))},i.onupgradeneeded=s=>{ce("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const o=s.target.result;this.p.O(o,i.transaction,s.oldVersion,this.version).next(()=>{ce("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,i){const s=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.M(e);const a=nA.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),K.reject(c))).toPromise();return l.catch(()=>{}),await a.m,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(ce("SimpleDb","Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function MF(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class BG{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Id(this.B.delete())}}class Gy extends be{constructor(e,t){super(ne.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ed(n){return n.name==="IndexedDbTransactionError"}class $G{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(ce("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(ce("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Id(r)}add(e){return ce("SimpleDb","ADD",this.store.name,e,e),Id(this.store.add(e))}get(e){return Id(this.store.get(e)).next(t=>(t===void 0&&(t=null),ce("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return ce("SimpleDb","DELETE",this.store.name,e),Id(this.store.delete(e))}count(){return ce("SimpleDb","COUNT",this.store.name),Id(this.store.count())}U(e,t){const r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){const s=i.getAll(r.range);return new K((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}{const s=this.cursor(r),o=[];return this.W(s,(a,l)=>{o.push(l)}).next(()=>o)}}G(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new K((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}j(e,t){ce("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.H=!1;const i=this.cursor(r);return this.W(i,(s,o,a)=>a.delete())}J(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.W(i,t)}Y(e){const t=this.cursor({});return new K((r,i)=>{t.onerror=s=>{const o=aP(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new K((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const l=new BG(a),c=t(a.primaryKey,a.value,l);if(c instanceof K){const u=c.catch(h=>(l.done(),K.reject(h)));r.push(u)}l.isDone?i():l.K===null?a.continue():a.continue(l.K)}}).next(()=>K.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Id(n){return new K((e,t)=>{n.onsuccess=r=>{const i=r.target.result;e(i)},n.onerror=r=>{const i=aP(r.target.error);t(i)}})}let H2=!1;function aP(n){const e=Pu.S(Ar());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new be("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return H2||(H2=!0,setTimeout(()=>{throw r},0)),r}}return n}class jG{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){ce("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{ce("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){ed(t)?ce("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Zu(t)}await this.X(6e4)})}}class zG{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const r=new Set;let i=t,s=!0;return K.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return ce("IndexBackfiller",`Processing collection: ${o}`),this.ne(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}ne(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.re(i,s)).next(a=>(ce("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}re(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=RF(s);oP(o,r)>0&&(r=o)}),new Us(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ie(r),this.se=r=>t.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Xi.oe=-1;function rA(n){return n==null}function mv(n){return n===0&&1/n==-1/0}function NF(n){return typeof n=="number"&&Number.isInteger(n)&&!mv(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Li(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=G2(e)),e=HG(n.get(t),e);return G2(e)}function HG(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function G2(n){return n+""}function La(n){const e=n.length;if(qe(e>=2),e===2)return qe(n.charAt(0)===""&&n.charAt(1)===""),Xt.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("",s);switch((o<0||o>t)&&Ue(),n.charAt(o+1)){case"":const a=n.substring(s,o);let l;i.length===0?l=a:(i+=a,l=i,i=""),r.push(l);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:Ue()}s=o+2}return new Xt(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W2=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vb(n,e){return[n,Li(e)]}function LF(n,e,t){return[n,Li(e),t]}const GG={},WG=["prefixPath","collectionGroup","readTime","documentId"],qG=["prefixPath","collectionGroup","documentId"],KG=["collectionGroup","readTime","prefixPath","documentId"],YG=["canonicalId","targetId"],QG=["targetId","path"],XG=["path","targetId"],JG=["collectionId","parent"],ZG=["indexId","uid"],e9=["uid","sequenceNumber"],t9=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],n9=["indexId","uid","orderedDocumentKey"],r9=["userId","collectionPath","documentId"],i9=["userId","collectionPath","largestBatchId"],s9=["userId","collectionGroup","largestBatchId"],OF=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],o9=[...OF,"documentOverlays"],FF=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],VF=FF,lP=[...VF,"indexConfiguration","indexState","indexEntries"],a9=lP,l9=[...lP,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZT extends DF{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Tr(n,e){const t=je(n);return Pu.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q2(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function yf(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function UF(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e,t){this.comparator=e,this.root=t||Yr.EMPTY}insert(e,t){return new An(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Yr.BLACK,null,null))}remove(e){return new An(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Yr.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new _E(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new _E(this.root,e,this.comparator,!1)}getReverseIterator(){return new _E(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new _E(this.root,e,this.comparator,!0)}}class _E{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Yr{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??Yr.RED,this.left=i??Yr.EMPTY,this.right=s??Yr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Yr(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Yr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return Yr.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Yr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Yr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ue();const e=this.left.check();if(e!==this.right.check())throw Ue();return e+(this.isRed()?0:1)}}Yr.EMPTY=null,Yr.RED=!0,Yr.BLACK=!1;Yr.EMPTY=new class{constructor(){this.size=0}get key(){throw Ue()}get value(){throw Ue()}get color(){throw Ue()}get left(){throw Ue()}get right(){throw Ue()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Yr(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this.comparator=e,this.data=new An(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new K2(this.data.getIterator())}getIteratorFrom(e){return new K2(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof fn)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new fn(this.comparator);return t.data=e,t}}class K2{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Mf(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(e){this.fields=e,e.sort(Bn.comparator)}static empty(){return new Ji([])}unionWith(e){let t=new fn(Bn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ji(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return zm(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BF extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new BF("Invalid base64 string: "+s):s}}(e);return new sr(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new sr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return vt(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}sr.EMPTY_BYTE_STRING=new sr("");const c9=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ec(n){if(qe(!!n),typeof n=="string"){let e=0;const t=c9.exec(n);if(qe(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Nn(n.seconds),nanos:Nn(n.nanos)}}function Nn(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function $u(n){return typeof n=="string"?sr.fromBase64String(n):sr.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cP(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function uP(n){const e=n.mapValue.fields.__previous_value__;return cP(e)?uP(e):e}function gv(n){const e=ec(n.mapValue.fields.__local_write_time__.timestampValue);return new xn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u9{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}}class Jh{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Jh("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Jh&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bu={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},wb={nullValue:"NULL_VALUE"};function Zh(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?cP(n)?4:$F(n)?9007199254740991:iA(n)?10:11:Ue()}function Ha(n,e){if(n===e)return!0;const t=Zh(n);if(t!==Zh(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return gv(n).isEqual(gv(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=ec(i.timestampValue),a=ec(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return $u(i.bytesValue).isEqual($u(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Nn(i.geoPointValue.latitude)===Nn(s.geoPointValue.latitude)&&Nn(i.geoPointValue.longitude)===Nn(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Nn(i.integerValue)===Nn(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=Nn(i.doubleValue),a=Nn(s.doubleValue);return o===a?mv(o)===mv(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return zm(n.arrayValue.values||[],e.arrayValue.values||[],Ha);case 10:case 11:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(q2(o)!==q2(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ha(o[l],a[l])))return!1;return!0}(n,e);default:return Ue()}}function yv(n,e){return(n.values||[]).find(t=>Ha(t,e))!==void 0}function ju(n,e){if(n===e)return 0;const t=Zh(n),r=Zh(e);if(t!==r)return vt(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return vt(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=Nn(s.integerValue||s.doubleValue),l=Nn(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return Y2(n.timestampValue,e.timestampValue);case 4:return Y2(gv(n),gv(e));case 5:return vt(n.stringValue,e.stringValue);case 6:return function(s,o){const a=$u(s),l=$u(o);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const u=vt(a[c],l[c]);if(u!==0)return u}return vt(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=vt(Nn(s.latitude),Nn(o.latitude));return a!==0?a:vt(Nn(s.longitude),Nn(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Q2(n.arrayValue,e.arrayValue);case 10:return function(s,o){var a,l,c,u;const h=s.fields||{},f=o.fields||{},v=(a=h.value)===null||a===void 0?void 0:a.arrayValue,w=(l=f.value)===null||l===void 0?void 0:l.arrayValue,E=vt(((c=v==null?void 0:v.values)===null||c===void 0?void 0:c.length)||0,((u=w==null?void 0:w.values)===null||u===void 0?void 0:u.length)||0);return E!==0?E:Q2(v,w)}(n.mapValue,e.mapValue);case 11:return function(s,o){if(s===bu.mapValue&&o===bu.mapValue)return 0;if(s===bu.mapValue)return 1;if(o===bu.mapValue)return-1;const a=s.fields||{},l=Object.keys(a),c=o.fields||{},u=Object.keys(c);l.sort(),u.sort();for(let h=0;h<l.length&&h<u.length;++h){const f=vt(l[h],u[h]);if(f!==0)return f;const v=ju(a[l[h]],c[u[h]]);if(v!==0)return v}return vt(l.length,u.length)}(n.mapValue,e.mapValue);default:throw Ue()}}function Y2(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return vt(n,e);const t=ec(n),r=ec(e),i=vt(t.seconds,r.seconds);return i!==0?i:vt(t.nanos,r.nanos)}function Q2(n,e){const t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){const s=ju(t[i],r[i]);if(s)return s}return vt(t.length,r.length)}function Hm(n){return eI(n)}function eI(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=ec(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return $u(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Re.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=eI(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${eI(t.fields[o])}`;return i+"}"}(n.mapValue):Ue()}function vv(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function tI(n){return!!n&&"integerValue"in n}function wv(n){return!!n&&"arrayValue"in n}function X2(n){return!!n&&"nullValue"in n}function J2(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Eb(n){return!!n&&"mapValue"in n}function iA(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function Wy(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return yf(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Wy(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Wy(n.arrayValue.values[t]);return e}return Object.assign({},n)}function $F(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const jF={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function d9(n){return"nullValue"in n?wb:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?vv(Jh.empty(),Re.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?iA(n)?jF:{mapValue:{}}:Ue()}function h9(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?vv(Jh.empty(),Re.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?jF:"mapValue"in n?iA(n)?{mapValue:{}}:bu:Ue()}function Z2(n,e){const t=ju(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function eD(n,e){const t=ju(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e){this.value=e}static empty(){return new gi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Eb(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Wy(t)}setAll(e){let t=Bn.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Wy(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Eb(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ha(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Eb(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){yf(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new gi(Wy(this.value))}}function zF(n){const e=[];return yf(n.fields,(t,r)=>{const i=new Bn([t]);if(Eb(r)){const s=zF(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Ji(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Qn(e,0,rt.min(),rt.min(),rt.min(),gi.empty(),0)}static newFoundDocument(e,t,r,i){return new Qn(e,1,t,rt.min(),r,i,0)}static newNoDocument(e,t){return new Qn(e,2,t,rt.min(),rt.min(),gi.empty(),0)}static newUnknownDocument(e,t){return new Qn(e,3,t,rt.min(),rt.min(),gi.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(rt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=gi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=gi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Qn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Qn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gm{constructor(e,t){this.position=e,this.inclusive=t}}function tD(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(s.field.isKeyField()?r=Re.comparator(Re.fromName(o.referenceValue),t.key):r=ju(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function nD(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ha(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(e,t="asc"){this.field=e,this.dir=t}}function f9(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HF{}class Ft extends HF{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new p9(e,t,r):t==="array-contains"?new y9(e,r):t==="in"?new QF(e,r):t==="not-in"?new v9(e,r):t==="array-contains-any"?new w9(e,r):new Ft(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new m9(e,r):new g9(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(ju(t,this.value)):t!==null&&Zh(this.value)===Zh(t)&&this.matchesComparison(ju(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ue()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class nn extends HF{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new nn(e,t)}matches(e){return Wm(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Wm(n){return n.op==="and"}function nI(n){return n.op==="or"}function dP(n){return GF(n)&&Wm(n)}function GF(n){for(const e of n.filters)if(e instanceof nn)return!1;return!0}function rI(n){if(n instanceof Ft)return n.field.canonicalString()+n.op.toString()+Hm(n.value);if(dP(n))return n.filters.map(e=>rI(e)).join(",");{const e=n.filters.map(t=>rI(t)).join(",");return`${n.op}(${e})`}}function WF(n,e){return n instanceof Ft?function(r,i){return i instanceof Ft&&r.op===i.op&&r.field.isEqual(i.field)&&Ha(r.value,i.value)}(n,e):n instanceof nn?function(r,i){return i instanceof nn&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&WF(o,i.filters[a]),!0):!1}(n,e):void Ue()}function qF(n,e){const t=n.filters.concat(e);return nn.create(t,n.op)}function KF(n){return n instanceof Ft?function(t){return`${t.field.canonicalString()} ${t.op} ${Hm(t.value)}`}(n):n instanceof nn?function(t){return t.op.toString()+" {"+t.getFilters().map(KF).join(" ,")+"}"}(n):"Filter"}class p9 extends Ft{constructor(e,t,r){super(e,t,r),this.key=Re.fromName(r.referenceValue)}matches(e){const t=Re.comparator(e.key,this.key);return this.matchesComparison(t)}}class m9 extends Ft{constructor(e,t){super(e,"in",t),this.keys=YF("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class g9 extends Ft{constructor(e,t){super(e,"not-in",t),this.keys=YF("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function YF(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Re.fromName(r.referenceValue))}class y9 extends Ft{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return wv(t)&&yv(t.arrayValue,this.value)}}class QF extends Ft{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&yv(this.value.arrayValue,t)}}class v9 extends Ft{constructor(e,t){super(e,"not-in",t)}matches(e){if(yv(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!yv(this.value.arrayValue,t)}}class w9 extends Ft{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!wv(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>yv(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E9{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}}function iI(n,e=null,t=[],r=[],i=null,s=null,o=null){return new E9(n,e,t,r,i,s,o)}function ef(n){const e=je(n);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>rI(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),rA(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Hm(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Hm(r)).join(",")),e.ue=t}return e.ue}function k0(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!f9(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!WF(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!nD(n.startAt,e.startAt)&&nD(n.endAt,e.endAt)}function P_(n){return Re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function R_(n,e){return n.filters.filter(t=>t instanceof Ft&&t.field.isEqual(e))}function rD(n,e,t){let r=wb,i=!0;for(const s of R_(n,e)){let o=wb,a=!0;switch(s.op){case"<":case"<=":o=d9(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=wb}Z2({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Z2({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function iD(n,e,t){let r=bu,i=!0;for(const s of R_(n,e)){let o=bu,a=!0;switch(s.op){case">=":case">":o=h9(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=bu}eD({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];eD({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function XF(n,e,t,r,i,s,o,a){return new yg(n,e,t,r,i,s,o,a)}function D0(n){return new yg(n)}function sD(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function JF(n){return n.collectionGroup!==null}function qy(n){const e=je(n);if(e.ce===null){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new fn(Bn.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Ev(s,r))}),t.has(Bn.keyField().canonicalString())||e.ce.push(new Ev(Bn.keyField(),r))}return e.ce}function Ls(n){const e=je(n);return e.le||(e.le=b9(e,qy(n))),e.le}function b9(n,e){if(n.limitType==="F")return iI(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new Ev(i.field,s)});const t=n.endAt?new Gm(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Gm(n.startAt.position,n.startAt.inclusive):null;return iI(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function sI(n,e){const t=n.filters.concat([e]);return new yg(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function k_(n,e,t){return new yg(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function sA(n,e){return k0(Ls(n),Ls(e))&&n.limitType===e.limitType}function ZF(n){return`${ef(Ls(n))}|lt:${n.limitType}`}function zf(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>KF(i)).join(", ")}]`),rA(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Hm(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Hm(i)).join(",")),`Target(${r})`}(Ls(n))}; limitType=${n.limitType})`}function M0(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Re.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of qy(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,l){const c=tD(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,qy(r),i)||r.endAt&&!function(o,a,l){const c=tD(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,qy(r),i))}(n,e)}function eV(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function tV(n){return(e,t)=>{let r=!1;for(const i of qy(n)){const s=_9(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function _9(n,e,t){const r=n.field.isKeyField()?Re.comparator(e.key,t.key):function(s,o,a){const l=o.data.field(s),c=a.data.field(s);return l!==null&&c!==null?ju(l,c):Ue()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ue()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){yf(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return UF(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S9=new An(Re.comparator);function Ms(){return S9}const nV=new An(Re.comparator);function hy(...n){let e=nV;for(const t of n)e=e.insert(t.key,t);return e}function rV(n){let e=nV;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Oa(){return Ky()}function iV(){return Ky()}function Ky(){return new td(n=>n.toString(),(n,e)=>n.isEqual(e))}const A9=new An(Re.comparator),T9=new fn(Re.comparator);function Pt(...n){let e=T9;for(const t of n)e=e.add(t);return e}const I9=new fn(vt);function hP(){return I9}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fP(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:mv(e)?"-0":e}}function sV(n){return{integerValue:""+n}}function oV(n,e){return NF(e)?sV(e):fP(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oA{constructor(){this._=void 0}}function x9(n,e,t){return n instanceof qm?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&cP(s)&&(s=uP(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Km?lV(n,e):n instanceof Ym?cV(n,e):function(i,s){const o=aV(i,s),a=oD(o)+oD(i.Pe);return tI(o)&&tI(i.Pe)?sV(a):fP(i.serializer,a)}(n,e)}function C9(n,e,t){return n instanceof Km?lV(n,e):n instanceof Ym?cV(n,e):t}function aV(n,e){return n instanceof Qm?function(r){return tI(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class qm extends oA{}class Km extends oA{constructor(e){super(),this.elements=e}}function lV(n,e){const t=uV(e);for(const r of n.elements)t.some(i=>Ha(i,r))||t.push(r);return{arrayValue:{values:t}}}class Ym extends oA{constructor(e){super(),this.elements=e}}function cV(n,e){let t=uV(e);for(const r of n.elements)t=t.filter(i=>!Ha(i,r));return{arrayValue:{values:t}}}class Qm extends oA{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function oD(n){return Nn(n.integerValue||n.doubleValue)}function uV(n){return wv(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pP{constructor(e,t){this.field=e,this.transform=t}}function P9(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Km&&i instanceof Km||r instanceof Ym&&i instanceof Ym?zm(r.elements,i.elements,Ha):r instanceof Qm&&i instanceof Qm?Ha(r.Pe,i.Pe):r instanceof qm&&i instanceof qm}(n.transform,e.transform)}class R9{constructor(e,t){this.version=e,this.transformResults=t}}class br{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new br}static exists(e){return new br(void 0,e)}static updateTime(e){return new br(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function bb(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class aA{}function dV(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new N0(n.key,br.none()):new vg(n.key,n.data,br.none());{const t=n.data,r=gi.empty();let i=new fn(Bn.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new uc(n.key,r,new Ji(i.toArray()),br.none())}}function k9(n,e,t){n instanceof vg?function(i,s,o){const a=i.value.clone(),l=lD(i.fieldTransforms,s,o.transformResults);a.setAll(l),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof uc?function(i,s,o){if(!bb(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=lD(i.fieldTransforms,s,o.transformResults),l=s.data;l.setAll(hV(i)),l.setAll(a),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Yy(n,e,t,r){return n instanceof vg?function(s,o,a,l){if(!bb(s.precondition,o))return a;const c=s.value.clone(),u=cD(s.fieldTransforms,l,o);return c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof uc?function(s,o,a,l){if(!bb(s.precondition,o))return a;const c=cD(s.fieldTransforms,l,o),u=o.data;return u.setAll(hV(s)),u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(s,o,a){return bb(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function D9(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=aV(r.transform,i||null);s!=null&&(t===null&&(t=gi.empty()),t.set(r.field,s))}return t||null}function aD(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&zm(r,i,(s,o)=>P9(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class vg extends aA{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class uc extends aA{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function hV(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function lD(n,e,t){const r=new Map;qe(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,C9(o,a,t[i]))}return r}function cD(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,x9(s,o,e))}return r}class N0 extends aA{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class fV extends aA{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mP{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&k9(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Yy(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Yy(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=iV();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const l=dV(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(rt.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Pt())}isEqual(e){return this.batchId===e.batchId&&zm(this.mutations,e.mutations,(t,r)=>aD(t,r))&&zm(this.baseMutations,e.baseMutations,(t,r)=>aD(t,r))}}class gP{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){qe(e.mutations.length===r.length);let i=function(){return A9}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new gP(e,t,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yP{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M9{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dr,$t;function N9(n){switch(n){default:return Ue();case ne.CANCELLED:case ne.UNKNOWN:case ne.DEADLINE_EXCEEDED:case ne.RESOURCE_EXHAUSTED:case ne.INTERNAL:case ne.UNAVAILABLE:case ne.UNAUTHENTICATED:return!1;case ne.INVALID_ARGUMENT:case ne.NOT_FOUND:case ne.ALREADY_EXISTS:case ne.PERMISSION_DENIED:case ne.FAILED_PRECONDITION:case ne.ABORTED:case ne.OUT_OF_RANGE:case ne.UNIMPLEMENTED:case ne.DATA_LOSS:return!0}}function pV(n){if(n===void 0)return rr("GRPC error has no .code"),ne.UNKNOWN;switch(n){case dr.OK:return ne.OK;case dr.CANCELLED:return ne.CANCELLED;case dr.UNKNOWN:return ne.UNKNOWN;case dr.DEADLINE_EXCEEDED:return ne.DEADLINE_EXCEEDED;case dr.RESOURCE_EXHAUSTED:return ne.RESOURCE_EXHAUSTED;case dr.INTERNAL:return ne.INTERNAL;case dr.UNAVAILABLE:return ne.UNAVAILABLE;case dr.UNAUTHENTICATED:return ne.UNAUTHENTICATED;case dr.INVALID_ARGUMENT:return ne.INVALID_ARGUMENT;case dr.NOT_FOUND:return ne.NOT_FOUND;case dr.ALREADY_EXISTS:return ne.ALREADY_EXISTS;case dr.PERMISSION_DENIED:return ne.PERMISSION_DENIED;case dr.FAILED_PRECONDITION:return ne.FAILED_PRECONDITION;case dr.ABORTED:return ne.ABORTED;case dr.OUT_OF_RANGE:return ne.OUT_OF_RANGE;case dr.UNIMPLEMENTED:return ne.UNIMPLEMENTED;case dr.DATA_LOSS:return ne.DATA_LOSS;default:return Ue()}}($t=dr||(dr={}))[$t.OK=0]="OK",$t[$t.CANCELLED=1]="CANCELLED",$t[$t.UNKNOWN=2]="UNKNOWN",$t[$t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$t[$t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$t[$t.NOT_FOUND=5]="NOT_FOUND",$t[$t.ALREADY_EXISTS=6]="ALREADY_EXISTS",$t[$t.PERMISSION_DENIED=7]="PERMISSION_DENIED",$t[$t.UNAUTHENTICATED=16]="UNAUTHENTICATED",$t[$t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$t[$t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$t[$t.ABORTED=10]="ABORTED",$t[$t.OUT_OF_RANGE=11]="OUT_OF_RANGE",$t[$t.UNIMPLEMENTED=12]="UNIMPLEMENTED",$t[$t.INTERNAL=13]="INTERNAL",$t[$t.UNAVAILABLE=14]="UNAVAILABLE",$t[$t.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L9(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O9=new Gh([4294967295,4294967295],0);function uD(n){const e=L9().encode(n),t=new EF;return t.update(e),new Uint8Array(t.digest())}function dD(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Gh([t,r],0),new Gh([i,s],0)]}class vP{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new fy(`Invalid padding: ${t}`);if(r<0)throw new fy(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new fy(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new fy(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Gh.fromNumber(this.Ie)}Ee(e,t,r){let i=e.add(t.multiply(Gh.fromNumber(r)));return i.compare(O9)===1&&(i=new Gh([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=uD(e),[r,i]=dD(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new vP(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ie===0)return;const t=uD(e),[r,i]=dD(t);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class fy extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,O0.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new L0(rt.min(),i,new An(vt),Ms(),Pt())}}class O0{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new O0(r,t,Pt(),Pt(),Pt())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _b{constructor(e,t,r,i){this.Re=e,this.removedTargetIds=t,this.key=r,this.Ve=i}}class mV{constructor(e,t){this.targetId=e,this.me=t}}class gV{constructor(e,t,r=sr.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class hD{constructor(){this.fe=0,this.ge=pD(),this.pe=sr.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Pt(),t=Pt(),r=Pt();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:Ue()}}),new O0(this.pe,this.ye,e,t,r)}Ce(){this.we=!1,this.ge=pD()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,qe(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class F9{constructor(e){this.Le=e,this.Be=new Map,this.ke=Ms(),this.qe=fD(),this.Qe=new An(vt)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const r=this.Ge(t);switch(e.state){case 0:this.ze(t)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),r.De(e.resumeToken));break;default:Ue()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((r,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,r=e.me.count,i=this.Je(t);if(i){const s=i.target;if(P_(s))if(r===0){const o=new Re(s.path);this.Ue(t,o,Qn.newNoDocument(o,rt.min()))}else qe(r===1);else{const o=this.Ye(t);if(o!==r){const a=this.Ze(e),l=a?this.Xe(a,e,o):1;if(l!==0){this.je(t);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,c)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=$u(r).toUint8Array()}catch(l){if(l instanceof BF)return jm("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new vP(o,i,s)}catch(l){return jm(l instanceof fy?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Ie===0?null:a}Xe(e,t,r){return t.me.count===r-this.nt(e,t.targetId)?0:2}nt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Le.tt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,o)=>{const a=this.Je(o);if(a){if(s.current&&P_(a.target)){const l=new Re(a.target.path);this.ke.get(l)!==null||this.it(o,l)||this.Ue(o,l,Qn.newNoDocument(l,e))}s.be&&(t.set(o,s.ve()),s.Ce())}});let r=Pt();this.qe.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.Je(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));const i=new L0(e,t,this.Qe,this.ke,r);return this.ke=Ms(),this.qe=fD(),this.Qe=new An(vt),i}$e(e,t){if(!this.ze(e))return;const r=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,r),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,r){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),r&&(this.ke=this.ke.insert(t,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new hD,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new fn(vt),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||ce("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new hD),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function fD(){return new An(Re.comparator)}function pD(){return new An(Re.comparator)}const V9={asc:"ASCENDING",desc:"DESCENDING"},U9={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},B9={and:"AND",or:"OR"};class $9{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function oI(n,e){return n.useProto3Json||rA(e)?e:{value:e}}function Xm(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function yV(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function j9(n,e){return Xm(n,e.toTimestamp())}function Oi(n){return qe(!!n),rt.fromTimestamp(function(t){const r=ec(t);return new xn(r.seconds,r.nanos)}(n))}function wP(n,e){return aI(n,e).canonicalString()}function aI(n,e){const t=function(i){return new Xt(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function vV(n){const e=Xt.fromString(n);return qe(xV(e)),e}function D_(n,e){return wP(n.databaseId,e.path)}function Wh(n,e){const t=vV(e);if(t.get(1)!==n.databaseId.projectId)throw new be(ne.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new be(ne.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Re(bV(t))}function wV(n,e){return wP(n.databaseId,e)}function EV(n){const e=vV(n);return e.length===4?Xt.emptyPath():bV(e)}function lI(n){return new Xt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function bV(n){return qe(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function mD(n,e,t){return{name:D_(n,e),fields:t.value.mapValue.fields}}function z9(n,e,t){const r=Wh(n,e.name),i=Oi(e.updateTime),s=e.createTime?Oi(e.createTime):rt.min(),o=new gi({mapValue:{fields:e.fields}}),a=Qn.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function H9(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:Ue()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,u){return c.useProto3Json?(qe(u===void 0||typeof u=="string"),sr.fromBase64String(u||"")):(qe(u===void 0||u instanceof Buffer||u instanceof Uint8Array),sr.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const u=c.code===void 0?ne.UNKNOWN:pV(c.code);return new be(u,c.message||"")}(o);t=new gV(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Wh(n,r.document.name),s=Oi(r.document.updateTime),o=r.document.createTime?Oi(r.document.createTime):rt.min(),a=new gi({mapValue:{fields:r.document.fields}}),l=Qn.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new _b(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Wh(n,r.document),s=r.readTime?Oi(r.readTime):rt.min(),o=Qn.newNoDocument(i,s),a=r.removedTargetIds||[];t=new _b([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Wh(n,r.document),s=r.removedTargetIds||[];t=new _b([],s,i,null)}else{if(!("filter"in e))return Ue();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new M9(i,s),a=r.targetId;t=new mV(a,o)}}return t}function M_(n,e){let t;if(e instanceof vg)t={update:mD(n,e.key,e.value)};else if(e instanceof N0)t={delete:D_(n,e.key)};else if(e instanceof uc)t={update:mD(n,e.key,e.data),updateMask:Q9(e.fieldMask)};else{if(!(e instanceof fV))return Ue();t={verify:D_(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof qm)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Km)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ym)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Qm)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw Ue()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:j9(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:Ue()}(n,e.precondition)),t}function cI(n,e){const t=e.currentDocument?function(s){return s.updateTime!==void 0?br.updateTime(Oi(s.updateTime)):s.exists!==void 0?br.exists(s.exists):br.none()}(e.currentDocument):br.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let l=null;if("setToServerValue"in a)qe(a.setToServerValue==="REQUEST_TIME"),l=new qm;else if("appendMissingElements"in a){const u=a.appendMissingElements.values||[];l=new Km(u)}else if("removeAllFromArray"in a){const u=a.removeAllFromArray.values||[];l=new Ym(u)}else"increment"in a?l=new Qm(o,a.increment):Ue();const c=Bn.fromServerFormat(a.fieldPath);return new pP(c,l)}(n,i)):[];if(e.update){e.update.name;const i=Wh(n,e.update.name),s=new gi({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new Ji(c.map(u=>Bn.fromServerFormat(u)))}(e.updateMask);return new uc(i,s,o,t,r)}return new vg(i,s,t,r)}if(e.delete){const i=Wh(n,e.delete);return new N0(i,t)}if(e.verify){const i=Wh(n,e.verify);return new fV(i,t)}return Ue()}function G9(n,e){return n&&n.length>0?(qe(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?Oi(i.updateTime):Oi(s);return o.isEqual(rt.min())&&(o=Oi(s)),new R9(o,i.transformResults||[])}(t,e))):[]}function _V(n,e){return{documents:[wV(n,e.path)]}}function SV(n,e){const t={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=wV(n,i);const s=function(c){if(c.length!==0)return IV(nn.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const o=function(c){if(c.length!==0)return c.map(u=>function(f){return{field:Hf(f.field),direction:q9(f.dir)}}(u))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=oI(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{_t:t,parent:i}}function AV(n){let e=EV(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){qe(r===1);const u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=function(h){const f=TV(h);return f instanceof nn&&dP(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(f=>function(w){return new Ev(Gf(w.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(f))}(t.orderBy));let a=null;t.limit&&(a=function(h){let f;return f=typeof h=="object"?h.value:h,rA(f)?null:f}(t.limit));let l=null;t.startAt&&(l=function(h){const f=!!h.before,v=h.values||[];return new Gm(v,f)}(t.startAt));let c=null;return t.endAt&&(c=function(h){const f=!h.before,v=h.values||[];return new Gm(v,f)}(t.endAt)),XF(e,i,o,s,a,"F",l,c)}function W9(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ue()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function TV(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Gf(t.unaryFilter.field);return Ft.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Gf(t.unaryFilter.field);return Ft.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Gf(t.unaryFilter.field);return Ft.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Gf(t.unaryFilter.field);return Ft.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Ue()}}(n):n.fieldFilter!==void 0?function(t){return Ft.create(Gf(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ue()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return nn.create(t.compositeFilter.filters.map(r=>TV(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Ue()}}(t.compositeFilter.op))}(n):Ue()}function q9(n){return V9[n]}function K9(n){return U9[n]}function Y9(n){return B9[n]}function Hf(n){return{fieldPath:n.canonicalString()}}function Gf(n){return Bn.fromServerFormat(n.fieldPath)}function IV(n){return n instanceof Ft?function(t){if(t.op==="=="){if(J2(t.value))return{unaryFilter:{field:Hf(t.field),op:"IS_NAN"}};if(X2(t.value))return{unaryFilter:{field:Hf(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(J2(t.value))return{unaryFilter:{field:Hf(t.field),op:"IS_NOT_NAN"}};if(X2(t.value))return{unaryFilter:{field:Hf(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hf(t.field),op:K9(t.op),value:t.value}}}(n):n instanceof nn?function(t){const r=t.getFilters().map(i=>IV(i));return r.length===1?r[0]:{compositeFilter:{op:Y9(t.op),filters:r}}}(n):Ue()}function Q9(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function xV(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(e,t,r,i,s=rt.min(),o=rt.min(),a=sr.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Gl(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Gl(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Gl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Gl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CV{constructor(e){this.ct=e}}function X9(n,e){let t;if(e.document)t=z9(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=Re.fromSegments(e.noDocument.path),i=nf(e.noDocument.readTime);t=Qn.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ue();{const r=Re.fromSegments(e.unknownDocument.path),i=nf(e.unknownDocument.version);t=Qn.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new xn(i[0],i[1]);return rt.fromTimestamp(s)}(e.readTime)),t}function gD(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:N_(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:D_(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Xm(s,o.version.toTimestamp()),createTime:Xm(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:tf(e.version)};else{if(!e.isUnknownDocument())return Ue();r.unknownDocument={path:t.path.toArray(),version:tf(e.version)}}return r}function N_(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function tf(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function nf(n){const e=new xn(n.seconds,n.nanoseconds);return rt.fromTimestamp(e)}function xd(n,e){const t=(e.baseMutations||[]).map(s=>cI(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){const o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(s=>cI(n.ct,s)),i=xn.fromMillis(e.localWriteTimeMs);return new mP(e.batchId,i,t,r)}function py(n){const e=nf(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?nf(n.lastLimboFreeSnapshotVersion):rt.min();let r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return qe(s.documents.length===1),Ls(D0(EV(s.documents[0])))}(n.query):function(s){return Ls(AV(s))}(n.query),new Gl(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,sr.fromBase64String(n.resumeToken))}function PV(n,e){const t=tf(e.snapshotVersion),r=tf(e.lastLimboFreeSnapshotVersion);let i;i=P_(e.target)?_V(n.ct,e.target):SV(n.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ef(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function RV(n){const e=AV({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?k_(e,e.limit,"L"):e}function D1(n,e){return new yP(e.largestBatchId,cI(n.ct,e.overlayMutation))}function yD(n,e){const t=e.path.lastSegment();return[n,Li(e.path.popLast()),t]}function vD(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:tf(r.readTime),documentKey:Li(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J9{getBundleMetadata(e,t){return wD(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:nf(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return wD(e).put(function(i){return{bundleId:i.id,createTime:tf(Oi(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return ED(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:RV(s.bundledQuery),readTime:nf(s.readTime)}}(r)})}saveNamedQuery(e,t){return ED(e).put(function(i){return{name:i.name,readTime:tf(Oi(i.readTime)),bundledQuery:i.bundledQuery}}(t))}}function wD(n){return Tr(n,"bundles")}function ED(n){return Tr(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lA{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const r=t.uid||"";return new lA(e,r)}getOverlay(e,t){return $g(e).get(yD(this.userId,t)).next(r=>r?D1(this.serializer,r):null)}getOverlays(e,t){const r=Oa();return K.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const a=new yP(t,o);i.push(this.ht(e,a))}),K.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(Li(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push($g(e).j("collectionPathOverlayIndex",a))}),K.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Oa(),s=Li(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return $g(e).U("collectionPathOverlayIndex",o).next(a=>{for(const l of a){const c=D1(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=Oa();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return $g(e).J({index:"collectionGroupOverlayIndex",range:a},(l,c,u)=>{const h=D1(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>s)}ht(e,t){return $g(e).put(function(i,s,o){const[a,l,c]=yD(s,o.mutation.key);return{userId:s,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:M_(i.ct,o.mutation)}}(this.serializer,this.userId,t))}}function $g(n){return Tr(n,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z9{Pt(e){return Tr(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const r=t==null?void 0:t.value;return r?sr.fromUint8Array(r):sr.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Nn(e.integerValue));else if("doubleValue"in e){const r=Nn(e.doubleValue);isNaN(r)?this.dt(t,13):(this.dt(t,15),mv(r)?t.At(0):t.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(t,20),typeof r=="string"&&(r=ec(r)),t.Rt(`${r.seconds||""}`),t.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt($u(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(t,45),t.At(r.latitude||0),t.At(r.longitude||0)}else"mapValue"in e?$F(e)?this.dt(t,Number.MAX_SAFE_INTEGER):iA(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):Ue()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const r=e.fields||{};this.dt(t,55);for(const i of Object.keys(r))this.Vt(i,t),this.Tt(r[i],t)}wt(e,t){var r,i;const s=e.fields||{};this.dt(t,53);const o="value",a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(t,15),t.At(Nn(a)),this.Vt(o,t),this.Tt(s[o],t)}bt(e,t){const r=e.values||[];this.dt(t,50);for(const i of r)this.Tt(i,t)}yt(e,t){this.dt(t,37),Re.fromName(e).path.forEach(r=>{this.dt(t,60),this.Dt(r,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Cd.vt=new Cd;function eW(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function bD(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=eW(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}class tW{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ot(r.value),r=t.next();this.Nt()}Lt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){const t=this.qt(e),r=bD(t);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){const t=this.qt(e),r=bD(t);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class nW{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class rW{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class jg{constructor(){this.jt=new tW,this.Ht=new nW(this.jt),this.Jt=new rW(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Pd(this.indexId,this.documentKey,this.arrayValue,r)}}function yc(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=_D(n.arrayValue,e.arrayValue),t!==0?t:(t=_D(n.directionalValue,e.directionalValue),t!==0?t:Re.comparator(n.documentKey,e.documentKey)))}function _D(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SD{constructor(e){this.Xt=new fn((t,r)=>Bn.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const r=t;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(qe(e.collectionGroup===this.collectionId),this.nn)return!1;const t=JT(e);if(t!==void 0&&!this.sn(t))return!1;const r=Ed(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.sn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Xt.size>0){const a=this.Xt.getIterator().getNext();if(!i.has(a.field.canonicalString())){const l=r[s];if(!this.on(a,l)||!this._n(this.en[o++],l))return!1}++s}for(;s<r.length;++s){const a=r[s];if(o>=this.en.length||!this._n(this.en[o++],a))return!1}return!0}an(){if(this.nn)return null;let e=new fn(Bn.comparator);const t=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new yb(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new yb(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new yb(r.field,r.dir==="asc"?0:1)));return new C_(C_.UNKNOWN_ID,this.collectionId,t,pv.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kV(n){var e,t;if(qe(n instanceof Ft||n instanceof nn),n instanceof Ft){if(n instanceof QF){const i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>Ft.create(n.field,"==",s)))||[];return nn.create(i,"or")}return n}const r=n.filters.map(i=>kV(i));return nn.create(r,n.op)}function iW(n){if(n.getFilters().length===0)return[];const e=hI(kV(n));return qe(DV(e)),uI(e)||dI(e)?[e]:e.getFilters()}function uI(n){return n instanceof Ft}function dI(n){return n instanceof nn&&dP(n)}function DV(n){return uI(n)||dI(n)||function(t){if(t instanceof nn&&nI(t)){for(const r of t.getFilters())if(!uI(r)&&!dI(r))return!1;return!0}return!1}(n)}function hI(n){if(qe(n instanceof Ft||n instanceof nn),n instanceof Ft)return n;if(n.filters.length===1)return hI(n.filters[0]);const e=n.filters.map(r=>hI(r));let t=nn.create(e,n.op);return t=L_(t),DV(t)?t:(qe(t instanceof nn),qe(Wm(t)),qe(t.filters.length>1),t.filters.reduce((r,i)=>EP(r,i)))}function EP(n,e){let t;return qe(n instanceof Ft||n instanceof nn),qe(e instanceof Ft||e instanceof nn),t=n instanceof Ft?e instanceof Ft?function(i,s){return nn.create([i,s],"and")}(n,e):AD(n,e):e instanceof Ft?AD(e,n):function(i,s){if(qe(i.filters.length>0&&s.filters.length>0),Wm(i)&&Wm(s))return qF(i,s.getFilters());const o=nI(i)?i:s,a=nI(i)?s:i,l=o.filters.map(c=>EP(c,a));return nn.create(l,"or")}(n,e),L_(t)}function AD(n,e){if(Wm(e))return qF(e,n.getFilters());{const t=e.filters.map(r=>EP(n,r));return nn.create(t,"or")}}function L_(n){if(qe(n instanceof Ft||n instanceof nn),n instanceof Ft)return n;const e=n.getFilters();if(e.length===1)return L_(e[0]);if(GF(n))return n;const t=e.map(i=>L_(i)),r=[];return t.forEach(i=>{i instanceof Ft?r.push(i):i instanceof nn&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:nn.create(r,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sW{constructor(){this.un=new bP}addToCollectionParentIndex(e,t){return this.un.add(t),K.resolve()}getCollectionParents(e,t){return K.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return K.resolve()}deleteFieldIndex(e,t){return K.resolve()}deleteAllFieldIndexes(e){return K.resolve()}createTargetIndexes(e,t){return K.resolve()}getDocumentsMatchingTarget(e,t){return K.resolve(null)}getIndexType(e,t){return K.resolve(0)}getFieldIndexes(e,t){return K.resolve([])}getNextCollectionGroupToUpdate(e){return K.resolve(null)}getMinOffset(e,t){return K.resolve(Us.min())}getMinOffsetFromCollectionGroup(e,t){return K.resolve(Us.min())}updateCollectionGroup(e,t,r){return K.resolve()}updateIndexEntries(e,t){return K.resolve()}}class bP{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new fn(Xt.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new fn(Xt.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SE=new Uint8Array(0);class oW{constructor(e,t){this.databaseId=t,this.cn=new bP,this.ln=new td(r=>ef(r),(r,i)=>k0(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const s={collectionId:r,parent:Li(i)};return TD(e).put(s)}return K.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[CF(t),""],!1,!0);return TD(e).U(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(La(o.parent))}return r})}addFieldIndex(e,t){const r=zg(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(t);delete i.indexId;const s=r.add(i);if(t.indexState){const o=Lf(e);return s.next(a=>{o.put(vD(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=zg(e),i=Lf(e),s=Nf(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=zg(e),r=Nf(e),i=Lf(e);return t.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,t){return K.forEach(this.hn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){const s=new SD(r).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=Nf(e);let i=!0;const s=new Map;return K.forEach(this.hn(t),o=>this.Pn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=Pt();const a=[];return K.forEach(s,(l,c)=>{ce("IndexedDbIndexManager",`Using index ${function(b){return`id=${b.indexId}|cg=${b.collectionGroup}|f=${b.fields.map(g=>`${g.fieldPath}:${g.kind}`).join(",")}`}(l)} to execute ${ef(t)}`);const u=function(b,g){const y=JT(g);if(y===void 0)return null;for(const x of R_(b,y.fieldPath))switch(x.op){case"array-contains-any":return x.value.arrayValue.values||[];case"array-contains":return[x.value]}return null}(c,l),h=function(b,g){const y=new Map;for(const x of Ed(g))for(const S of R_(b,x.fieldPath))switch(S.op){case"==":case"in":y.set(x.fieldPath.canonicalString(),S.value);break;case"not-in":case"!=":return y.set(x.fieldPath.canonicalString(),S.value),Array.from(y.values())}return null}(c,l),f=function(b,g){const y=[];let x=!0;for(const S of Ed(g)){const I=S.kind===0?rD(b,S.fieldPath,b.startAt):iD(b,S.fieldPath,b.startAt);y.push(I.value),x&&(x=I.inclusive)}return new Gm(y,x)}(c,l),v=function(b,g){const y=[];let x=!0;for(const S of Ed(g)){const I=S.kind===0?iD(b,S.fieldPath,b.endAt):rD(b,S.fieldPath,b.endAt);y.push(I.value),x&&(x=I.inclusive)}return new Gm(y,x)}(c,l),w=this.In(l,c,f),E=this.In(l,c,v),A=this.Tn(l,c,h),T=this.En(l.indexId,u,w,f.inclusive,E,v.inclusive,A);return K.forEach(T,_=>r.G(_,t.limit).next(b=>{b.forEach(g=>{const y=Re.fromSegments(g.documentKey);o.has(y)||(o=o.add(y),a.push(y))})}))}).next(()=>a)}return K.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=iW(nn.create(e.filters,"and")).map(r=>iI(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,r,i,s,o,a){const l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let h=0;h<l;++h){const f=t?this.dn(t[h/c]):SE,v=this.An(e,f,r[h%c],i),w=this.Rn(e,f,s[h%c],o),E=a.map(A=>this.An(e,f,A,!0));u.push(...this.createRange(v,w,E))}return u}An(e,t,r,i){const s=new Pd(e,Re.empty(),t,r);return i?s:s.Zt()}Rn(e,t,r,i){const s=new Pd(e,Re.empty(),t,r);return i?s.Zt():s}Pn(e,t){const r=new SD(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.rn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const i=this.hn(t);return K.forEach(i,s=>this.Pn(e,s).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new fn(Bn.comparator),u=!1;for(const h of l.filters)for(const f of h.getFlattenedFilters())f.field.isKeyField()||(f.op==="array-contains"||f.op==="array-contains-any"?u=!0:c=c.add(f.field));for(const h of l.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(u?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}Vn(e,t){const r=new jg;for(const i of Ed(e)){const s=t.data.field(i.fieldPath);if(s==null)return null;const o=r.Yt(i.kind);Cd.vt.It(s,o)}return r.zt()}dn(e){const t=new jg;return Cd.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const r=new jg;return Cd.vt.It(vv(this.databaseId,t),r.Yt(function(s){const o=Ed(s);return o.length===0?0:o[o.length-1].kind}(e))),r.zt()}Tn(e,t,r){if(r===null)return[];let i=[];i.push(new jg);let s=0;for(const o of Ed(e)){const a=r[s++];for(const l of i)if(this.fn(t,o.fieldPath)&&wv(a))i=this.gn(i,o,a);else{const c=l.Yt(o.kind);Cd.vt.It(a,c)}}return this.pn(i)}In(e,t,r){return this.Tn(e,t,r.position)}pn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].zt();return t}gn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const l=new jg;l.seed(a.zt()),Cd.vt.It(o,l.Yt(t.kind)),s.push(l)}return s}fn(e,t){return!!e.filters.find(r=>r instanceof Ft&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=zg(e),i=Lf(e);return(t?r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.U()).next(s=>{const o=[];return K.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(function(u,h){const f=h?new pv(h.sequenceNumber,new Us(nf(h.readTime),new Re(La(h.documentKey)),h.largestBatchId)):pv.empty(),v=u.fields.map(([w,E])=>new yb(Bn.fromServerFormat(w),E));return new C_(u.indexId,u.collectionGroup,v,f)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:vt(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=zg(e),s=Lf(e);return this.yn(e).next(o=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>K.forEach(a,l=>s.put(vD(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){const r=new Map;return K.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?K.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),K.forEach(a,l=>this.wn(e,i,l).next(c=>{const u=this.Sn(s,l);return c.isEqual(u)?K.resolve():this.bn(e,s,l,c,u)}))))})}Dn(e,t,r,i){return Nf(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,t.key),documentKey:t.key.path.toArray()})}vn(e,t,r,i){return Nf(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const i=Nf(e);let s=new fn(yc);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,t)])},(o,a)=>{s=s.add(new Pd(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}Sn(e,t){let r=new fn(yc);const i=this.Vn(t,e);if(i==null)return r;const s=JT(t);if(s!=null){const o=e.data.field(s.fieldPath);if(wv(o))for(const a of o.arrayValue.values||[])r=r.add(new Pd(t.indexId,e.key,this.dn(a),i))}else r=r.add(new Pd(t.indexId,e.key,SE,i));return r}bn(e,t,r,i,s){ce("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(l,c,u,h,f){const v=l.getIterator(),w=c.getIterator();let E=Mf(v),A=Mf(w);for(;E||A;){let T=!1,_=!1;if(E&&A){const b=u(E,A);b<0?_=!0:b>0&&(T=!0)}else E!=null?_=!0:T=!0;T?(h(A),A=Mf(w)):_?(f(E),E=Mf(v)):(E=Mf(v),A=Mf(w))}}(i,s,yc,a=>{o.push(this.Dn(e,t,r,a))},a=>{o.push(this.vn(e,t,r,a))}),K.waitFor(o)}yn(e){let t=1;return Lf(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>yc(o,a)).filter((o,a,l)=>!a||yc(o,l[a-1])!==0);const i=[];i.push(e);for(const o of r){const a=yc(o,e),l=yc(o,t);if(a===0)i[0]=e.Zt();else if(a>0&&l<0)i.push(o),i.push(o.Zt());else if(l>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.Cn(i[o],i[o+1]))return[];const a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,SE,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,SE,[]];s.push(IDBKeyRange.bound(a,l))}return s}Cn(e,t){return yc(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ID)}getMinOffset(e,t){return K.mapArray(this.hn(t),r=>this.Pn(e,r).next(i=>i||Ue())).next(ID)}}function TD(n){return Tr(n,"collectionParents")}function Nf(n){return Tr(n,"indexEntries")}function zg(n){return Tr(n,"indexConfiguration")}function Lf(n){return Tr(n,"indexState")}function ID(n){qe(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;oP(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Us(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xD={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Yi{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Yi(e,Yi.DEFAULT_COLLECTION_PERCENTILE,Yi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MV(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const l=r.J({range:o},(u,h,f)=>(a++,f.delete()));s.push(l.next(()=>{qe(a===1)}));const c=[];for(const u of t.mutations){const h=LF(e,u.key.path,t.batchId);s.push(i.delete(h)),c.push(u.key)}return K.waitFor(s).next(()=>c)}function O_(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ue();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Yi.DEFAULT_COLLECTION_PERCENTILE=10,Yi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Yi.DEFAULT=new Yi(41943040,Yi.DEFAULT_COLLECTION_PERCENTILE,Yi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Yi.DISABLED=new Yi(-1,0,0);class cA{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(e,t,r,i){qe(e.uid!=="");const s=e.isAuthenticated()?e.uid:"";return new cA(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return vc(e).J({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Wf(e),o=vc(e);return o.add({}).next(a=>{qe(typeof a=="number");const l=new mP(a,t,r,i),c=function(v,w,E){const A=E.baseMutations.map(_=>M_(v.ct,_)),T=E.mutations.map(_=>M_(v.ct,_));return{userId:w,batchId:E.batchId,localWriteTimeMs:E.localWriteTime.toMillis(),baseMutations:A,mutations:T}}(this.serializer,this.userId,l),u=[];let h=new fn((f,v)=>vt(f.canonicalString(),v.canonicalString()));for(const f of i){const v=LF(this.userId,f.key.path,a);h=h.add(f.key.path.popLast()),u.push(o.put(c)),u.push(s.put(v,GG))}return h.forEach(f=>{u.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.Fn[a]=l.keys()}),K.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return vc(e).get(t).next(r=>r?(qe(r.userId===this.userId),xd(this.serializer,r)):null)}Mn(e,t){return this.Fn[t]?K.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return vc(e).J({index:"userMutationsIndex",range:i},(o,a,l)=>{a.userId===this.userId&&(qe(a.batchId>=r),s=xd(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return vc(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return vc(e).U("userMutationsIndex",t).next(r=>r.map(i=>xd(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=vb(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Wf(e).J({range:i},(o,a,l)=>{const[c,u,h]=o,f=La(u);if(c===this.userId&&t.path.isEqual(f))return vc(e).get(h).next(v=>{if(!v)throw Ue();qe(v.userId===this.userId),s.push(xd(this.serializer,v))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fn(vt);const i=[];return t.forEach(s=>{const o=vb(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Wf(e).J({range:a},(c,u,h)=>{const[f,v,w]=c,E=La(v);f===this.userId&&s.path.isEqual(E)?r=r.add(w):h.done()});i.push(l)}),K.waitFor(i).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=vb(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new fn(vt);return Wf(e).J({range:o},(l,c,u)=>{const[h,f,v]=l,w=La(f);h===this.userId&&r.isPrefixOf(w)?w.length===i&&(a=a.add(v)):u.done()}).next(()=>this.xn(e,a))}xn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(vc(e).get(s).next(o=>{if(o===null)throw Ue();qe(o.userId===this.userId),r.push(xd(this.serializer,o))}))}),K.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return MV(e._e,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),K.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return K.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return Wf(e).J({range:r},(s,o,a)=>{if(s[0]===this.userId){const l=La(s[1]);i.push(l)}else a.done()}).next(()=>{qe(i.length===0)})})}containsKey(e,t){return NV(e,this.userId,t)}Nn(e){return LV(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function NV(n,e,t){const r=vb(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return Wf(n).J({range:s,H:!0},(a,l,c)=>{const[u,h,f]=a;u===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function vc(n){return Tr(n,"mutations")}function Wf(n){return Tr(n,"documentMutations")}function LV(n){return Tr(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rf{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new rf(0)}static kn(){return new rf(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aW{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const r=new rf(t.highestTargetId);return t.highestTargetId=r.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>rt.fromTimestamp(new xn(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(t,r),this.Qn(e,r))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Of(e).delete(t.targetId)).next(()=>this.qn(e)).next(r=>(qe(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return Of(e).J((o,a)=>{const l=py(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>K.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Of(e).J((r,i)=>{const s=py(i);t(s)})}qn(e){return CD(e).get("targetGlobalKey").next(t=>(qe(t!==null),t))}Qn(e,t){return CD(e).put("targetGlobalKey",t)}Kn(e,t){return Of(e).put(PV(this.serializer,t))}$n(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=ef(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Of(e).J({range:i,index:"queryTargetsIndex"},(o,a,l)=>{const c=py(a);k0(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Lc(e);return t.forEach(o=>{const a=Li(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),K.waitFor(i)}removeMatchingKeys(e,t,r){const i=Lc(e);return K.forEach(t,s=>{const o=Li(s.path);return K.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Lc(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Lc(e);let s=Pt();return i.J({range:r,H:!0},(o,a,l)=>{const c=La(o[1]),u=new Re(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){const r=Li(t.path),i=IDBKeyRange.bound([r],[CF(r)],!1,!0);let s=0;return Lc(e).J({index:"documentTargetsIndex",H:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}ot(e,t){return Of(e).get(t).next(r=>r?py(r):null)}}function Of(n){return Tr(n,"targets")}function CD(n){return Tr(n,"targetGlobal")}function Lc(n){return Tr(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PD([n,e],[t,r]){const i=vt(n,t);return i===0?vt(e,r):i}class lW{constructor(e){this.Un=e,this.buffer=new fn(PD),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();PD(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class cW{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){ce("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ed(t)?ce("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Zu(t)}await this.Hn(3e5)})}}class uW{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return K.resolve(Xi.oe);const r=new lW(t);return this.Jn.forEachTarget(e,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ce("LruGarbageCollector","Garbage collection skipped; disabled"),K.resolve(xD)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ce("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),xD):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let r,i,s,o,a,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(ce("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),jf()<=Lt.DEBUG&&ce("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-u}ms`),K.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}}function dW(n,e){return new uW(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hW{constructor(e,t){this.db=e,this.garbageCollector=dW(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}er(e){let t=0;return this.Zn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(r,i)=>t(i))}addReference(e,t,r){return AE(e,r)}removeReference(e,t,r){return AE(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return AE(e,t)}nr(e,t){return function(i,s){let o=!1;return LV(i).Y(a=>NV(i,a,s).next(l=>(l&&(o=!0),K.resolve(!l)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.tr(e,(o,a)=>{if(a<=t){const l=this.nr(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,rt.min()),Lc(e).delete(function(h){return[0,Li(h.path)]}(o))))});i.push(l)}}).next(()=>K.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return AE(e,t)}tr(e,t){const r=Lc(e);let i,s=Xi.oe;return r.J({index:"documentTargetsIndex"},([o,a],{path:l,sequenceNumber:c})=>{o===0?(s!==Xi.oe&&t(new Re(La(i)),s),s=c,i=l):s=Xi.oe}).next(()=>{s!==Xi.oe&&t(new Re(La(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function AE(n,e){return Lc(n).put(function(r,i){return{targetId:0,path:Li(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OV{constructor(){this.changes=new td(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Qn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?K.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fW{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return pd(e).put(r)}removeEntry(e,t,r){return pd(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],N_(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.rr(e,r)))}getEntry(e,t){let r=Qn.newInvalidDocument(t);return pd(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Hg(t))},(i,s)=>{r=this.ir(t,s)}).next(()=>r)}sr(e,t){let r={size:0,document:Qn.newInvalidDocument(t)};return pd(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Hg(t))},(i,s)=>{r={document:this.ir(t,s),size:O_(s)}}).next(()=>r)}getEntries(e,t){let r=Ms();return this._r(e,t,(i,s)=>{const o=this.ir(i,s);r=r.insert(i,o)}).next(()=>r)}ar(e,t){let r=Ms(),i=new An(Re.comparator);return this._r(e,t,(s,o)=>{const a=this.ir(s,o);r=r.insert(s,a),i=i.insert(s,O_(o))}).next(()=>({documents:r,ur:i}))}_r(e,t,r){if(t.isEmpty())return K.resolve();let i=new fn(DD);t.forEach(l=>i=i.add(l));const s=IDBKeyRange.bound(Hg(i.first()),Hg(i.last())),o=i.getIterator();let a=o.getNext();return pd(e).J({index:"documentKeyIndex",range:s},(l,c,u)=>{const h=Re.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&DD(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.$(Hg(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),N_(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return pd(e).U(IDBKeyRange.bound(a,l,!0)).next(c=>{s==null||s.incrementDocumentReadCount(c.length);let u=Ms();for(const h of c){const f=this.ir(Re.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);f.isFoundDocument()&&(M0(t,f)||i.has(f.key))&&(u=u.insert(f.key,f))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=Ms();const o=kD(t,r),a=kD(t,Us.max());return pd(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{const h=this.ir(Re.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new pW(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return RD(e).get("remoteDocumentGlobalKey").next(t=>(qe(!!t),t))}rr(e,t){return RD(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const r=X9(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(rt.min())))return r}return Qn.newInvalidDocument(e)}}function FV(n){return new fW(n)}class pW extends OV{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new td(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new fn((s,o)=>vt(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,a.readTime)),o.isValidDocument()){const l=gD(this.cr.serializer,o);i=i.add(s.path.popLast());const c=O_(l);r+=c-a.size,t.push(this.cr.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){const l=gD(this.cr.serializer,o.convertToNoDocument(rt.min()));t.push(this.cr.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,r)),K.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(r=>(this.lr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:r,ur:i})=>(i.forEach((s,o)=>{this.lr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function RD(n){return Tr(n,"remoteDocumentGlobal")}function pd(n){return Tr(n,"remoteDocumentsV14")}function Hg(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function kD(n,e){const t=e.documentKey.path.toArray();return[n,N_(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function DD(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=vt(t[s],r[s]),i)return i;return i=vt(t.length,r.length),i||(i=vt(t[t.length-2],r[r.length-2]),i||vt(t[t.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mW{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VV{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Yy(r.mutation,i,Ji.empty(),xn.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Pt()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Pt()){const i=Oa();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=hy();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Oa();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Pt()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Ms();const o=Ky(),a=function(){return Ky()}();return t.forEach((l,c)=>{const u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof uc)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Yy(u.mutation,c,u.mutation.getFieldMask(),xn.now())):o.set(c.key,Ji.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var h;return a.set(c,new mW(u,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Ky();let i=new An((o,a)=>o-a),s=Pt();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=t.get(l);if(c===null)return;let u=r.get(l)||Ji.empty();u=a.applyToLocalView(c,u),r.set(l,u);const h=(i.get(a.batchId)||Pt()).add(l);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,u=l.value,h=iV();u.forEach(f=>{if(!s.has(f)){const v=dV(t.get(f),r.get(f));v!==null&&h.set(f,v),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return K.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return Re.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):JF(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):K.resolve(Oa());let a=-1,l=s;return o.next(c=>K.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(u)?K.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Pt())).next(u=>({batchId:a,changes:rV(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Re(t)).next(r=>{let i=hy();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=hy();return this.indexManager.getCollectionParents(e,s).next(a=>K.forEach(a,l=>{const c=function(h,f){return new yg(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{const u=c.getKey();o.get(u)===null&&(o=o.insert(u,Qn.newInvalidDocument(u)))});let a=hy();return o.forEach((l,c)=>{const u=s.get(l);u!==void 0&&Yy(u.mutation,c,Ji.empty(),xn.now()),M0(t,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gW{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return K.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Oi(i.createTime)}}(t)),K.resolve()}getNamedQuery(e,t){return K.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(i){return{name:i.name,query:RV(i.bundledQuery),readTime:Oi(i.readTime)}}(t)),K.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yW{constructor(){this.overlays=new An(Re.comparator),this.Ir=new Map}getOverlay(e,t){return K.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Oa();return K.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),K.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),K.resolve()}getOverlaysForCollection(e,t,r){const i=Oa(),s=t.length+1,o=new Re(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return K.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new An((c,u)=>c-u);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let u=s.get(c.largestBatchId);u===null&&(u=Oa(),s=s.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const a=Oa(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>a.set(c,u)),!(a.size()>=i)););return K.resolve(a)}ht(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new yP(t,r));let s=this.Ir.get(t);s===void 0&&(s=Pt(),this.Ir.set(t,s)),this.Ir.set(t,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vW{constructor(){this.sessionToken=sr.EMPTY_BYTE_STRING}getSessionToken(e){return K.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,K.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _P{constructor(){this.Tr=new fn(Lr.Er),this.dr=new fn(Lr.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const r=new Lr(e,t);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Vr(new Lr(e,t))}mr(e,t){e.forEach(r=>this.removeReference(r,t))}gr(e){const t=new Re(new Xt([])),r=new Lr(t,e),i=new Lr(t,e+1),s=[];return this.dr.forEachInRange([r,i],o=>{this.Vr(o),s.push(o.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new Re(new Xt([])),r=new Lr(t,e),i=new Lr(t,e+1);let s=Pt();return this.dr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new Lr(e,0),r=this.Tr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class Lr{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return Re.comparator(e.key,t.key)||vt(e.wr,t.wr)}static Ar(e,t){return vt(e.wr,t.wr)||Re.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wW{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new fn(Lr.Er)}checkEmpty(e){return K.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new mP(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.br=this.br.add(new Lr(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return K.resolve(o)}lookupMutationBatch(e,t){return K.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.vr(r),s=i<0?0:i;return K.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return K.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return K.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Lr(t,0),i=new Lr(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],o=>{const a=this.Dr(o.wr);s.push(a)}),K.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fn(vt);return t.forEach(i=>{const s=new Lr(i,0),o=new Lr(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,o],a=>{r=r.add(a.wr)})}),K.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;Re.isDocumentKey(s)||(s=s.child(""));const o=new Lr(new Re(s),0);let a=new fn(vt);return this.br.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(l.wr)),!0)},o),K.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(r=>{const i=this.Dr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){qe(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return K.forEach(t.mutations,i=>{const s=new Lr(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,t){const r=new Lr(t,0),i=this.br.firstAfterOrEqual(r);return K.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,K.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EW{constructor(e){this.Mr=e,this.docs=function(){return new An(Re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Mr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return K.resolve(r?r.document.mutableCopy():Qn.newInvalidDocument(t))}getEntries(e,t){let r=Ms();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Qn.newInvalidDocument(i))}),K.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Ms();const o=t.path,a=new Re(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||oP(RF(u),r)<=0||(i.has(u.key)||M0(t,u))&&(s=s.insert(u.key,u.mutableCopy()))}return K.resolve(s)}getAllFromCollectionGroup(e,t,r,i){Ue()}Or(e,t){return K.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new bW(this)}getSize(e){return K.resolve(this.size)}}class bW extends OV{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),K.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _W{constructor(e){this.persistence=e,this.Nr=new td(t=>ef(t),k0),this.lastRemoteSnapshotVersion=rt.min(),this.highestTargetId=0,this.Lr=0,this.Br=new _P,this.targetCount=0,this.kr=rf.Bn()}forEachTarget(e,t){return this.Nr.forEach((r,i)=>t(i)),K.resolve()}getLastRemoteSnapshotVersion(e){return K.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return K.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),K.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Lr&&(this.Lr=t),K.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new rf(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,K.resolve()}updateTargetData(e,t){return this.Kn(t),K.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,K.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Nr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Nr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),K.waitFor(s).next(()=>i)}getTargetCount(e){return K.resolve(this.targetCount)}getTargetData(e,t){const r=this.Nr.get(t)||null;return K.resolve(r)}addMatchingKeys(e,t,r){return this.Br.Rr(t,r),K.resolve()}removeMatchingKeys(e,t,r){this.Br.mr(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),K.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),K.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Br.yr(t);return K.resolve(r)}containsKey(e,t){return K.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UV{constructor(e,t){this.qr={},this.overlays={},this.Qr=new Xi(0),this.Kr=!1,this.Kr=!0,this.$r=new vW,this.referenceDelegate=e(this),this.Ur=new _W(this),this.indexManager=new sW,this.remoteDocumentCache=function(i){return new EW(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new CV(t),this.Gr=new gW(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new yW,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.qr[e.toKey()];return r||(r=new wW(t,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,r){ce("MemoryPersistence","Starting transaction:",e);const i=new SW(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return K.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,t)))}}class SW extends DF{constructor(e){super(),this.currentSequenceNumber=e}}class uA{constructor(e){this.persistence=e,this.Jr=new _P,this.Yr=null}static Zr(e){return new uA(e)}get Xr(){if(this.Yr)return this.Yr;throw Ue()}addReference(e,t,r){return this.Jr.addReference(r,t),this.Xr.delete(r.toString()),K.resolve()}removeReference(e,t,r){return this.Jr.removeReference(r,t),this.Xr.add(r.toString()),K.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),K.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return K.forEach(this.Xr,r=>{const i=Re.fromPath(r);return this.ei(e,i).next(s=>{s||t.removeEntry(i,rt.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(r=>{r?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return K.or([()=>K.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AW{constructor(e){this.serializer=e}O(e,t,r,i){const s=new nA("createOrUpgrade",t);r<1&&i>=1&&(function(l){l.createObjectStore("owner")}(e),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",W2,{unique:!0}),l.createObjectStore("documentMutations")}(e),MD(e),function(l){l.createObjectStore("remoteDocuments")}(e));let o=K.resolve();return r<3&&i>=3&&(r!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),MD(e)),o=o.next(()=>function(l){const c=l.store("targetGlobal"),u={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rt.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",u)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store("mutations").U().next(u=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",W2,{unique:!0});const h=c.store("mutations"),f=u.map(v=>h.put(v));return K.waitFor(f)})}(e,s))),o=o.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.ni(s))),r<6&&i>=6&&(o=o.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),r<7&&i>=7&&(o=o.next(()=>this.ii(s))),r<8&&i>=8&&(o=o.next(()=>this.si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.oi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore("documentOverlays",{keyPath:r9});c.createIndex("collectionPathOverlayIndex",i9,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",s9,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore("remoteDocumentsV14",{keyPath:WG});c.createIndex("documentKeyIndex",qG),c.createIndex("collectionGroupIndex",KG)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ai(e,s))),r<15&&i>=15&&(o=o.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:ZG}).createIndex("sequenceNumberIndex",e9,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:t9}).createIndex("documentKeyIndex",n9,{unique:!1})}(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(l){l.createObjectStore("globals",{keyPath:"name"})})(e)})),o}ri(e){let t=0;return e.store("remoteDocuments").J((r,i)=>{t+=O_(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.U().next(i=>K.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",o).next(a=>K.forEach(a,l=>{qe(l.userId===s.userId);const c=xd(this.serializer,l);return MV(e,s.userId,c).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.J((o,a)=>{const l=new Xt(o),c=function(h){return[0,Li(h)]}(l);s.push(t.get(c).next(u=>u?K.resolve():(h=>t.put({targetId:0,path:Li(h),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>K.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:JG});const r=t.store("collectionParents"),i=new bP,s=o=>{if(i.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Li(l)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const l=new Xt(o);return s(l.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,l],c)=>{const u=La(a);return s(u.popLast())}))}oi(e){const t=e.store("targets");return t.J((r,i)=>{const s=py(i),o=PV(this.serializer,s);return t.put(o)})}_i(e,t){const r=t.store("remoteDocuments"),i=[];return r.J((s,o)=>{const a=t.store("remoteDocumentsV14"),l=function(h){return h.document?new Re(Xt.fromString(h.document.name).popFirst(5)):h.noDocument?Re.fromSegments(h.noDocument.path):h.unknownDocument?Re.fromSegments(h.unknownDocument.path):Ue()}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>K.waitFor(i))}ai(e,t){const r=t.store("mutations"),i=FV(this.serializer),s=new UV(uA.Zr,this.serializer.ct);return r.U().next(o=>{const a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:Pt();xd(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),K.forEach(a,(l,c)=>{const u=new Or(c),h=lA.lt(this.serializer,u),f=s.getIndexManager(u),v=cA.lt(u,this.serializer,f,s.referenceDelegate);return new VV(i,v,h,f).recalculateAndSaveOverlaysForDocumentKeys(new ZT(t,Xi.oe),l).next()})})}}function MD(n){n.createObjectStore("targetDocuments",{keyPath:QG}).createIndex("documentTargetsIndex",XG,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",YG,{unique:!0}),n.createObjectStore("targetGlobal")}const M1="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class SP{constructor(e,t,r,i,s,o,a,l,c,u,h=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ui=s,this.window=o,this.document=a,this.ci=c,this.li=u,this.hi=h,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=f=>Promise.resolve(),!SP.D())throw new be(ne.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new hW(this,i),this.Ai=t+"main",this.serializer=new CV(l),this.Ri=new Pu(this.Ai,this.hi,new AW(this.serializer)),this.$r=new Z9,this.Ur=new aW(this.referenceDelegate,this.serializer),this.remoteDocumentCache=FV(this.serializer),this.Gr=new J9,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,u===!1&&rr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new be(ne.FAILED_PRECONDITION,M1);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new Xi(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>TE(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(ed(e))return ce("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ce("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return Gg(e).get("owner").next(t=>K.resolve(this.vi(t)))}Ci(e){return TE(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=Tr(t,"clientMetadata");return r.U().next(i=>{const s=this.xi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return K.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?K.resolve(!0):Gg(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new be(ne.FAILED_PRECONDITION,M1);return!1}}return!(!this.networkEnabled||!this.inForeground)||TE(e).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){const s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&ce("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new ZT(e,Xi.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(r=>this.Mi(r.updateTimeMs,t)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>TE(e).U().next(t=>this.xi(t,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return cA.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new oW(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return lA.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,r){ce("IndexedDbPersistence","Starting transaction:",e);const i=t==="readonly"?"readonly":"readwrite",s=function(l){return l===17?l9:l===16?a9:l===15?lP:l===14?VF:l===13?FF:l===12?o9:l===11?OF:void Ue()}(this.hi);let o;return this.Ri.runTransaction(e,i,s,a=>(o=new ZT(a,this.Qr?this.Qr.next():Xi.oe),t==="readwrite-primary"?this.wi(o).next(l=>!!l||this.Si(o)).next(l=>{if(!l)throw rr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new be(ne.FAILED_PRECONDITION,kF);return r(o)}).next(l=>this.Di(o).next(()=>l)):this.Ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ki(e){return Gg(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new be(ne.FAILED_PRECONDITION,M1)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Gg(e).put("owner",t)}static D(){return Pu.D()}bi(e){const t=Gg(e);return t.get("owner").next(r=>this.vi(r)?(ce("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):K.resolve())}Mi(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(rr(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;kO()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const r=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return ce("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return rr("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){rr("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Gg(n){return Tr(n,"owner")}function TE(n){return Tr(n,"clientMetadata")}function BV(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.$i=r,this.Ui=i}static Wi(e,t){let r=Pt(),i=Pt();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new AP(e,t.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TW{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $V{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return kO()?8:MF(Ar())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.Yi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Zi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new TW;return this.Xi(e,t,o).next(a=>{if(s.result=a,this.zi)return this.es(e,t,o,a.size)})}).next(()=>s.result)}es(e,t,r,i){return r.documentReadCount<this.ji?(jf()<=Lt.DEBUG&&ce("QueryEngine","SDK will not create cache indexes for query:",zf(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),K.resolve()):(jf()<=Lt.DEBUG&&ce("QueryEngine","Query:",zf(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(jf()<=Lt.DEBUG&&ce("QueryEngine","The SDK decides to create cache indexes for query:",zf(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ls(t))):K.resolve())}Yi(e,t){if(sD(t))return K.resolve(null);let r=Ls(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=k_(t,null,"F"),r=Ls(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=Pt(...s);return this.Ji.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.ts(t,a);return this.ns(t,c,o,l.readTime)?this.Yi(e,k_(t,null,"F")):this.rs(e,c,t,l)}))})))}Zi(e,t,r,i){return sD(t)||i.isEqual(rt.min())?K.resolve(null):this.Ji.getDocuments(e,r).next(s=>{const o=this.ts(t,s);return this.ns(t,o,r,i)?K.resolve(null):(jf()<=Lt.DEBUG&&ce("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),zf(t)),this.rs(e,o,t,PF(i,-1)).next(a=>a))})}ts(e,t){let r=new fn(tV(e));return t.forEach((i,s)=>{M0(e,s)&&(r=r.add(s))}),r}ns(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,r){return jf()<=Lt.DEBUG&&ce("QueryEngine","Using full collection scan to execute query:",zf(t)),this.Ji.getDocumentsMatchingQuery(e,t,Us.min(),r)}rs(e,t,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IW{constructor(e,t,r,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new An(vt),this._s=new td(s=>ef(s),k0),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new VV(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function jV(n,e,t,r){return new IW(n,e,t,r)}async function zV(n,e){const t=je(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let l=Pt();for(const c of i){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of s){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return t.localDocuments.getDocuments(r,l).next(c=>({hs:c,removedBatchIds:o,addedBatchIds:a}))})})}function xW(n,e){const t=je(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,u){const h=c.batch,f=h.keys();let v=K.resolve();return f.forEach(w=>{v=v.next(()=>u.getEntry(l,w)).next(E=>{const A=c.docVersions.get(w);qe(A!==null),E.version.compareTo(A)<0&&(h.applyToRemoteDocument(E,c),E.isValidDocument()&&(E.setReadTime(c.commitVersion),u.addEntry(E)))})}),v.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Pt();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function HV(n){const e=je(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function CW(n,e){const t=je(n),r=e.snapshotVersion;let i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;const a=[];e.targetChanges.forEach((u,h)=>{const f=i.get(h);if(!f)return;a.push(t.Ur.removeMatchingKeys(s,u.removedDocuments,h).next(()=>t.Ur.addMatchingKeys(s,u.addedDocuments,h)));let v=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?v=v.withResumeToken(sr.EMPTY_BYTE_STRING,rt.min()).withLastLimboFreeSnapshotVersion(rt.min()):u.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(u.resumeToken,r)),i=i.insert(h,v),function(E,A,T){return E.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=3e8?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0}(f,v,u)&&a.push(t.Ur.updateTargetData(s,v))});let l=Ms(),c=Pt();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(PW(s,o,e.documentUpdates).next(u=>{l=u.Ps,c=u.Is})),!r.isEqual(rt.min())){const u=t.Ur.getLastRemoteSnapshotVersion(s).next(h=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return K.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.os=i,s))}function PW(n,e,t){let r=Pt(),i=Pt();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Ms();return t.forEach((a,l)=>{const c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(rt.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ce("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Ps:o,Is:i}})}function RW(n,e){const t=je(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function F_(n,e){const t=je(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Ur.getTargetData(r,e).next(s=>s?(i=s,K.resolve(i)):t.Ur.allocateTargetId(r).next(o=>(i=new Gl(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(r.targetId,r),t._s.set(e,r.targetId)),r})}async function Jm(n,e,t){const r=je(n),i=r.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!ed(o))throw o;ce("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(i.target)}function fI(n,e,t){const r=je(n);let i=rt.min(),s=Pt();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,u){const h=je(l),f=h._s.get(u);return f!==void 0?K.resolve(h.os.get(f)):h.Ur.getTargetData(c,u)}(r,o,Ls(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,t?i:rt.min(),t?s:Pt())).next(a=>(qV(r,eV(e),a),{documents:a,Ts:s})))}function GV(n,e){const t=je(n),r=je(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(o=>o?o.target:null))}function WV(n,e){const t=je(n),r=t.us.get(e)||rt.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,PF(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(qV(t,e,i),i))}function qV(n,e,t){let r=n.us.get(e)||rt.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.us.set(e,r)}function ND(n,e){return`firestore_clients_${n}_${e}`}function LD(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function N1(n,e){return`firestore_targets_${n}_${e}`}class V_{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Rs(e,t,r){const i=JSON.parse(r);let s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new be(i.error.code,i.error.message))),o?new V_(e,t,i.state,s):(rr("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Qy{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Rs(e,t){const r=JSON.parse(t);let i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new be(r.error.code,r.error.message))),s?new Qy(e,r.state,i):(rr("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class U_{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const r=JSON.parse(t);let i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=hP();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=NF(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new U_(e,s):(rr("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class TP{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new TP(t.clientId,t.onlineState):(rr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class pI{constructor(){this.activeTargetIds=hP()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class L1{constructor(e,t,r,i,s){this.window=e,this.ui=t,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new An(vt),this.started=!1,this.bs=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=ND(this.persistenceKey,this.ps),this.vs=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new pI),this.Cs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.xs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Os=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const i=this.getItem(ND(this.persistenceKey,r));if(i){const s=U_.Rs(r,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const r=this.Ls(t);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,r){this.qs(e,t,r),this.Qs(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(N1(this.persistenceKey,e));if(i){const s=Qy.Rs(e,i);s&&(r=s.state)}}return t&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(N1(this.persistenceKey,e))}updateQueryState(e,t,r){this.$s(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ce("SharedClientState","READ",e,t),t}setItem(e,t){ce("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ce("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(ce("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void rr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const r=this.Gs(t.key);return this.zs(r,null)}{const r=this.js(t.key,t.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const r=this.Hs(t.key,t.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const r=this.Ys(t.key,t.newValue);if(r)return this.Zs(r)}}else if(t.key===this.xs){if(t.newValue!==null){const r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs){const r=function(s){let o=Xi.oe;if(s!=null)try{const a=JSON.parse(s);qe(typeof a=="number"),o=a}catch(a){rr("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Xi.oe&&this.sequenceNumberHandler(r)}else if(t.key===this.Os){const r=this.Xs(t.newValue);await Promise.all(r.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,r){const i=new V_(this.currentUser,e,t,r),s=LD(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){const t=LD(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,r){const i=N1(this.persistenceKey,e),s=new Qy(e,t,r);this.setItem(i,s.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const r=this.Gs(e);return U_.Rs(r,t)}Hs(e,t){const r=this.Fs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return V_.Rs(new Or(s),i,t)}Ys(e,t){const r=this.Ms.exec(e),i=Number(r[1]);return Qy.Rs(i,t)}Ls(e){return TP.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);ce("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const r=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.io(o,a).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=hP();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class KV{constructor(){this.so=new pI,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,r){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new pI,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kW{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ce("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ce("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IE=null;function O1(){return IE===null?IE=function(){return 268435456+Math.round(2147483648*Math.random())}():IE++,"0x"+IE.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DW={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MW{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ii="WebChannelConnection";class NW extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,r,i,s,o){const a=O1(),l=this.xo(t,r.toUriEncodedString());ce("RestConnection",`Sending RPC '${t}' ${a}:`,l,i);const c={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(c,s,o),this.No(t,l,c,i).then(u=>(ce("RestConnection",`Received RPC '${t}' ${a}: `,u),u),u=>{throw jm("RestConnection",`RPC '${t}' ${a} failed with error: `,u,"url: ",l,"request:",i),u})}Lo(t,r,i,s,o,a){return this.Mo(t,r,i,s,o)}Oo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+gg}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}xo(t,r){const i=DW[t];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,r,i){const s=O1();return new Promise((o,a)=>{const l=new bF;l.setWithCredentials(!0),l.listenOnce(_F.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case gb.NO_ERROR:const u=l.getResponseJson();ce(ii,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(u)),o(u);break;case gb.TIMEOUT:ce(ii,`RPC '${e}' ${s} timed out`),a(new be(ne.DEADLINE_EXCEEDED,"Request time out"));break;case gb.HTTP_ERROR:const h=l.getStatus();if(ce(ii,`RPC '${e}' ${s} failed with status:`,h,"response text:",l.getResponseText()),h>0){let f=l.getResponseJson();Array.isArray(f)&&(f=f[0]);const v=f==null?void 0:f.error;if(v&&v.status&&v.message){const w=function(A){const T=A.toLowerCase().replace(/_/g,"-");return Object.values(ne).indexOf(T)>=0?T:ne.UNKNOWN}(v.status);a(new be(w,v.message))}else a(new be(ne.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new be(ne.UNAVAILABLE,"Connection failed."));break;default:Ue()}}finally{ce(ii,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);ce(ii,`RPC '${e}' ${s} sending request:`,i),l.send(t,"POST",c,r,15)})}Bo(e,t,r){const i=O1(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=TF(),a=AF(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Oo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const u=s.join("");ce(ii,`Creating RPC '${e}' stream ${i}: ${u}`,l);const h=o.createWebChannel(u,l);let f=!1,v=!1;const w=new MW({Io:A=>{v?ce(ii,`Not sending because RPC '${e}' stream ${i} is closed:`,A):(f||(ce(ii,`Opening RPC '${e}' stream ${i} transport.`),h.open(),f=!0),ce(ii,`RPC '${e}' stream ${i} sending:`,A),h.send(A))},To:()=>h.close()}),E=(A,T,_)=>{A.listen(T,b=>{try{_(b)}catch(g){setTimeout(()=>{throw g},0)}})};return E(h,dy.EventType.OPEN,()=>{v||(ce(ii,`RPC '${e}' stream ${i} transport opened.`),w.yo())}),E(h,dy.EventType.CLOSE,()=>{v||(v=!0,ce(ii,`RPC '${e}' stream ${i} transport closed`),w.So())}),E(h,dy.EventType.ERROR,A=>{v||(v=!0,jm(ii,`RPC '${e}' stream ${i} transport errored:`,A),w.So(new be(ne.UNAVAILABLE,"The operation could not be completed")))}),E(h,dy.EventType.MESSAGE,A=>{var T;if(!v){const _=A.data[0];qe(!!_);const b=_,g=b.error||((T=b[0])===null||T===void 0?void 0:T.error);if(g){ce(ii,`RPC '${e}' stream ${i} received error:`,g);const y=g.status;let x=function(P){const N=dr[P];if(N!==void 0)return pV(N)}(y),S=g.message;x===void 0&&(x=ne.INTERNAL,S="Unknown error status: "+y+" with message "+g.message),v=!0,w.So(new be(x,S)),h.close()}else ce(ii,`RPC '${e}' stream ${i} received:`,_),w.bo(_)}}),E(a,SF.STAT_EVENT,A=>{A.stat===XT.PROXY?ce(ii,`RPC '${e}' stream ${i} detected buffering proxy`):A.stat===XT.NOPROXY&&ce(ii,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{w.wo()},0),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YV(){return typeof window<"u"?window:null}function Sb(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dA(n){return new $9(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QV{constructor(e,t,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-r);i>0&&ce("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XV{constructor(e,t,r,i,s,o,a,l){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new QV(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===ne.RESOURCE_EXHAUSTED?(rr(t.toString()),rr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===ne.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===t&&this.P_(r,i)},r=>{e(()=>{const i=new be(ne.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,t){const r=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ce("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(ce("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class LW extends XV{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=H9(this.serializer,e),r=function(s){if(!("targetChange"in s))return rt.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?rt.min():o.readTime?Oi(o.readTime):rt.min()}(e);return this.listener.d_(t,r)}A_(e){const t={};t.database=lI(this.serializer),t.addTarget=function(s,o){let a;const l=o.target;if(a=P_(l)?{documents:_V(s,l)}:{query:SV(s,l)._t},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=yV(s,o.resumeToken);const c=oI(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(rt.min())>0){a.readTime=Xm(s,o.snapshotVersion.toTimestamp());const c=oI(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=W9(this.serializer,e);r&&(t.labels=r),this.a_(t)}R_(e){const t={};t.database=lI(this.serializer),t.removeTarget=e,this.a_(t)}}class OW extends XV{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return qe(!!e.streamToken),this.lastStreamToken=e.streamToken,qe(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){qe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=G9(e.writeResults,e.commitTime),r=Oi(e.commitTime);return this.listener.g_(r,t)}p_(){const e={};e.database=lI(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>M_(this.serializer,r))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FW extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new be(ne.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Mo(e,aI(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new be(ne.UNKNOWN,s.toString())})}Lo(e,t,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Lo(e,aI(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===ne.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new be(ne.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class VW{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(rr(t),this.D_=!1):ce("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UW{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(o=>{r.enqueueAndForget(async()=>{vf(this)&&(ce("RemoteStore","Restarting streams for network reachability change."),await async function(l){const c=je(l);c.L_.add(4),await F0(c),c.q_.set("Unknown"),c.L_.delete(4),await hA(c)}(this))})}),this.q_=new VW(r,i)}}async function hA(n){if(vf(n))for(const e of n.B_)await e(!0)}async function F0(n){for(const e of n.B_)await e(!1)}function fA(n,e){const t=je(n);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),CP(t)?xP(t):Eg(t).r_()&&IP(t,e))}function Zm(n,e){const t=je(n),r=Eg(t);t.N_.delete(e),r.r_()&&JV(t,e),t.N_.size===0&&(r.r_()?r.o_():vf(t)&&t.q_.set("Unknown"))}function IP(n,e){if(n.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(rt.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Eg(n).A_(e)}function JV(n,e){n.Q_.xe(e),Eg(n).R_(e)}function xP(n){n.Q_=new F9({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>n.N_.get(e)||null,tt:()=>n.datastore.serializer.databaseId}),Eg(n).start(),n.q_.v_()}function CP(n){return vf(n)&&!Eg(n).n_()&&n.N_.size>0}function vf(n){return je(n).L_.size===0}function ZV(n){n.Q_=void 0}async function BW(n){n.q_.set("Online")}async function $W(n){n.N_.forEach((e,t)=>{IP(n,e)})}async function jW(n,e){ZV(n),CP(n)?(n.q_.M_(e),xP(n)):n.q_.set("Unknown")}async function zW(n,e,t){if(n.q_.set("Online"),e instanceof gV&&e.state===2&&e.cause)try{await async function(i,s){const o=s.cause;for(const a of s.targetIds)i.N_.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.N_.delete(a),i.Q_.removeTarget(a))}(n,e)}catch(r){ce("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await B_(n,r)}else if(e instanceof _b?n.Q_.Ke(e):e instanceof mV?n.Q_.He(e):n.Q_.We(e),!t.isEqual(rt.min()))try{const r=await HV(n.localStore);t.compareTo(r)>=0&&await function(s,o){const a=s.Q_.rt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const u=s.N_.get(c);u&&s.N_.set(c,u.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const u=s.N_.get(l);if(!u)return;s.N_.set(l,u.withResumeToken(sr.EMPTY_BYTE_STRING,u.snapshotVersion)),JV(s,l);const h=new Gl(u.target,l,c,u.sequenceNumber);IP(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){ce("RemoteStore","Failed to raise snapshot:",r),await B_(n,r)}}async function B_(n,e,t){if(!ed(e))throw e;n.L_.add(1),await F0(n),n.q_.set("Offline"),t||(t=()=>HV(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ce("RemoteStore","Retrying IndexedDB access"),await t(),n.L_.delete(1),await hA(n)})}function eU(n,e){return e().catch(t=>B_(n,t,e))}async function wg(n){const e=je(n),t=zu(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;HW(e);)try{const i=await RW(e.localStore,r);if(i===null){e.O_.length===0&&t.o_();break}r=i.batchId,GW(e,i)}catch(i){await B_(e,i)}tU(e)&&nU(e)}function HW(n){return vf(n)&&n.O_.length<10}function GW(n,e){n.O_.push(e);const t=zu(n);t.r_()&&t.V_&&t.m_(e.mutations)}function tU(n){return vf(n)&&!zu(n).n_()&&n.O_.length>0}function nU(n){zu(n).start()}async function WW(n){zu(n).p_()}async function qW(n){const e=zu(n);for(const t of n.O_)e.m_(t.mutations)}async function KW(n,e,t){const r=n.O_.shift(),i=gP.from(r,e,t);await eU(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await wg(n)}async function YW(n,e){e&&zu(n).V_&&await async function(r,i){if(function(o){return N9(o)&&o!==ne.ABORTED}(i.code)){const s=r.O_.shift();zu(r).s_(),await eU(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await wg(r)}}(n,e),tU(n)&&nU(n)}async function FD(n,e){const t=je(n);t.asyncQueue.verifyOperationInProgress(),ce("RemoteStore","RemoteStore received new credentials");const r=vf(t);t.L_.add(3),await F0(t),r&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await hA(t)}async function mI(n,e){const t=je(n);e?(t.L_.delete(2),await hA(t)):e||(t.L_.add(2),await F0(t),t.q_.set("Unknown"))}function Eg(n){return n.K_||(n.K_=function(t,r,i){const s=je(t);return s.w_(),new LW(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:BW.bind(null,n),Ro:$W.bind(null,n),mo:jW.bind(null,n),d_:zW.bind(null,n)}),n.B_.push(async e=>{e?(n.K_.s_(),CP(n)?xP(n):n.q_.set("Unknown")):(await n.K_.stop(),ZV(n))})),n.K_}function zu(n){return n.U_||(n.U_=function(t,r,i){const s=je(t);return s.w_(),new OW(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Eo:()=>Promise.resolve(),Ro:WW.bind(null,n),mo:YW.bind(null,n),f_:qW.bind(null,n),g_:KW.bind(null,n)}),n.B_.push(async e=>{e?(n.U_.s_(),await wg(n)):(await n.U_.stop(),n.O_.length>0&&(ce("RemoteStore",`Stopping write stream with ${n.O_.length} pending writes`),n.O_=[]))})),n.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new $a,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new PP(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new be(ne.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function RP(n,e){if(rr("AsyncQueue",`${e}: ${n}`),ed(n))return new be(ne.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sp{constructor(e){this.comparator=e?(t,r)=>e(t,r)||Re.comparator(t.key,r.key):(t,r)=>Re.comparator(t.key,r.key),this.keyedMap=hy(),this.sortedSet=new An(this.comparator)}static emptySet(e){return new Sp(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Sp)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Sp;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VD{constructor(){this.W_=new An(Re.comparator)}track(e){const t=e.doc.key,r=this.W_.get(t);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(t,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(t):e.type===1&&r.type===2?this.W_=this.W_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):Ue():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,r)=>{e.push(r)}),e}}class eg{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new eg(e,t,Sp.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sA(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QW{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class XW{constructor(){this.queries=UD(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,r){const i=je(t),s=i.queries;i.queries=UD(),s.forEach((o,a)=>{for(const l of a.j_)l.onError(r)})})(this,new be(ne.ABORTED,"Firestore shutting down"))}}function UD(){return new td(n=>ZF(n),sA)}async function kP(n,e){const t=je(n);let r=3;const i=e.query;let s=t.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new QW,r=e.J_()?0:1);try{switch(r){case 0:s.z_=await t.onListen(i,!0);break;case 1:s.z_=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){const a=RP(o,`Initialization of query '${zf(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&MP(t)}async function DP(n,e){const t=je(n),r=e.query;let i=3;const s=t.queries.get(r);if(s){const o=s.j_.indexOf(e);o>=0&&(s.j_.splice(o,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function JW(n,e){const t=je(n);let r=!1;for(const i of e){const s=i.query,o=t.queries.get(s);if(o){for(const a of o.j_)a.X_(i)&&(r=!0);o.z_=i}}r&&MP(t)}function ZW(n,e,t){const r=je(n),i=r.queries.get(e);if(i)for(const s of i.j_)s.onError(t);r.queries.delete(e)}function MP(n){n.Y_.forEach(e=>{e.next()})}var gI,BD;(BD=gI||(gI={})).ea="default",BD.Cache="cache";class NP{constructor(e,t,r){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new eg(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const r=t!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=eg.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==gI.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rU{constructor(e){this.key=e}}class iU{constructor(e){this.key=e}}class eq{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Pt(),this.mutatedKeys=Pt(),this.Aa=tV(e),this.Ra=new Sp(this.Aa)}get Va(){return this.Ta}ma(e,t){const r=t?t.fa:new VD,i=t?t.Ra:this.Ra;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,h)=>{const f=i.get(u),v=M0(this.query,h)?h:null,w=!!f&&this.mutatedKeys.has(f.key),E=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let A=!1;f&&v?f.data.isEqual(v.data)?w!==E&&(r.track({type:3,doc:v}),A=!0):this.ga(f,v)||(r.track({type:2,doc:v}),A=!0,(l&&this.Aa(v,l)>0||c&&this.Aa(v,c)<0)&&(a=!0)):!f&&v?(r.track({type:0,doc:v}),A=!0):f&&!v&&(r.track({type:1,doc:f}),A=!0,(l||c)&&(a=!0)),A&&(v?(o=o.add(v),s=E?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{Ra:o,fa:r,ns:a,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((u,h)=>function(v,w){const E=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ue()}};return E(v)-E(w)}(u.type,h.type)||this.Aa(u.doc,h.doc)),this.pa(r),i=i!=null&&i;const a=t&&!i?this.ya():[],l=this.da.size===0&&this.current&&!i?1:0,c=l!==this.Ea;return this.Ea=l,o.length!==0||c?{snapshot:new eg(this.query,e.Ra,s,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new VD,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Pt(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const t=[];return e.forEach(r=>{this.da.has(r)||t.push(new iU(r))}),this.da.forEach(r=>{e.has(r)||t.push(new rU(r))}),t}ba(e){this.Ta=e.Ts,this.da=Pt();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return eg.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class tq{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class nq{constructor(e){this.key=e,this.va=!1}}class rq{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new td(a=>ZF(a),sA),this.Ma=new Map,this.xa=new Set,this.Oa=new An(Re.comparator),this.Na=new Map,this.La=new _P,this.Ba={},this.ka=new Map,this.qa=rf.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function iq(n,e,t=!0){const r=pA(n);let i;const s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=await sU(r,e,t,!0),i}async function sq(n,e){const t=pA(n);await sU(t,e,!0,!1)}async function sU(n,e,t,r){const i=await F_(n.localStore,Ls(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t);let a;return r&&(a=await LP(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&fA(n.remoteStore,i),a}async function LP(n,e,t,r,i){n.Ka=(h,f,v)=>async function(E,A,T,_){let b=A.view.ma(T);b.ns&&(b=await fI(E.localStore,A.query,!1).then(({documents:S})=>A.view.ma(S,b)));const g=_&&_.targetChanges.get(A.targetId),y=_&&_.targetMismatches.get(A.targetId)!=null,x=A.view.applyChanges(b,E.isPrimaryClient,g,y);return yI(E,A.targetId,x.wa),x.snapshot}(n,h,f,v);const s=await fI(n.localStore,e,!0),o=new eq(e,s.Ts),a=o.ma(s.documents),l=O0.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);yI(n,t,c.wa);const u=new tq(e,t,o);return n.Fa.set(e,u),n.Ma.has(t)?n.Ma.get(t).push(e):n.Ma.set(t,[e]),c.snapshot}async function oq(n,e,t){const r=je(n),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(o=>!sA(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Jm(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Zm(r.remoteStore,i.targetId),tg(r,i.targetId)}).catch(Zu)):(tg(r,i.targetId),await Jm(r.localStore,i.targetId,!0))}async function aq(n,e){const t=je(n),r=t.Fa.get(e),i=t.Ma.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Zm(t.remoteStore,r.targetId))}async function lq(n,e,t){const r=UP(n);try{const i=await function(o,a){const l=je(o),c=xn.now(),u=a.reduce((v,w)=>v.add(w.key),Pt());let h,f;return l.persistence.runTransaction("Locally write mutations","readwrite",v=>{let w=Ms(),E=Pt();return l.cs.getEntries(v,u).next(A=>{w=A,w.forEach((T,_)=>{_.isValidDocument()||(E=E.add(T))})}).next(()=>l.localDocuments.getOverlayedDocuments(v,w)).next(A=>{h=A;const T=[];for(const _ of a){const b=D9(_,h.get(_.key).overlayedDocument);b!=null&&T.push(new uc(_.key,b,zF(b.value.mapValue),br.exists(!0)))}return l.mutationQueue.addMutationBatch(v,c,T,a)}).next(A=>{f=A;const T=A.applyToLocalDocumentSet(h,E);return l.documentOverlayCache.saveOverlays(v,A.batchId,T)})}).then(()=>({batchId:f.batchId,changes:rV(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,l){let c=o.Ba[o.currentUser.toKey()];c||(c=new An(vt)),c=c.insert(a,l),o.Ba[o.currentUser.toKey()]=c}(r,i.batchId,t),await nd(r,i.changes),await wg(r.remoteStore)}catch(i){const s=RP(i,"Failed to persist write");t.reject(s)}}async function oU(n,e){const t=je(n);try{const r=await CW(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.Na.get(s);o&&(qe(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.va=!0:i.modifiedDocuments.size>0?qe(o.va):i.removedDocuments.size>0&&(qe(o.va),o.va=!1))}),await nd(t,r,e)}catch(r){await Zu(r)}}function $D(n,e,t){const r=je(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.Fa.forEach((s,o)=>{const a=o.view.Z_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const l=je(o);l.onlineState=a;let c=!1;l.queries.forEach((u,h)=>{for(const f of h.j_)f.Z_(a)&&(c=!0)}),c&&MP(l)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function cq(n,e,t){const r=je(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.Na.get(e),s=i&&i.key;if(s){let o=new An(Re.comparator);o=o.insert(s,Qn.newNoDocument(s,rt.min()));const a=Pt().add(s),l=new L0(rt.min(),new Map,new An(vt),o,a);await oU(r,l),r.Oa=r.Oa.remove(s),r.Na.delete(e),VP(r)}else await Jm(r.localStore,e,!1).then(()=>tg(r,e,t)).catch(Zu)}async function uq(n,e){const t=je(n),r=e.batch.batchId;try{const i=await xW(t.localStore,e);FP(t,r,null),OP(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await nd(t,i)}catch(i){await Zu(i)}}async function dq(n,e,t){const r=je(n);try{const i=await function(o,a){const l=je(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let u;return l.mutationQueue.lookupMutationBatch(c,a).next(h=>(qe(h!==null),u=h.keys(),l.mutationQueue.removeMutationBatch(c,h))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,u,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,u)).next(()=>l.localDocuments.getDocuments(c,u))})}(r.localStore,e);FP(r,e,t),OP(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await nd(r,i)}catch(i){await Zu(i)}}function OP(n,e){(n.ka.get(e)||[]).forEach(t=>{t.resolve()}),n.ka.delete(e)}function FP(n,e,t){const r=je(n);let i=r.Ba[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function tg(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Ma.get(e))n.Fa.delete(r),t&&n.Ca.$a(r,t);n.Ma.delete(e),n.isPrimaryClient&&n.La.gr(e).forEach(r=>{n.La.containsKey(r)||aU(n,r)})}function aU(n,e){n.xa.delete(e.path.canonicalString());const t=n.Oa.get(e);t!==null&&(Zm(n.remoteStore,t),n.Oa=n.Oa.remove(e),n.Na.delete(t),VP(n))}function yI(n,e,t){for(const r of t)r instanceof rU?(n.La.addReference(r.key,e),hq(n,r)):r instanceof iU?(ce("SyncEngine","Document no longer in limbo: "+r.key),n.La.removeReference(r.key,e),n.La.containsKey(r.key)||aU(n,r.key)):Ue()}function hq(n,e){const t=e.key,r=t.path.canonicalString();n.Oa.get(t)||n.xa.has(r)||(ce("SyncEngine","New document in limbo: "+t),n.xa.add(r),VP(n))}function VP(n){for(;n.xa.size>0&&n.Oa.size<n.maxConcurrentLimboResolutions;){const e=n.xa.values().next().value;n.xa.delete(e);const t=new Re(Xt.fromString(e)),r=n.qa.next();n.Na.set(r,new nq(t)),n.Oa=n.Oa.insert(t,r),fA(n.remoteStore,new Gl(Ls(D0(t.path)),r,"TargetPurposeLimboResolution",Xi.oe))}}async function nd(n,e,t){const r=je(n),i=[],s=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((a,l)=>{o.push(r.Ka(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){const h=c?!c.fromCache:(u=t==null?void 0:t.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){i.push(c);const h=AP.Wi(l.targetId,c);s.push(h)}}))}),await Promise.all(o),r.Ca.d_(i),await async function(l,c){const u=je(l);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>K.forEach(c,f=>K.forEach(f.$i,v=>u.persistence.referenceDelegate.addReference(h,f.targetId,v)).next(()=>K.forEach(f.Ui,v=>u.persistence.referenceDelegate.removeReference(h,f.targetId,v)))))}catch(h){if(!ed(h))throw h;ce("LocalStore","Failed to update sequence numbers: "+h)}for(const h of c){const f=h.targetId;if(!h.fromCache){const v=u.os.get(f),w=v.snapshotVersion,E=v.withLastLimboFreeSnapshotVersion(w);u.os=u.os.insert(f,E)}}}(r.localStore,s))}async function fq(n,e){const t=je(n);if(!t.currentUser.isEqual(e)){ce("SyncEngine","User change. New user:",e.toKey());const r=await zV(t.localStore,e);t.currentUser=e,function(s,o){s.ka.forEach(a=>{a.forEach(l=>{l.reject(new be(ne.CANCELLED,o))})}),s.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await nd(t,r.hs)}}function pq(n,e){const t=je(n),r=t.Na.get(e);if(r&&r.va)return Pt().add(r.key);{let i=Pt();const s=t.Ma.get(e);if(!s)return i;for(const o of s){const a=t.Fa.get(o);i=i.unionWith(a.view.Va)}return i}}async function mq(n,e){const t=je(n),r=await fI(t.localStore,e.query,!0),i=e.view.ba(r);return t.isPrimaryClient&&yI(t,e.targetId,i.wa),i}async function gq(n,e){const t=je(n);return WV(t.localStore,e).then(r=>nd(t,r))}async function yq(n,e,t,r){const i=je(n),s=await function(a,l){const c=je(a),u=je(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>u.Mn(h,l).next(f=>f?c.localDocuments.getDocuments(h,f):K.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?await wg(i.remoteStore):t==="acknowledged"||t==="rejected"?(FP(i,e,r||null),OP(i,e),function(a,l){je(je(a).mutationQueue).On(l)}(i.localStore,e)):Ue(),await nd(i,s)):ce("SyncEngine","Cannot apply mutation batch with id: "+e)}async function vq(n,e){const t=je(n);if(pA(t),UP(t),e===!0&&t.Qa!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),i=await jD(t,r.toArray());t.Qa=!0,await mI(t.remoteStore,!0);for(const s of i)fA(t.remoteStore,s)}else if(e===!1&&t.Qa!==!1){const r=[];let i=Promise.resolve();t.Ma.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(tg(t,o),Jm(t.localStore,o,!0))),Zm(t.remoteStore,o)}),await i,await jD(t,r),function(o){const a=je(o);a.Na.forEach((l,c)=>{Zm(a.remoteStore,c)}),a.La.pr(),a.Na=new Map,a.Oa=new An(Re.comparator)}(t),t.Qa=!1,await mI(t.remoteStore,!1)}}async function jD(n,e,t){const r=je(n),i=[],s=[];for(const o of e){let a;const l=r.Ma.get(o);if(l&&l.length!==0){a=await F_(r.localStore,Ls(l[0]));for(const c of l){const u=r.Fa.get(c),h=await mq(r,u);h.snapshot&&s.push(h.snapshot)}}else{const c=await GV(r.localStore,o);a=await F_(r.localStore,c),await LP(r,lU(c),o,!1,a.resumeToken)}i.push(a)}return r.Ca.d_(s),i}function lU(n){return XF(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function wq(n){return function(t){return je(je(t).persistence).Qi()}(je(n).localStore)}async function Eq(n,e,t,r){const i=je(n);if(i.Qa)return void ce("SyncEngine","Ignoring unexpected query state notification.");const s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=await WV(i.localStore,eV(s[0])),a=L0.createSynthesizedRemoteEventForCurrentChange(e,t==="current",sr.EMPTY_BYTE_STRING);await nd(i,o,a);break}case"rejected":await Jm(i.localStore,e,!0),tg(i,e,r);break;default:Ue()}}async function bq(n,e,t){const r=pA(n);if(r.Qa){for(const i of e){if(r.Ma.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){ce("SyncEngine","Adding an already active target "+i);continue}const s=await GV(r.localStore,i),o=await F_(r.localStore,s);await LP(r,lU(s),o.targetId,!1,o.resumeToken),fA(r.remoteStore,o)}for(const i of t)r.Ma.has(i)&&await Jm(r.localStore,i,!1).then(()=>{Zm(r.remoteStore,i),tg(r,i)}).catch(Zu)}}function pA(n){const e=je(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=oU.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=pq.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=cq.bind(null,e),e.Ca.d_=JW.bind(null,e.eventManager),e.Ca.$a=ZW.bind(null,e.eventManager),e}function UP(n){const e=je(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=uq.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=dq.bind(null,e),e}class bv{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=dA(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return jV(this.persistence,new $V,e.initialUser,this.serializer)}Ga(e){return new UV(uA.Zr,this.serializer)}Wa(e){return new KV}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}bv.provider={build:()=>new bv};class cU extends bv{constructor(e,t,r){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await UP(this.Ja.syncEngine),await wg(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return jV(this.persistence,new $V,e.initialUser,this.serializer)}ja(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new cW(r,e.asyncQueue,t)}Ha(e,t){const r=new zG(t,this.persistence);return new jG(e.asyncQueue,r)}Ga(e){const t=BV(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Yi.withCacheSize(this.cacheSizeBytes):Yi.DEFAULT;return new SP(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,YV(),Sb(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new KV}}class _q extends cU{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof L1&&(this.sharedClientState.syncEngine={no:yq.bind(null,t),ro:Eq.bind(null,t),io:bq.bind(null,t),Qi:wq.bind(null,t),eo:gq.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await vq(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const t=YV();if(!L1.D(t))throw new be(ne.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=BV(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new L1(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class _v{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$D(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=fq.bind(null,this.syncEngine),await mI(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new XW}()}createDatastore(e){const t=dA(e.databaseInfo.databaseId),r=function(s){return new NW(s)}(e.databaseInfo);return function(s,o,a,l){return new FW(s,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new UW(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>$D(this.syncEngine,t,0),function(){return OD.D()?new OD:new kW}())}createSyncEngine(e,t){return function(i,s,o,a,l,c,u){const h=new rq(i,s,o,a,l,c);return u&&(h.Qa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(i){const s=je(i);ce("RemoteStore","RemoteStore shutting down."),s.L_.add(5),await F0(s),s.k_.shutdown(),s.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}_v.provider={build:()=>new _v};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):rr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sq{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Or.UNAUTHENTICATED,this.clientId=xF.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async o=>{ce("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ce("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new $a;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=RP(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function F1(n,e){n.asyncQueue.verifyOperationInProgress(),ce("FirestoreClient","Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await zV(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function zD(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Aq(n);ce("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>FD(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>FD(e.remoteStore,i)),n._onlineComponents=e}async function Aq(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ce("FirestoreClient","Using user provided OfflineComponentProvider");try{await F1(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(i){return i.name==="FirebaseError"?i.code===ne.FAILED_PRECONDITION||i.code===ne.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;jm("Error using user provided cache. Falling back to memory cache: "+t),await F1(n,new bv)}}else ce("FirestoreClient","Using default OfflineComponentProvider"),await F1(n,new bv);return n._offlineComponents}async function uU(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ce("FirestoreClient","Using user provided OnlineComponentProvider"),await zD(n,n._uninitializedComponentsProvider._online)):(ce("FirestoreClient","Using default OnlineComponentProvider"),await zD(n,new _v))),n._onlineComponents}function Tq(n){return uU(n).then(e=>e.syncEngine)}async function $_(n){const e=await uU(n),t=e.eventManager;return t.onListen=iq.bind(null,e.syncEngine),t.onUnlisten=oq.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=sq.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=aq.bind(null,e.syncEngine),t}function Iq(n,e,t={}){const r=new $a;return n.asyncQueue.enqueueAndForget(async()=>function(s,o,a,l,c){const u=new BP({next:f=>{u.Za(),o.enqueueAndForget(()=>DP(s,h));const v=f.docs.has(a);!v&&f.fromCache?c.reject(new be(ne.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&f.fromCache&&l&&l.source==="server"?c.reject(new be(ne.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new NP(D0(a.path),u,{includeMetadataChanges:!0,_a:!0});return kP(s,h)}(await $_(n),n.asyncQueue,e,t,r)),r.promise}function xq(n,e,t={}){const r=new $a;return n.asyncQueue.enqueueAndForget(async()=>function(s,o,a,l,c){const u=new BP({next:f=>{u.Za(),o.enqueueAndForget(()=>DP(s,h)),f.fromCache&&l.source==="server"?c.reject(new be(ne.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new NP(a,u,{includeMetadataChanges:!0,_a:!0});return kP(s,h)}(await $_(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dU(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HD=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hU(n,e,t){if(!t)throw new be(ne.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Cq(n,e,t,r){if(e===!0&&r===!0)throw new be(ne.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function GD(n){if(!Re.isDocumentKey(n))throw new be(ne.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function WD(n){if(Re.isDocumentKey(n))throw new be(ne.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function mA(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ue()}function Fi(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new be(ne.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=mA(n);throw new be(ne.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new be(ne.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new be(ne.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Cq("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=dU((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new be(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new be(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new be(ne.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gA{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qD({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new be(ne.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new be(ne.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qD(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new kG;switch(r.type){case"firstParty":return new LG(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new be(ne.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=HD.get(t);r&&(ce("ComponentProvider","Removing Datastore"),HD.delete(t),r.terminate())}(this),Promise.resolve()}}function $P(n,e,t,r={}){var i;const s=(n=Fi(n,gA))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&jm("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Or.MOCK_USER;else{a=j6(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new be(ne.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Or(c)}n._authCredentials=new DG(new IF(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new dc(this.firestore,e,this._query)}}class wi{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ru(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new wi(this.firestore,e,this._key)}}class Ru extends dc{constructor(e,t,r){super(e,t,D0(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new wi(this.firestore,null,new Re(e))}withConverter(e){return new Ru(this.firestore,e,this._path)}}function tn(n,e,...t){if(n=sn(n),hU("collection","path",e),n instanceof gA){const r=Xt.fromString(e,...t);return WD(r),new Ru(n,null,r)}{if(!(n instanceof wi||n instanceof Ru))throw new be(ne.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Xt.fromString(e,...t));return WD(r),new Ru(n.firestore,null,r)}}function se(n,e,...t){if(n=sn(n),arguments.length===1&&(e=xF.newId()),hU("doc","path",e),n instanceof gA){const r=Xt.fromString(e,...t);return GD(r),new wi(n,null,new Re(r))}{if(!(n instanceof wi||n instanceof Ru))throw new be(ne.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Xt.fromString(e,...t));return GD(r),new wi(n.firestore,n instanceof Ru?n.converter:null,new Re(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new QV(this,"async_queue_retry"),this.Vu=()=>{const r=Sb();r&&ce("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const t=Sb();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Sb();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new $a;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!ed(e))throw e;ce("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw rr("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=t,t}enqueueAfterDelay(e,t,r){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const i=PP.createAndSchedule(this,e,t,r,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&Ue()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function YD(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}class Ga extends gA{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new KD,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new KD(e),this._firestoreClient=void 0,await e}}}function Pq(n,e,t){t||(t="(default)");const r=cc(n,"firestore");if(r.isInitialized(t)){const i=r.getImmediate({identifier:t}),s=r.getOptions(t);if(Bm(s,e))return i;throw new be(ne.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new be(ne.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new be(ne.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:t})}function fU(n,e){const t=typeof n=="object"?n:Bu(),r=typeof n=="string"?n:"(default)",i=cc(t,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=CO("firestore");s&&$P(i,...s)}return i}function V0(n){if(n._terminated)throw new be(ne.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Rq(n),n._firestoreClient}function Rq(n){var e,t,r;const i=n._freezeSettings(),s=function(a,l,c,u){return new u9(a,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,dU(u.experimentalLongPollingOptions),u.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Sq(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ng(sr.fromBase64String(e))}catch(t){throw new be(ne.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new ng(sr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U0{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new be(ne.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jP{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new be(ne.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new be(ne.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return vt(this._lat,e._lat)||vt(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zP{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kq=/^__.*__$/;class Dq{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new uc(e,this.data,this.fieldMask,t,this.fieldTransforms):new vg(e,this.data,t,this.fieldTransforms)}}class pU{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new uc(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function mU(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ue()}}class HP{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new HP(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return j_(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(mU(this.Cu)&&kq.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Mq{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||dA(e)}Qu(e,t,r,i=!1){return new HP({Cu:e,methodName:t,qu:r,path:Bn.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function $0(n){const e=n._freezeSettings(),t=dA(n._databaseId);return new Mq(n._databaseId,!!e.ignoreUndefinedProperties,t)}function GP(n,e,t,r,i,s={}){const o=n.Qu(s.merge||s.mergeFields?2:0,e,t,i);KP("Data must be an object, but it was:",o,r);const a=vU(r,o);let l,c;if(s.merge)l=new Ji(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const u=[];for(const h of s.mergeFields){const f=vI(e,h,t);if(!o.contains(f))throw new be(ne.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);EU(u,f)||u.push(f)}l=new Ji(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new Dq(new gi(a),l,c)}class yA extends B0{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof yA}}class WP extends B0{_toFieldTransform(e){return new pP(e.path,new qm)}isEqual(e){return e instanceof WP}}class qP extends B0{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Qm(e.serializer,oV(e.serializer,this.$u));return new pP(e.path,t)}isEqual(e){return e instanceof qP&&this.$u===e.$u}}function gU(n,e,t,r){const i=n.Qu(1,e,t);KP("Data must be an object, but it was:",i,r);const s=[],o=gi.empty();yf(r,(l,c)=>{const u=YP(e,l,t);c=sn(c);const h=i.Nu(u);if(c instanceof yA)s.push(u);else{const f=j0(c,h);f!=null&&(s.push(u),o.set(u,f))}});const a=new Ji(s);return new pU(o,a,i.fieldTransforms)}function yU(n,e,t,r,i,s){const o=n.Qu(1,e,t),a=[vI(e,r,t)],l=[i];if(s.length%2!=0)throw new be(ne.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(vI(e,s[f])),l.push(s[f+1]);const c=[],u=gi.empty();for(let f=a.length-1;f>=0;--f)if(!EU(c,a[f])){const v=a[f];let w=l[f];w=sn(w);const E=o.Nu(v);if(w instanceof yA)c.push(v);else{const A=j0(w,E);A!=null&&(c.push(v),u.set(v,A))}}const h=new Ji(c);return new pU(u,h,o.fieldTransforms)}function Nq(n,e,t,r=!1){return j0(t,n.Qu(r?4:3,e))}function j0(n,e){if(wU(n=sn(n)))return KP("Unsupported field value:",e,n),vU(n,e);if(n instanceof B0)return function(r,i){if(!mU(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let l=j0(a,i.Lu(o));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=sn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return oV(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=xn.fromDate(r);return{timestampValue:Xm(i.serializer,s)}}if(r instanceof xn){const s=new xn(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Xm(i.serializer,s)}}if(r instanceof jP)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ng)return{bytesValue:yV(i.serializer,r._byteString)};if(r instanceof wi){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:wP(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof zP)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.Bu("VectorValues must only contain numeric values.");return fP(a.serializer,l)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${mA(r)}`)}(n,e)}function vU(n,e){const t={};return UF(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):yf(n,(r,i)=>{const s=j0(i,e.Mu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function wU(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof xn||n instanceof jP||n instanceof ng||n instanceof wi||n instanceof B0||n instanceof zP)}function KP(n,e,t){if(!wU(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const r=mA(t);throw r==="an object"?e.Bu(n+" a custom object"):e.Bu(n+" "+r)}}function vI(n,e,t){if((e=sn(e))instanceof U0)return e._internalPath;if(typeof e=="string")return YP(n,e);throw j_("Field path arguments must be of type string or ",n,!1,void 0,t)}const Lq=new RegExp("[~\\*/\\[\\]]");function YP(n,e,t){if(e.search(Lq)>=0)throw j_(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new U0(...e.split("."))._internalPath}catch{throw j_(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function j_(n,e,t,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new be(ne.INVALID_ARGUMENT,a+n+l)}function EU(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new wi(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Oq(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(vA("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Oq extends bU{data(){return super.data()}}function vA(n,e){return typeof e=="string"?YP(n,e):e instanceof U0?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _U(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new be(ne.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class QP{}class XP extends QP{}function Bo(n,e,...t){let r=[];e instanceof QP&&r.push(e),r=r.concat(t),function(s){const o=s.filter(l=>l instanceof JP).length,a=s.filter(l=>l instanceof wA).length;if(o>1||o>0&&a>0)throw new be(ne.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class wA extends XP{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new wA(e,t,r)}_apply(e){const t=this._parse(e);return SU(e._query,t),new dc(e.firestore,e.converter,sI(e._query,t))}_parse(e){const t=$0(e.firestore);return function(s,o,a,l,c,u,h){let f;if(c.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new be(ne.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){XD(h,u);const v=[];for(const w of h)v.push(QD(l,s,w));f={arrayValue:{values:v}}}else f=QD(l,s,h)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||XD(h,u),f=Nq(a,o,h,u==="in"||u==="not-in");return Ft.create(c,u,f)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function fi(n,e,t){const r=e,i=vA("where",n);return wA._create(i,r,t)}class JP extends QP{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new JP(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:nn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const l of a)SU(o,l),o=sI(o,l)}(e._query,t),new dc(e.firestore,e.converter,sI(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ZP extends XP{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ZP(e,t)}_apply(e){const t=function(i,s,o){if(i.startAt!==null)throw new be(ne.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new be(ne.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ev(s,o)}(e._query,this._field,this._direction);return new dc(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new yg(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function z_(n,e="asc"){const t=e,r=vA("orderBy",n);return ZP._create(r,t)}class eR extends XP{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new eR(e,t,r)}_apply(e){return new dc(e.firestore,e.converter,k_(e._query,this._limit,this._limitType))}}function Fq(n){return eR._create("limit",n,"F")}function QD(n,e,t){if(typeof(t=sn(t))=="string"){if(t==="")throw new be(ne.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!JF(e)&&t.indexOf("/")!==-1)throw new be(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(Xt.fromString(t));if(!Re.isDocumentKey(r))throw new be(ne.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return vv(n,new Re(r))}if(t instanceof wi)return vv(n,t._key);throw new be(ne.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mA(t)}.`)}function XD(n,e){if(!Array.isArray(n)||n.length===0)throw new be(ne.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function SU(n,e){const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new be(ne.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new be(ne.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Vq{convertValue(e,t="none"){switch(Zh(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Nn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes($u(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ue()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return yf(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;const s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Nn(o.doubleValue));return new zP(s)}convertGeoPoint(e){return new jP(Nn(e.latitude),Nn(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=uP(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(gv(e));default:return null}}convertTimestamp(e){const t=ec(e);return new xn(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Xt.fromString(e);qe(xV(r));const i=new Jh(r.get(1),r.get(3)),s=new Re(r.popFirst(5));return i.isEqual(t)||rr(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tR(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class AU extends bU{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ab(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(vA("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Ab extends AU{data(e={}){return super.data(e)}}class TU{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new my(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ab(this._firestore,this._userDataWriter,r.key,r,new my(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new be(ne.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const l=new Ab(i._firestore,i._userDataWriter,a.doc.key,a.doc,new my(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const l=new Ab(i._firestore,i._userDataWriter,a.doc.key,a.doc,new my(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,u=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:Uq(a.type),doc:l,oldIndex:c,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Uq(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ue()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fe(n){n=Fi(n,wi);const e=Fi(n.firestore,Ga);return Iq(V0(e),n._key).then(t=>IU(e,n,t))}class nR extends Vq{constructor(e){super(),this.firestore=e}convertBytes(e){return new ng(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new wi(this.firestore,null,t)}}function $n(n){n=Fi(n,dc);const e=Fi(n.firestore,Ga),t=V0(e),r=new nR(e);return _U(n._query),xq(t,n._query).then(i=>new TU(e,r,n,i))}function xt(n,e,t){n=Fi(n,wi);const r=Fi(n.firestore,Ga),i=tR(n.converter,e,t);return z0(r,[GP($0(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,br.none())])}function gy(n,e,t,...r){n=Fi(n,wi);const i=Fi(n.firestore,Ga),s=$0(i);let o;return o=typeof(e=sn(e))=="string"||e instanceof U0?yU(s,"updateDoc",n._key,e,t,r):gU(s,"updateDoc",n._key,e),z0(i,[o.toMutation(n._key,br.exists(!0))])}function rR(n){return z0(Fi(n.firestore,Ga),[new N0(n._key,br.none())])}function V1(n,e){const t=Fi(n.firestore,Ga),r=se(n),i=tR(n.converter,e);return z0(t,[GP($0(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,br.exists(!1))]).then(()=>r)}function fa(n,...e){var t,r,i;n=sn(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||YD(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(YD(e[o])){const h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let l,c,u;if(n instanceof wi)c=Fi(n.firestore,Ga),u=D0(n._key.path),l={next:h=>{e[o]&&e[o](IU(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=Fi(n,dc);c=Fi(h.firestore,Ga),u=h._query;const f=new nR(c);l={next:v=>{e[o]&&e[o](new TU(c,f,h,v))},error:e[o+1],complete:e[o+2]},_U(n._query)}return function(f,v,w,E){const A=new BP(E),T=new NP(v,A,w);return f.asyncQueue.enqueueAndForget(async()=>kP(await $_(f),T)),()=>{A.Za(),f.asyncQueue.enqueueAndForget(async()=>DP(await $_(f),T))}}(V0(c),u,a,l)}function z0(n,e){return function(r,i){const s=new $a;return r.asyncQueue.enqueueAndForget(async()=>lq(await Tq(r),i,s)),s.promise}(V0(n),e)}function IU(n,e,t){const r=t.docs.get(e._key),i=new nR(n);return new AU(n,i,e._key,r,new my(t.hasPendingWrites,t.fromCache),e.converter)}class Bq{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=zq(),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function JD(n){return new Bq(n)}class $q{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=_v.provider,this._offlineComponentProvider={build:t=>new cU(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class jq{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=_v.provider,this._offlineComponentProvider={build:t=>new _q(t,e==null?void 0:e.cacheSizeBytes)}}}function zq(n){return new $q(void 0)}function U1(){return new jq}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hq{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=$0(e)}set(e,t,r){this._verifyNotCommitted();const i=B1(e,this._firestore),s=tR(i.converter,t,r),o=GP(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,br.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=B1(e,this._firestore);let o;return o=typeof(t=sn(t))=="string"||t instanceof U0?yU(this._dataReader,"WriteBatch.update",s._key,t,r,i):gU(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,br.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=B1(e,this._firestore);return this._mutations=this._mutations.concat(new N0(t._key,br.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new be(ne.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function B1(n,e){if((n=sn(n)).firestore!==e)throw new be(ne.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}function ut(){return new WP("serverTimestamp")}function ZD(n){return new qP("increment",n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eM(n){return V0(n=Fi(n,Ga)),new Hq(n,e=>z0(n,e))}(function(e,t=!0){(function(i){gg=i})(pg),qo(new po("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new Ga(new MG(r.getProvider("auth-internal")),new FG(r.getProvider("app-check-internal")),function(c,u){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new be(ne.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Jh(c.options.projectId,u)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),ts(z2,"4.7.3",e),ts(z2,"4.7.3","esm2017")})();const xU="@firebase/installations",iR="0.6.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CU=1e4,PU=`w:${iR}`,RU="FIS_v2",Gq="https://firebaseinstallations.googleapis.com/v1",Wq=60*60*1e3,qq="installations",Kq="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yq={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},sf=new gf(qq,Kq,Yq);function kU(n){return n instanceof wo&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DU({projectId:n}){return`${Gq}/projects/${n}/installations`}function MU(n){return{token:n.token,requestStatus:2,expiresIn:Xq(n.expiresIn),creationTime:Date.now()}}async function NU(n,e){const r=(await e.json()).error;return sf.create("request-failed",{requestName:n,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function LU({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function Qq(n,{refreshToken:e}){const t=LU(n);return t.append("Authorization",Jq(e)),t}async function OU(n){const e=await n();return e.status>=500&&e.status<600?n():e}function Xq(n){return Number(n.replace("s","000"))}function Jq(n){return`${RU} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zq({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const r=DU(n),i=LU(n),s=e.getImmediate({optional:!0});if(s){const c=await s.getHeartbeatsHeader();c&&i.append("x-firebase-client",c)}const o={fid:t,authVersion:RU,appId:n.appId,sdkVersion:PU},a={method:"POST",headers:i,body:JSON.stringify(o)},l=await OU(()=>fetch(r,a));if(l.ok){const c=await l.json();return{fid:c.fid||t,registrationStatus:2,refreshToken:c.refreshToken,authToken:MU(c.authToken)}}else throw await NU("Create Installation",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FU(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e7(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t7=/^[cdef][\w-]{21}$/,wI="";function n7(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=r7(n);return t7.test(t)?t:wI}catch{return wI}}function r7(n){return e7(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EA(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VU=new Map;function UU(n,e){const t=EA(n);BU(t,e),i7(t,e)}function BU(n,e){const t=VU.get(n);if(t)for(const r of t)r(e)}function i7(n,e){const t=s7();t&&t.postMessage({key:n,fid:e}),o7()}let Dd=null;function s7(){return!Dd&&"BroadcastChannel"in self&&(Dd=new BroadcastChannel("[Firebase] FID Change"),Dd.onmessage=n=>{BU(n.data.key,n.data.fid)}),Dd}function o7(){VU.size===0&&Dd&&(Dd.close(),Dd=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a7="firebase-installations-database",l7=1,of="firebase-installations-store";let $1=null;function sR(){return $1||($1=LO(a7,l7,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(of)}}})),$1}async function H_(n,e){const t=EA(n),i=(await sR()).transaction(of,"readwrite"),s=i.objectStore(of),o=await s.get(t);return await s.put(e,t),await i.done,(!o||o.fid!==e.fid)&&UU(n,e.fid),e}async function $U(n){const e=EA(n),r=(await sR()).transaction(of,"readwrite");await r.objectStore(of).delete(e),await r.done}async function bA(n,e){const t=EA(n),i=(await sR()).transaction(of,"readwrite"),s=i.objectStore(of),o=await s.get(t),a=e(o);return a===void 0?await s.delete(t):await s.put(a,t),await i.done,a&&(!o||o.fid!==a.fid)&&UU(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oR(n){let e;const t=await bA(n.appConfig,r=>{const i=c7(r),s=u7(n,i);return e=s.registrationPromise,s.installationEntry});return t.fid===wI?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function c7(n){const e=n||{fid:n7(),registrationStatus:0};return jU(e)}function u7(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(sf.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=d7(n,t);return{installationEntry:t,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:h7(n)}:{installationEntry:e}}async function d7(n,e){try{const t=await Zq(n,e);return H_(n.appConfig,t)}catch(t){throw kU(t)&&t.customData.serverCode===409?await $U(n.appConfig):await H_(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function h7(n){let e=await tM(n.appConfig);for(;e.registrationStatus===1;)await FU(100),e=await tM(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:r}=await oR(n);return r||t}return e}function tM(n){return bA(n,e=>{if(!e)throw sf.create("installation-not-found");return jU(e)})}function jU(n){return f7(n)?{fid:n.fid,registrationStatus:0}:n}function f7(n){return n.registrationStatus===1&&n.registrationTime+CU<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p7({appConfig:n,heartbeatServiceProvider:e},t){const r=m7(n,t),i=Qq(n,t),s=e.getImmediate({optional:!0});if(s){const c=await s.getHeartbeatsHeader();c&&i.append("x-firebase-client",c)}const o={installation:{sdkVersion:PU,appId:n.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},l=await OU(()=>fetch(r,a));if(l.ok){const c=await l.json();return MU(c)}else throw await NU("Generate Auth Token",l)}function m7(n,{fid:e}){return`${DU(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aR(n,e=!1){let t;const r=await bA(n.appConfig,s=>{if(!zU(s))throw sf.create("not-registered");const o=s.authToken;if(!e&&v7(o))return s;if(o.requestStatus===1)return t=g7(n,e),s;{if(!navigator.onLine)throw sf.create("app-offline");const a=E7(s);return t=y7(n,a),a}});return t?await t:r.authToken}async function g7(n,e){let t=await nM(n.appConfig);for(;t.authToken.requestStatus===1;)await FU(100),t=await nM(n.appConfig);const r=t.authToken;return r.requestStatus===0?aR(n,e):r}function nM(n){return bA(n,e=>{if(!zU(e))throw sf.create("not-registered");const t=e.authToken;return b7(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function y7(n,e){try{const t=await p7(n,e),r=Object.assign(Object.assign({},e),{authToken:t});return await H_(n.appConfig,r),t}catch(t){if(kU(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await $U(n.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await H_(n.appConfig,r)}throw t}}function zU(n){return n!==void 0&&n.registrationStatus===2}function v7(n){return n.requestStatus===2&&!w7(n)}function w7(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+Wq}function E7(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function b7(n){return n.requestStatus===1&&n.requestTime+CU<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _7(n){const e=n,{installationEntry:t,registrationPromise:r}=await oR(e);return r?r.catch(console.error):aR(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S7(n,e=!1){const t=n;return await A7(t),(await aR(t,e)).token}async function A7(n){const{registrationPromise:e}=await oR(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T7(n){if(!n||!n.options)throw j1("App Configuration");if(!n.name)throw j1("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw j1(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function j1(n){return sf.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HU="installations",I7="installations-internal",x7=n=>{const e=n.getProvider("app").getImmediate(),t=T7(e),r=cc(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},C7=n=>{const e=n.getProvider("app").getImmediate(),t=cc(e,HU).getImmediate();return{getId:()=>_7(t),getToken:i=>S7(t,i)}};function P7(){qo(new po(HU,x7,"PUBLIC")),qo(new po(I7,C7,"PRIVATE"))}P7();ts(xU,iR);ts(xU,iR,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G_="analytics",R7="firebase_id",k7="origin",D7=60*1e3,M7="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",lR="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ns=new JS("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N7={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Os=new gf("analytics","Analytics",N7);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L7(n){if(!n.startsWith(lR)){const e=Os.create("invalid-gtag-resource",{gtagURL:n});return ns.warn(e.message),""}return n}function GU(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function O7(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function F7(n,e){const t=O7("firebase-js-sdk-policy",{createScriptURL:L7}),r=document.createElement("script"),i=`${lR}?l=${n}&id=${e}`;r.src=t?t==null?void 0:t.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function V7(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function U7(n,e,t,r,i,s){const o=r[i];try{if(o)await e[o];else{const l=(await GU(t)).find(c=>c.measurementId===i);l&&await e[l.appId]}}catch(a){ns.error(a)}n("config",i,s)}async function B7(n,e,t,r,i){try{let s=[];if(i&&i.send_to){let o=i.send_to;Array.isArray(o)||(o=[o]);const a=await GU(t);for(const l of o){const c=a.find(h=>h.measurementId===l),u=c&&e[c.appId];if(u)s.push(u);else{s=[];break}}}s.length===0&&(s=Object.values(e)),await Promise.all(s),n("event",r,i||{})}catch(s){ns.error(s)}}function $7(n,e,t,r){async function i(s,...o){try{if(s==="event"){const[a,l]=o;await B7(n,e,t,a,l)}else if(s==="config"){const[a,l]=o;await U7(n,e,t,r,a,l)}else if(s==="consent"){const[a,l]=o;n("consent",a,l)}else if(s==="get"){const[a,l,c]=o;n("get",a,l,c)}else if(s==="set"){const[a]=o;n("set",a)}else n(s,...o)}catch(a){ns.error(a)}}return i}function j7(n,e,t,r,i){let s=function(...o){window[r].push(arguments)};return window[i]&&typeof window[i]=="function"&&(s=window[i]),window[i]=$7(s,n,e,t),{gtagCore:s,wrappedGtag:window[i]}}function z7(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(lR)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H7=30,G7=1e3;class W7{constructor(e={},t=G7){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const WU=new W7;function q7(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function K7(n){var e;const{appId:t,apiKey:r}=n,i={method:"GET",headers:q7(r)},s=M7.replace("{app-id}",t),o=await fetch(s,i);if(o.status!==200&&o.status!==304){let a="";try{const l=await o.json();!((e=l.error)===null||e===void 0)&&e.message&&(a=l.error.message)}catch{}throw Os.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function Y7(n,e=WU,t){const{appId:r,apiKey:i,measurementId:s}=n.options;if(!r)throw Os.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw Os.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new J7;return setTimeout(async()=>{a.abort()},D7),qU({appId:r,apiKey:i,measurementId:s},o,a,e)}async function qU(n,{throttleEndTimeMillis:e,backoffCount:t},r,i=WU){var s;const{appId:o,measurementId:a}=n;try{await Q7(r,e)}catch(l){if(a)return ns.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:o,measurementId:a};throw l}try{const l=await K7(n);return i.deleteThrottleMetadata(o),l}catch(l){const c=l;if(!X7(c)){if(i.deleteThrottleMetadata(o),a)return ns.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:o,measurementId:a};throw l}const u=Number((s=c==null?void 0:c.customData)===null||s===void 0?void 0:s.httpStatus)===503?p2(t,i.intervalMillis,H7):p2(t,i.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:t+1};return i.setThrottleMetadata(o,h),ns.debug(`Calling attemptFetch again in ${u} millis`),qU(n,h,r,i)}}function Q7(n,e){return new Promise((t,r)=>{const i=Math.max(e-Date.now(),0),s=setTimeout(t,i);n.addEventListener(()=>{clearTimeout(s),r(Os.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function X7(n){if(!(n instanceof wo)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class J7{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Z7(n,e,t,r,i){if(i&&i.global){n("event",t,r);return}else{const s=await e,o=Object.assign(Object.assign({},r),{send_to:s});n("event",t,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eK(){if(XS())try{await qC()}catch(n){return ns.warn(Os.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return ns.warn(Os.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function tK(n,e,t,r,i,s,o){var a;const l=Y7(n);l.then(v=>{t[v.measurementId]=v.appId,n.options.measurementId&&v.measurementId!==n.options.measurementId&&ns.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${v.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(v=>ns.error(v)),e.push(l);const c=eK().then(v=>{if(v)return r.getId()}),[u,h]=await Promise.all([l,c]);z7(s)||F7(s,u.measurementId),i("js",new Date);const f=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return f[k7]="firebase",f.update=!0,h!=null&&(f[R7]=h),i("config",u.measurementId,f),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nK{constructor(e){this.app=e}_delete(){return delete Xy[this.app.options.appId],Promise.resolve()}}let Xy={},rM=[];const iM={};let z1="dataLayer",rK="gtag",sM,KU,oM=!1;function iK(){const n=[];if(WC()&&n.push("This is a browser extension environment."),DO()||n.push("Cookies are not available."),n.length>0){const e=n.map((r,i)=>`(${i+1}) ${r}`).join(" "),t=Os.create("invalid-analytics-context",{errorInfo:e});ns.warn(t.message)}}function sK(n,e,t){iK();const r=n.options.appId;if(!r)throw Os.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)ns.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Os.create("no-api-key");if(Xy[r]!=null)throw Os.create("already-exists",{id:r});if(!oM){V7(z1);const{wrappedGtag:s,gtagCore:o}=j7(Xy,rM,iM,z1,rK);KU=s,sM=o,oM=!0}return Xy[r]=tK(n,rM,iM,e,sM,z1,t),new nK(n)}function oK(n=Bu()){n=sn(n);const e=cc(n,G_);return e.isInitialized()?e.getImmediate():aK(n)}function aK(n,e={}){const t=cc(n,G_);if(t.isInitialized()){const i=t.getImmediate();if(Bm(e,t.getOptions()))return i;throw Os.create("already-initialized")}return t.initialize({options:e})}async function lK(){if(WC()||!DO()||!XS())return!1;try{return await qC()}catch{return!1}}function cK(n,e,t,r){n=sn(n),Z7(KU,Xy[n.app.options.appId],e,t,r).catch(i=>ns.error(i))}const aM="@firebase/analytics",lM="0.10.8";function uK(){qo(new po(G_,(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return sK(r,i,t)},"PUBLIC")),qo(new po("analytics-internal",n,"PRIVATE")),ts(aM,lM),ts(aM,lM,"esm2017");function n(e){try{const t=e.getProvider(G_).getImmediate();return{logEvent:(r,i,s)=>cK(t,r,i,s)}}catch(t){throw Os.create("interop-component-reg-failed",{reason:t})}}}uK();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dK="type.googleapis.com/google.protobuf.Int64Value",hK="type.googleapis.com/google.protobuf.UInt64Value";function YU(n,e){const t={};for(const r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}function EI(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>EI(e));if(typeof n=="function"||typeof n=="object")return YU(n,e=>EI(e));throw new Error("Data cannot be encoded in JSON: "+n)}function W_(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case dK:case hK:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>W_(e)):typeof n=="function"||typeof n=="object"?YU(n,e=>W_(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cR="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cM={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ap extends wo{constructor(e,t,r){super(`${cR}/${e}`,t||""),this.details=r}}function fK(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function pK(n,e){let t=fK(n),r=t,i;try{const s=e&&e.error;if(s){const o=s.status;if(typeof o=="string"){if(!cM[o])return new Ap("internal","internal");t=cM[o],r=o}const a=s.message;typeof a=="string"&&(r=a),i=s.details,i!==void 0&&(i=W_(i))}}catch{}return t==="ok"?null:new Ap(t,r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mK{constructor(e,t,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(i=>this.auth=i,()=>{}),this.messaging||t.get().then(i=>this.messaging=i,()=>{}),this.appCheck||r.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),r=await this.getMessagingToken(),i=await this.getAppCheckToken(e);return{authToken:t,messagingToken:r,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bI="us-central1";function gK(n){let e=null;return{promise:new Promise((t,r)=>{e=setTimeout(()=>{r(new Ap("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class yK{constructor(e,t,r,i,s=bI,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new mK(t,r,i),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(s);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=bI}catch{this.customDomain=null,this.region=s}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function vK(n,e,t){n.emulatorOrigin=`http://${e}:${t}`}function wK(n,e,t){return r=>bK(n,e,r,{})}async function EK(n,e,t,r){t["Content-Type"]="application/json";let i;try{i=await r(n,{method:"POST",body:JSON.stringify(e),headers:t})}catch{return{status:0,json:null}}let s=null;try{s=await i.json()}catch{}return{status:i.status,json:s}}function bK(n,e,t,r){const i=n._url(e);return _K(n,i,t,r)}async function _K(n,e,t,r){t=EI(t);const i={data:t},s={},o=await n.contextProvider.getContext(r.limitedUseAppCheckTokens);o.authToken&&(s.Authorization="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(s["X-Firebase-AppCheck"]=o.appCheckToken);const a=r.timeout||7e4,l=gK(a),c=await Promise.race([EK(e,i,s,n.fetchImpl),l.promise,n.cancelAllRequests]);if(l.cancel(),!c)throw new Ap("cancelled","Firebase Functions instance was deleted.");const u=pK(c.status,c.json);if(u)throw u;if(!c.json)throw new Ap("internal","Response is not valid JSON object.");let h=c.json.data;if(typeof h>"u"&&(h=c.json.result),typeof h>"u")throw new Ap("internal","Response is missing data field.");return{data:W_(h)}}const uM="@firebase/functions",dM="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SK="auth-internal",AK="app-check-internal",TK="messaging-internal";function IK(n,e){const t=(r,{instanceIdentifier:i})=>{const s=r.getProvider("app").getImmediate(),o=r.getProvider(SK),a=r.getProvider(TK),l=r.getProvider(AK);return new yK(s,o,a,l,i,n)};qo(new po(cR,t,"PUBLIC").setMultipleInstances(!0)),ts(uM,dM,e),ts(uM,dM,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H0(n=Bu(),e=bI){const r=cc(sn(n),cR).getImmediate({identifier:e}),i=CO("functions");return i&&Hu(r,...i),r}function Hu(n,e,t){vK(sn(n),e,t)}function QU(n,e,t){return wK(sn(n),e)}IK(fetch.bind(self));var hM={};const xK={apiKey:"AIzaSyC6uvGu9_9kNx1vInNy7X2ny2JPkE4M-YU",authDomain:"pragma-2c5d1.firebaseapp.com",projectId:"pragma-2c5d1",storageBucket:"pragma-2c5d1.firebasestorage.app",messagingSenderId:"203232076035",appId:"1:203232076035:web:1ed2a449ba619ac30b8936",measurementId:"G-348TG6WKLE"};let _I;try{_I=nH().length?Bu():OO(xK)}catch{_I=Bu()}const tc=_I,we=PG(tc);try{g8(we,nP).then(()=>{console.info("[Auth] Persistencia fijada a 'browserSessionPersistence' (por sesiÃ³n).")}).catch(n=>{console.warn("[Auth] No se pudo fijar persistencia por sesiÃ³n:",(n==null?void 0:n.code)||(n==null?void 0:n.message)||n)})}catch{}const af=typeof window<"u"&&/(^|\.)localhost(:\d+)?$|127\.0\.0\.1/.test(window.location.host),XU=H0(Bu(),"us-central1"),JU=H0(Bu(),"southamerica-east1"),bg=typeof process<"u"&&hM&&hM.REACT_APP_USE_EMULATORS==="true",wf=typeof window<"u"&&new URLSearchParams(window.location.search).get("emul")==="1";let Zi=!1,SI=!1;const X=(()=>{try{const n=Pq(tc,{...JD?{localCache:JD({tabManager:U1==null?void 0:U1()})}:{},experimentalAutoDetectLongPolling:!0,experimentalForceLongPolling:af,useFetchStreams:!1});if(af&&(wf||bg))try{$P(n,"127.0.0.1",8080),SI=!0,console.info("[Firestore] Conectado a emulador 127.0.0.1:8080")}catch(e){console.warn("[Firestore] No se pudo conectar al emulador:",(e==null?void 0:e.message)||e)}return n}catch{return fU(tc)}})(),uR=H0(tc,"us-central1");if(af&&(wf||bg)&&!Zi)try{Hu(uR,"127.0.0.1",5002),Zi=!0,console.info("[Functions] Emulador en 127.0.0.1:5002")}catch(n){console.warn("[Functions] No se pudo conectar al emulador (bloque localhost):",(n==null?void 0:n.message)||n)}if(af&&wf&&!Zi)try{Hu(uR,"127.0.0.1",5002),Zi=!0,console.info("[Functions] Emulador en 127.0.0.1:5002")}catch(n){console.warn("[Functions] No se pudo conectar al emulador:",(n==null?void 0:n.message)||n)}if(typeof window<"u"&&window.location.hostname==="localhost"&&(wf||bg)){try{SI||($P(X,"127.0.0.1",8080),SI=!0,console.info("[Firestore] Conectado a emulador 127.0.0.1:8080 (bloque compat)"))}catch{}try{Zi||(Hu(XU,"127.0.0.1",5002),Zi=!0)}catch{}try{Zi||(Hu(JU,"127.0.0.1",5002),Zi=!0)}catch{}}try{af&&(wf||bg)&&!Zi&&(Hu(uR,"127.0.0.1",5001),Zi=!0,console.info("[Functions] Emulador fallback en 127.0.0.1:5001"))}catch{}try{af&&(wf||bg)&&!Zi&&(Hu(XU,"127.0.0.1",5001),Zi=!0,console.info("[Functions][US] Fallback 5001"))}catch{}try{af&&(wf||bg)&&!Zi&&(Hu(JU,"127.0.0.1",5001),Zi=!0,console.info("[Functions][SA] Fallback 5001"))}catch{}let CK;lK().then(n=>{if(n)try{CK=oK(tc)}catch{}}).catch(()=>{});typeof window<"u"&&(window.firebaseApp=tc,window.db=X,window.__fs={collection:tn,doc:se,setDoc:xt,getDoc:Fe,getDocs:$n,deleteDoc:rR,serverTimestamp:ut});const ZU=H0(tc,"southamerica-east1");async function PK(n){return(await QU(ZU,"flowCreateV2")(n)).data}typeof window<"u"&&(window.__app=tc,window.__auth=we,window.__fx=ZU,window.__callFlowV2=PK);var RK=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _g(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function kK(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var e4={exports:{}},Mt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G0=Symbol.for("react.element"),DK=Symbol.for("react.portal"),MK=Symbol.for("react.fragment"),NK=Symbol.for("react.strict_mode"),LK=Symbol.for("react.profiler"),OK=Symbol.for("react.provider"),FK=Symbol.for("react.context"),VK=Symbol.for("react.forward_ref"),UK=Symbol.for("react.suspense"),BK=Symbol.for("react.memo"),$K=Symbol.for("react.lazy"),fM=Symbol.iterator;function jK(n){return n===null||typeof n!="object"?null:(n=fM&&n[fM]||n["@@iterator"],typeof n=="function"?n:null)}var t4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},n4=Object.assign,r4={};function Sg(n,e,t){this.props=n,this.context=e,this.refs=r4,this.updater=t||t4}Sg.prototype.isReactComponent={};Sg.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Sg.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function i4(){}i4.prototype=Sg.prototype;function dR(n,e,t){this.props=n,this.context=e,this.refs=r4,this.updater=t||t4}var hR=dR.prototype=new i4;hR.constructor=dR;n4(hR,Sg.prototype);hR.isPureReactComponent=!0;var pM=Array.isArray,s4=Object.prototype.hasOwnProperty,fR={current:null},o4={key:!0,ref:!0,__self:!0,__source:!0};function a4(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)s4.call(e,r)&&!o4.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:G0,type:n,key:s,ref:o,props:i,_owner:fR.current}}function zK(n,e){return{$$typeof:G0,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function pR(n){return typeof n=="object"&&n!==null&&n.$$typeof===G0}function HK(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var mM=/\/+/g;function H1(n,e){return typeof n=="object"&&n!==null&&n.key!=null?HK(""+n.key):e.toString(36)}function Tb(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case G0:case DK:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+H1(o,0):r,pM(i)?(t="",n!=null&&(t=n.replace(mM,"$&/")+"/"),Tb(i,e,t,"",function(c){return c})):i!=null&&(pR(i)&&(i=zK(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(mM,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",pM(n))for(var a=0;a<n.length;a++){s=n[a];var l=r+H1(s,a);o+=Tb(s,e,t,l,i)}else if(l=jK(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=r+H1(s,a++),o+=Tb(s,e,t,l,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function xE(n,e,t){if(n==null)return n;var r=[],i=0;return Tb(n,r,"","",function(s){return e.call(t,s,i++)}),r}function GK(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Bi={current:null},Ib={transition:null},WK={ReactCurrentDispatcher:Bi,ReactCurrentBatchConfig:Ib,ReactCurrentOwner:fR};function l4(){throw Error("act(...) is not supported in production builds of React.")}Mt.Children={map:xE,forEach:function(n,e,t){xE(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return xE(n,function(){e++}),e},toArray:function(n){return xE(n,function(e){return e})||[]},only:function(n){if(!pR(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Mt.Component=Sg;Mt.Fragment=MK;Mt.Profiler=LK;Mt.PureComponent=dR;Mt.StrictMode=NK;Mt.Suspense=UK;Mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WK;Mt.act=l4;Mt.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=n4({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=fR.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)s4.call(e,l)&&!o4.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:G0,type:n.type,key:i,ref:s,props:r,_owner:o}};Mt.createContext=function(n){return n={$$typeof:FK,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:OK,_context:n},n.Consumer=n};Mt.createElement=a4;Mt.createFactory=function(n){var e=a4.bind(null,n);return e.type=n,e};Mt.createRef=function(){return{current:null}};Mt.forwardRef=function(n){return{$$typeof:VK,render:n}};Mt.isValidElement=pR;Mt.lazy=function(n){return{$$typeof:$K,_payload:{_status:-1,_result:n},_init:GK}};Mt.memo=function(n,e){return{$$typeof:BK,type:n,compare:e===void 0?null:e}};Mt.startTransition=function(n){var e=Ib.transition;Ib.transition={};try{n()}finally{Ib.transition=e}};Mt.unstable_act=l4;Mt.useCallback=function(n,e){return Bi.current.useCallback(n,e)};Mt.useContext=function(n){return Bi.current.useContext(n)};Mt.useDebugValue=function(){};Mt.useDeferredValue=function(n){return Bi.current.useDeferredValue(n)};Mt.useEffect=function(n,e){return Bi.current.useEffect(n,e)};Mt.useId=function(){return Bi.current.useId()};Mt.useImperativeHandle=function(n,e,t){return Bi.current.useImperativeHandle(n,e,t)};Mt.useInsertionEffect=function(n,e){return Bi.current.useInsertionEffect(n,e)};Mt.useLayoutEffect=function(n,e){return Bi.current.useLayoutEffect(n,e)};Mt.useMemo=function(n,e){return Bi.current.useMemo(n,e)};Mt.useReducer=function(n,e,t){return Bi.current.useReducer(n,e,t)};Mt.useRef=function(n){return Bi.current.useRef(n)};Mt.useState=function(n){return Bi.current.useState(n)};Mt.useSyncExternalStore=function(n,e,t){return Bi.current.useSyncExternalStore(n,e,t)};Mt.useTransition=function(){return Bi.current.useTransition()};Mt.version="18.3.1";e4.exports=Mt;var D=e4.exports;const m=_g(D),qK=M6({__proto__:null,default:m},[D]);var c4={exports:{}},js={},u4={exports:{}},d4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(G,Z){var ee=G.length;G.push(Z);e:for(;0<ee;){var fe=ee-1>>>1,ae=G[fe];if(0<i(ae,Z))G[fe]=Z,G[ee]=ae,ee=fe;else break e}}function t(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var Z=G[0],ee=G.pop();if(ee!==Z){G[0]=ee;e:for(var fe=0,ae=G.length,_e=ae>>>1;fe<_e;){var Qe=2*(fe+1)-1,Ye=G[Qe],gt=Qe+1,ie=G[gt];if(0>i(Ye,ee))gt<ae&&0>i(ie,Ye)?(G[fe]=ie,G[gt]=ee,fe=gt):(G[fe]=Ye,G[Qe]=ee,fe=Qe);else if(gt<ae&&0>i(ie,ee))G[fe]=ie,G[gt]=ee,fe=gt;else break e}}return Z}function i(G,Z){var ee=G.sortIndex-Z.sortIndex;return ee!==0?ee:G.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,v=!1,w=!1,E=!1,A=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(G){for(var Z=t(c);Z!==null;){if(Z.callback===null)r(c);else if(Z.startTime<=G)r(c),Z.sortIndex=Z.expirationTime,e(l,Z);else break;Z=t(c)}}function g(G){if(E=!1,b(G),!w)if(t(l)!==null)w=!0,$(y);else{var Z=t(c);Z!==null&&B(g,Z.startTime-G)}}function y(G,Z){w=!1,E&&(E=!1,T(I),I=-1),v=!0;var ee=f;try{for(b(Z),h=t(l);h!==null&&(!(h.expirationTime>Z)||G&&!M());){var fe=h.callback;if(typeof fe=="function"){h.callback=null,f=h.priorityLevel;var ae=fe(h.expirationTime<=Z);Z=n.unstable_now(),typeof ae=="function"?h.callback=ae:h===t(l)&&r(l),b(Z)}else r(l);h=t(l)}if(h!==null)var _e=!0;else{var Qe=t(c);Qe!==null&&B(g,Qe.startTime-Z),_e=!1}return _e}finally{h=null,f=ee,v=!1}}var x=!1,S=null,I=-1,P=5,N=-1;function M(){return!(n.unstable_now()-N<P)}function V(){if(S!==null){var G=n.unstable_now();N=G;var Z=!0;try{Z=S(!0,G)}finally{Z?L():(x=!1,S=null)}}else x=!1}var L;if(typeof _=="function")L=function(){_(V)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,oe=j.port2;j.port1.onmessage=V,L=function(){oe.postMessage(null)}}else L=function(){A(V,0)};function $(G){S=G,x||(x=!0,L())}function B(G,Z){I=A(function(){G(n.unstable_now())},Z)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){w||v||(w=!0,$(y))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(G){switch(f){case 1:case 2:case 3:var Z=3;break;default:Z=f}var ee=f;f=Z;try{return G()}finally{f=ee}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,Z){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var ee=f;f=G;try{return Z()}finally{f=ee}},n.unstable_scheduleCallback=function(G,Z,ee){var fe=n.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?fe+ee:fe):ee=fe,G){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=ee+ae,G={id:u++,callback:Z,priorityLevel:G,startTime:ee,expirationTime:ae,sortIndex:-1},ee>fe?(G.sortIndex=ee,e(c,G),t(l)===null&&G===t(c)&&(E?(T(I),I=-1):E=!0,B(g,ee-fe))):(G.sortIndex=ae,e(l,G),w||v||(w=!0,$(y))),G},n.unstable_shouldYield=M,n.unstable_wrapCallback=function(G){var Z=f;return function(){var ee=f;f=Z;try{return G.apply(this,arguments)}finally{f=ee}}}})(d4);u4.exports=d4;var KK=u4.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var YK=D,Bs=KK;function he(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var h4=new Set,Sv={};function Ef(n,e){rg(n,e),rg(n+"Capture",e)}function rg(n,e){for(Sv[n]=e,n=0;n<e.length;n++)h4.add(e[n])}var nc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),AI=Object.prototype.hasOwnProperty,QK=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gM={},yM={};function XK(n){return AI.call(yM,n)?!0:AI.call(gM,n)?!1:QK.test(n)?yM[n]=!0:(gM[n]=!0,!1)}function JK(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function ZK(n,e,t,r){if(e===null||typeof e>"u"||JK(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function $i(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var ei={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){ei[n]=new $i(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];ei[e]=new $i(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){ei[n]=new $i(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){ei[n]=new $i(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){ei[n]=new $i(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){ei[n]=new $i(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){ei[n]=new $i(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){ei[n]=new $i(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){ei[n]=new $i(n,5,!1,n.toLowerCase(),null,!1,!1)});var mR=/[\-:]([a-z])/g;function gR(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(mR,gR);ei[e]=new $i(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(mR,gR);ei[e]=new $i(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(mR,gR);ei[e]=new $i(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){ei[n]=new $i(n,1,!1,n.toLowerCase(),null,!1,!1)});ei.xlinkHref=new $i("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){ei[n]=new $i(n,1,!1,n.toLowerCase(),null,!0,!0)});function yR(n,e,t,r){var i=ei.hasOwnProperty(e)?ei[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ZK(e,t,i,r)&&(t=null),r||i===null?XK(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var hc=YK.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,CE=Symbol.for("react.element"),tp=Symbol.for("react.portal"),np=Symbol.for("react.fragment"),vR=Symbol.for("react.strict_mode"),TI=Symbol.for("react.profiler"),f4=Symbol.for("react.provider"),p4=Symbol.for("react.context"),wR=Symbol.for("react.forward_ref"),II=Symbol.for("react.suspense"),xI=Symbol.for("react.suspense_list"),ER=Symbol.for("react.memo"),Ic=Symbol.for("react.lazy"),m4=Symbol.for("react.offscreen"),vM=Symbol.iterator;function Wg(n){return n===null||typeof n!="object"?null:(n=vM&&n[vM]||n["@@iterator"],typeof n=="function"?n:null)}var zn=Object.assign,G1;function yy(n){if(G1===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);G1=e&&e[1]||""}return`
`+G1+n}var W1=!1;function q1(n,e){if(!n||W1)return"";W1=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{W1=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?yy(n):""}function eY(n){switch(n.tag){case 5:return yy(n.type);case 16:return yy("Lazy");case 13:return yy("Suspense");case 19:return yy("SuspenseList");case 0:case 2:case 15:return n=q1(n.type,!1),n;case 11:return n=q1(n.type.render,!1),n;case 1:return n=q1(n.type,!0),n;default:return""}}function CI(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case np:return"Fragment";case tp:return"Portal";case TI:return"Profiler";case vR:return"StrictMode";case II:return"Suspense";case xI:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case p4:return(n.displayName||"Context")+".Consumer";case f4:return(n._context.displayName||"Context")+".Provider";case wR:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ER:return e=n.displayName||null,e!==null?e:CI(n.type)||"Memo";case Ic:e=n._payload,n=n._init;try{return CI(n(e))}catch{}}return null}function tY(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return CI(e);case 8:return e===vR?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gu(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function g4(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function nY(n){var e=g4(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function PE(n){n._valueTracker||(n._valueTracker=nY(n))}function y4(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=g4(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function q_(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function PI(n,e){var t=e.checked;return zn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function wM(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Gu(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function v4(n,e){e=e.checked,e!=null&&yR(n,"checked",e,!1)}function RI(n,e){v4(n,e);var t=Gu(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?kI(n,e.type,t):e.hasOwnProperty("defaultValue")&&kI(n,e.type,Gu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function EM(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function kI(n,e,t){(e!=="number"||q_(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var vy=Array.isArray;function Tp(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Gu(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function DI(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(he(91));return zn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function bM(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(he(92));if(vy(t)){if(1<t.length)throw Error(he(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Gu(t)}}function w4(n,e){var t=Gu(e.value),r=Gu(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function _M(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function E4(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function MI(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?E4(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var RE,b4=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(RE=RE||document.createElement("div"),RE.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=RE.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Av(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Jy={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rY=["Webkit","ms","Moz","O"];Object.keys(Jy).forEach(function(n){rY.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Jy[e]=Jy[n]})});function _4(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Jy.hasOwnProperty(n)&&Jy[n]?(""+e).trim():e+"px"}function S4(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=_4(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var iY=zn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function NI(n,e){if(e){if(iY[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(he(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(he(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(he(61))}if(e.style!=null&&typeof e.style!="object")throw Error(he(62))}}function LI(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var OI=null;function bR(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var FI=null,Ip=null,xp=null;function SM(n){if(n=K0(n)){if(typeof FI!="function")throw Error(he(280));var e=n.stateNode;e&&(e=IA(e),FI(n.stateNode,n.type,e))}}function A4(n){Ip?xp?xp.push(n):xp=[n]:Ip=n}function T4(){if(Ip){var n=Ip,e=xp;if(xp=Ip=null,SM(n),e)for(n=0;n<e.length;n++)SM(e[n])}}function I4(n,e){return n(e)}function x4(){}var K1=!1;function C4(n,e,t){if(K1)return n(e,t);K1=!0;try{return I4(n,e,t)}finally{K1=!1,(Ip!==null||xp!==null)&&(x4(),T4())}}function Tv(n,e){var t=n.stateNode;if(t===null)return null;var r=IA(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(he(231,e,typeof t));return t}var VI=!1;if(nc)try{var qg={};Object.defineProperty(qg,"passive",{get:function(){VI=!0}}),window.addEventListener("test",qg,qg),window.removeEventListener("test",qg,qg)}catch{VI=!1}function sY(n,e,t,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var Zy=!1,K_=null,Y_=!1,UI=null,oY={onError:function(n){Zy=!0,K_=n}};function aY(n,e,t,r,i,s,o,a,l){Zy=!1,K_=null,sY.apply(oY,arguments)}function lY(n,e,t,r,i,s,o,a,l){if(aY.apply(this,arguments),Zy){if(Zy){var c=K_;Zy=!1,K_=null}else throw Error(he(198));Y_||(Y_=!0,UI=c)}}function bf(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function P4(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function AM(n){if(bf(n)!==n)throw Error(he(188))}function cY(n){var e=n.alternate;if(!e){if(e=bf(n),e===null)throw Error(he(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return AM(i),n;if(s===r)return AM(i),e;s=s.sibling}throw Error(he(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o)throw Error(he(189))}}if(t.alternate!==r)throw Error(he(190))}if(t.tag!==3)throw Error(he(188));return t.stateNode.current===t?n:e}function R4(n){return n=cY(n),n!==null?k4(n):null}function k4(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=k4(n);if(e!==null)return e;n=n.sibling}return null}var D4=Bs.unstable_scheduleCallback,TM=Bs.unstable_cancelCallback,uY=Bs.unstable_shouldYield,dY=Bs.unstable_requestPaint,nr=Bs.unstable_now,hY=Bs.unstable_getCurrentPriorityLevel,_R=Bs.unstable_ImmediatePriority,M4=Bs.unstable_UserBlockingPriority,Q_=Bs.unstable_NormalPriority,fY=Bs.unstable_LowPriority,N4=Bs.unstable_IdlePriority,_A=null,ja=null;function pY(n){if(ja&&typeof ja.onCommitFiberRoot=="function")try{ja.onCommitFiberRoot(_A,n,void 0,(n.current.flags&128)===128)}catch{}}var Go=Math.clz32?Math.clz32:yY,mY=Math.log,gY=Math.LN2;function yY(n){return n>>>=0,n===0?32:31-(mY(n)/gY|0)|0}var kE=64,DE=4194304;function wy(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function X_(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?r=wy(a):(s&=o,s!==0&&(r=wy(s)))}else o=t&~i,o!==0?r=wy(o):s!==0&&(r=wy(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Go(e),i=1<<t,r|=n[t],e&=~i;return r}function vY(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wY(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-Go(s),a=1<<o,l=i[o];l===-1?(!(a&t)||a&r)&&(i[o]=vY(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function BI(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function L4(){var n=kE;return kE<<=1,!(kE&4194240)&&(kE=64),n}function Y1(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function W0(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Go(e),n[e]=t}function EY(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Go(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function SR(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Go(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var rn=0;function O4(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var F4,AR,V4,U4,B4,$I=!1,ME=[],ku=null,Du=null,Mu=null,Iv=new Map,xv=new Map,Oc=[],bY="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function IM(n,e){switch(n){case"focusin":case"focusout":ku=null;break;case"dragenter":case"dragleave":Du=null;break;case"mouseover":case"mouseout":Mu=null;break;case"pointerover":case"pointerout":Iv.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":xv.delete(e.pointerId)}}function Kg(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=K0(e),e!==null&&AR(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function _Y(n,e,t,r,i){switch(e){case"focusin":return ku=Kg(ku,n,e,t,r,i),!0;case"dragenter":return Du=Kg(Du,n,e,t,r,i),!0;case"mouseover":return Mu=Kg(Mu,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return Iv.set(s,Kg(Iv.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,xv.set(s,Kg(xv.get(s)||null,n,e,t,r,i)),!0}return!1}function $4(n){var e=Md(n.target);if(e!==null){var t=bf(e);if(t!==null){if(e=t.tag,e===13){if(e=P4(t),e!==null){n.blockedOn=e,B4(n.priority,function(){V4(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function xb(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=jI(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);OI=r,t.target.dispatchEvent(r),OI=null}else return e=K0(t),e!==null&&AR(e),n.blockedOn=t,!1;e.shift()}return!0}function xM(n,e,t){xb(n)&&t.delete(e)}function SY(){$I=!1,ku!==null&&xb(ku)&&(ku=null),Du!==null&&xb(Du)&&(Du=null),Mu!==null&&xb(Mu)&&(Mu=null),Iv.forEach(xM),xv.forEach(xM)}function Yg(n,e){n.blockedOn===e&&(n.blockedOn=null,$I||($I=!0,Bs.unstable_scheduleCallback(Bs.unstable_NormalPriority,SY)))}function Cv(n){function e(i){return Yg(i,n)}if(0<ME.length){Yg(ME[0],n);for(var t=1;t<ME.length;t++){var r=ME[t];r.blockedOn===n&&(r.blockedOn=null)}}for(ku!==null&&Yg(ku,n),Du!==null&&Yg(Du,n),Mu!==null&&Yg(Mu,n),Iv.forEach(e),xv.forEach(e),t=0;t<Oc.length;t++)r=Oc[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Oc.length&&(t=Oc[0],t.blockedOn===null);)$4(t),t.blockedOn===null&&Oc.shift()}var Cp=hc.ReactCurrentBatchConfig,J_=!0;function AY(n,e,t,r){var i=rn,s=Cp.transition;Cp.transition=null;try{rn=1,TR(n,e,t,r)}finally{rn=i,Cp.transition=s}}function TY(n,e,t,r){var i=rn,s=Cp.transition;Cp.transition=null;try{rn=4,TR(n,e,t,r)}finally{rn=i,Cp.transition=s}}function TR(n,e,t,r){if(J_){var i=jI(n,e,t,r);if(i===null)sT(n,e,r,Z_,t),IM(n,r);else if(_Y(i,n,e,t,r))r.stopPropagation();else if(IM(n,r),e&4&&-1<bY.indexOf(n)){for(;i!==null;){var s=K0(i);if(s!==null&&F4(s),s=jI(n,e,t,r),s===null&&sT(n,e,r,Z_,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else sT(n,e,r,null,t)}}var Z_=null;function jI(n,e,t,r){if(Z_=null,n=bR(r),n=Md(n),n!==null)if(e=bf(n),e===null)n=null;else if(t=e.tag,t===13){if(n=P4(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Z_=n,null}function j4(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hY()){case _R:return 1;case M4:return 4;case Q_:case fY:return 16;case N4:return 536870912;default:return 16}default:return 16}}var _u=null,IR=null,Cb=null;function z4(){if(Cb)return Cb;var n,e=IR,t=e.length,r,i="value"in _u?_u.value:_u.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return Cb=i.slice(n,1<r?1-r:void 0)}function Pb(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function NE(){return!0}function CM(){return!1}function zs(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?NE:CM,this.isPropagationStopped=CM,this}return zn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=NE)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=NE)},persist:function(){},isPersistent:NE}),e}var Ag={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xR=zs(Ag),q0=zn({},Ag,{view:0,detail:0}),IY=zs(q0),Q1,X1,Qg,SA=zn({},q0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:CR,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Qg&&(Qg&&n.type==="mousemove"?(Q1=n.screenX-Qg.screenX,X1=n.screenY-Qg.screenY):X1=Q1=0,Qg=n),Q1)},movementY:function(n){return"movementY"in n?n.movementY:X1}}),PM=zs(SA),xY=zn({},SA,{dataTransfer:0}),CY=zs(xY),PY=zn({},q0,{relatedTarget:0}),J1=zs(PY),RY=zn({},Ag,{animationName:0,elapsedTime:0,pseudoElement:0}),kY=zs(RY),DY=zn({},Ag,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),MY=zs(DY),NY=zn({},Ag,{data:0}),RM=zs(NY),LY={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},OY={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},FY={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VY(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=FY[n])?!!e[n]:!1}function CR(){return VY}var UY=zn({},q0,{key:function(n){if(n.key){var e=LY[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Pb(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?OY[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:CR,charCode:function(n){return n.type==="keypress"?Pb(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Pb(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),BY=zs(UY),$Y=zn({},SA,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kM=zs($Y),jY=zn({},q0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:CR}),zY=zs(jY),HY=zn({},Ag,{propertyName:0,elapsedTime:0,pseudoElement:0}),GY=zs(HY),WY=zn({},SA,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),qY=zs(WY),KY=[9,13,27,32],PR=nc&&"CompositionEvent"in window,ev=null;nc&&"documentMode"in document&&(ev=document.documentMode);var YY=nc&&"TextEvent"in window&&!ev,H4=nc&&(!PR||ev&&8<ev&&11>=ev),DM=" ",MM=!1;function G4(n,e){switch(n){case"keyup":return KY.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function W4(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var rp=!1;function QY(n,e){switch(n){case"compositionend":return W4(e);case"keypress":return e.which!==32?null:(MM=!0,DM);case"textInput":return n=e.data,n===DM&&MM?null:n;default:return null}}function XY(n,e){if(rp)return n==="compositionend"||!PR&&G4(n,e)?(n=z4(),Cb=IR=_u=null,rp=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return H4&&e.locale!=="ko"?null:e.data;default:return null}}var JY={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function NM(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!JY[n.type]:e==="textarea"}function q4(n,e,t,r){A4(r),e=eS(e,"onChange"),0<e.length&&(t=new xR("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var tv=null,Pv=null;function ZY(n){iB(n,0)}function AA(n){var e=op(n);if(y4(e))return n}function eQ(n,e){if(n==="change")return e}var K4=!1;if(nc){var Z1;if(nc){var eT="oninput"in document;if(!eT){var LM=document.createElement("div");LM.setAttribute("oninput","return;"),eT=typeof LM.oninput=="function"}Z1=eT}else Z1=!1;K4=Z1&&(!document.documentMode||9<document.documentMode)}function OM(){tv&&(tv.detachEvent("onpropertychange",Y4),Pv=tv=null)}function Y4(n){if(n.propertyName==="value"&&AA(Pv)){var e=[];q4(e,Pv,n,bR(n)),C4(ZY,e)}}function tQ(n,e,t){n==="focusin"?(OM(),tv=e,Pv=t,tv.attachEvent("onpropertychange",Y4)):n==="focusout"&&OM()}function nQ(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return AA(Pv)}function rQ(n,e){if(n==="click")return AA(e)}function iQ(n,e){if(n==="input"||n==="change")return AA(e)}function sQ(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Yo=typeof Object.is=="function"?Object.is:sQ;function Rv(n,e){if(Yo(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!AI.call(e,i)||!Yo(n[i],e[i]))return!1}return!0}function FM(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function VM(n,e){var t=FM(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=FM(t)}}function Q4(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Q4(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function X4(){for(var n=window,e=q_();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=q_(n.document)}return e}function RR(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function oQ(n){var e=X4(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Q4(t.ownerDocument.documentElement,t)){if(r!==null&&RR(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=VM(t,s);var o=VM(t,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var aQ=nc&&"documentMode"in document&&11>=document.documentMode,ip=null,zI=null,nv=null,HI=!1;function UM(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;HI||ip==null||ip!==q_(r)||(r=ip,"selectionStart"in r&&RR(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),nv&&Rv(nv,r)||(nv=r,r=eS(zI,"onSelect"),0<r.length&&(e=new xR("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=ip)))}function LE(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var sp={animationend:LE("Animation","AnimationEnd"),animationiteration:LE("Animation","AnimationIteration"),animationstart:LE("Animation","AnimationStart"),transitionend:LE("Transition","TransitionEnd")},tT={},J4={};nc&&(J4=document.createElement("div").style,"AnimationEvent"in window||(delete sp.animationend.animation,delete sp.animationiteration.animation,delete sp.animationstart.animation),"TransitionEvent"in window||delete sp.transitionend.transition);function TA(n){if(tT[n])return tT[n];if(!sp[n])return n;var e=sp[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in J4)return tT[n]=e[t];return n}var Z4=TA("animationend"),eB=TA("animationiteration"),tB=TA("animationstart"),nB=TA("transitionend"),rB=new Map,BM="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function rd(n,e){rB.set(n,e),Ef(e,[n])}for(var nT=0;nT<BM.length;nT++){var rT=BM[nT],lQ=rT.toLowerCase(),cQ=rT[0].toUpperCase()+rT.slice(1);rd(lQ,"on"+cQ)}rd(Z4,"onAnimationEnd");rd(eB,"onAnimationIteration");rd(tB,"onAnimationStart");rd("dblclick","onDoubleClick");rd("focusin","onFocus");rd("focusout","onBlur");rd(nB,"onTransitionEnd");rg("onMouseEnter",["mouseout","mouseover"]);rg("onMouseLeave",["mouseout","mouseover"]);rg("onPointerEnter",["pointerout","pointerover"]);rg("onPointerLeave",["pointerout","pointerover"]);Ef("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ef("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ef("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ef("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ef("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ef("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ey="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),uQ=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ey));function $M(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,lY(r,e,void 0,n),n.currentTarget=null}function iB(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;$M(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;$M(i,a,c),s=l}}}if(Y_)throw n=UI,Y_=!1,UI=null,n}function Tn(n,e){var t=e[YI];t===void 0&&(t=e[YI]=new Set);var r=n+"__bubble";t.has(r)||(sB(e,n,2,!1),t.add(r))}function iT(n,e,t){var r=0;e&&(r|=4),sB(t,n,r,e)}var OE="_reactListening"+Math.random().toString(36).slice(2);function kv(n){if(!n[OE]){n[OE]=!0,h4.forEach(function(t){t!=="selectionchange"&&(uQ.has(t)||iT(t,!1,n),iT(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[OE]||(e[OE]=!0,iT("selectionchange",!1,e))}}function sB(n,e,t,r){switch(j4(e)){case 1:var i=AY;break;case 4:i=TY;break;default:i=TR}t=i.bind(null,e,t,n),i=void 0,!VI||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function sT(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Md(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}C4(function(){var c=s,u=bR(t),h=[];e:{var f=rB.get(n);if(f!==void 0){var v=xR,w=n;switch(n){case"keypress":if(Pb(t)===0)break e;case"keydown":case"keyup":v=BY;break;case"focusin":w="focus",v=J1;break;case"focusout":w="blur",v=J1;break;case"beforeblur":case"afterblur":v=J1;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":v=PM;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":v=CY;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":v=zY;break;case Z4:case eB:case tB:v=kY;break;case nB:v=GY;break;case"scroll":v=IY;break;case"wheel":v=qY;break;case"copy":case"cut":case"paste":v=MY;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":v=kM}var E=(e&4)!==0,A=!E&&n==="scroll",T=E?f!==null?f+"Capture":null:f;E=[];for(var _=c,b;_!==null;){b=_;var g=b.stateNode;if(b.tag===5&&g!==null&&(b=g,T!==null&&(g=Tv(_,T),g!=null&&E.push(Dv(_,g,b)))),A)break;_=_.return}0<E.length&&(f=new v(f,w,null,t,u),h.push({event:f,listeners:E}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",v=n==="mouseout"||n==="pointerout",f&&t!==OI&&(w=t.relatedTarget||t.fromElement)&&(Md(w)||w[rc]))break e;if((v||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,v?(w=t.relatedTarget||t.toElement,v=c,w=w?Md(w):null,w!==null&&(A=bf(w),w!==A||w.tag!==5&&w.tag!==6)&&(w=null)):(v=null,w=c),v!==w)){if(E=PM,g="onMouseLeave",T="onMouseEnter",_="mouse",(n==="pointerout"||n==="pointerover")&&(E=kM,g="onPointerLeave",T="onPointerEnter",_="pointer"),A=v==null?f:op(v),b=w==null?f:op(w),f=new E(g,_+"leave",v,t,u),f.target=A,f.relatedTarget=b,g=null,Md(u)===c&&(E=new E(T,_+"enter",w,t,u),E.target=b,E.relatedTarget=A,g=E),A=g,v&&w)t:{for(E=v,T=w,_=0,b=E;b;b=Ff(b))_++;for(b=0,g=T;g;g=Ff(g))b++;for(;0<_-b;)E=Ff(E),_--;for(;0<b-_;)T=Ff(T),b--;for(;_--;){if(E===T||T!==null&&E===T.alternate)break t;E=Ff(E),T=Ff(T)}E=null}else E=null;v!==null&&jM(h,f,v,E,!1),w!==null&&A!==null&&jM(h,A,w,E,!0)}}e:{if(f=c?op(c):window,v=f.nodeName&&f.nodeName.toLowerCase(),v==="select"||v==="input"&&f.type==="file")var y=eQ;else if(NM(f))if(K4)y=iQ;else{y=nQ;var x=tQ}else(v=f.nodeName)&&v.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(y=rQ);if(y&&(y=y(n,c))){q4(h,y,t,u);break e}x&&x(n,f,c),n==="focusout"&&(x=f._wrapperState)&&x.controlled&&f.type==="number"&&kI(f,"number",f.value)}switch(x=c?op(c):window,n){case"focusin":(NM(x)||x.contentEditable==="true")&&(ip=x,zI=c,nv=null);break;case"focusout":nv=zI=ip=null;break;case"mousedown":HI=!0;break;case"contextmenu":case"mouseup":case"dragend":HI=!1,UM(h,t,u);break;case"selectionchange":if(aQ)break;case"keydown":case"keyup":UM(h,t,u)}var S;if(PR)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else rp?G4(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(H4&&t.locale!=="ko"&&(rp||I!=="onCompositionStart"?I==="onCompositionEnd"&&rp&&(S=z4()):(_u=u,IR="value"in _u?_u.value:_u.textContent,rp=!0)),x=eS(c,I),0<x.length&&(I=new RM(I,n,null,t,u),h.push({event:I,listeners:x}),S?I.data=S:(S=W4(t),S!==null&&(I.data=S)))),(S=YY?QY(n,t):XY(n,t))&&(c=eS(c,"onBeforeInput"),0<c.length&&(u=new RM("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=S))}iB(h,e)})}function Dv(n,e,t){return{instance:n,listener:e,currentTarget:t}}function eS(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Tv(n,t),s!=null&&r.unshift(Dv(n,s,i)),s=Tv(n,e),s!=null&&r.push(Dv(n,s,i))),n=n.return}return r}function Ff(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function jM(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Tv(t,s),l!=null&&o.unshift(Dv(t,l,a))):i||(l=Tv(t,s),l!=null&&o.push(Dv(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var dQ=/\r\n?/g,hQ=/\u0000|\uFFFD/g;function zM(n){return(typeof n=="string"?n:""+n).replace(dQ,`
`).replace(hQ,"")}function FE(n,e,t){if(e=zM(e),zM(n)!==e&&t)throw Error(he(425))}function tS(){}var GI=null,WI=null;function qI(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var KI=typeof setTimeout=="function"?setTimeout:void 0,fQ=typeof clearTimeout=="function"?clearTimeout:void 0,HM=typeof Promise=="function"?Promise:void 0,pQ=typeof queueMicrotask=="function"?queueMicrotask:typeof HM<"u"?function(n){return HM.resolve(null).then(n).catch(mQ)}:KI;function mQ(n){setTimeout(function(){throw n})}function oT(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Cv(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Cv(e)}function Nu(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function GM(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Tg=Math.random().toString(36).slice(2),ka="__reactFiber$"+Tg,Mv="__reactProps$"+Tg,rc="__reactContainer$"+Tg,YI="__reactEvents$"+Tg,gQ="__reactListeners$"+Tg,yQ="__reactHandles$"+Tg;function Md(n){var e=n[ka];if(e)return e;for(var t=n.parentNode;t;){if(e=t[rc]||t[ka]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=GM(n);n!==null;){if(t=n[ka])return t;n=GM(n)}return e}n=t,t=n.parentNode}return null}function K0(n){return n=n[ka]||n[rc],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function op(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(he(33))}function IA(n){return n[Mv]||null}var QI=[],ap=-1;function id(n){return{current:n}}function In(n){0>ap||(n.current=QI[ap],QI[ap]=null,ap--)}function _n(n,e){ap++,QI[ap]=n.current,n.current=e}var Wu={},Ei=id(Wu),rs=id(!1),lf=Wu;function ig(n,e){var t=n.type.contextTypes;if(!t)return Wu;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function is(n){return n=n.childContextTypes,n!=null}function nS(){In(rs),In(Ei)}function WM(n,e,t){if(Ei.current!==Wu)throw Error(he(168));_n(Ei,e),_n(rs,t)}function oB(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(he(108,tY(n)||"Unknown",i));return zn({},t,r)}function rS(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Wu,lf=Ei.current,_n(Ei,n),_n(rs,rs.current),!0}function qM(n,e,t){var r=n.stateNode;if(!r)throw Error(he(169));t?(n=oB(n,e,lf),r.__reactInternalMemoizedMergedChildContext=n,In(rs),In(Ei),_n(Ei,n)):In(rs),_n(rs,t)}var ul=null,xA=!1,aT=!1;function aB(n){ul===null?ul=[n]:ul.push(n)}function vQ(n){xA=!0,aB(n)}function sd(){if(!aT&&ul!==null){aT=!0;var n=0,e=rn;try{var t=ul;for(rn=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}ul=null,xA=!1}catch(i){throw ul!==null&&(ul=ul.slice(n+1)),D4(_R,sd),i}finally{rn=e,aT=!1}}return null}var lp=[],cp=0,iS=null,sS=0,ao=[],lo=0,cf=null,Wl=1,ql="";function bd(n,e){lp[cp++]=sS,lp[cp++]=iS,iS=n,sS=e}function lB(n,e,t){ao[lo++]=Wl,ao[lo++]=ql,ao[lo++]=cf,cf=n;var r=Wl;n=ql;var i=32-Go(r)-1;r&=~(1<<i),t+=1;var s=32-Go(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Wl=1<<32-Go(e)+i|t<<i|r,ql=s+n}else Wl=1<<s|t<<i|r,ql=n}function kR(n){n.return!==null&&(bd(n,1),lB(n,1,0))}function DR(n){for(;n===iS;)iS=lp[--cp],lp[cp]=null,sS=lp[--cp],lp[cp]=null;for(;n===cf;)cf=ao[--lo],ao[lo]=null,ql=ao[--lo],ao[lo]=null,Wl=ao[--lo],ao[lo]=null}var Fs=null,Ns=null,Ln=!1,$o=null;function cB(n,e){var t=uo(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function KM(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Fs=n,Ns=Nu(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Fs=n,Ns=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=cf!==null?{id:Wl,overflow:ql}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=uo(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Fs=n,Ns=null,!0):!1;default:return!1}}function XI(n){return(n.mode&1)!==0&&(n.flags&128)===0}function JI(n){if(Ln){var e=Ns;if(e){var t=e;if(!KM(n,e)){if(XI(n))throw Error(he(418));e=Nu(t.nextSibling);var r=Fs;e&&KM(n,e)?cB(r,t):(n.flags=n.flags&-4097|2,Ln=!1,Fs=n)}}else{if(XI(n))throw Error(he(418));n.flags=n.flags&-4097|2,Ln=!1,Fs=n}}}function YM(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Fs=n}function VE(n){if(n!==Fs)return!1;if(!Ln)return YM(n),Ln=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!qI(n.type,n.memoizedProps)),e&&(e=Ns)){if(XI(n))throw uB(),Error(he(418));for(;e;)cB(n,e),e=Nu(e.nextSibling)}if(YM(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(he(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Ns=Nu(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Ns=null}}else Ns=Fs?Nu(n.stateNode.nextSibling):null;return!0}function uB(){for(var n=Ns;n;)n=Nu(n.nextSibling)}function sg(){Ns=Fs=null,Ln=!1}function MR(n){$o===null?$o=[n]:$o.push(n)}var wQ=hc.ReactCurrentBatchConfig;function Xg(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(he(309));var r=t.stateNode}if(!r)throw Error(he(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(he(284));if(!t._owner)throw Error(he(290,n))}return n}function UE(n,e){throw n=Object.prototype.toString.call(e),Error(he(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function QM(n){var e=n._init;return e(n._payload)}function dB(n){function e(T,_){if(n){var b=T.deletions;b===null?(T.deletions=[_],T.flags|=16):b.push(_)}}function t(T,_){if(!n)return null;for(;_!==null;)e(T,_),_=_.sibling;return null}function r(T,_){for(T=new Map;_!==null;)_.key!==null?T.set(_.key,_):T.set(_.index,_),_=_.sibling;return T}function i(T,_){return T=Vu(T,_),T.index=0,T.sibling=null,T}function s(T,_,b){return T.index=b,n?(b=T.alternate,b!==null?(b=b.index,b<_?(T.flags|=2,_):b):(T.flags|=2,_)):(T.flags|=1048576,_)}function o(T){return n&&T.alternate===null&&(T.flags|=2),T}function a(T,_,b,g){return _===null||_.tag!==6?(_=pT(b,T.mode,g),_.return=T,_):(_=i(_,b),_.return=T,_)}function l(T,_,b,g){var y=b.type;return y===np?u(T,_,b.props.children,g,b.key):_!==null&&(_.elementType===y||typeof y=="object"&&y!==null&&y.$$typeof===Ic&&QM(y)===_.type)?(g=i(_,b.props),g.ref=Xg(T,_,b),g.return=T,g):(g=Ob(b.type,b.key,b.props,null,T.mode,g),g.ref=Xg(T,_,b),g.return=T,g)}function c(T,_,b,g){return _===null||_.tag!==4||_.stateNode.containerInfo!==b.containerInfo||_.stateNode.implementation!==b.implementation?(_=mT(b,T.mode,g),_.return=T,_):(_=i(_,b.children||[]),_.return=T,_)}function u(T,_,b,g,y){return _===null||_.tag!==7?(_=Kh(b,T.mode,g,y),_.return=T,_):(_=i(_,b),_.return=T,_)}function h(T,_,b){if(typeof _=="string"&&_!==""||typeof _=="number")return _=pT(""+_,T.mode,b),_.return=T,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case CE:return b=Ob(_.type,_.key,_.props,null,T.mode,b),b.ref=Xg(T,null,_),b.return=T,b;case tp:return _=mT(_,T.mode,b),_.return=T,_;case Ic:var g=_._init;return h(T,g(_._payload),b)}if(vy(_)||Wg(_))return _=Kh(_,T.mode,b,null),_.return=T,_;UE(T,_)}return null}function f(T,_,b,g){var y=_!==null?_.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return y!==null?null:a(T,_,""+b,g);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case CE:return b.key===y?l(T,_,b,g):null;case tp:return b.key===y?c(T,_,b,g):null;case Ic:return y=b._init,f(T,_,y(b._payload),g)}if(vy(b)||Wg(b))return y!==null?null:u(T,_,b,g,null);UE(T,b)}return null}function v(T,_,b,g,y){if(typeof g=="string"&&g!==""||typeof g=="number")return T=T.get(b)||null,a(_,T,""+g,y);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case CE:return T=T.get(g.key===null?b:g.key)||null,l(_,T,g,y);case tp:return T=T.get(g.key===null?b:g.key)||null,c(_,T,g,y);case Ic:var x=g._init;return v(T,_,b,x(g._payload),y)}if(vy(g)||Wg(g))return T=T.get(b)||null,u(_,T,g,y,null);UE(_,g)}return null}function w(T,_,b,g){for(var y=null,x=null,S=_,I=_=0,P=null;S!==null&&I<b.length;I++){S.index>I?(P=S,S=null):P=S.sibling;var N=f(T,S,b[I],g);if(N===null){S===null&&(S=P);break}n&&S&&N.alternate===null&&e(T,S),_=s(N,_,I),x===null?y=N:x.sibling=N,x=N,S=P}if(I===b.length)return t(T,S),Ln&&bd(T,I),y;if(S===null){for(;I<b.length;I++)S=h(T,b[I],g),S!==null&&(_=s(S,_,I),x===null?y=S:x.sibling=S,x=S);return Ln&&bd(T,I),y}for(S=r(T,S);I<b.length;I++)P=v(S,T,I,b[I],g),P!==null&&(n&&P.alternate!==null&&S.delete(P.key===null?I:P.key),_=s(P,_,I),x===null?y=P:x.sibling=P,x=P);return n&&S.forEach(function(M){return e(T,M)}),Ln&&bd(T,I),y}function E(T,_,b,g){var y=Wg(b);if(typeof y!="function")throw Error(he(150));if(b=y.call(b),b==null)throw Error(he(151));for(var x=y=null,S=_,I=_=0,P=null,N=b.next();S!==null&&!N.done;I++,N=b.next()){S.index>I?(P=S,S=null):P=S.sibling;var M=f(T,S,N.value,g);if(M===null){S===null&&(S=P);break}n&&S&&M.alternate===null&&e(T,S),_=s(M,_,I),x===null?y=M:x.sibling=M,x=M,S=P}if(N.done)return t(T,S),Ln&&bd(T,I),y;if(S===null){for(;!N.done;I++,N=b.next())N=h(T,N.value,g),N!==null&&(_=s(N,_,I),x===null?y=N:x.sibling=N,x=N);return Ln&&bd(T,I),y}for(S=r(T,S);!N.done;I++,N=b.next())N=v(S,T,I,N.value,g),N!==null&&(n&&N.alternate!==null&&S.delete(N.key===null?I:N.key),_=s(N,_,I),x===null?y=N:x.sibling=N,x=N);return n&&S.forEach(function(V){return e(T,V)}),Ln&&bd(T,I),y}function A(T,_,b,g){if(typeof b=="object"&&b!==null&&b.type===np&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case CE:e:{for(var y=b.key,x=_;x!==null;){if(x.key===y){if(y=b.type,y===np){if(x.tag===7){t(T,x.sibling),_=i(x,b.props.children),_.return=T,T=_;break e}}else if(x.elementType===y||typeof y=="object"&&y!==null&&y.$$typeof===Ic&&QM(y)===x.type){t(T,x.sibling),_=i(x,b.props),_.ref=Xg(T,x,b),_.return=T,T=_;break e}t(T,x);break}else e(T,x);x=x.sibling}b.type===np?(_=Kh(b.props.children,T.mode,g,b.key),_.return=T,T=_):(g=Ob(b.type,b.key,b.props,null,T.mode,g),g.ref=Xg(T,_,b),g.return=T,T=g)}return o(T);case tp:e:{for(x=b.key;_!==null;){if(_.key===x)if(_.tag===4&&_.stateNode.containerInfo===b.containerInfo&&_.stateNode.implementation===b.implementation){t(T,_.sibling),_=i(_,b.children||[]),_.return=T,T=_;break e}else{t(T,_);break}else e(T,_);_=_.sibling}_=mT(b,T.mode,g),_.return=T,T=_}return o(T);case Ic:return x=b._init,A(T,_,x(b._payload),g)}if(vy(b))return w(T,_,b,g);if(Wg(b))return E(T,_,b,g);UE(T,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,_!==null&&_.tag===6?(t(T,_.sibling),_=i(_,b),_.return=T,T=_):(t(T,_),_=pT(b,T.mode,g),_.return=T,T=_),o(T)):t(T,_)}return A}var og=dB(!0),hB=dB(!1),oS=id(null),aS=null,up=null,NR=null;function LR(){NR=up=aS=null}function OR(n){var e=oS.current;In(oS),n._currentValue=e}function ZI(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Pp(n,e){aS=n,NR=up=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(es=!0),n.firstContext=null)}function go(n){var e=n._currentValue;if(NR!==n)if(n={context:n,memoizedValue:e,next:null},up===null){if(aS===null)throw Error(he(308));up=n,aS.dependencies={lanes:0,firstContext:n}}else up=up.next=n;return e}var Nd=null;function FR(n){Nd===null?Nd=[n]:Nd.push(n)}function fB(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,FR(e)):(t.next=i.next,i.next=t),e.interleaved=t,ic(n,r)}function ic(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var xc=!1;function VR(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pB(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Kl(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Lu(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,zt&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,ic(n,t)}return i=r.interleaved,i===null?(e.next=e,FR(r)):(e.next=i.next,i.next=e),r.interleaved=e,ic(n,t)}function Rb(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,SR(n,t)}}function XM(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function lS(n,e,t,r){var i=n.updateQueue;xc=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=i.baseState;o=0,u=c=l=null,a=s;do{var f=a.lane,v=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:v,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var w=n,E=a;switch(f=e,v=t,E.tag){case 1:if(w=E.payload,typeof w=="function"){h=w.call(v,h,f);break e}h=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=E.payload,f=typeof w=="function"?w.call(v,h,f):w,f==null)break e;h=zn({},h,f);break e;case 2:xc=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else v={eventTime:v,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=v,l=h):u=u.next=v,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(u===null&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);df|=o,n.lanes=o,n.memoizedState=h}}function JM(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(he(191,i));i.call(r)}}}var Y0={},za=id(Y0),Nv=id(Y0),Lv=id(Y0);function Ld(n){if(n===Y0)throw Error(he(174));return n}function UR(n,e){switch(_n(Lv,e),_n(Nv,n),_n(za,Y0),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:MI(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=MI(e,n)}In(za),_n(za,e)}function ag(){In(za),In(Nv),In(Lv)}function mB(n){Ld(Lv.current);var e=Ld(za.current),t=MI(e,n.type);e!==t&&(_n(Nv,n),_n(za,t))}function BR(n){Nv.current===n&&(In(za),In(Nv))}var Un=id(0);function cS(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var lT=[];function $R(){for(var n=0;n<lT.length;n++)lT[n]._workInProgressVersionPrimary=null;lT.length=0}var kb=hc.ReactCurrentDispatcher,cT=hc.ReactCurrentBatchConfig,uf=0,jn=null,Er=null,Fr=null,uS=!1,rv=!1,Ov=0,EQ=0;function si(){throw Error(he(321))}function jR(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Yo(n[t],e[t]))return!1;return!0}function zR(n,e,t,r,i,s){if(uf=s,jn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,kb.current=n===null||n.memoizedState===null?AQ:TQ,n=t(r,i),rv){s=0;do{if(rv=!1,Ov=0,25<=s)throw Error(he(301));s+=1,Fr=Er=null,e.updateQueue=null,kb.current=IQ,n=t(r,i)}while(rv)}if(kb.current=dS,e=Er!==null&&Er.next!==null,uf=0,Fr=Er=jn=null,uS=!1,e)throw Error(he(300));return n}function HR(){var n=Ov!==0;return Ov=0,n}function ha(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fr===null?jn.memoizedState=Fr=n:Fr=Fr.next=n,Fr}function yo(){if(Er===null){var n=jn.alternate;n=n!==null?n.memoizedState:null}else n=Er.next;var e=Fr===null?jn.memoizedState:Fr.next;if(e!==null)Fr=e,Er=n;else{if(n===null)throw Error(he(310));Er=n,n={memoizedState:Er.memoizedState,baseState:Er.baseState,baseQueue:Er.baseQueue,queue:Er.queue,next:null},Fr===null?jn.memoizedState=Fr=n:Fr=Fr.next=n}return Fr}function Fv(n,e){return typeof e=="function"?e(n):e}function uT(n){var e=yo(),t=e.queue;if(t===null)throw Error(he(311));t.lastRenderedReducer=n;var r=Er,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((uf&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,jn.lanes|=u,df|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,Yo(r,e.memoizedState)||(es=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,jn.lanes|=s,df|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function dT(n){var e=yo(),t=e.queue;if(t===null)throw Error(he(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);Yo(s,e.memoizedState)||(es=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function gB(){}function yB(n,e){var t=jn,r=yo(),i=e(),s=!Yo(r.memoizedState,i);if(s&&(r.memoizedState=i,es=!0),r=r.queue,GR(EB.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||Fr!==null&&Fr.memoizedState.tag&1){if(t.flags|=2048,Vv(9,wB.bind(null,t,r,i,e),void 0,null),Vr===null)throw Error(he(349));uf&30||vB(t,e,i)}return i}function vB(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=jn.updateQueue,e===null?(e={lastEffect:null,stores:null},jn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function wB(n,e,t,r){e.value=t,e.getSnapshot=r,bB(e)&&_B(n)}function EB(n,e,t){return t(function(){bB(e)&&_B(n)})}function bB(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Yo(n,t)}catch{return!0}}function _B(n){var e=ic(n,1);e!==null&&Wo(e,n,1,-1)}function ZM(n){var e=ha();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fv,lastRenderedState:n},e.queue=n,n=n.dispatch=SQ.bind(null,jn,n),[e.memoizedState,n]}function Vv(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=jn.updateQueue,e===null?(e={lastEffect:null,stores:null},jn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function SB(){return yo().memoizedState}function Db(n,e,t,r){var i=ha();jn.flags|=n,i.memoizedState=Vv(1|e,t,void 0,r===void 0?null:r)}function CA(n,e,t,r){var i=yo();r=r===void 0?null:r;var s=void 0;if(Er!==null){var o=Er.memoizedState;if(s=o.destroy,r!==null&&jR(r,o.deps)){i.memoizedState=Vv(e,t,s,r);return}}jn.flags|=n,i.memoizedState=Vv(1|e,t,s,r)}function eN(n,e){return Db(8390656,8,n,e)}function GR(n,e){return CA(2048,8,n,e)}function AB(n,e){return CA(4,2,n,e)}function TB(n,e){return CA(4,4,n,e)}function IB(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function xB(n,e,t){return t=t!=null?t.concat([n]):null,CA(4,4,IB.bind(null,e,n),t)}function WR(){}function CB(n,e){var t=yo();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&jR(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function PB(n,e){var t=yo();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&jR(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function RB(n,e,t){return uf&21?(Yo(t,e)||(t=L4(),jn.lanes|=t,df|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,es=!0),n.memoizedState=t)}function bQ(n,e){var t=rn;rn=t!==0&&4>t?t:4,n(!0);var r=cT.transition;cT.transition={};try{n(!1),e()}finally{rn=t,cT.transition=r}}function kB(){return yo().memoizedState}function _Q(n,e,t){var r=Fu(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},DB(n))MB(e,t);else if(t=fB(n,e,t,r),t!==null){var i=Vi();Wo(t,n,r,i),NB(t,e,r)}}function SQ(n,e,t){var r=Fu(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(DB(n))MB(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,Yo(a,o)){var l=e.interleaved;l===null?(i.next=i,FR(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=fB(n,e,i,r),t!==null&&(i=Vi(),Wo(t,n,r,i),NB(t,e,r))}}function DB(n){var e=n.alternate;return n===jn||e!==null&&e===jn}function MB(n,e){rv=uS=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function NB(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,SR(n,t)}}var dS={readContext:go,useCallback:si,useContext:si,useEffect:si,useImperativeHandle:si,useInsertionEffect:si,useLayoutEffect:si,useMemo:si,useReducer:si,useRef:si,useState:si,useDebugValue:si,useDeferredValue:si,useTransition:si,useMutableSource:si,useSyncExternalStore:si,useId:si,unstable_isNewReconciler:!1},AQ={readContext:go,useCallback:function(n,e){return ha().memoizedState=[n,e===void 0?null:e],n},useContext:go,useEffect:eN,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Db(4194308,4,IB.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Db(4194308,4,n,e)},useInsertionEffect:function(n,e){return Db(4,2,n,e)},useMemo:function(n,e){var t=ha();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=ha();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=_Q.bind(null,jn,n),[r.memoizedState,n]},useRef:function(n){var e=ha();return n={current:n},e.memoizedState=n},useState:ZM,useDebugValue:WR,useDeferredValue:function(n){return ha().memoizedState=n},useTransition:function(){var n=ZM(!1),e=n[0];return n=bQ.bind(null,n[1]),ha().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=jn,i=ha();if(Ln){if(t===void 0)throw Error(he(407));t=t()}else{if(t=e(),Vr===null)throw Error(he(349));uf&30||vB(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,eN(EB.bind(null,r,s,n),[n]),r.flags|=2048,Vv(9,wB.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=ha(),e=Vr.identifierPrefix;if(Ln){var t=ql,r=Wl;t=(r&~(1<<32-Go(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Ov++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=EQ++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},TQ={readContext:go,useCallback:CB,useContext:go,useEffect:GR,useImperativeHandle:xB,useInsertionEffect:AB,useLayoutEffect:TB,useMemo:PB,useReducer:uT,useRef:SB,useState:function(){return uT(Fv)},useDebugValue:WR,useDeferredValue:function(n){var e=yo();return RB(e,Er.memoizedState,n)},useTransition:function(){var n=uT(Fv)[0],e=yo().memoizedState;return[n,e]},useMutableSource:gB,useSyncExternalStore:yB,useId:kB,unstable_isNewReconciler:!1},IQ={readContext:go,useCallback:CB,useContext:go,useEffect:GR,useImperativeHandle:xB,useInsertionEffect:AB,useLayoutEffect:TB,useMemo:PB,useReducer:dT,useRef:SB,useState:function(){return dT(Fv)},useDebugValue:WR,useDeferredValue:function(n){var e=yo();return Er===null?e.memoizedState=n:RB(e,Er.memoizedState,n)},useTransition:function(){var n=dT(Fv)[0],e=yo().memoizedState;return[n,e]},useMutableSource:gB,useSyncExternalStore:yB,useId:kB,unstable_isNewReconciler:!1};function Io(n,e){if(n&&n.defaultProps){e=zn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function ex(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:zn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var PA={isMounted:function(n){return(n=n._reactInternals)?bf(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Vi(),i=Fu(n),s=Kl(r,i);s.payload=e,t!=null&&(s.callback=t),e=Lu(n,s,i),e!==null&&(Wo(e,n,i,r),Rb(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Vi(),i=Fu(n),s=Kl(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Lu(n,s,i),e!==null&&(Wo(e,n,i,r),Rb(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Vi(),r=Fu(n),i=Kl(t,r);i.tag=2,e!=null&&(i.callback=e),e=Lu(n,i,r),e!==null&&(Wo(e,n,r,t),Rb(e,n,r))}};function tN(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Rv(t,r)||!Rv(i,s):!0}function LB(n,e,t){var r=!1,i=Wu,s=e.contextType;return typeof s=="object"&&s!==null?s=go(s):(i=is(e)?lf:Ei.current,r=e.contextTypes,s=(r=r!=null)?ig(n,i):Wu),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=PA,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function nN(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&PA.enqueueReplaceState(e,e.state,null)}function tx(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},VR(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=go(s):(s=is(e)?lf:Ei.current,i.context=ig(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(ex(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&PA.enqueueReplaceState(i,i.state,null),lS(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function lg(n,e){try{var t="",r=e;do t+=eY(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function hT(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function nx(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var xQ=typeof WeakMap=="function"?WeakMap:Map;function OB(n,e,t){t=Kl(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){fS||(fS=!0,hx=r),nx(n,e)},t}function FB(n,e,t){t=Kl(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){nx(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){nx(n,e),typeof r!="function"&&(Ou===null?Ou=new Set([this]):Ou.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function rN(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new xQ;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=$Q.bind(null,n,e,t),e.then(n,n))}function iN(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function sN(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Kl(-1,1),e.tag=2,Lu(t,e,1))),t.lanes|=1),n)}var CQ=hc.ReactCurrentOwner,es=!1;function ki(n,e,t,r){e.child=n===null?hB(e,null,t,r):og(e,n.child,t,r)}function oN(n,e,t,r,i){t=t.render;var s=e.ref;return Pp(e,i),r=zR(n,e,t,r,s,i),t=HR(),n!==null&&!es?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,sc(n,e,i)):(Ln&&t&&kR(e),e.flags|=1,ki(n,e,r,i),e.child)}function aN(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!ek(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,VB(n,e,s,r,i)):(n=Ob(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:Rv,t(o,r)&&n.ref===e.ref)return sc(n,e,i)}return e.flags|=1,n=Vu(s,r),n.ref=e.ref,n.return=e,e.child=n}function VB(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(Rv(s,r)&&n.ref===e.ref)if(es=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(es=!0);else return e.lanes=n.lanes,sc(n,e,i)}return rx(n,e,t,r,i)}function UB(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_n(hp,Ps),Ps|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,_n(hp,Ps),Ps|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,_n(hp,Ps),Ps|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,_n(hp,Ps),Ps|=r;return ki(n,e,i,t),e.child}function BB(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function rx(n,e,t,r,i){var s=is(t)?lf:Ei.current;return s=ig(e,s),Pp(e,i),t=zR(n,e,t,r,s,i),r=HR(),n!==null&&!es?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,sc(n,e,i)):(Ln&&r&&kR(e),e.flags|=1,ki(n,e,t,i),e.child)}function lN(n,e,t,r,i){if(is(t)){var s=!0;rS(e)}else s=!1;if(Pp(e,i),e.stateNode===null)Mb(n,e),LB(e,t,r),tx(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=go(c):(c=is(t)?lf:Ei.current,c=ig(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&nN(e,o,r,c),xc=!1;var f=e.memoizedState;o.state=f,lS(e,r,o,i),l=e.memoizedState,a!==r||f!==l||rs.current||xc?(typeof u=="function"&&(ex(e,t,u,r),l=e.memoizedState),(a=xc||tN(e,t,a,r,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,pB(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:Io(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=go(l):(l=is(t)?lf:Ei.current,l=ig(e,l));var v=t.getDerivedStateFromProps;(u=typeof v=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&nN(e,o,r,l),xc=!1,f=e.memoizedState,o.state=f,lS(e,r,o,i);var w=e.memoizedState;a!==h||f!==w||rs.current||xc?(typeof v=="function"&&(ex(e,t,v,r),w=e.memoizedState),(c=xc||tN(e,t,c,r,f,w,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,w,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,w,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=w),o.props=r,o.state=w,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return ix(n,e,t,r,s,i)}function ix(n,e,t,r,i,s){BB(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&qM(e,t,!1),sc(n,e,s);r=e.stateNode,CQ.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=og(e,n.child,null,s),e.child=og(e,null,a,s)):ki(n,e,a,s),e.memoizedState=r.state,i&&qM(e,t,!0),e.child}function $B(n){var e=n.stateNode;e.pendingContext?WM(n,e.pendingContext,e.pendingContext!==e.context):e.context&&WM(n,e.context,!1),UR(n,e.containerInfo)}function cN(n,e,t,r,i){return sg(),MR(i),e.flags|=256,ki(n,e,t,r),e.child}var sx={dehydrated:null,treeContext:null,retryLane:0};function ox(n){return{baseLanes:n,cachePool:null,transitions:null}}function jB(n,e,t){var r=e.pendingProps,i=Un.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),_n(Un,i&1),n===null)return JI(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=DA(o,r,0,null),n=Kh(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=ox(t),e.memoizedState=sx,n):qR(e,o));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return PQ(n,e,o,r,a,i,t);if(s){s=r.fallback,o=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Vu(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Vu(a,s):(s=Kh(s,o,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=n.child.memoizedState,o=o===null?ox(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=sx,r}return s=n.child,n=s.sibling,r=Vu(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function qR(n,e){return e=DA({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function BE(n,e,t,r){return r!==null&&MR(r),og(e,n.child,null,t),n=qR(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function PQ(n,e,t,r,i,s,o){if(t)return e.flags&256?(e.flags&=-257,r=hT(Error(he(422))),BE(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=DA({mode:"visible",children:r.children},i,0,null),s=Kh(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&og(e,n.child,null,o),e.child.memoizedState=ox(o),e.memoizedState=sx,s);if(!(e.mode&1))return BE(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(he(419)),r=hT(s,r,void 0),BE(n,e,o,r)}if(a=(o&n.childLanes)!==0,es||a){if(r=Vr,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,ic(n,i),Wo(r,n,i,-1))}return ZR(),r=hT(Error(he(421))),BE(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=jQ.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,Ns=Nu(i.nextSibling),Fs=e,Ln=!0,$o=null,n!==null&&(ao[lo++]=Wl,ao[lo++]=ql,ao[lo++]=cf,Wl=n.id,ql=n.overflow,cf=e),e=qR(e,r.children),e.flags|=4096,e)}function uN(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),ZI(n.return,e,t)}function fT(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function zB(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(ki(n,e,r.children,t),r=Un.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&uN(n,t,e);else if(n.tag===19)uN(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(_n(Un,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&cS(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),fT(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&cS(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}fT(e,!0,t,null,s);break;case"together":fT(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Mb(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function sc(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),df|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(he(153));if(e.child!==null){for(n=e.child,t=Vu(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Vu(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function RQ(n,e,t){switch(e.tag){case 3:$B(e),sg();break;case 5:mB(e);break;case 1:is(e.type)&&rS(e);break;case 4:UR(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;_n(oS,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(_n(Un,Un.current&1),e.flags|=128,null):t&e.child.childLanes?jB(n,e,t):(_n(Un,Un.current&1),n=sc(n,e,t),n!==null?n.sibling:null);_n(Un,Un.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return zB(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),_n(Un,Un.current),r)break;return null;case 22:case 23:return e.lanes=0,UB(n,e,t)}return sc(n,e,t)}var HB,ax,GB,WB;HB=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};ax=function(){};GB=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Ld(za.current);var s=null;switch(t){case"input":i=PI(n,i),r=PI(n,r),s=[];break;case"select":i=zn({},i,{value:void 0}),r=zn({},r,{value:void 0}),s=[];break;case"textarea":i=DI(n,i),r=DI(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=tS)}NI(t,r);var o;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Sv.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Sv.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Tn("scroll",n),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};WB=function(n,e,t,r){t!==r&&(e.flags|=4)};function Jg(n,e){if(!Ln)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function oi(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function kQ(n,e,t){var r=e.pendingProps;switch(DR(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return oi(e),null;case 1:return is(e.type)&&nS(),oi(e),null;case 3:return r=e.stateNode,ag(),In(rs),In(Ei),$R(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(VE(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,$o!==null&&(mx($o),$o=null))),ax(n,e),oi(e),null;case 5:BR(e);var i=Ld(Lv.current);if(t=e.type,n!==null&&e.stateNode!=null)GB(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(he(166));return oi(e),null}if(n=Ld(za.current),VE(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[ka]=e,r[Mv]=s,n=(e.mode&1)!==0,t){case"dialog":Tn("cancel",r),Tn("close",r);break;case"iframe":case"object":case"embed":Tn("load",r);break;case"video":case"audio":for(i=0;i<Ey.length;i++)Tn(Ey[i],r);break;case"source":Tn("error",r);break;case"img":case"image":case"link":Tn("error",r),Tn("load",r);break;case"details":Tn("toggle",r);break;case"input":wM(r,s),Tn("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Tn("invalid",r);break;case"textarea":bM(r,s),Tn("invalid",r)}NI(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&FE(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&FE(r.textContent,a,n),i=["children",""+a]):Sv.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Tn("scroll",r)}switch(t){case"input":PE(r),EM(r,s,!0);break;case"textarea":PE(r),_M(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=tS)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=E4(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[ka]=e,n[Mv]=r,HB(n,e,!1,!1),e.stateNode=n;e:{switch(o=LI(t,r),t){case"dialog":Tn("cancel",n),Tn("close",n),i=r;break;case"iframe":case"object":case"embed":Tn("load",n),i=r;break;case"video":case"audio":for(i=0;i<Ey.length;i++)Tn(Ey[i],n);i=r;break;case"source":Tn("error",n),i=r;break;case"img":case"image":case"link":Tn("error",n),Tn("load",n),i=r;break;case"details":Tn("toggle",n),i=r;break;case"input":wM(n,r),i=PI(n,r),Tn("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=zn({},r,{value:void 0}),Tn("invalid",n);break;case"textarea":bM(n,r),i=DI(n,r),Tn("invalid",n);break;default:i=r}NI(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?S4(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&b4(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Av(n,l):typeof l=="number"&&Av(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Sv.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Tn("scroll",n):l!=null&&yR(n,s,l,o))}switch(t){case"input":PE(n),EM(n,r,!1);break;case"textarea":PE(n),_M(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Gu(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?Tp(n,!!r.multiple,s,!1):r.defaultValue!=null&&Tp(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=tS)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return oi(e),null;case 6:if(n&&e.stateNode!=null)WB(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(he(166));if(t=Ld(Lv.current),Ld(za.current),VE(e)){if(r=e.stateNode,t=e.memoizedProps,r[ka]=e,(s=r.nodeValue!==t)&&(n=Fs,n!==null))switch(n.tag){case 3:FE(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&FE(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[ka]=e,e.stateNode=r}return oi(e),null;case 13:if(In(Un),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Ln&&Ns!==null&&e.mode&1&&!(e.flags&128))uB(),sg(),e.flags|=98560,s=!1;else if(s=VE(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(he(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(he(317));s[ka]=e}else sg(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;oi(e),s=!1}else $o!==null&&(mx($o),$o=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Un.current&1?_r===0&&(_r=3):ZR())),e.updateQueue!==null&&(e.flags|=4),oi(e),null);case 4:return ag(),ax(n,e),n===null&&kv(e.stateNode.containerInfo),oi(e),null;case 10:return OR(e.type._context),oi(e),null;case 17:return is(e.type)&&nS(),oi(e),null;case 19:if(In(Un),s=e.memoizedState,s===null)return oi(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)Jg(s,!1);else{if(_r!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=cS(n),o!==null){for(e.flags|=128,Jg(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return _n(Un,Un.current&1|2),e.child}n=n.sibling}s.tail!==null&&nr()>cg&&(e.flags|=128,r=!0,Jg(s,!1),e.lanes=4194304)}else{if(!r)if(n=cS(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Jg(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Ln)return oi(e),null}else 2*nr()-s.renderingStartTime>cg&&t!==1073741824&&(e.flags|=128,r=!0,Jg(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=nr(),e.sibling=null,t=Un.current,_n(Un,r?t&1|2:t&1),e):(oi(e),null);case 22:case 23:return JR(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Ps&1073741824&&(oi(e),e.subtreeFlags&6&&(e.flags|=8192)):oi(e),null;case 24:return null;case 25:return null}throw Error(he(156,e.tag))}function DQ(n,e){switch(DR(e),e.tag){case 1:return is(e.type)&&nS(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return ag(),In(rs),In(Ei),$R(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return BR(e),null;case 13:if(In(Un),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(he(340));sg()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return In(Un),null;case 4:return ag(),null;case 10:return OR(e.type._context),null;case 22:case 23:return JR(),null;case 24:return null;default:return null}}var $E=!1,pi=!1,MQ=typeof WeakSet=="function"?WeakSet:Set,Le=null;function dp(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Kn(n,e,r)}else t.current=null}function lx(n,e,t){try{t()}catch(r){Kn(n,e,r)}}var dN=!1;function NQ(n,e){if(GI=J_,n=X4(),RR(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=n,f=null;t:for(;;){for(var v;h!==t||i!==0&&h.nodeType!==3||(a=o+i),h!==s||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(v=h.firstChild)!==null;)f=h,h=v;for(;;){if(h===n)break t;if(f===t&&++c===i&&(a=o),f===s&&++u===r&&(l=o),(v=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=v}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(WI={focusedElem:n,selectionRange:t},J_=!1,Le=e;Le!==null;)if(e=Le,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Le=n;else for(;Le!==null;){e=Le;try{var w=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var E=w.memoizedProps,A=w.memoizedState,T=e.stateNode,_=T.getSnapshotBeforeUpdate(e.elementType===e.type?E:Io(e.type,E),A);T.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(he(163))}}catch(g){Kn(e,e.return,g)}if(n=e.sibling,n!==null){n.return=e.return,Le=n;break}Le=e.return}return w=dN,dN=!1,w}function iv(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&lx(e,t,s)}i=i.next}while(i!==r)}}function RA(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function cx(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function qB(n){var e=n.alternate;e!==null&&(n.alternate=null,qB(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[ka],delete e[Mv],delete e[YI],delete e[gQ],delete e[yQ])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function KB(n){return n.tag===5||n.tag===3||n.tag===4}function hN(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||KB(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function ux(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=tS));else if(r!==4&&(n=n.child,n!==null))for(ux(n,e,t),n=n.sibling;n!==null;)ux(n,e,t),n=n.sibling}function dx(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(dx(n,e,t),n=n.sibling;n!==null;)dx(n,e,t),n=n.sibling}var Kr=null,Uo=!1;function wc(n,e,t){for(t=t.child;t!==null;)YB(n,e,t),t=t.sibling}function YB(n,e,t){if(ja&&typeof ja.onCommitFiberUnmount=="function")try{ja.onCommitFiberUnmount(_A,t)}catch{}switch(t.tag){case 5:pi||dp(t,e);case 6:var r=Kr,i=Uo;Kr=null,wc(n,e,t),Kr=r,Uo=i,Kr!==null&&(Uo?(n=Kr,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Kr.removeChild(t.stateNode));break;case 18:Kr!==null&&(Uo?(n=Kr,t=t.stateNode,n.nodeType===8?oT(n.parentNode,t):n.nodeType===1&&oT(n,t),Cv(n)):oT(Kr,t.stateNode));break;case 4:r=Kr,i=Uo,Kr=t.stateNode.containerInfo,Uo=!0,wc(n,e,t),Kr=r,Uo=i;break;case 0:case 11:case 14:case 15:if(!pi&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&lx(t,e,o),i=i.next}while(i!==r)}wc(n,e,t);break;case 1:if(!pi&&(dp(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Kn(t,e,a)}wc(n,e,t);break;case 21:wc(n,e,t);break;case 22:t.mode&1?(pi=(r=pi)||t.memoizedState!==null,wc(n,e,t),pi=r):wc(n,e,t);break;default:wc(n,e,t)}}function fN(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new MQ),e.forEach(function(r){var i=zQ.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function So(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Kr=a.stateNode,Uo=!1;break e;case 3:Kr=a.stateNode.containerInfo,Uo=!0;break e;case 4:Kr=a.stateNode.containerInfo,Uo=!0;break e}a=a.return}if(Kr===null)throw Error(he(160));YB(s,o,i),Kr=null,Uo=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){Kn(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)QB(e,n),e=e.sibling}function QB(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(So(e,n),sa(n),r&4){try{iv(3,n,n.return),RA(3,n)}catch(E){Kn(n,n.return,E)}try{iv(5,n,n.return)}catch(E){Kn(n,n.return,E)}}break;case 1:So(e,n),sa(n),r&512&&t!==null&&dp(t,t.return);break;case 5:if(So(e,n),sa(n),r&512&&t!==null&&dp(t,t.return),n.flags&32){var i=n.stateNode;try{Av(i,"")}catch(E){Kn(n,n.return,E)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&v4(i,s),LI(a,o);var c=LI(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?S4(i,h):u==="dangerouslySetInnerHTML"?b4(i,h):u==="children"?Av(i,h):yR(i,u,h,c)}switch(a){case"input":RI(i,s);break;case"textarea":w4(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var v=s.value;v!=null?Tp(i,!!s.multiple,v,!1):f!==!!s.multiple&&(s.defaultValue!=null?Tp(i,!!s.multiple,s.defaultValue,!0):Tp(i,!!s.multiple,s.multiple?[]:"",!1))}i[Mv]=s}catch(E){Kn(n,n.return,E)}}break;case 6:if(So(e,n),sa(n),r&4){if(n.stateNode===null)throw Error(he(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(E){Kn(n,n.return,E)}}break;case 3:if(So(e,n),sa(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Cv(e.containerInfo)}catch(E){Kn(n,n.return,E)}break;case 4:So(e,n),sa(n);break;case 13:So(e,n),sa(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(QR=nr())),r&4&&fN(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(pi=(c=pi)||u,So(e,n),pi=c):So(e,n),sa(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(Le=n,u=n.child;u!==null;){for(h=Le=u;Le!==null;){switch(f=Le,v=f.child,f.tag){case 0:case 11:case 14:case 15:iv(4,f,f.return);break;case 1:dp(f,f.return);var w=f.stateNode;if(typeof w.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,w.props=e.memoizedProps,w.state=e.memoizedState,w.componentWillUnmount()}catch(E){Kn(r,t,E)}}break;case 5:dp(f,f.return);break;case 22:if(f.memoizedState!==null){mN(h);continue}}v!==null?(v.return=f,Le=v):mN(h)}u=u.sibling}e:for(u=null,h=n;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=_4("display",o))}catch(E){Kn(n,n.return,E)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(E){Kn(n,n.return,E)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:So(e,n),sa(n),r&4&&fN(n);break;case 21:break;default:So(e,n),sa(n)}}function sa(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(KB(t)){var r=t;break e}t=t.return}throw Error(he(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Av(i,""),r.flags&=-33);var s=hN(n);dx(n,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=hN(n);ux(n,a,o);break;default:throw Error(he(161))}}catch(l){Kn(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function LQ(n,e,t){Le=n,XB(n)}function XB(n,e,t){for(var r=(n.mode&1)!==0;Le!==null;){var i=Le,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||$E;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||pi;a=$E;var c=pi;if($E=o,(pi=l)&&!c)for(Le=i;Le!==null;)o=Le,l=o.child,o.tag===22&&o.memoizedState!==null?gN(i):l!==null?(l.return=o,Le=l):gN(i);for(;s!==null;)Le=s,XB(s),s=s.sibling;Le=i,$E=a,pi=c}pN(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,Le=s):pN(n)}}function pN(n){for(;Le!==null;){var e=Le;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:pi||RA(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!pi)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Io(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&JM(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}JM(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Cv(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(he(163))}pi||e.flags&512&&cx(e)}catch(f){Kn(e,e.return,f)}}if(e===n){Le=null;break}if(t=e.sibling,t!==null){t.return=e.return,Le=t;break}Le=e.return}}function mN(n){for(;Le!==null;){var e=Le;if(e===n){Le=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Le=t;break}Le=e.return}}function gN(n){for(;Le!==null;){var e=Le;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{RA(4,e)}catch(l){Kn(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){Kn(e,i,l)}}var s=e.return;try{cx(e)}catch(l){Kn(e,s,l)}break;case 5:var o=e.return;try{cx(e)}catch(l){Kn(e,o,l)}}}catch(l){Kn(e,e.return,l)}if(e===n){Le=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Le=a;break}Le=e.return}}var OQ=Math.ceil,hS=hc.ReactCurrentDispatcher,KR=hc.ReactCurrentOwner,ho=hc.ReactCurrentBatchConfig,zt=0,Vr=null,hr=null,Zr=0,Ps=0,hp=id(0),_r=0,Uv=null,df=0,kA=0,YR=0,sv=null,Qi=null,QR=0,cg=1/0,sl=null,fS=!1,hx=null,Ou=null,jE=!1,Su=null,pS=0,ov=0,fx=null,Nb=-1,Lb=0;function Vi(){return zt&6?nr():Nb!==-1?Nb:Nb=nr()}function Fu(n){return n.mode&1?zt&2&&Zr!==0?Zr&-Zr:wQ.transition!==null?(Lb===0&&(Lb=L4()),Lb):(n=rn,n!==0||(n=window.event,n=n===void 0?16:j4(n.type)),n):1}function Wo(n,e,t,r){if(50<ov)throw ov=0,fx=null,Error(he(185));W0(n,t,r),(!(zt&2)||n!==Vr)&&(n===Vr&&(!(zt&2)&&(kA|=t),_r===4&&Fc(n,Zr)),ss(n,r),t===1&&zt===0&&!(e.mode&1)&&(cg=nr()+500,xA&&sd()))}function ss(n,e){var t=n.callbackNode;wY(n,e);var r=X_(n,n===Vr?Zr:0);if(r===0)t!==null&&TM(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&TM(t),e===1)n.tag===0?vQ(yN.bind(null,n)):aB(yN.bind(null,n)),pQ(function(){!(zt&6)&&sd()}),t=null;else{switch(O4(r)){case 1:t=_R;break;case 4:t=M4;break;case 16:t=Q_;break;case 536870912:t=N4;break;default:t=Q_}t=s3(t,JB.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function JB(n,e){if(Nb=-1,Lb=0,zt&6)throw Error(he(327));var t=n.callbackNode;if(Rp()&&n.callbackNode!==t)return null;var r=X_(n,n===Vr?Zr:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=mS(n,r);else{e=r;var i=zt;zt|=2;var s=e3();(Vr!==n||Zr!==e)&&(sl=null,cg=nr()+500,qh(n,e));do try{UQ();break}catch(a){ZB(n,a)}while(!0);LR(),hS.current=s,zt=i,hr!==null?e=0:(Vr=null,Zr=0,e=_r)}if(e!==0){if(e===2&&(i=BI(n),i!==0&&(r=i,e=px(n,i))),e===1)throw t=Uv,qh(n,0),Fc(n,r),ss(n,nr()),t;if(e===6)Fc(n,r);else{if(i=n.current.alternate,!(r&30)&&!FQ(i)&&(e=mS(n,r),e===2&&(s=BI(n),s!==0&&(r=s,e=px(n,s))),e===1))throw t=Uv,qh(n,0),Fc(n,r),ss(n,nr()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(he(345));case 2:_d(n,Qi,sl);break;case 3:if(Fc(n,r),(r&130023424)===r&&(e=QR+500-nr(),10<e)){if(X_(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Vi(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=KI(_d.bind(null,n,Qi,sl),e);break}_d(n,Qi,sl);break;case 4:if(Fc(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-Go(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=nr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*OQ(r/1960))-r,10<r){n.timeoutHandle=KI(_d.bind(null,n,Qi,sl),r);break}_d(n,Qi,sl);break;case 5:_d(n,Qi,sl);break;default:throw Error(he(329))}}}return ss(n,nr()),n.callbackNode===t?JB.bind(null,n):null}function px(n,e){var t=sv;return n.current.memoizedState.isDehydrated&&(qh(n,e).flags|=256),n=mS(n,e),n!==2&&(e=Qi,Qi=t,e!==null&&mx(e)),n}function mx(n){Qi===null?Qi=n:Qi.push.apply(Qi,n)}function FQ(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!Yo(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Fc(n,e){for(e&=~YR,e&=~kA,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Go(e),r=1<<t;n[t]=-1,e&=~r}}function yN(n){if(zt&6)throw Error(he(327));Rp();var e=X_(n,0);if(!(e&1))return ss(n,nr()),null;var t=mS(n,e);if(n.tag!==0&&t===2){var r=BI(n);r!==0&&(e=r,t=px(n,r))}if(t===1)throw t=Uv,qh(n,0),Fc(n,e),ss(n,nr()),t;if(t===6)throw Error(he(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,_d(n,Qi,sl),ss(n,nr()),null}function XR(n,e){var t=zt;zt|=1;try{return n(e)}finally{zt=t,zt===0&&(cg=nr()+500,xA&&sd())}}function hf(n){Su!==null&&Su.tag===0&&!(zt&6)&&Rp();var e=zt;zt|=1;var t=ho.transition,r=rn;try{if(ho.transition=null,rn=1,n)return n()}finally{rn=r,ho.transition=t,zt=e,!(zt&6)&&sd()}}function JR(){Ps=hp.current,In(hp)}function qh(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,fQ(t)),hr!==null)for(t=hr.return;t!==null;){var r=t;switch(DR(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&nS();break;case 3:ag(),In(rs),In(Ei),$R();break;case 5:BR(r);break;case 4:ag();break;case 13:In(Un);break;case 19:In(Un);break;case 10:OR(r.type._context);break;case 22:case 23:JR()}t=t.return}if(Vr=n,hr=n=Vu(n.current,null),Zr=Ps=e,_r=0,Uv=null,YR=kA=df=0,Qi=sv=null,Nd!==null){for(e=0;e<Nd.length;e++)if(t=Nd[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}t.pending=r}Nd=null}return n}function ZB(n,e){do{var t=hr;try{if(LR(),kb.current=dS,uS){for(var r=jn.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}uS=!1}if(uf=0,Fr=Er=jn=null,rv=!1,Ov=0,KR.current=null,t===null||t.return===null){_r=1,Uv=e,hr=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=Zr,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var v=iN(o);if(v!==null){v.flags&=-257,sN(v,o,a,s,e),v.mode&1&&rN(s,c,e),e=v,l=c;var w=e.updateQueue;if(w===null){var E=new Set;E.add(l),e.updateQueue=E}else w.add(l);break e}else{if(!(e&1)){rN(s,c,e),ZR();break e}l=Error(he(426))}}else if(Ln&&a.mode&1){var A=iN(o);if(A!==null){!(A.flags&65536)&&(A.flags|=256),sN(A,o,a,s,e),MR(lg(l,a));break e}}s=l=lg(l,a),_r!==4&&(_r=2),sv===null?sv=[s]:sv.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var T=OB(s,l,e);XM(s,T);break e;case 1:a=l;var _=s.type,b=s.stateNode;if(!(s.flags&128)&&(typeof _.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ou===null||!Ou.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var g=FB(s,a,e);XM(s,g);break e}}s=s.return}while(s!==null)}n3(t)}catch(y){e=y,hr===t&&t!==null&&(hr=t=t.return);continue}break}while(!0)}function e3(){var n=hS.current;return hS.current=dS,n===null?dS:n}function ZR(){(_r===0||_r===3||_r===2)&&(_r=4),Vr===null||!(df&268435455)&&!(kA&268435455)||Fc(Vr,Zr)}function mS(n,e){var t=zt;zt|=2;var r=e3();(Vr!==n||Zr!==e)&&(sl=null,qh(n,e));do try{VQ();break}catch(i){ZB(n,i)}while(!0);if(LR(),zt=t,hS.current=r,hr!==null)throw Error(he(261));return Vr=null,Zr=0,_r}function VQ(){for(;hr!==null;)t3(hr)}function UQ(){for(;hr!==null&&!uY();)t3(hr)}function t3(n){var e=i3(n.alternate,n,Ps);n.memoizedProps=n.pendingProps,e===null?n3(n):hr=e,KR.current=null}function n3(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=DQ(t,e),t!==null){t.flags&=32767,hr=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{_r=6,hr=null;return}}else if(t=kQ(t,e,Ps),t!==null){hr=t;return}if(e=e.sibling,e!==null){hr=e;return}hr=e=n}while(e!==null);_r===0&&(_r=5)}function _d(n,e,t){var r=rn,i=ho.transition;try{ho.transition=null,rn=1,BQ(n,e,t,r)}finally{ho.transition=i,rn=r}return null}function BQ(n,e,t,r){do Rp();while(Su!==null);if(zt&6)throw Error(he(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(he(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(EY(n,s),n===Vr&&(hr=Vr=null,Zr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||jE||(jE=!0,s3(Q_,function(){return Rp(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=ho.transition,ho.transition=null;var o=rn;rn=1;var a=zt;zt|=4,KR.current=null,NQ(n,t),QB(t,n),oQ(WI),J_=!!GI,WI=GI=null,n.current=t,LQ(t),dY(),zt=a,rn=o,ho.transition=s}else n.current=t;if(jE&&(jE=!1,Su=n,pS=i),s=n.pendingLanes,s===0&&(Ou=null),pY(t.stateNode),ss(n,nr()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(fS)throw fS=!1,n=hx,hx=null,n;return pS&1&&n.tag!==0&&Rp(),s=n.pendingLanes,s&1?n===fx?ov++:(ov=0,fx=n):ov=0,sd(),null}function Rp(){if(Su!==null){var n=O4(pS),e=ho.transition,t=rn;try{if(ho.transition=null,rn=16>n?16:n,Su===null)var r=!1;else{if(n=Su,Su=null,pS=0,zt&6)throw Error(he(331));var i=zt;for(zt|=4,Le=n.current;Le!==null;){var s=Le,o=s.child;if(Le.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Le=c;Le!==null;){var u=Le;switch(u.tag){case 0:case 11:case 15:iv(8,u,s)}var h=u.child;if(h!==null)h.return=u,Le=h;else for(;Le!==null;){u=Le;var f=u.sibling,v=u.return;if(qB(u),u===c){Le=null;break}if(f!==null){f.return=v,Le=f;break}Le=v}}}var w=s.alternate;if(w!==null){var E=w.child;if(E!==null){w.child=null;do{var A=E.sibling;E.sibling=null,E=A}while(E!==null)}}Le=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Le=o;else e:for(;Le!==null;){if(s=Le,s.flags&2048)switch(s.tag){case 0:case 11:case 15:iv(9,s,s.return)}var T=s.sibling;if(T!==null){T.return=s.return,Le=T;break e}Le=s.return}}var _=n.current;for(Le=_;Le!==null;){o=Le;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,Le=b;else e:for(o=_;Le!==null;){if(a=Le,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:RA(9,a)}}catch(y){Kn(a,a.return,y)}if(a===o){Le=null;break e}var g=a.sibling;if(g!==null){g.return=a.return,Le=g;break e}Le=a.return}}if(zt=i,sd(),ja&&typeof ja.onPostCommitFiberRoot=="function")try{ja.onPostCommitFiberRoot(_A,n)}catch{}r=!0}return r}finally{rn=t,ho.transition=e}}return!1}function vN(n,e,t){e=lg(t,e),e=OB(n,e,1),n=Lu(n,e,1),e=Vi(),n!==null&&(W0(n,1,e),ss(n,e))}function Kn(n,e,t){if(n.tag===3)vN(n,n,t);else for(;e!==null;){if(e.tag===3){vN(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ou===null||!Ou.has(r))){n=lg(t,n),n=FB(e,n,1),e=Lu(e,n,1),n=Vi(),e!==null&&(W0(e,1,n),ss(e,n));break}}e=e.return}}function $Q(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Vi(),n.pingedLanes|=n.suspendedLanes&t,Vr===n&&(Zr&t)===t&&(_r===4||_r===3&&(Zr&130023424)===Zr&&500>nr()-QR?qh(n,0):YR|=t),ss(n,e)}function r3(n,e){e===0&&(n.mode&1?(e=DE,DE<<=1,!(DE&130023424)&&(DE=4194304)):e=1);var t=Vi();n=ic(n,e),n!==null&&(W0(n,e,t),ss(n,t))}function jQ(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),r3(n,t)}function zQ(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(he(314))}r!==null&&r.delete(e),r3(n,t)}var i3;i3=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||rs.current)es=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return es=!1,RQ(n,e,t);es=!!(n.flags&131072)}else es=!1,Ln&&e.flags&1048576&&lB(e,sS,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Mb(n,e),n=e.pendingProps;var i=ig(e,Ei.current);Pp(e,t),i=zR(null,e,r,n,i,t);var s=HR();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,is(r)?(s=!0,rS(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,VR(e),i.updater=PA,e.stateNode=i,i._reactInternals=e,tx(e,r,n,t),e=ix(null,e,r,!0,s,t)):(e.tag=0,Ln&&s&&kR(e),ki(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Mb(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=GQ(r),n=Io(r,n),i){case 0:e=rx(null,e,r,n,t);break e;case 1:e=lN(null,e,r,n,t);break e;case 11:e=oN(null,e,r,n,t);break e;case 14:e=aN(null,e,r,Io(r.type,n),t);break e}throw Error(he(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Io(r,i),rx(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Io(r,i),lN(n,e,r,i,t);case 3:e:{if($B(e),n===null)throw Error(he(387));r=e.pendingProps,s=e.memoizedState,i=s.element,pB(n,e),lS(e,r,null,t);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=lg(Error(he(423)),e),e=cN(n,e,r,t,i);break e}else if(r!==i){i=lg(Error(he(424)),e),e=cN(n,e,r,t,i);break e}else for(Ns=Nu(e.stateNode.containerInfo.firstChild),Fs=e,Ln=!0,$o=null,t=hB(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(sg(),r===i){e=sc(n,e,t);break e}ki(n,e,r,t)}e=e.child}return e;case 5:return mB(e),n===null&&JI(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,qI(r,i)?o=null:s!==null&&qI(r,s)&&(e.flags|=32),BB(n,e),ki(n,e,o,t),e.child;case 6:return n===null&&JI(e),null;case 13:return jB(n,e,t);case 4:return UR(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=og(e,null,r,t):ki(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Io(r,i),oN(n,e,r,i,t);case 7:return ki(n,e,e.pendingProps,t),e.child;case 8:return ki(n,e,e.pendingProps.children,t),e.child;case 12:return ki(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,_n(oS,r._currentValue),r._currentValue=o,s!==null)if(Yo(s.value,o)){if(s.children===i.children&&!rs.current){e=sc(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=Kl(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),ZI(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(he(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),ZI(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}ki(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Pp(e,t),i=go(i),r=r(i),e.flags|=1,ki(n,e,r,t),e.child;case 14:return r=e.type,i=Io(r,e.pendingProps),i=Io(r.type,i),aN(n,e,r,i,t);case 15:return VB(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Io(r,i),Mb(n,e),e.tag=1,is(r)?(n=!0,rS(e)):n=!1,Pp(e,t),LB(e,r,i),tx(e,r,i,t),ix(null,e,r,!0,n,t);case 19:return zB(n,e,t);case 22:return UB(n,e,t)}throw Error(he(156,e.tag))};function s3(n,e){return D4(n,e)}function HQ(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function uo(n,e,t,r){return new HQ(n,e,t,r)}function ek(n){return n=n.prototype,!(!n||!n.isReactComponent)}function GQ(n){if(typeof n=="function")return ek(n)?1:0;if(n!=null){if(n=n.$$typeof,n===wR)return 11;if(n===ER)return 14}return 2}function Vu(n,e){var t=n.alternate;return t===null?(t=uo(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Ob(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")ek(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case np:return Kh(t.children,i,s,e);case vR:o=8,i|=8;break;case TI:return n=uo(12,t,e,i|2),n.elementType=TI,n.lanes=s,n;case II:return n=uo(13,t,e,i),n.elementType=II,n.lanes=s,n;case xI:return n=uo(19,t,e,i),n.elementType=xI,n.lanes=s,n;case m4:return DA(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case f4:o=10;break e;case p4:o=9;break e;case wR:o=11;break e;case ER:o=14;break e;case Ic:o=16,r=null;break e}throw Error(he(130,n==null?n:typeof n,""))}return e=uo(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function Kh(n,e,t,r){return n=uo(7,n,r,e),n.lanes=t,n}function DA(n,e,t,r){return n=uo(22,n,r,e),n.elementType=m4,n.lanes=t,n.stateNode={isHidden:!1},n}function pT(n,e,t){return n=uo(6,n,null,e),n.lanes=t,n}function mT(n,e,t){return e=uo(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function WQ(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Y1(0),this.expirationTimes=Y1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Y1(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function tk(n,e,t,r,i,s,o,a,l){return n=new WQ(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=uo(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},VR(s),n}function qQ(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:tp,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function o3(n){if(!n)return Wu;n=n._reactInternals;e:{if(bf(n)!==n||n.tag!==1)throw Error(he(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(is(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(he(171))}if(n.tag===1){var t=n.type;if(is(t))return oB(n,t,e)}return e}function a3(n,e,t,r,i,s,o,a,l){return n=tk(t,r,!0,n,i,s,o,a,l),n.context=o3(null),t=n.current,r=Vi(),i=Fu(t),s=Kl(r,i),s.callback=e??null,Lu(t,s,i),n.current.lanes=i,W0(n,i,r),ss(n,r),n}function MA(n,e,t,r){var i=e.current,s=Vi(),o=Fu(i);return t=o3(t),e.context===null?e.context=t:e.pendingContext=t,e=Kl(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Lu(i,e,o),n!==null&&(Wo(n,i,o,s),Rb(n,i,o)),o}function gS(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function wN(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function nk(n,e){wN(n,e),(n=n.alternate)&&wN(n,e)}function KQ(){return null}var l3=typeof reportError=="function"?reportError:function(n){console.error(n)};function rk(n){this._internalRoot=n}NA.prototype.render=rk.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(he(409));MA(n,e,null,null)};NA.prototype.unmount=rk.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;hf(function(){MA(null,n,null,null)}),e[rc]=null}};function NA(n){this._internalRoot=n}NA.prototype.unstable_scheduleHydration=function(n){if(n){var e=U4();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Oc.length&&e!==0&&e<Oc[t].priority;t++);Oc.splice(t,0,n),t===0&&$4(n)}};function ik(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function LA(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function EN(){}function YQ(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=gS(o);s.call(c)}}var o=a3(e,r,n,0,null,!1,!1,"",EN);return n._reactRootContainer=o,n[rc]=o.current,kv(n.nodeType===8?n.parentNode:n),hf(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=gS(l);a.call(c)}}var l=tk(n,0,!1,null,null,!1,!1,"",EN);return n._reactRootContainer=l,n[rc]=l.current,kv(n.nodeType===8?n.parentNode:n),hf(function(){MA(e,l,t,r)}),l}function OA(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=gS(o);a.call(l)}}MA(e,o,n,i)}else o=YQ(t,e,n,i,r);return gS(o)}F4=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=wy(e.pendingLanes);t!==0&&(SR(e,t|1),ss(e,nr()),!(zt&6)&&(cg=nr()+500,sd()))}break;case 13:hf(function(){var r=ic(n,1);if(r!==null){var i=Vi();Wo(r,n,1,i)}}),nk(n,1)}};AR=function(n){if(n.tag===13){var e=ic(n,134217728);if(e!==null){var t=Vi();Wo(e,n,134217728,t)}nk(n,134217728)}};V4=function(n){if(n.tag===13){var e=Fu(n),t=ic(n,e);if(t!==null){var r=Vi();Wo(t,n,e,r)}nk(n,e)}};U4=function(){return rn};B4=function(n,e){var t=rn;try{return rn=n,e()}finally{rn=t}};FI=function(n,e,t){switch(e){case"input":if(RI(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=IA(r);if(!i)throw Error(he(90));y4(r),RI(r,i)}}}break;case"textarea":w4(n,t);break;case"select":e=t.value,e!=null&&Tp(n,!!t.multiple,e,!1)}};I4=XR;x4=hf;var QQ={usingClientEntryPoint:!1,Events:[K0,op,IA,A4,T4,XR]},Zg={findFiberByHostInstance:Md,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},XQ={bundleType:Zg.bundleType,version:Zg.version,rendererPackageName:Zg.rendererPackageName,rendererConfig:Zg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:hc.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=R4(n),n===null?null:n.stateNode},findFiberByHostInstance:Zg.findFiberByHostInstance||KQ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zE.isDisabled&&zE.supportsFiber)try{_A=zE.inject(XQ),ja=zE}catch{}}js.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QQ;js.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ik(e))throw Error(he(200));return qQ(n,e,null,t)};js.createRoot=function(n,e){if(!ik(n))throw Error(he(299));var t=!1,r="",i=l3;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=tk(n,1,!1,null,null,t,!1,r,i),n[rc]=e.current,kv(n.nodeType===8?n.parentNode:n),new rk(e)};js.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(he(188)):(n=Object.keys(n).join(","),Error(he(268,n)));return n=R4(e),n=n===null?null:n.stateNode,n};js.flushSync=function(n){return hf(n)};js.hydrate=function(n,e,t){if(!LA(e))throw Error(he(200));return OA(null,n,e,!0,t)};js.hydrateRoot=function(n,e,t){if(!ik(n))throw Error(he(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",o=l3;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=a3(e,null,n,1,t??null,i,!1,s,o),n[rc]=e.current,kv(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new NA(e)};js.render=function(n,e,t){if(!LA(e))throw Error(he(200));return OA(null,n,e,!1,t)};js.unmountComponentAtNode=function(n){if(!LA(n))throw Error(he(40));return n._reactRootContainer?(hf(function(){OA(null,null,n,!1,function(){n._reactRootContainer=null,n[rc]=null})}),!0):!1};js.unstable_batchedUpdates=XR;js.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!LA(t))throw Error(he(200));if(n==null||n._reactInternals===void 0)throw Error(he(38));return OA(n,e,t,!1,r)};js.version="18.3.1-next-f1338f8080-20240426";function c3(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c3)}catch(n){console.error(n)}}c3(),c4.exports=js;var JQ=c4.exports,u3,bN=JQ;u3=bN.createRoot,bN.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Bv(){return Bv=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Bv.apply(this,arguments)}var Au;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Au||(Au={}));const _N="popstate";function ZQ(n){n===void 0&&(n={});function e(r,i){let{pathname:s,search:o,hash:a}=r.location;return gx("",{pathname:s,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:yS(i)}return tX(e,t,null,n)}function ir(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function d3(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function eX(){return Math.random().toString(36).substr(2,8)}function SN(n,e){return{usr:n.state,key:n.key,idx:e}}function gx(n,e,t,r){return t===void 0&&(t=null),Bv({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Ig(e):e,{state:t,key:e&&e.key||r||eX()})}function yS(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Ig(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function tX(n,e,t,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a=Au.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(Bv({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function h(){a=Au.Pop;let A=u(),T=A==null?null:A-c;c=A,l&&l({action:a,location:E.location,delta:T})}function f(A,T){a=Au.Push;let _=gx(E.location,A,T);c=u()+1;let b=SN(_,c),g=E.createHref(_);try{o.pushState(b,"",g)}catch(y){if(y instanceof DOMException&&y.name==="DataCloneError")throw y;i.location.assign(g)}s&&l&&l({action:a,location:E.location,delta:1})}function v(A,T){a=Au.Replace;let _=gx(E.location,A,T);c=u();let b=SN(_,c),g=E.createHref(_);o.replaceState(b,"",g),s&&l&&l({action:a,location:E.location,delta:0})}function w(A){let T=i.location.origin!=="null"?i.location.origin:i.location.href,_=typeof A=="string"?A:yS(A);return _=_.replace(/ $/,"%20"),ir(T,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,T)}let E={get action(){return a},get location(){return n(i,o)},listen(A){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(_N,h),l=A,()=>{i.removeEventListener(_N,h),l=null}},createHref(A){return e(i,A)},createURL:w,encodeLocation(A){let T=w(A);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:f,replace:v,go(A){return o.go(A)}};return E}var AN;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(AN||(AN={}));function nX(n,e,t){return t===void 0&&(t="/"),rX(n,e,t)}function rX(n,e,t,r){let i=typeof e=="string"?Ig(e):e,s=sk(i.pathname||"/",t);if(s==null)return null;let o=h3(n);iX(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=gX(s);a=fX(o[l],c)}return a}function h3(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let i=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(ir(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=Uu([r,l.relativePath]),u=t.concat(l);s.children&&s.children.length>0&&(ir(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),h3(s.children,e,u,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:dX(c,s.index),routesMeta:u})};return n.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,o);else for(let l of f3(s.path))i(s,o,l)}),e}function f3(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=f3(r.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),i&&a.push(...o),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function iX(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:hX(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const sX=/^:[\w-]+$/,oX=3,aX=2,lX=1,cX=10,uX=-2,TN=n=>n==="*";function dX(n,e){let t=n.split("/"),r=t.length;return t.some(TN)&&(r+=uX),e&&(r+=aX),t.filter(i=>!TN(i)).reduce((i,s)=>i+(sX.test(s)?oX:s===""?lX:cX),r)}function hX(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function fX(n,e,t){let{routesMeta:r}=n,i={},s="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=s==="/"?e:e.slice(s.length)||"/",h=pX({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!h)return null;Object.assign(i,h.params),o.push({params:i,pathname:Uu([s,h.pathname]),pathnameBase:EX(Uu([s,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(s=Uu([s,h.pathnameBase]))}return o}function pX(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=mX(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((c,u,h)=>{let{paramName:f,isOptional:v}=u;if(f==="*"){let E=a[h]||"";o=s.slice(0,s.length-E.length).replace(/(.)\/+$/,"$1")}const w=a[h];return v&&!w?c[f]=void 0:c[f]=(w||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:o,pattern:n}}function mX(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),d3(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function gX(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return d3(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function sk(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function yX(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?Ig(n):n;return{pathname:t?t.startsWith("/")?t:vX(t,e):e,search:bX(r),hash:_X(i)}}function vX(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function gT(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function wX(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function ok(n,e){let t=wX(n);return e?t.map((r,i)=>i===t.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function ak(n,e,t,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=Ig(n):(i=Bv({},n),ir(!i.pathname||!i.pathname.includes("?"),gT("?","pathname","search",i)),ir(!i.pathname||!i.pathname.includes("#"),gT("#","pathname","hash",i)),ir(!i.search||!i.search.includes("#"),gT("#","search","hash",i)));let s=n===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=t;else{let h=e.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),h-=1;i.pathname=f.join("/")}a=h>=0?e[h]:"/"}let l=yX(i,a),c=o&&o!=="/"&&o.endsWith("/"),u=(s||o===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const Uu=n=>n.join("/").replace(/\/\/+/g,"/"),EX=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),bX=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,_X=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function SX(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const p3=["post","put","patch","delete"];new Set(p3);const AX=["get",...p3];new Set(AX);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $v(){return $v=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},$v.apply(this,arguments)}const lk=D.createContext(null),TX=D.createContext(null),od=D.createContext(null),FA=D.createContext(null),Ka=D.createContext({outlet:null,matches:[],isDataRoute:!1}),m3=D.createContext(null);function IX(n,e){let{relative:t}=e===void 0?{}:e;xg()||ir(!1);let{basename:r,navigator:i}=D.useContext(od),{hash:s,pathname:o,search:a}=y3(n,{relative:t}),l=o;return r!=="/"&&(l=o==="/"?r:Uu([r,o])),i.createHref({pathname:l,search:a,hash:s})}function xg(){return D.useContext(FA)!=null}function Hs(){return xg()||ir(!1),D.useContext(FA).location}function g3(n){D.useContext(od).static||D.useLayoutEffect(n)}function ji(){let{isDataRoute:n}=D.useContext(Ka);return n?jX():xX()}function xX(){xg()||ir(!1);let n=D.useContext(lk),{basename:e,future:t,navigator:r}=D.useContext(od),{matches:i}=D.useContext(Ka),{pathname:s}=Hs(),o=JSON.stringify(ok(i,t.v7_relativeSplatPath)),a=D.useRef(!1);return g3(()=>{a.current=!0}),D.useCallback(function(c,u){if(u===void 0&&(u={}),!a.current)return;if(typeof c=="number"){r.go(c);return}let h=ak(c,JSON.parse(o),s,u.relative==="path");n==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Uu([e,h.pathname])),(u.replace?r.replace:r.push)(h,u.state,u)},[e,r,o,s,n])}const CX=D.createContext(null);function PX(n){let e=D.useContext(Ka).outlet;return e&&D.createElement(CX.Provider,{value:n},e)}function RX(){let{matches:n}=D.useContext(Ka),e=n[n.length-1];return e?e.params:{}}function y3(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=D.useContext(od),{matches:i}=D.useContext(Ka),{pathname:s}=Hs(),o=JSON.stringify(ok(i,r.v7_relativeSplatPath));return D.useMemo(()=>ak(n,JSON.parse(o),s,t==="path"),[n,o,s,t])}function kX(n,e){return DX(n,e)}function DX(n,e,t,r){xg()||ir(!1);let{navigator:i}=D.useContext(od),{matches:s}=D.useContext(Ka),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=Hs(),u;if(e){var h;let A=typeof e=="string"?Ig(e):e;l==="/"||(h=A.pathname)!=null&&h.startsWith(l)||ir(!1),u=A}else u=c;let f=u.pathname||"/",v=f;if(l!=="/"){let A=l.replace(/^\//,"").split("/");v="/"+f.replace(/^\//,"").split("/").slice(A.length).join("/")}let w=nX(n,{pathname:v}),E=FX(w&&w.map(A=>Object.assign({},A,{params:Object.assign({},a,A.params),pathname:Uu([l,i.encodeLocation?i.encodeLocation(A.pathname).pathname:A.pathname]),pathnameBase:A.pathnameBase==="/"?l:Uu([l,i.encodeLocation?i.encodeLocation(A.pathnameBase).pathname:A.pathnameBase])})),s,t,r);return e&&E?D.createElement(FA.Provider,{value:{location:$v({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Au.Pop}},E):E}function MX(){let n=$X(),e=SX(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),t?D.createElement("pre",{style:i},t):null,null)}const NX=D.createElement(MX,null);class LX extends D.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?D.createElement(Ka.Provider,{value:this.props.routeContext},D.createElement(m3.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function OX(n){let{routeContext:e,match:t,children:r}=n,i=D.useContext(lk);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),D.createElement(Ka.Provider,{value:e},r)}function FX(n,e,t,r){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var s;if(!t)return null;if(t.errors)n=t.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,a=(i=t)==null?void 0:i.errors;if(a!=null){let u=o.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);u>=0||ir(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(t&&r&&r.v7_partialHydration)for(let u=0;u<o.length;u++){let h=o[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=u),h.route.id){let{loaderData:f,errors:v}=t,w=h.route.loader&&f[h.route.id]===void 0&&(!v||v[h.route.id]===void 0);if(h.route.lazy||w){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,h,f)=>{let v,w=!1,E=null,A=null;t&&(v=a&&h.route.id?a[h.route.id]:void 0,E=h.route.errorElement||NX,l&&(c<0&&f===0?(zX("route-fallback"),w=!0,A=null):c===f&&(w=!0,A=h.route.hydrateFallbackElement||null)));let T=e.concat(o.slice(0,f+1)),_=()=>{let b;return v?b=E:w?b=A:h.route.Component?b=D.createElement(h.route.Component,null):h.route.element?b=h.route.element:b=u,D.createElement(OX,{match:h,routeContext:{outlet:u,matches:T,isDataRoute:t!=null},children:b})};return t&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?D.createElement(LX,{location:t.location,revalidation:t.revalidation,component:E,error:v,children:_(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):_()},null)}var v3=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(v3||{}),w3=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(w3||{});function VX(n){let e=D.useContext(lk);return e||ir(!1),e}function UX(n){let e=D.useContext(TX);return e||ir(!1),e}function BX(n){let e=D.useContext(Ka);return e||ir(!1),e}function E3(n){let e=BX(),t=e.matches[e.matches.length-1];return t.route.id||ir(!1),t.route.id}function $X(){var n;let e=D.useContext(m3),t=UX(),r=E3();return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function jX(){let{router:n}=VX(v3.UseNavigateStable),e=E3(w3.UseNavigateStable),t=D.useRef(!1);return g3(()=>{t.current=!0}),D.useCallback(function(i,s){s===void 0&&(s={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,$v({fromRouteId:e},s)))},[n,e])}const IN={};function zX(n,e,t){IN[n]||(IN[n]=!0)}function HX(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function Tu(n){let{to:e,replace:t,state:r,relative:i}=n;xg()||ir(!1);let{future:s,static:o}=D.useContext(od),{matches:a}=D.useContext(Ka),{pathname:l}=Hs(),c=ji(),u=ak(e,ok(a,s.v7_relativeSplatPath),l,i==="path"),h=JSON.stringify(u);return D.useEffect(()=>c(JSON.parse(h),{replace:t,state:r,relative:i}),[c,h,i,t,r]),null}function GX(n){return PX(n.context)}function gr(n){ir(!1)}function WX(n){let{basename:e="/",children:t=null,location:r,navigationType:i=Au.Pop,navigator:s,static:o=!1,future:a}=n;xg()&&ir(!1);let l=e.replace(/^\/*/,"/"),c=D.useMemo(()=>({basename:l,navigator:s,static:o,future:$v({v7_relativeSplatPath:!1},a)}),[l,a,s,o]);typeof r=="string"&&(r=Ig(r));let{pathname:u="/",search:h="",hash:f="",state:v=null,key:w="default"}=r,E=D.useMemo(()=>{let A=sk(u,l);return A==null?null:{location:{pathname:A,search:h,hash:f,state:v,key:w},navigationType:i}},[l,u,h,f,v,w,i]);return E==null?null:D.createElement(od.Provider,{value:c},D.createElement(FA.Provider,{children:t,value:E}))}function qX(n){let{children:e,location:t}=n;return kX(yx(e),t)}new Promise(()=>{});function yx(n,e){e===void 0&&(e=[]);let t=[];return D.Children.forEach(n,(r,i)=>{if(!D.isValidElement(r))return;let s=[...e,i];if(r.type===D.Fragment){t.push.apply(t,yx(r.props.children,s));return}r.type!==gr&&ir(!1),!r.props.index||!r.props.children||ir(!1);let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=yx(r.props.children,s)),t.push(o)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function vx(){return vx=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},vx.apply(this,arguments)}function KX(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function YX(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function QX(n,e){return n.button===0&&(!e||e==="_self")&&!YX(n)}function wx(n){return n===void 0&&(n=""),new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let r=n[t];return e.concat(Array.isArray(r)?r.map(i=>[t,i]):[[t,r]])},[]))}function XX(n,e){let t=wx(n);return e&&e.forEach((r,i)=>{t.has(i)||e.getAll(i).forEach(s=>{t.append(i,s)})}),t}const JX=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ZX="6";try{window.__reactRouterVersion=ZX}catch{}const eJ="startTransition",xN=qK[eJ];function tJ(n){let{basename:e,children:t,future:r,window:i}=n,s=D.useRef();s.current==null&&(s.current=ZQ({window:i,v5Compat:!0}));let o=s.current,[a,l]=D.useState({action:o.action,location:o.location}),{v7_startTransition:c}=r||{},u=D.useCallback(h=>{c&&xN?xN(()=>l(h)):l(h)},[l,c]);return D.useLayoutEffect(()=>o.listen(u),[o,u]),D.useEffect(()=>HX(r),[r]),D.createElement(WX,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:o,future:r})}const nJ=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",rJ=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,iJ=D.forwardRef(function(e,t){let{onClick:r,relative:i,reloadDocument:s,replace:o,state:a,target:l,to:c,preventScrollReset:u,viewTransition:h}=e,f=KX(e,JX),{basename:v}=D.useContext(od),w,E=!1;if(typeof c=="string"&&rJ.test(c)&&(w=c,nJ))try{let b=new URL(window.location.href),g=c.startsWith("//")?new URL(b.protocol+c):new URL(c),y=sk(g.pathname,v);g.origin===b.origin&&y!=null?c=y+g.search+g.hash:E=!0}catch{}let A=IX(c,{relative:i}),T=sJ(c,{replace:o,state:a,target:l,preventScrollReset:u,relative:i,viewTransition:h});function _(b){r&&r(b),b.defaultPrevented||T(b)}return D.createElement("a",vx({},f,{href:w||A,onClick:E||s?r:_,ref:t,target:l}))});var CN;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(CN||(CN={}));var PN;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(PN||(PN={}));function sJ(n,e){let{target:t,replace:r,state:i,preventScrollReset:s,relative:o,viewTransition:a}=e===void 0?{}:e,l=ji(),c=Hs(),u=y3(n,{relative:o});return D.useCallback(h=>{if(QX(h,t)){h.preventDefault();let f=r!==void 0?r:yS(c)===yS(u);l(n,{replace:f,state:i,preventScrollReset:s,relative:o,viewTransition:a})}},[c,l,u,r,i,t,n,s,o,a])}function ck(n){let e=D.useRef(wx(n)),t=D.useRef(!1),r=Hs(),i=D.useMemo(()=>XX(r.search,t.current?null:e.current),[r.search]),s=ji(),o=D.useCallback((a,l)=>{const c=wx(typeof a=="function"?a(i):a);t.current=!0,s("?"+c,l)},[s,i]);return[i,o]}var Ex={exports:{}};(function(n,e){(function(t,r){r(e)})(RK,function(t){class r{constructor(g,y){this.state={angle:0,area:[],position:{x:0,y:0},hardAngle:0,hardDrawingAngle:0},this.createdDensity=y,this.nowDrawingDensity=this.createdDensity,this.render=g}setDensity(g){this.createdDensity=g,this.nowDrawingDensity=g}setDrawingDensity(g){this.nowDrawingDensity=g}setPosition(g){this.state.position=g}setAngle(g){this.state.angle=g}setArea(g){this.state.area=g}setHardDrawingAngle(g){this.state.hardDrawingAngle=g}setHardAngle(g){this.state.hardAngle=g,this.state.hardDrawingAngle=g}setOrientation(g){this.orientation=g}getDrawingDensity(){return this.nowDrawingDensity}getDensity(){return this.createdDensity}getHardAngle(){return this.state.hardAngle}}class i extends r{constructor(g,y,x){super(g,x),this.image=null,this.isLoad=!1,this.loadingAngle=0,this.image=new Image,this.image.src=y}draw(g){const y=this.render.getContext(),x=this.render.convertToGlobal(this.state.position),S=this.render.getRect().pageWidth,I=this.render.getRect().height;y.save(),y.translate(x.x,x.y),y.beginPath();for(let P of this.state.area)P!==null&&(P=this.render.convertToGlobal(P),y.lineTo(P.x-x.x,P.y-x.y));y.rotate(this.state.angle),y.clip(),this.isLoad?y.drawImage(this.image,0,0,S,I):this.drawLoader(y,{x:0,y:0},S,I),y.restore()}simpleDraw(g){const y=this.render.getRect(),x=this.render.getContext(),S=y.pageWidth,I=y.height,P=g===1?y.left+y.pageWidth:y.left,N=y.top;this.isLoad?x.drawImage(this.image,P,N,S,I):this.drawLoader(x,{x:P,y:N},S,I)}drawLoader(g,y,x,S){g.beginPath(),g.strokeStyle="rgb(200, 200, 200)",g.fillStyle="rgb(255, 255, 255)",g.lineWidth=1,g.rect(y.x+1,y.y+1,x-1,S-1),g.stroke(),g.fill();const I={x:y.x+x/2,y:y.y+S/2};g.beginPath(),g.lineWidth=10,g.arc(I.x,I.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),g.stroke(),g.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}load(){this.isLoad||(this.image.onload=()=>{this.isLoad=!0})}newTemporaryCopy(){return this}getTemporaryCopy(){return this}hideTemporaryCopy(){}}class s{constructor(g,y){this.pages=[],this.currentPageIndex=0,this.currentSpreadIndex=0,this.landscapeSpread=[],this.portraitSpread=[],this.render=y,this.app=g,this.currentPageIndex=0,this.isShowCover=this.app.getSettings().showCover}destroy(){this.pages=[]}createSpread(){this.landscapeSpread=[],this.portraitSpread=[];for(let y=0;y<this.pages.length;y++)this.portraitSpread.push([y]);let g=0;this.isShowCover&&(this.pages[0].setDensity("hard"),this.landscapeSpread.push([g]),g++);for(let y=g;y<this.pages.length;y+=2)y<this.pages.length-1?this.landscapeSpread.push([y,y+1]):(this.landscapeSpread.push([y]),this.pages[y].setDensity("hard"))}getSpread(){return this.render.getOrientation()==="landscape"?this.landscapeSpread:this.portraitSpread}getSpreadIndexByPage(g){const y=this.getSpread();for(let x=0;x<y.length;x++)if(g===y[x][0]||g===y[x][1])return x;return null}getPageCount(){return this.pages.length}getPages(){return this.pages}getPage(g){if(g>=0&&g<this.pages.length)return this.pages[g];throw new Error("Invalid page number")}nextBy(g){const y=this.pages.indexOf(g);return y<this.pages.length-1?this.pages[y+1]:null}prevBy(g){const y=this.pages.indexOf(g);return y>0?this.pages[y-1]:null}getFlippingPage(g){const y=this.currentSpreadIndex;if(this.render.getOrientation()==="portrait")return g===0?this.pages[y].newTemporaryCopy():this.pages[y-1];{const x=g===0?this.getSpread()[y+1]:this.getSpread()[y-1];return x.length===1||g===0?this.pages[x[0]]:this.pages[x[1]]}}getBottomPage(g){const y=this.currentSpreadIndex;if(this.render.getOrientation()==="portrait")return g===0?this.pages[y+1]:this.pages[y-1];{const x=g===0?this.getSpread()[y+1]:this.getSpread()[y-1];return x.length===1?this.pages[x[0]]:g===0?this.pages[x[1]]:this.pages[x[0]]}}showNext(){this.currentSpreadIndex<this.getSpread().length&&(this.currentSpreadIndex++,this.showSpread())}showPrev(){this.currentSpreadIndex>0&&(this.currentSpreadIndex--,this.showSpread())}getCurrentPageIndex(){return this.currentPageIndex}show(g=null){if(g===null&&(g=this.currentPageIndex),g<0||g>=this.pages.length)return;const y=this.getSpreadIndexByPage(g);y!==null&&(this.currentSpreadIndex=y,this.showSpread())}getCurrentSpreadIndex(){return this.currentSpreadIndex}setCurrentSpreadIndex(g){if(!(g>=0&&g<this.getSpread().length))throw new Error("Invalid page");this.currentSpreadIndex=g}showSpread(){const g=this.getSpread()[this.currentSpreadIndex];g.length===2?(this.render.setLeftPage(this.pages[g[0]]),this.render.setRightPage(this.pages[g[1]])):this.render.getOrientation()==="landscape"&&g[0]===this.pages.length-1?(this.render.setLeftPage(this.pages[g[0]]),this.render.setRightPage(null)):(this.render.setLeftPage(null),this.render.setRightPage(this.pages[g[0]])),this.currentPageIndex=g[0],this.app.updatePageIndex(this.currentPageIndex)}}class o extends s{constructor(g,y,x){super(g,y),this.imagesHref=x}load(){for(const g of this.imagesHref){const y=new i(this.render,g,"soft");y.load(),this.pages.push(y)}this.createSpread()}}class a{static GetDistanceBetweenTwoPoint(g,y){return g===null||y===null?1/0:Math.sqrt(Math.pow(y.x-g.x,2)+Math.pow(y.y-g.y,2))}static GetSegmentLength(g){return a.GetDistanceBetweenTwoPoint(g[0],g[1])}static GetAngleBetweenTwoLine(g,y){const x=g[0].y-g[1].y,S=y[0].y-y[1].y,I=g[1].x-g[0].x,P=y[1].x-y[0].x;return Math.acos((x*S+I*P)/(Math.sqrt(x*x+I*I)*Math.sqrt(S*S+P*P)))}static PointInRect(g,y){return y===null?null:y.x>=g.left&&y.x<=g.width+g.left&&y.y>=g.top&&y.y<=g.top+g.height?y:null}static GetRotatedPoint(g,y,x){return{x:g.x*Math.cos(x)+g.y*Math.sin(x)+y.x,y:g.y*Math.cos(x)-g.x*Math.sin(x)+y.y}}static LimitPointToCircle(g,y,x){if(a.GetDistanceBetweenTwoPoint(g,x)<=y)return x;const S=g.x,I=g.y,P=x.x,N=x.y;let M=Math.sqrt(Math.pow(y,2)*Math.pow(S-P,2)/(Math.pow(S-P,2)+Math.pow(I-N,2)))+S;x.x<0&&(M*=-1);let V=(M-S)*(I-N)/(S-P)+I;return S-P+I===0&&(V=y),{x:M,y:V}}static GetIntersectBetweenTwoSegment(g,y,x){return a.PointInRect(g,a.GetIntersectBeetwenTwoLine(y,x))}static GetIntersectBeetwenTwoLine(g,y){const x=g[0].y-g[1].y,S=y[0].y-y[1].y,I=g[1].x-g[0].x,P=y[1].x-y[0].x,N=g[0].x*g[1].y-g[1].x*g[0].y,M=y[0].x*y[1].y-y[1].x*y[0].y,V=x*M-S*N,L=I*M-P*N,j=-(N*P-M*I)/(x*P-S*I),oe=-(x*M-S*N)/(x*P-S*I);if(isFinite(j)&&isFinite(oe))return{x:j,y:oe};if(Math.abs(V-L)<.1)throw new Error("Segment included");return null}static GetCordsFromTwoPoint(g,y){const x=Math.abs(g.x-y.x),S=Math.abs(g.y-y.y),I=Math.max(x,S),P=[g];function N(M,V,L,j,oe){return V>M?M+oe*(L/j):V<M?M-oe*(L/j):M}for(let M=1;M<=I;M+=1)P.push({x:N(g.x,y.x,x,I,M),y:N(g.y,y.y,S,I,M)});return P}}class l extends r{constructor(g,y,x){super(g,x),this.copiedElement=null,this.temporaryCopy=null,this.isLoad=!1,this.element=y,this.element.classList.add("stf__item"),this.element.classList.add("--"+x)}newTemporaryCopy(){return this.nowDrawingDensity==="hard"?this:(this.temporaryCopy===null&&(this.copiedElement=this.element.cloneNode(!0),this.element.parentElement.appendChild(this.copiedElement),this.temporaryCopy=new l(this.render,this.copiedElement,this.nowDrawingDensity)),this.getTemporaryCopy())}getTemporaryCopy(){return this.temporaryCopy}hideTemporaryCopy(){this.temporaryCopy!==null&&(this.copiedElement.remove(),this.copiedElement=null,this.temporaryCopy=null)}draw(g){const y=g||this.nowDrawingDensity,x=this.render.convertToGlobal(this.state.position),S=this.render.getRect().pageWidth,I=this.render.getRect().height;this.element.classList.remove("--simple");const P=`
            display: block;
            z-index: ${this.element.style.zIndex};
            left: 0;
            top: 0;
            width: ${S}px;
            height: ${I}px;
        `;y==="hard"?this.drawHard(P):this.drawSoft(x,P)}drawHard(g=""){const y=this.render.getRect().left+this.render.getRect().width/2,x=this.state.hardDrawingAngle,S=g+`
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
                clip-path: none;
                -webkit-clip-path: none;
            `+(this.orientation===0?`transform-origin: ${this.render.getRect().pageWidth}px 0; 
                   transform: translate3d(0, 0, 0) rotateY(${x}deg);`:`transform-origin: 0 0; 
                   transform: translate3d(${y}px, 0, 0) rotateY(${x}deg);`);this.element.style.cssText=S}drawSoft(g,y=""){let x="polygon( ";for(const I of this.state.area)if(I!==null){let P=this.render.getDirection()===1?{x:-I.x+this.state.position.x,y:I.y-this.state.position.y}:{x:I.x-this.state.position.x,y:I.y-this.state.position.y};P=a.GetRotatedPoint(P,{x:0,y:0},this.state.angle),x+=P.x+"px "+P.y+"px, "}x=x.slice(0,-2),x+=")";const S=y+`transform-origin: 0 0; clip-path: ${x}; -webkit-clip-path: ${x};`+(this.render.isSafari()&&this.state.angle===0?`transform: translate(${g.x}px, ${g.y}px);`:`transform: translate3d(${g.x}px, ${g.y}px, 0) rotate(${this.state.angle}rad);`);this.element.style.cssText=S}simpleDraw(g){const y=this.render.getRect(),x=y.pageWidth,S=y.height,I=g===1?y.left+y.pageWidth:y.left,P=y.top;this.element.classList.add("--simple"),this.element.style.cssText=`
            position: absolute; 
            display: block; 
            height: ${S}px; 
            left: ${I}px; 
            top: ${P}px; 
            width: ${x}px; 
            z-index: ${this.render.getSettings().startZIndex+1};`}getElement(){return this.element}load(){this.isLoad=!0}setOrientation(g){super.setOrientation(g),this.element.classList.remove("--left","--right"),this.element.classList.add(g===1?"--right":"--left")}setDrawingDensity(g){this.element.classList.remove("--soft","--hard"),this.element.classList.add("--"+g),super.setDrawingDensity(g)}}class c extends s{constructor(g,y,x,S){super(g,y),this.element=x,this.pagesElement=S}load(){for(const g of this.pagesElement){const y=new l(this.render,g,g.dataset.density==="hard"?"hard":"soft");y.load(),this.pages.push(y)}this.createSpread()}}class u{constructor(g,y,x,S){this.direction=g,this.corner=y,this.topIntersectPoint=null,this.sideIntersectPoint=null,this.bottomIntersectPoint=null,this.pageWidth=parseInt(x,10),this.pageHeight=parseInt(S,10)}calc(g){try{return this.position=this.calcAngleAndPosition(g),this.calculateIntersectPoint(this.position),!0}catch{return!1}}getFlippingClipArea(){const g=[];let y=!1;return g.push(this.rect.topLeft),g.push(this.topIntersectPoint),this.sideIntersectPoint===null?y=!0:(g.push(this.sideIntersectPoint),this.bottomIntersectPoint===null&&(y=!1)),g.push(this.bottomIntersectPoint),(y||this.corner==="bottom")&&g.push(this.rect.bottomLeft),g}getBottomClipArea(){const g=[];return g.push(this.topIntersectPoint),this.corner==="top"?g.push({x:this.pageWidth,y:0}):(this.topIntersectPoint!==null&&g.push({x:this.pageWidth,y:0}),g.push({x:this.pageWidth,y:this.pageHeight})),this.sideIntersectPoint!==null?a.GetDistanceBetweenTwoPoint(this.sideIntersectPoint,this.topIntersectPoint)>=10&&g.push(this.sideIntersectPoint):this.corner==="top"&&g.push({x:this.pageWidth,y:this.pageHeight}),g.push(this.bottomIntersectPoint),g.push(this.topIntersectPoint),g}getAngle(){return this.direction===0?-this.angle:this.angle}getRect(){return this.rect}getPosition(){return this.position}getActiveCorner(){return this.direction===0?this.rect.topLeft:this.rect.topRight}getDirection(){return this.direction}getFlippingProgress(){return Math.abs((this.position.x-this.pageWidth)/(2*this.pageWidth)*100)}getCorner(){return this.corner}getBottomPagePosition(){return this.direction===1?{x:this.pageWidth,y:0}:{x:0,y:0}}getShadowStartPoint(){return this.corner==="top"?this.topIntersectPoint:this.sideIntersectPoint!==null?this.sideIntersectPoint:this.topIntersectPoint}getShadowAngle(){const g=a.GetAngleBetweenTwoLine(this.getSegmentToShadowLine(),[{x:0,y:0},{x:this.pageWidth,y:0}]);return this.direction===0?g:Math.PI-g}calcAngleAndPosition(g){let y=g;if(this.updateAngleAndGeometry(y),y=this.corner==="top"?this.checkPositionAtCenterLine(y,{x:0,y:0},{x:0,y:this.pageHeight}):this.checkPositionAtCenterLine(y,{x:0,y:this.pageHeight},{x:0,y:0}),Math.abs(y.x-this.pageWidth)<1&&Math.abs(y.y)<1)throw new Error("Point is too small");return y}updateAngleAndGeometry(g){this.angle=this.calculateAngle(g),this.rect=this.getPageRect(g)}calculateAngle(g){const y=this.pageWidth-g.x+1,x=this.corner==="bottom"?this.pageHeight-g.y:g.y;let S=2*Math.acos(y/Math.sqrt(x*x+y*y));x<0&&(S=-S);const I=Math.PI-S;if(!isFinite(S)||I>=0&&I<.003)throw new Error("The G point is too small");return this.corner==="bottom"&&(S=-S),S}getPageRect(g){return this.corner==="top"?this.getRectFromBasePoint([{x:0,y:0},{x:this.pageWidth,y:0},{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}],g):this.getRectFromBasePoint([{x:0,y:-this.pageHeight},{x:this.pageWidth,y:-this.pageHeight},{x:0,y:0},{x:this.pageWidth,y:0}],g)}getRectFromBasePoint(g,y){return{topLeft:this.getRotatedPoint(g[0],y),topRight:this.getRotatedPoint(g[1],y),bottomLeft:this.getRotatedPoint(g[2],y),bottomRight:this.getRotatedPoint(g[3],y)}}getRotatedPoint(g,y){return{x:g.x*Math.cos(this.angle)+g.y*Math.sin(this.angle)+y.x,y:g.y*Math.cos(this.angle)-g.x*Math.sin(this.angle)+y.y}}calculateIntersectPoint(g){const y={left:-1,top:-1,width:this.pageWidth+2,height:this.pageHeight+2};this.corner==="top"?(this.topIntersectPoint=a.GetIntersectBetweenTwoSegment(y,[g,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=a.GetIntersectBetweenTwoSegment(y,[g,this.rect.bottomLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=a.GetIntersectBetweenTwoSegment(y,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}])):(this.topIntersectPoint=a.GetIntersectBetweenTwoSegment(y,[this.rect.topLeft,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=a.GetIntersectBetweenTwoSegment(y,[g,this.rect.topLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=a.GetIntersectBetweenTwoSegment(y,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}]))}checkPositionAtCenterLine(g,y,x){let S=g;const I=a.LimitPointToCircle(y,this.pageWidth,S);S!==I&&(S=I,this.updateAngleAndGeometry(S));const P=Math.sqrt(Math.pow(this.pageWidth,2)+Math.pow(this.pageHeight,2));let N=this.rect.bottomRight,M=this.rect.topLeft;if(this.corner==="bottom"&&(N=this.rect.topRight,M=this.rect.bottomLeft),N.x<=0){const V=a.LimitPointToCircle(x,P,M);V!==S&&(S=V,this.updateAngleAndGeometry(S))}return S}getSegmentToShadowLine(){const g=this.getShadowStartPoint();return[g,g!==this.sideIntersectPoint&&this.sideIntersectPoint!==null?this.sideIntersectPoint:this.bottomIntersectPoint]}}class h{constructor(g,y){this.flippingPage=null,this.bottomPage=null,this.calc=null,this.state="read",this.render=g,this.app=y}fold(g){this.setState("user_fold"),this.calc===null&&this.start(g),this.do(this.render.convertToPage(g))}flip(g){if(this.app.getSettings().disableFlipByClick&&!this.isPointOnCorners(g)||(this.calc!==null&&this.render.finishAnimation(),!this.start(g)))return;const y=this.getBoundsRect();this.setState("flipping");const x=y.height/10,S=this.calc.getCorner()==="bottom"?y.height-x:x,I=this.calc.getCorner()==="bottom"?y.height:0;this.calc.calc({x:y.pageWidth-x,y:S}),this.animateFlippingTo({x:y.pageWidth-x,y:S},{x:-y.pageWidth,y:I},!0)}start(g){this.reset();const y=this.render.convertToBook(g),x=this.getBoundsRect(),S=this.getDirectionByPoint(y),I=y.y>=x.height/2?"bottom":"top";if(!this.checkDirection(S))return!1;try{if(this.flippingPage=this.app.getPageCollection().getFlippingPage(S),this.bottomPage=this.app.getPageCollection().getBottomPage(S),this.render.getOrientation()==="landscape")if(S===1){const P=this.app.getPageCollection().nextBy(this.flippingPage);P!==null&&this.flippingPage.getDensity()!==P.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),P.setDrawingDensity("hard"))}else{const P=this.app.getPageCollection().prevBy(this.flippingPage);P!==null&&this.flippingPage.getDensity()!==P.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),P.setDrawingDensity("hard"))}return this.render.setDirection(S),this.calc=new u(S,I,x.pageWidth.toString(10),x.height.toString(10)),!0}catch{return!1}}do(g){if(this.calc!==null&&this.calc.calc(g)){const y=this.calc.getFlippingProgress();this.bottomPage.setArea(this.calc.getBottomClipArea()),this.bottomPage.setPosition(this.calc.getBottomPagePosition()),this.bottomPage.setAngle(0),this.bottomPage.setHardAngle(0),this.flippingPage.setArea(this.calc.getFlippingClipArea()),this.flippingPage.setPosition(this.calc.getActiveCorner()),this.flippingPage.setAngle(this.calc.getAngle()),this.calc.getDirection()===0?this.flippingPage.setHardAngle(90*(200-2*y)/100):this.flippingPage.setHardAngle(-90*(200-2*y)/100),this.render.setPageRect(this.calc.getRect()),this.render.setBottomPage(this.bottomPage),this.render.setFlippingPage(this.flippingPage),this.render.setShadowData(this.calc.getShadowStartPoint(),this.calc.getShadowAngle(),y,this.calc.getDirection())}}flipToPage(g,y){const x=this.app.getPageCollection().getCurrentSpreadIndex(),S=this.app.getPageCollection().getSpreadIndexByPage(g);try{S>x&&(this.app.getPageCollection().setCurrentSpreadIndex(S-1),this.flipNext(y)),S<x&&(this.app.getPageCollection().setCurrentSpreadIndex(S+1),this.flipPrev(y))}catch{}}flipNext(g){this.flip({x:this.render.getRect().left+2*this.render.getRect().pageWidth-10,y:g==="top"?1:this.render.getRect().height-2})}flipPrev(g){this.flip({x:10,y:g==="top"?1:this.render.getRect().height-2})}stopMove(){if(this.calc===null)return;const g=this.calc.getPosition(),y=this.getBoundsRect(),x=this.calc.getCorner()==="bottom"?y.height:0;g.x<=0?this.animateFlippingTo(g,{x:-y.pageWidth,y:x},!0):this.animateFlippingTo(g,{x:y.pageWidth,y:x},!1)}showCorner(g){if(!this.checkState("read","fold_corner"))return;const y=this.getBoundsRect(),x=y.pageWidth;if(this.isPointOnCorners(g))if(this.calc===null){if(!this.start(g))return;this.setState("fold_corner"),this.calc.calc({x:x-1,y:1});const S=50,I=this.calc.getCorner()==="bottom"?y.height-1:1,P=this.calc.getCorner()==="bottom"?y.height-S:S;this.animateFlippingTo({x:x-1,y:I},{x:x-S,y:P},!1,!1)}else this.do(this.render.convertToPage(g));else this.setState("read"),this.render.finishAnimation(),this.stopMove()}animateFlippingTo(g,y,x,S=!0){const I=a.GetCordsFromTwoPoint(g,y),P=[];for(const M of I)P.push(()=>this.do(M));const N=this.getAnimationDuration(I.length);this.render.startAnimation(P,N,()=>{this.calc&&(x&&(this.calc.getDirection()===1?this.app.turnToPrevPage():this.app.turnToNextPage()),S&&(this.render.setBottomPage(null),this.render.setFlippingPage(null),this.render.clearShadow(),this.setState("read"),this.reset()))})}getCalculation(){return this.calc}getState(){return this.state}setState(g){this.state!==g&&(this.app.updateState(g),this.state=g)}getDirectionByPoint(g){const y=this.getBoundsRect();if(this.render.getOrientation()==="portrait"){if(g.x-y.pageWidth<=y.width/5)return 1}else if(g.x<y.width/2)return 1;return 0}getAnimationDuration(g){const y=this.app.getSettings().flippingTime;return g>=1e3?y:g/1e3*y}checkDirection(g){return g===0?this.app.getCurrentPageIndex()<this.app.getPageCount()-1:this.app.getCurrentPageIndex()>=1}reset(){this.calc=null,this.flippingPage=null,this.bottomPage=null}getBoundsRect(){return this.render.getRect()}checkState(...g){for(const y of g)if(this.state===y)return!0;return!1}isPointOnCorners(g){const y=this.getBoundsRect(),x=y.pageWidth,S=Math.sqrt(Math.pow(x,2)+Math.pow(y.height,2))/5,I=this.render.convertToBook(g);return I.x>0&&I.y>0&&I.x<y.width&&I.y<y.height&&(I.x<S||I.x>y.width-S)&&(I.y<S||I.y>y.height-S)}}class f{constructor(g,y){this.leftPage=null,this.rightPage=null,this.flippingPage=null,this.bottomPage=null,this.direction=null,this.orientation=null,this.shadow=null,this.animation=null,this.pageRect=null,this.boundsRect=null,this.timer=0,this.safari=!1,this.setting=y,this.app=g;const x=new RegExp("Version\\/[\\d\\.]+.*Safari/");this.safari=x.exec(window.navigator.userAgent)!==null}render(g){if(this.animation!==null){const y=Math.round((g-this.animation.startedAt)/this.animation.durationFrame);y<this.animation.frames.length?this.animation.frames[y]():(this.animation.onAnimateEnd(),this.animation=null)}this.timer=g,this.drawFrame()}start(){this.update();const g=y=>{this.render(y),requestAnimationFrame(g)};requestAnimationFrame(g)}startAnimation(g,y,x){this.finishAnimation(),this.animation={frames:g,duration:y,durationFrame:y/g.length,onAnimateEnd:x,startedAt:this.timer}}finishAnimation(){this.animation!==null&&(this.animation.frames[this.animation.frames.length-1](),this.animation.onAnimateEnd!==null&&this.animation.onAnimateEnd()),this.animation=null}update(){this.boundsRect=null;const g=this.calculateBoundsRect();this.orientation!==g&&(this.orientation=g,this.app.updateOrientation(g))}calculateBoundsRect(){let g="landscape";const y=this.getBlockWidth(),x=y/2,S=this.getBlockHeight()/2,I=this.setting.width/this.setting.height;let P=this.setting.width,N=this.setting.height,M=x-P;return this.setting.size==="stretch"?(y<2*this.setting.minWidth&&this.app.getSettings().usePortrait&&(g="portrait"),P=g==="portrait"?this.getBlockWidth():this.getBlockWidth()/2,P>this.setting.maxWidth&&(P=this.setting.maxWidth),N=P/I,N>this.getBlockHeight()&&(N=this.getBlockHeight(),P=N*I),M=g==="portrait"?x-P/2-P:x-P):y<2*P&&this.app.getSettings().usePortrait&&(g="portrait",M=x-P/2-P),this.boundsRect={left:M,top:S-N/2,width:2*P,height:N,pageWidth:P},g}setShadowData(g,y,x,S){if(!this.app.getSettings().drawShadow)return;const I=100*this.getSettings().maxShadowOpacity;this.shadow={pos:g,angle:y,width:3*this.getRect().pageWidth/4*x/100,opacity:(100-x)*I/100/100,direction:S,progress:2*x}}clearShadow(){this.shadow=null}getBlockWidth(){return this.app.getUI().getDistElement().offsetWidth}getBlockHeight(){return this.app.getUI().getDistElement().offsetHeight}getDirection(){return this.direction}getRect(){return this.boundsRect===null&&this.calculateBoundsRect(),this.boundsRect}getSettings(){return this.app.getSettings()}getOrientation(){return this.orientation}setPageRect(g){this.pageRect=g}setDirection(g){this.direction=g}setRightPage(g){g!==null&&g.setOrientation(1),this.rightPage=g}setLeftPage(g){g!==null&&g.setOrientation(0),this.leftPage=g}setBottomPage(g){g!==null&&g.setOrientation(this.direction===1?0:1),this.bottomPage=g}setFlippingPage(g){g!==null&&g.setOrientation(this.direction===0&&this.orientation!=="portrait"?0:1),this.flippingPage=g}convertToBook(g){const y=this.getRect();return{x:g.x-y.left,y:g.y-y.top}}isSafari(){return this.safari}convertToPage(g,y){y||(y=this.direction);const x=this.getRect();return{x:y===0?g.x-x.left-x.width/2:x.width/2-g.x+x.left,y:g.y-x.top}}convertToGlobal(g,y){if(y||(y=this.direction),g==null)return null;const x=this.getRect();return{x:y===0?g.x+x.left+x.width/2:x.width/2-g.x+x.left,y:g.y+x.top}}convertRectToGlobal(g,y){return y||(y=this.direction),{topLeft:this.convertToGlobal(g.topLeft,y),topRight:this.convertToGlobal(g.topRight,y),bottomLeft:this.convertToGlobal(g.bottomLeft,y),bottomRight:this.convertToGlobal(g.bottomRight,y)}}}class v extends f{constructor(g,y,x){super(g,y),this.canvas=x,this.ctx=x.getContext("2d")}getContext(){return this.ctx}reload(){}drawFrame(){this.clear(),this.orientation!=="portrait"&&this.leftPage!=null&&this.leftPage.simpleDraw(0),this.rightPage!=null&&this.rightPage.simpleDraw(1),this.bottomPage!=null&&this.bottomPage.draw(),this.drawBookShadow(),this.flippingPage!=null&&this.flippingPage.draw(),this.shadow!=null&&(this.drawOuterShadow(),this.drawInnerShadow());const g=this.getRect();this.orientation==="portrait"&&(this.ctx.beginPath(),this.ctx.rect(g.left+g.pageWidth,g.top,g.width,g.height),this.ctx.clip())}drawBookShadow(){const g=this.getRect();this.ctx.save(),this.ctx.beginPath();const y=g.width/20;this.ctx.rect(g.left,g.top,g.width,g.height);const x={x:g.left+g.width/2-y/2,y:0};this.ctx.translate(x.x,x.y);const S=this.ctx.createLinearGradient(0,0,y,0);S.addColorStop(0,"rgba(0, 0, 0, 0)"),S.addColorStop(.4,"rgba(0, 0, 0, 0.2)"),S.addColorStop(.49,"rgba(0, 0, 0, 0.1)"),S.addColorStop(.5,"rgba(0, 0, 0, 0.5)"),S.addColorStop(.51,"rgba(0, 0, 0, 0.4)"),S.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.clip(),this.ctx.fillStyle=S,this.ctx.fillRect(0,0,y,2*g.height),this.ctx.restore()}drawOuterShadow(){const g=this.getRect();this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(g.left,g.top,g.width,g.height);const y=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.translate(y.x,y.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const x=this.ctx.createLinearGradient(0,0,this.shadow.width,0);this.shadow.direction===0?(this.ctx.translate(0,-100),x.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),x.addColorStop(1,"rgba(0, 0, 0, 0)")):(this.ctx.translate(-this.shadow.width,-100),x.addColorStop(0,"rgba(0, 0, 0, 0)"),x.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")")),this.ctx.clip(),this.ctx.fillStyle=x,this.ctx.fillRect(0,0,this.shadow.width,2*g.height),this.ctx.restore()}drawInnerShadow(){const g=this.getRect();this.ctx.save(),this.ctx.beginPath();const y=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),x=this.convertRectToGlobal(this.pageRect);this.ctx.moveTo(x.topLeft.x,x.topLeft.y),this.ctx.lineTo(x.topRight.x,x.topRight.y),this.ctx.lineTo(x.bottomRight.x,x.bottomRight.y),this.ctx.lineTo(x.bottomLeft.x,x.bottomLeft.y),this.ctx.translate(y.x,y.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const S=3*this.shadow.width/4,I=this.ctx.createLinearGradient(0,0,S,0);this.shadow.direction===0?(this.ctx.translate(-S,-100),I.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")"),I.addColorStop(.9,"rgba(0, 0, 0, 0.05)"),I.addColorStop(.7,"rgba(0, 0, 0, "+this.shadow.opacity+")"),I.addColorStop(0,"rgba(0, 0, 0, 0)")):(this.ctx.translate(0,-100),I.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),I.addColorStop(.1,"rgba(0, 0, 0, 0.05)"),I.addColorStop(.3,"rgba(0, 0, 0, "+this.shadow.opacity+")"),I.addColorStop(1,"rgba(0, 0, 0, 0)")),this.ctx.clip(),this.ctx.fillStyle=I,this.ctx.fillRect(0,0,S,2*g.height),this.ctx.restore()}clear(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}class w{constructor(g,y,x){this.touchPoint=null,this.swipeTimeout=250,this.onResize=()=>{this.update()},this.onMouseDown=I=>{if(this.checkTarget(I.target)){const P=this.getMousePos(I.clientX,I.clientY);this.app.startUserTouch(P),I.preventDefault()}},this.onTouchStart=I=>{if(this.checkTarget(I.target)&&I.changedTouches.length>0){const P=I.changedTouches[0],N=this.getMousePos(P.clientX,P.clientY);this.touchPoint={point:N,time:Date.now()},setTimeout(()=>{this.touchPoint!==null&&this.app.startUserTouch(N)},this.swipeTimeout),this.app.getSettings().mobileScrollSupport||I.preventDefault()}},this.onMouseUp=I=>{const P=this.getMousePos(I.clientX,I.clientY);this.app.userStop(P)},this.onMouseMove=I=>{const P=this.getMousePos(I.clientX,I.clientY);this.app.userMove(P,!1)},this.onTouchMove=I=>{if(I.changedTouches.length>0){const P=I.changedTouches[0],N=this.getMousePos(P.clientX,P.clientY);this.app.getSettings().mobileScrollSupport?(this.touchPoint!==null&&(Math.abs(this.touchPoint.point.x-N.x)>10||this.app.getState()!=="read")&&I.cancelable&&this.app.userMove(N,!0),this.app.getState()!=="read"&&I.preventDefault()):this.app.userMove(N,!0)}},this.onTouchEnd=I=>{if(I.changedTouches.length>0){const P=I.changedTouches[0],N=this.getMousePos(P.clientX,P.clientY);let M=!1;if(this.touchPoint!==null){const V=N.x-this.touchPoint.point.x,L=Math.abs(N.y-this.touchPoint.point.y);Math.abs(V)>this.swipeDistance&&L<2*this.swipeDistance&&Date.now()-this.touchPoint.time<this.swipeTimeout&&(V>0?this.app.flipPrev(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"):this.app.flipNext(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"),M=!0),this.touchPoint=null}this.app.userStop(N,M)}},this.parentElement=g,g.classList.add("stf__parent"),g.insertAdjacentHTML("afterbegin",'<div class="stf__wrapper"></div>'),this.wrapper=g.querySelector(".stf__wrapper"),this.app=y;const S=this.app.getSettings().usePortrait?1:2;g.style.minWidth=x.minWidth*S+"px",g.style.minHeight=x.minHeight+"px",x.size==="fixed"&&(g.style.minWidth=x.width*S+"px",g.style.minHeight=x.height+"px"),x.autoSize&&(g.style.width="100%",g.style.maxWidth=2*x.maxWidth+"px"),g.style.display="block",window.addEventListener("resize",this.onResize,!1),this.swipeDistance=x.swipeDistance}destroy(){this.app.getSettings().useMouseEvents&&this.removeHandlers(),this.distElement.remove(),this.wrapper.remove()}getDistElement(){return this.distElement}getWrapper(){return this.wrapper}setOrientationStyle(g){this.wrapper.classList.remove("--portrait","--landscape"),g==="portrait"?(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/this.app.getSettings().width*100+"%"),this.wrapper.classList.add("--portrait")):(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/(2*this.app.getSettings().width)*100+"%"),this.wrapper.classList.add("--landscape")),this.update()}removeHandlers(){window.removeEventListener("resize",this.onResize),this.distElement.removeEventListener("mousedown",this.onMouseDown),this.distElement.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}setHandlers(){window.addEventListener("resize",this.onResize,!1),this.app.getSettings().useMouseEvents&&(this.distElement.addEventListener("mousedown",this.onMouseDown),this.distElement.addEventListener("touchstart",this.onTouchStart),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!this.app.getSettings().mobileScrollSupport}),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd))}getMousePos(g,y){const x=this.distElement.getBoundingClientRect();return{x:g-x.left,y:y-x.top}}checkTarget(g){return!this.app.getSettings().clickEventForward||!["a","button"].includes(g.tagName.toLowerCase())}}class E extends w{constructor(g,y,x,S){super(g,y,x),this.wrapper.insertAdjacentHTML("afterbegin",'<div class="stf__block"></div>'),this.distElement=g.querySelector(".stf__block"),this.items=S;for(const I of S)this.distElement.appendChild(I);this.setHandlers()}clear(){for(const g of this.items)this.parentElement.appendChild(g)}updateItems(g){this.removeHandlers(),this.distElement.innerHTML="";for(const y of g)this.distElement.appendChild(y);this.items=g,this.setHandlers()}update(){this.app.getRender().update()}}class A extends w{constructor(g,y,x){super(g,y,x),this.wrapper.innerHTML='<canvas class="stf__canvas"></canvas>',this.canvas=g.querySelectorAll("canvas")[0],this.distElement=this.canvas,this.resizeCanvas(),this.setHandlers()}resizeCanvas(){const g=getComputedStyle(this.canvas),y=parseInt(g.getPropertyValue("width"),10),x=parseInt(g.getPropertyValue("height"),10);this.canvas.width=y,this.canvas.height=x}getCanvas(){return this.canvas}update(){this.resizeCanvas(),this.app.getRender().update()}}class T extends f{constructor(g,y,x){super(g,y),this.outerShadow=null,this.innerShadow=null,this.hardShadow=null,this.hardInnerShadow=null,this.element=x,this.createShadows()}createShadows(){this.element.insertAdjacentHTML("beforeend",`<div class="stf__outerShadow"></div>
             <div class="stf__innerShadow"></div>
             <div class="stf__hardShadow"></div>
             <div class="stf__hardInnerShadow"></div>`),this.outerShadow=this.element.querySelector(".stf__outerShadow"),this.innerShadow=this.element.querySelector(".stf__innerShadow"),this.hardShadow=this.element.querySelector(".stf__hardShadow"),this.hardInnerShadow=this.element.querySelector(".stf__hardInnerShadow")}clearShadow(){super.clearShadow(),this.outerShadow.style.cssText="display: none",this.innerShadow.style.cssText="display: none",this.hardShadow.style.cssText="display: none",this.hardInnerShadow.style.cssText="display: none"}reload(){this.element.querySelector(".stf__outerShadow")||this.createShadows()}drawHardInnerShadow(){const g=this.getRect(),y=this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress;let x=(100-y)*(2.5*g.pageWidth)/100+20;x>g.pageWidth&&(x=g.pageWidth);let S=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+5).toString(10)};
            width: ${x}px;
            height: ${g.height}px;
            background: linear-gradient(to right,
                rgba(0, 0, 0, ${this.shadow.opacity*y/100}) 5%,
                rgba(0, 0, 0, 0) 100%);
            left: ${g.left+g.width/2}px;
            transform-origin: 0 0;
        `;S+=this.getDirection()===0&&this.shadow.progress>100||this.getDirection()===1&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0);":"transform: translate3d(0, 0, 0) rotateY(180deg);",this.hardInnerShadow.style.cssText=S}drawHardOuterShadow(){const g=this.getRect();let y=(100-(this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress))*(2.5*g.pageWidth)/100+20;y>g.pageWidth&&(y=g.pageWidth);let x=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+4).toString(10)};
            width: ${y}px;
            height: ${g.height}px;
            background: linear-gradient(to left, rgba(0, 0, 0, ${this.shadow.opacity}) 5%, rgba(0, 0, 0, 0) 100%);
            left: ${g.left+g.width/2}px;
            transform-origin: 0 0;
        `;x+=this.getDirection()===0&&this.shadow.progress>100||this.getDirection()===1&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0) rotateY(180deg);":"transform: translate3d(0, 0, 0);",this.hardShadow.style.cssText=x}drawInnerShadow(){const g=this.getRect(),y=3*this.shadow.width/4,x=this.getDirection()===0?y:0,S=this.getDirection()===0?"to left":"to right",I=this.convertToGlobal(this.shadow.pos),P=this.shadow.angle+3*Math.PI/2,N=[this.pageRect.topLeft,this.pageRect.topRight,this.pageRect.bottomRight,this.pageRect.bottomLeft];let M="polygon( ";for(const L of N){let j=this.getDirection()===1?{x:-L.x+this.shadow.pos.x,y:L.y-this.shadow.pos.y}:{x:L.x-this.shadow.pos.x,y:L.y-this.shadow.pos.y};j=a.GetRotatedPoint(j,{x,y:100},P),M+=j.x+"px "+j.y+"px, "}M=M.slice(0,-2),M+=")";const V=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${y}px;
            height: ${2*g.height}px;
            background: linear-gradient(${S},
                rgba(0, 0, 0, ${this.shadow.opacity}) 5%,
                rgba(0, 0, 0, 0.05) 15%,
                rgba(0, 0, 0, ${this.shadow.opacity}) 35%,
                rgba(0, 0, 0, 0) 100%);
            transform-origin: ${x}px 100px;
            transform: translate3d(${I.x-x}px, ${I.y-100}px, 0) rotate(${P}rad);
            clip-path: ${M};
            -webkit-clip-path: ${M};
        `;this.innerShadow.style.cssText=V}drawOuterShadow(){const g=this.getRect(),y=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),x=this.shadow.angle+3*Math.PI/2,S=this.getDirection()===1?this.shadow.width:0,I=this.getDirection()===0?"to right":"to left",P=[{x:0,y:0},{x:g.pageWidth,y:0},{x:g.pageWidth,y:g.height},{x:0,y:g.height}];let N="polygon( ";for(const V of P)if(V!==null){let L=this.getDirection()===1?{x:-V.x+this.shadow.pos.x,y:V.y-this.shadow.pos.y}:{x:V.x-this.shadow.pos.x,y:V.y-this.shadow.pos.y};L=a.GetRotatedPoint(L,{x:S,y:100},x),N+=L.x+"px "+L.y+"px, "}N=N.slice(0,-2),N+=")";const M=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${this.shadow.width}px;
            height: ${2*g.height}px;
            background: linear-gradient(${I}, rgba(0, 0, 0, ${this.shadow.opacity}), rgba(0, 0, 0, 0));
            transform-origin: ${S}px 100px;
            transform: translate3d(${y.x-S}px, ${y.y-100}px, 0) rotate(${x}rad);
            clip-path: ${N};
            -webkit-clip-path: ${N};
        `;this.outerShadow.style.cssText=M}drawLeftPage(){this.orientation!=="portrait"&&this.leftPage!==null&&(this.direction===1&&this.flippingPage!==null&&this.flippingPage.getDrawingDensity()==="hard"?(this.leftPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.leftPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.leftPage.draw(this.flippingPage.getDrawingDensity())):this.leftPage.simpleDraw(0))}drawRightPage(){this.rightPage!==null&&(this.direction===0&&this.flippingPage!==null&&this.flippingPage.getDrawingDensity()==="hard"?(this.rightPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.rightPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.rightPage.draw(this.flippingPage.getDrawingDensity())):this.rightPage.simpleDraw(1))}drawBottomPage(){if(this.bottomPage===null)return;const g=this.flippingPage!=null?this.flippingPage.getDrawingDensity():null;this.orientation==="portrait"&&this.direction===1||(this.bottomPage.getElement().style.zIndex=(this.getSettings().startZIndex+3).toString(10),this.bottomPage.draw(g))}drawFrame(){this.clear(),this.drawLeftPage(),this.drawRightPage(),this.drawBottomPage(),this.flippingPage!=null&&(this.flippingPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.flippingPage.draw()),this.shadow!=null&&this.flippingPage!==null&&(this.flippingPage.getDrawingDensity()==="soft"?(this.drawOuterShadow(),this.drawInnerShadow()):(this.drawHardOuterShadow(),this.drawHardInnerShadow()))}clear(){for(const g of this.app.getPageCollection().getPages())g!==this.leftPage&&g!==this.rightPage&&g!==this.flippingPage&&g!==this.bottomPage&&(g.getElement().style.cssText="display: none"),g.getTemporaryCopy()!==this.flippingPage&&g.hideTemporaryCopy()}update(){super.update(),this.rightPage!==null&&this.rightPage.setOrientation(1),this.leftPage!==null&&this.leftPage.setOrientation(0)}}class _{constructor(){this._default={startPage:0,size:"fixed",width:0,height:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,drawShadow:!0,flippingTime:1e3,usePortrait:!0,startZIndex:0,autoSize:!0,maxShadowOpacity:1,showCover:!1,mobileScrollSupport:!0,swipeDistance:30,clickEventForward:!0,useMouseEvents:!0,showPageCorners:!0,disableFlipByClick:!1}}getSettings(g){const y=this._default;if(Object.assign(y,g),y.size!=="stretch"&&y.size!=="fixed")throw new Error('Invalid size type. Available only "fixed" and "stretch" value');if(y.width<=0||y.height<=0)throw new Error("Invalid width or height");if(y.flippingTime<=0)throw new Error("Invalid flipping time");return y.size==="stretch"?(y.minWidth<=0&&(y.minWidth=100),y.maxWidth<y.minWidth&&(y.maxWidth=2e3),y.minHeight<=0&&(y.minHeight=100),y.maxHeight<y.minHeight&&(y.maxHeight=2e3)):(y.minWidth=y.width,y.maxWidth=y.width,y.minHeight=y.height,y.maxHeight=y.height),y}}(function(b,g){g===void 0&&(g={});var y=g.insertAt;if(typeof document<"u"){var x=document.head||document.getElementsByTagName("head")[0],S=document.createElement("style");S.type="text/css",y==="top"&&x.firstChild?x.insertBefore(S,x.firstChild):x.appendChild(S),S.styleSheet?S.styleSheet.cssText=b:S.appendChild(document.createTextNode(b))}})(`.stf__parent {
  position: relative;
  display: block;
  box-sizing: border-box;
  transform: translateZ(0);

  -ms-touch-action: pan-y;
  touch-action: pan-y;
}

.sft__wrapper {
  position: relative;
  width: 100%;
  box-sizing: border-box;
}

.stf__parent canvas {
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
}

.stf__block {
  position: absolute;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  perspective: 2000px;
}

.stf__item {
  display: none;
  position: absolute;
  transform-style: preserve-3d;
}

.stf__outerShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__innerShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__hardShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__hardInnerShadow {
  position: absolute;
  left: 0;
  top: 0;
}`),t.PageFlip=class extends class{constructor(){this.events=new Map}on(b,g){return this.events.has(b)?this.events.get(b).push(g):this.events.set(b,[g]),this}off(b){this.events.delete(b)}trigger(b,g,y=null){if(this.events.has(b))for(const x of this.events.get(b))x({data:y,object:g})}}{constructor(b,g){super(),this.isUserTouch=!1,this.isUserMove=!1,this.setting=null,this.pages=null,this.setting=new _().getSettings(g),this.block=b}destroy(){this.ui.destroy(),this.block.remove()}update(){this.render.update(),this.pages.show()}loadFromImages(b){this.ui=new A(this.block,this,this.setting);const g=this.ui.getCanvas();this.render=new v(this,this.setting,g),this.flipController=new h(this.render,this),this.pages=new o(this,this.render,b),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}loadFromHTML(b){this.ui=new E(this.block,this,this.setting,b),this.render=new T(this,this.setting,this.ui.getDistElement()),this.flipController=new h(this.render,this),this.pages=new c(this,this.render,this.ui.getDistElement(),b),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}updateFromImages(b){const g=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new o(this,this.render,b),this.pages.load(),this.pages.show(g),this.trigger("update",this,{page:g,mode:this.render.getOrientation()})}updateFromHtml(b){const g=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new c(this,this.render,this.ui.getDistElement(),b),this.pages.load(),this.ui.updateItems(b),this.render.reload(),this.pages.show(g),this.trigger("update",this,{page:g,mode:this.render.getOrientation()})}clear(){this.pages.destroy(),this.ui.clear()}turnToPrevPage(){this.pages.showPrev()}turnToNextPage(){this.pages.showNext()}turnToPage(b){this.pages.show(b)}flipNext(b="top"){this.flipController.flipNext(b)}flipPrev(b="top"){this.flipController.flipPrev(b)}flip(b,g="top"){this.flipController.flipToPage(b,g)}updateState(b){this.trigger("changeState",this,b)}updatePageIndex(b){this.trigger("flip",this,b)}updateOrientation(b){this.ui.setOrientationStyle(b),this.update(),this.trigger("changeOrientation",this,b)}getPageCount(){return this.pages.getPageCount()}getCurrentPageIndex(){return this.pages.getCurrentPageIndex()}getPage(b){return this.pages.getPage(b)}getRender(){return this.render}getFlipController(){return this.flipController}getOrientation(){return this.render.getOrientation()}getBoundsRect(){return this.render.getRect()}getSettings(){return this.setting}getUI(){return this.ui}getState(){return this.flipController.getState()}getPageCollection(){return this.pages}startUserTouch(b){this.mousePosition=b,this.isUserTouch=!0,this.isUserMove=!1}userMove(b,g){this.isUserTouch||g||!this.setting.showPageCorners?this.isUserTouch&&a.GetDistanceBetweenTwoPoint(this.mousePosition,b)>5&&(this.isUserMove=!0,this.flipController.fold(b)):this.flipController.showCorner(b)}userStop(b,g=!1){this.isUserTouch&&(this.isUserTouch=!1,g||(this.isUserMove?this.flipController.stopMove():this.flipController.flip(b)))}},Object.defineProperty(t,"__esModule",{value:!0})})})(Ex,Ex.exports);var oJ=Ex.exports;const aJ=m.forwardRef((n,e)=>{const t=D.useRef(null),r=D.useRef([]),i=D.useRef(),[s,o]=D.useState([]);D.useImperativeHandle(e,()=>({pageFlip:()=>i.current}));const a=D.useCallback(()=>{i.current&&i.current.clear()},[]),l=D.useCallback(()=>{const c=i.current;c&&(c.off("flip"),c.off("changeOrientation"),c.off("changeState"),c.off("init"),c.off("update"))},[]);return D.useEffect(()=>{if(r.current=[],n.children){const c=m.Children.map(n.children,u=>m.cloneElement(u,{ref:h=>{h&&r.current.push(h)}}));(!n.renderOnlyPageLengthChange||s.length!==c.length)&&(c.length<s.length&&a(),o(c))}},[n.children]),D.useEffect(()=>{const c=()=>{const u=i.current;u&&(n.onFlip&&u.on("flip",h=>n.onFlip(h)),n.onChangeOrientation&&u.on("changeOrientation",h=>n.onChangeOrientation(h)),n.onChangeState&&u.on("changeState",h=>n.onChangeState(h)),n.onInit&&u.on("init",h=>n.onInit(h)),n.onUpdate&&u.on("update",h=>n.onUpdate(h)))};s.length>0&&r.current.length>0&&(l(),t.current&&!i.current&&(i.current=new oJ.PageFlip(t.current,n)),i.current.getFlipController()?i.current.updateFromHtml(r.current):i.current.loadFromHTML(r.current),c())},[s]),m.createElement("div",{ref:t,className:n.className,style:n.style},s)}),b3=m.memo(aJ),Ri=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),bx=[.001,0,0,.001,0,0],yT=1.35,Cs={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Da={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},_3="pdfjs_internal_editor_",mt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},Ot={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},S3={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ai={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},av={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Jn={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},qf={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Q0={ERRORS:0,WARNINGS:1,INFOS:5},jv={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},HE={moveTo:0,lineTo:1,curveTo:2,closePath:3},A3={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let VA=Q0.WARNINGS;function lJ(n){Number.isInteger(n)&&(VA=n)}function cJ(){return VA}function UA(n){VA>=Q0.INFOS&&console.log(`Info: ${n}`)}function wt(n){VA>=Q0.WARNINGS&&console.log(`Warning: ${n}`)}function hn(n){throw new Error(n)}function fr(n,e){n||hn(e)}function uJ(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function uk(n,e=null,t=null){if(!n)return null;if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const i=n.match(/\./g);(i==null?void 0:i.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=mJ(n)}catch{}}const r=e?URL.parse(n,e):URL.parse(n);return uJ(r)?r:null}function dk(n,e,t=!1){const r=URL.parse(n);return r?(r.hash=e,r.href):t&&uk(n,"http://example.com")?n.split("#",1)[0]+`${e?`#${e}`:""}`:""}function Dt(n,e,t,r=!1){return Object.defineProperty(n,e,{value:t,enumerable:!r,configurable:!0,writable:!1}),t}const _f=function(){function e(t,r){this.message=t,this.name=r}return e.prototype=new Error,e.constructor=e,e}();class RN extends _f{constructor(e,t){super(e,"PasswordException"),this.code=t}}class vT extends _f{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class vS extends _f{constructor(e){super(e,"InvalidPDFException")}}class zv extends _f{constructor(e,t,r){super(e,"ResponseException"),this.status=t,this.missing=r}}class dJ extends _f{constructor(e){super(e,"FormatError")}}class oc extends _f{constructor(e){super(e,"AbortException")}}function T3(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&hn("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const r=[];for(let i=0;i<e;i+=t){const s=Math.min(i+t,e),o=n.subarray(i,s);r.push(String.fromCharCode.apply(null,o))}return r.join("")}function X0(n){typeof n!="string"&&hn("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let r=0;r<e;++r)t[r]=n.charCodeAt(r)&255;return t}function hJ(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function fJ(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function pJ(){try{return new Function(""),!0}catch{return!1}}class Ur{static get isLittleEndian(){return Dt(this,"isLittleEndian",fJ())}static get isEvalSupported(){return Dt(this,"isEvalSupported",pJ())}static get isOffscreenCanvasSupported(){return Dt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Dt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return Dt(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return Dt(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const wT=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var Yl,Fb,_x;class Ke{static makeHexColor(e,t,r){return`#${wT[e]}${wT[t]}${wT[r]}`}static scaleMinMax(e,t){let r;e[0]?(e[0]<0&&(r=t[0],t[0]=t[2],t[2]=r),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(r=t[1],t[1]=t[3],t[3]=r),t[1]*=e[3],t[3]*=e[3]):(r=t[0],t[0]=t[1],t[1]=r,r=t[2],t[2]=t[3],t[3]=r,e[1]<0&&(r=t[1],t[1]=t[3],t[3]=r),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(r=t[0],t[0]=t[2],t[2]=r),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t,r=0){const i=e[r],s=e[r+1];e[r]=i*t[0]+s*t[2]+t[4],e[r+1]=i*t[1]+s*t[3]+t[5]}static applyTransformToBezier(e,t,r=0){const i=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<6;u+=2){const h=e[r+u],f=e[r+u+1];e[r+u]=h*i+f*o+l,e[r+u+1]=h*s+f*a+c}}static applyInverseTransform(e,t){const r=e[0],i=e[1],s=t[0]*t[3]-t[1]*t[2];e[0]=(r*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/s,e[1]=(-r*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/s}static axialAlignedBoundingBox(e,t,r){const i=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5],u=e[0],h=e[1],f=e[2],v=e[3];let w=i*u+l,E=w,A=i*f+l,T=A,_=a*h+c,b=_,g=a*v+c,y=g;if(s!==0||o!==0){const x=s*u,S=s*f,I=o*h,P=o*v;w+=I,T+=I,A+=P,E+=P,_+=x,y+=x,g+=S,b+=S}r[0]=Math.min(r[0],w,A,E,T),r[1]=Math.min(r[1],_,g,b,y),r[2]=Math.max(r[2],w,A,E,T),r[3]=Math.max(r[3],_,g,b,y)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const r=e[0],i=e[1],s=e[2],o=e[3],a=r**2+i**2,l=r*s+i*o,c=s**2+o**2,u=(a+c)/2,h=Math.sqrt(u**2-(a*c-l**2));t[0]=Math.sqrt(u+h||1),t[1]=Math.sqrt(u-h||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const r=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(r>i)return null;const s=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return s>o?null:[r,s,i,o]}static pointBoundingBox(e,t,r){r[0]=Math.min(r[0],e),r[1]=Math.min(r[1],t),r[2]=Math.max(r[2],e),r[3]=Math.max(r[3],t)}static rectBoundingBox(e,t,r,i,s){s[0]=Math.min(s[0],e,r),s[1]=Math.min(s[1],t,i),s[2]=Math.max(s[2],e,r),s[3]=Math.max(s[3],t,i)}static bezierBoundingBox(e,t,r,i,s,o,a,l,c){c[0]=Math.min(c[0],e,a),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,a),c[3]=Math.max(c[3],t,l),F(this,Yl,_x).call(this,e,r,s,a,t,i,o,l,3*(-e+3*(r-s)+a),6*(e-2*r+s),3*(r-e),c),F(this,Yl,_x).call(this,e,r,s,a,t,i,o,l,3*(-t+3*(i-o)+l),6*(t-2*i+o),3*(i-t),c)}}Yl=new WeakSet,Fb=function(e,t,r,i,s,o,a,l,c,u){if(c<=0||c>=1)return;const h=1-c,f=c*c,v=f*c,w=h*(h*(h*e+3*c*t)+3*f*r)+v*i,E=h*(h*(h*s+3*c*o)+3*f*a)+v*l;u[0]=Math.min(u[0],w),u[1]=Math.min(u[1],E),u[2]=Math.max(u[2],w),u[3]=Math.max(u[3],E)},_x=function(e,t,r,i,s,o,a,l,c,u,h,f){if(Math.abs(c)<1e-12){Math.abs(u)>=1e-12&&F(this,Yl,Fb).call(this,e,t,r,i,s,o,a,l,-h/u,f);return}const v=u**2-4*h*c;if(v<0)return;const w=Math.sqrt(v),E=2*c;F(this,Yl,Fb).call(this,e,t,r,i,s,o,a,l,(-u+w)/E,f),F(this,Yl,Fb).call(this,e,t,r,i,s,o,a,l,(-u-w)/E,f)},O(Ke,Yl);function mJ(n){return decodeURIComponent(escape(n))}let ET=null,kN=null;function I3(n){return ET||(ET=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,kN=new Map([["ï¬…","Å¿t"]])),n.replaceAll(ET,(e,t,r)=>t?t.normalize("NFKC"):kN.get(r))}function hk(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),T3(n)}const fk="pdfjs_internal_id_";function gJ(n,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[r,i,...s]=t;if(!n(r)&&!Number.isInteger(r)||!e(i))return!1;const o=s.length;let a=!0;switch(i.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;a=!1;break;default:return!1}for(const l of s)if(!(typeof l=="number"||a&&l===null))return!1;return!0}function hi(n,e,t){return Math.min(Math.max(n,e),t)}function x3(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(T3(n))}function yJ(n){return Uint8Array.fromBase64?Uint8Array.fromBase64(n):X0(atob(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(n){return n.reduce((e,t)=>e+t,0)});const nl="http://www.w3.org/2000/svg",Rd=class Rd{};ge(Rd,"CSS",96),ge(Rd,"PDF",72),ge(Rd,"PDF_TO_CSS_UNITS",Rd.CSS/Rd.PDF);let ac=Rd;async function Cg(n,e="text"){if(by(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,r)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}r(new Error(i.statusText))}},i.send(null)})}class J0{constructor({viewBox:e,userUnit:t,scale:r,rotation:i,offsetX:s=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=r,this.rotation=i,this.offsetX=s,this.offsetY=o,r*=t;const l=(e[2]+e[0])/2,c=(e[3]+e[1])/2;let u,h,f,v;switch(i%=360,i<0&&(i+=360),i){case 180:u=-1,h=0,f=0,v=1;break;case 90:u=0,h=1,f=1,v=0;break;case 270:u=0,h=-1,f=-1,v=0;break;case 0:u=1,h=0,f=0,v=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(f=-f,v=-v);let w,E,A,T;u===0?(w=Math.abs(c-e[1])*r+s,E=Math.abs(l-e[0])*r+o,A=(e[3]-e[1])*r,T=(e[2]-e[0])*r):(w=Math.abs(l-e[0])*r+s,E=Math.abs(c-e[1])*r+o,A=(e[2]-e[0])*r,T=(e[3]-e[1])*r),this.transform=[u*r,h*r,f*r,v*r,w-u*r*l-f*r*c,E-h*r*l-v*r*c],this.width=A,this.height=T}get rawDims(){const e=this.viewBox;return Dt(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:r=this.offsetX,offsetY:i=this.offsetY,dontFlip:s=!1}={}){return new J0({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:r,offsetY:i,dontFlip:s})}convertToViewportPoint(e,t){const r=[e,t];return Ke.applyTransform(r,this.transform),r}convertToViewportRectangle(e){const t=[e[0],e[1]];Ke.applyTransform(t,this.transform);const r=[e[2],e[3]];return Ke.applyTransform(r,this.transform),[t[0],t[1],r[0],r[1]]}convertToPdfPoint(e,t){const r=[e,t];return Ke.applyInverseTransform(r,this.transform),r}}class BA extends _f{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Z0(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function $A(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function C3(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function P3(n,e="document.pdf"){if(typeof n!="string")return e;if(Z0(n))return wt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const r=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(n);if(!r)return e;const i=a=>{try{let l=decodeURIComponent(a);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:a):l}catch{return a}},s=/\.pdf$/i,o=r.pathname.split("/").at(-1);if(s.test(o))return i(o);if(r.searchParams.size>0){const a=Array.from(r.searchParams.values()).reverse();for(const c of a)if(s.test(c))return i(c);const l=Array.from(r.searchParams.keys()).reverse();for(const c of l)if(s.test(c))return i(c)}if(r.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(r.hash);if(l)return i(l[0])}return e}class DN{constructor(){ge(this,"started",Object.create(null));ge(this,"times",[])}time(e){e in this.started&&wt(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||wt(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:r}of this.times)t=Math.max(r.length,t);for(const{name:r,start:i,end:s}of this.times)e.push(`${r.padEnd(t)} ${s-i}ms
`);return e.join("")}}function by(n,e){const t=e?URL.parse(n,e):URL.parse(n);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function vo(n){n.preventDefault()}function tr(n){n.preventDefault(),n.stopPropagation()}function vJ(n){console.log("Deprecated API usage: "+n)}var Jv;class jA{static toDateObject(e){if(!e||typeof e!="string")return null;d(this,Jv)||R(this,Jv,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=d(this,Jv).exec(e);if(!t)return null;const r=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let s=parseInt(t[3],10);s=s>=1&&s<=31?s:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const c=t[7]||"Z";let u=parseInt(t[8],10);u=u>=0&&u<=23?u:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,c==="-"?(o+=u,a+=h):c==="+"&&(o-=u,a-=h),new Date(Date.UTC(r,i,s,o,a,l))}}Jv=new WeakMap,O(jA,Jv);function R3(n,{scale:e=1,rotation:t=0}){const{width:r,height:i}=n.attributes.style,s=[0,0,parseInt(r),parseInt(i)];return new J0({viewBox:s,userUnit:1,scale:e,rotation:t})}function pk(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(wt(`Not a valid color format: "${n}"`),[0,0,0])}function wJ(n){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of n.keys()){e.style.color=t;const r=window.getComputedStyle(e).color;n.set(t,pk(r))}e.remove()}function Fn(n){const{a:e,b:t,c:r,d:i,e:s,f:o}=n.getTransform();return[e,t,r,i,s,o]}function oa(n){const{a:e,b:t,c:r,d:i,e:s,f:o}=n.getTransform().invertSelf();return[e,t,r,i,s,o]}function qu(n,e,t=!1,r=!0){if(e instanceof J0){const{pageWidth:i,pageHeight:s}=e.rawDims,{style:o}=n,a=Ur.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,c=`var(--total-scale-factor) * ${s}px`,u=a?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,h=a?`round(down, ${c}, var(--scale-round-y))`:`calc(${c})`;!t||e.rotation%180===0?(o.width=u,o.height=h):(o.width=h,o.height=u)}r&&n.setAttribute("data-main-rotation",e.rotation)}class Qo{constructor(){const{pixelRatio:e}=Qo;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,r,i,s=-1){let o=1/0,a=1/0,l=1/0;r=Qo.capPixels(r,s),r>0&&(o=Math.sqrt(r/(e*t))),i!==-1&&(a=i/e,l=i/t);const c=Math.min(o,a,l);return this.sx>c||this.sy>c?(this.sx=c,this.sy=c,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const r=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,r):r}return e}}const wS=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var Vc,Fd,eo,Uc,Zv,Np,ew,kS,k3,Mi,D3,M3,_y,Vb;const ll=class ll{constructor(e){O(this,Mi);O(this,Vc,null);O(this,Fd,null);O(this,eo);O(this,Uc,null);O(this,Zv,null);O(this,Np,null);R(this,eo,e),d(ll,ew)||R(ll,ew,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=R(this,Vc,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=d(this,eo)._uiManager._signal;e.addEventListener("contextmenu",vo,{signal:t}),e.addEventListener("pointerdown",F(ll,kS,k3),{signal:t});const r=R(this,Uc,document.createElement("div"));r.className="buttons",e.append(r);const i=d(this,eo).toolbarPosition;if(i){const{style:s}=e,o=d(this,eo)._uiManager.direction==="ltr"?1-i[0]:i[0];s.insetInlineEnd=`${100*o}%`,s.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return d(this,Vc)}hide(){var e;d(this,Vc).classList.add("hidden"),(e=d(this,Fd))==null||e.hideDropdown()}show(){var e;d(this,Vc).classList.remove("hidden"),(e=d(this,Zv))==null||e.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=d(this,eo),r=document.createElement("button");r.className="delete",r.tabIndex=0,r.setAttribute("data-l10n-id",d(ll,ew)[e]),F(this,Mi,_y).call(this,r),r.addEventListener("click",i=>{t.delete()},{signal:t._signal}),d(this,Uc).append(r)}async addAltText(e){const t=await e.render();F(this,Mi,_y).call(this,t),d(this,Uc).append(t,d(this,Mi,Vb)),R(this,Zv,e)}addColorPicker(e){R(this,Fd,e);const t=e.renderButton();F(this,Mi,_y).call(this,t),d(this,Uc).append(t,d(this,Mi,Vb))}async addEditSignatureButton(e){const t=R(this,Np,await e.renderEditButton(d(this,eo)));F(this,Mi,_y).call(this,t),d(this,Uc).append(t,d(this,Mi,Vb))}async addButton(e,t){switch(e){case"colorPicker":this.addColorPicker(t);break;case"altText":await this.addAltText(t);break;case"editSignature":await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break}}updateEditSignatureButton(e){d(this,Np)&&(d(this,Np).title=e)}remove(){var e;d(this,Vc).remove(),(e=d(this,Fd))==null||e.destroy(),R(this,Fd,null)}};Vc=new WeakMap,Fd=new WeakMap,eo=new WeakMap,Uc=new WeakMap,Zv=new WeakMap,Np=new WeakMap,ew=new WeakMap,kS=new WeakSet,k3=function(e){e.stopPropagation()},Mi=new WeakSet,D3=function(e){d(this,eo)._focusEventsAllowed=!1,tr(e)},M3=function(e){d(this,eo)._focusEventsAllowed=!0,tr(e)},_y=function(e){const t=d(this,eo)._uiManager._signal;e.addEventListener("focusin",F(this,Mi,D3).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",F(this,Mi,M3).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",vo,{signal:t})},Vb=function(){const e=document.createElement("div");return e.className="divider",e},O(ll,kS),O(ll,ew,null);let Sx=ll;var tw,Vd,Ud,Yu,N3,L3,O3;class EJ{constructor(e){O(this,Yu);O(this,tw,null);O(this,Vd,null);O(this,Ud);R(this,Ud,e)}show(e,t,r){const[i,s]=F(this,Yu,L3).call(this,t,r),{style:o}=d(this,Vd)||R(this,Vd,F(this,Yu,N3).call(this));e.append(d(this,Vd)),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){d(this,Vd).remove()}}tw=new WeakMap,Vd=new WeakMap,Ud=new WeakMap,Yu=new WeakSet,N3=function(){const e=R(this,Vd,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",vo,{signal:d(this,Ud)._signal});const t=R(this,tw,document.createElement("div"));return t.className="buttons",e.append(t),F(this,Yu,O3).call(this),e},L3=function(e,t){let r=0,i=0;for(const s of e){const o=s.y+s.height;if(o<r)continue;const a=s.x+(t?s.width:0);if(o>r){i=a,r=o;continue}t?a>i&&(i=a):a<i&&(i=a)}return[t?1-i:i,r]},O3=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const r=d(this,Ud)._signal;e.addEventListener("contextmenu",vo,{signal:r}),e.addEventListener("click",()=>{d(this,Ud).highlightSelection("floating_button")},{signal:r}),d(this,tw).append(e)};function F3(n,e,t){for(const r of t)e.addEventListener(r,n[r].bind(n))}var DS;class bJ{constructor(){O(this,DS,0)}get id(){return`${_3}${Si(this,DS)._++}`}}DS=new WeakMap;var Lp,nw,ci,Op,Ub;const $k=class $k{constructor(){O(this,Op);O(this,Lp,hk());O(this,nw,0);O(this,ci,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',r=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const s=i.decode().then(()=>(r.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(r.getImageData(0,0,1,1).data.buffer)[0]===0));return Dt(this,"_isSVGFittingCanvas",s)}async getFromFile(e){const{lastModified:t,name:r,size:i,type:s}=e;return F(this,Op,Ub).call(this,`${t}_${r}_${i}_${s}`,e)}async getFromUrl(e){return F(this,Op,Ub).call(this,e,e)}async getFromBlob(e,t){const r=await t;return F(this,Op,Ub).call(this,e,r)}async getFromId(e){d(this,ci)||R(this,ci,new Map);const t=d(this,ci).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:r}=t;return delete t.blobPromise,this.getFromBlob(t.id,r)}return this.getFromUrl(t.url)}getFromCanvas(e,t){d(this,ci)||R(this,ci,new Map);let r=d(this,ci).get(e);if(r!=null&&r.bitmap)return r.refCounter+=1,r;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),r={bitmap:i.transferToImageBitmap(),id:`image_${d(this,Lp)}_${Si(this,nw)._++}`,refCounter:1,isSvg:!1},d(this,ci).set(e,r),d(this,ci).set(r.id,r),r}getSvgUrl(e){const t=d(this,ci).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;d(this,ci)||R(this,ci,new Map);const t=d(this,ci).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:r}=t;if(!t.url&&!t.file){const s=new OffscreenCanvas(r.width,r.height);s.getContext("bitmaprenderer").transferFromImageBitmap(r),t.blobPromise=s.convertToBlob()}(i=r.close)==null||i.call(r),t.bitmap=null}isValidId(e){return e.startsWith(`image_${d(this,Lp)}_`)}};Lp=new WeakMap,nw=new WeakMap,ci=new WeakMap,Op=new WeakSet,Ub=async function(e,t){d(this,ci)||R(this,ci,new Map);let r=d(this,ci).get(e);if(r===null)return null;if(r!=null&&r.bitmap)return r.refCounter+=1,r;try{r||(r={bitmap:null,id:`image_${d(this,Lp)}_${Si(this,nw)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(r.url=t,i=await Cg(t,"blob")):t instanceof File?i=r.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const s=$k._isSVGFittingCanvas,o=new FileReader,a=new Image,l=new Promise((c,u)=>{a.onload=()=>{r.bitmap=a,r.isSvg=!0,c()},o.onload=async()=>{const h=r.svgUrl=o.result;a.src=await s?`${h}#svgView(preserveAspectRatio(none))`:h},a.onerror=o.onerror=u});o.readAsDataURL(i),await l}else r.bitmap=await createImageBitmap(i);r.refCounter=1}catch(i){wt(i),r=null}return d(this,ci).set(e,r),r&&d(this,ci).set(r.id,r),r};let Ax=$k;var Zn,Bc,rw,On;class _J{constructor(e=128){O(this,Zn,[]);O(this,Bc,!1);O(this,rw);O(this,On,-1);R(this,rw,e)}add({cmd:e,undo:t,post:r,mustExec:i,type:s=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(i&&e(),d(this,Bc))return;const l={cmd:e,undo:t,post:r,type:s};if(d(this,On)===-1){d(this,Zn).length>0&&(d(this,Zn).length=0),R(this,On,0),d(this,Zn).push(l);return}if(o&&d(this,Zn)[d(this,On)].type===s){a&&(l.undo=d(this,Zn)[d(this,On)].undo),d(this,Zn)[d(this,On)]=l;return}const c=d(this,On)+1;c===d(this,rw)?d(this,Zn).splice(0,1):(R(this,On,c),c<d(this,Zn).length&&d(this,Zn).splice(c)),d(this,Zn).push(l)}undo(){if(d(this,On)===-1)return;R(this,Bc,!0);const{undo:e,post:t}=d(this,Zn)[d(this,On)];e(),t==null||t(),R(this,Bc,!1),R(this,On,d(this,On)-1)}redo(){if(d(this,On)<d(this,Zn).length-1){R(this,On,d(this,On)+1),R(this,Bc,!0);const{cmd:e,post:t}=d(this,Zn)[d(this,On)];e(),t==null||t(),R(this,Bc,!1)}}hasSomethingToUndo(){return d(this,On)!==-1}hasSomethingToRedo(){return d(this,On)<d(this,Zn).length-1}cleanType(e){if(d(this,On)!==-1){for(let t=d(this,On);t>=0;t--)if(d(this,Zn)[t].type!==e){d(this,Zn).splice(t+1,d(this,On)-t),R(this,On,t);return}d(this,Zn).length=0,R(this,On,-1)}}destroy(){R(this,Zn,null)}}Zn=new WeakMap,Bc=new WeakMap,rw=new WeakMap,On=new WeakMap;var MS,V3;class eE{constructor(e){O(this,MS);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Ur.platform;for(const[r,i,s={}]of e)for(const o of r){const a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:i,options:s}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:i,options:s}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const r=this.callbacks.get(F(this,MS,V3).call(this,t));if(!r)return;const{callback:i,options:{bubbles:s=!1,args:o=[],checker:a=null}}=r;a&&!a(e,t)||(i.bind(e,...o,t)(),s||tr(t))}}MS=new WeakSet,V3=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const NS=class NS{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return wJ(e),Dt(this,"_colors",e)}convert(e){const t=pk(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[r,i]of this._colors)if(i.every((s,o)=>s===t[o]))return NS._colorsMapping.get(r);return t}getHexCode(e){const t=this._colors.get(e);return t?Ke.makeHexColor(...t):e}};ge(NS,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Tx=NS;var Fp,ps,vr,zr,Vp,dl,Up,to,$c,jc,Bp,Bd,pa,xo,$d,iw,sw,$p,ow,ma,zc,jp,Hc,ga,LS,Gc,aw,Wc,jd,zd,qc,lw,Cr,Zt,hl,Kc,Hd,cw,uw,Yc,ya,fl,dw,hw,no,Ie,Bb,Ix,U3,B3,$b,$3,j3,z3,xx,H3,Cx,Px,G3,Ti,rl,W3,q3,Rx,K3,Sy,kx;const vp=class vp{constructor(e,t,r,i,s,o,a,l,c,u,h,f,v,w,E){O(this,Ie);O(this,Fp,new AbortController);O(this,ps,null);O(this,vr,new Map);O(this,zr,new Map);O(this,Vp,null);O(this,dl,null);O(this,Up,null);O(this,to,new _J);O(this,$c,null);O(this,jc,null);O(this,Bp,0);O(this,Bd,new Set);O(this,pa,null);O(this,xo,null);O(this,$d,new Set);ge(this,"_editorUndoBar",null);O(this,iw,!1);O(this,sw,!1);O(this,$p,!1);O(this,ow,null);O(this,ma,null);O(this,zc,null);O(this,jp,null);O(this,Hc,!1);O(this,ga,null);O(this,LS,new bJ);O(this,Gc,!1);O(this,aw,!1);O(this,Wc,null);O(this,jd,null);O(this,zd,null);O(this,qc,null);O(this,lw,null);O(this,Cr,mt.NONE);O(this,Zt,new Set);O(this,hl,null);O(this,Kc,null);O(this,Hd,null);O(this,cw,null);O(this,uw,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});O(this,Yc,[0,0]);O(this,ya,null);O(this,fl,null);O(this,dw,null);O(this,hw,null);O(this,no,null);const A=this._signal=d(this,Fp).signal;R(this,fl,e),R(this,dw,t),R(this,hw,r),R(this,Vp,i),R(this,Kc,s),this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:A}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:A}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:A}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:A}),o._on("setpreference",this.onSetPreference.bind(this),{signal:A}),o._on("switchannotationeditorparams",T=>this.updateParams(T.type,T.value),{signal:A}),F(this,Ie,$3).call(this),F(this,Ie,G3).call(this),F(this,Ie,xx).call(this),R(this,dl,a.annotationStorage),R(this,ow,a.filterFactory),R(this,Hd,l),R(this,jp,c||null),R(this,iw,u),R(this,sw,h),R(this,$p,f),R(this,lw,v||null),this.viewParameters={realScale:ac.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=w||null,this._supportsPinchToZoom=E!==!1}static get _keyboardManager(){const e=vp.prototype,t=o=>d(o,fl).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),r=(o,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,s=this.TRANSLATE_BIG;return Dt(this,"_keyboardManager",new eE([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:r}],[["ctrl+z","mac+meta+z"],e.undo,{checker:r}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:r}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:r}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&d(o,fl).contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&d(o,fl).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}]]))}destroy(){var e,t,r,i,s,o,a,l;(e=d(this,no))==null||e.resolve(),R(this,no,null),(t=d(this,Fp))==null||t.abort(),R(this,Fp,null),this._signal=null;for(const c of d(this,zr).values())c.destroy();d(this,zr).clear(),d(this,vr).clear(),d(this,$d).clear(),(r=d(this,qc))==null||r.clear(),R(this,ps,null),d(this,Zt).clear(),d(this,to).destroy(),(i=d(this,Vp))==null||i.destroy(),(s=d(this,Kc))==null||s.destroy(),(o=d(this,ga))==null||o.hide(),R(this,ga,null),(a=d(this,zd))==null||a.destroy(),R(this,zd,null),d(this,ma)&&(clearTimeout(d(this,ma)),R(this,ma,null)),d(this,ya)&&(clearTimeout(d(this,ya)),R(this,ya,null)),(l=this._editorUndoBar)==null||l.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return d(this,lw)}get useNewAltTextFlow(){return d(this,sw)}get useNewAltTextWhenAddingImage(){return d(this,$p)}get hcmFilter(){return Dt(this,"hcmFilter",d(this,Hd)?d(this,ow).addHCMFilter(d(this,Hd).foreground,d(this,Hd).background):"none")}get direction(){return Dt(this,"direction",getComputedStyle(d(this,fl)).direction)}get highlightColors(){return Dt(this,"highlightColors",d(this,jp)?new Map(d(this,jp).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColorNames(){return Dt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),R(this,jc,e)}setMainHighlightColorPicker(e){R(this,zd,e)}editAltText(e,t=!1){var r;(r=d(this,Vp))==null||r.editAltText(this,e,t)}getSignature(e){var t;(t=d(this,Kc))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return d(this,Kc)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":R(this,$p,t);break}}onPageChanging({pageNumber:e}){R(this,Bp,e-1)}focusMainContainer(){d(this,fl).focus()}findParent(e,t){for(const r of d(this,zr).values()){const{x:i,y:s,width:o,height:a}=r.div.getBoundingClientRect();if(e>=i&&e<=i+o&&t>=s&&t<=s+a)return r}return null}disableUserSelect(e=!1){d(this,dw).classList.toggle("noUserSelect",e)}addShouldRescale(e){d(this,$d).add(e)}removeShouldRescale(e){d(this,$d).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*ac.PDF_TO_CSS_UNITS;for(const r of d(this,$d))r.onScaleChanging();(t=d(this,jc))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}=t,a=t.toString(),c=F(this,Ie,Bb).call(this,t).closest(".textLayer"),u=this.getSelectionBoxes(c);if(!u)return;t.empty();const h=F(this,Ie,Ix).call(this,c),f=d(this,Cr)===mt.NONE,v=()=>{h==null||h.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:u,anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o,text:a}),f&&this.showAllEditors("highlight",!0,!0)};if(f){this.switchToMode(mt.HIGHLIGHT,v);return}v()}addToAnnotationStorage(e){!e.isEmpty()&&d(this,dl)&&!d(this,dl).has(e.id)&&d(this,dl).setValue(e.id,e)}a11yAlert(e,t=null){const r=d(this,hw);r&&(r.setAttribute("data-l10n-id",e),t?r.setAttribute("data-l10n-args",JSON.stringify(t)):r.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,d(this,Hc)&&(R(this,Hc,!1),F(this,Ie,$b).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of d(this,Zt))if(t.div.contains(e)){R(this,jd,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!d(this,jd))return;const[e,t]=d(this,jd);R(this,jd,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){F(this,Ie,xx).call(this),F(this,Ie,Cx).call(this)}removeEditListeners(){F(this,Ie,H3).call(this),F(this,Ie,Px).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const r of d(this,xo))if(r.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const r of d(this,xo))if(r.isHandlingMimeForPasting(t.type)){r.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var r;if(e.preventDefault(),(r=d(this,ps))==null||r.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of d(this,Zt)){const s=i.serialize(!0);s&&t.push(s)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const s of t.items)for(const o of d(this,xo))if(o.isHandlingMimeForPasting(s.type)){o.paste(s,this.currentLayer);return}let r=t.getData("application/pdfjs");if(!r)return;try{r=JSON.parse(r)}catch(s){wt(`paste: "${s.message}".`);return}if(!Array.isArray(r))return;this.unselectAll();const i=this.currentLayer;try{const s=[];for(const l of r){const c=await i.deserialize(l);if(!c)return;s.push(c)}const o=()=>{for(const l of s)F(this,Ie,Rx).call(this,l);F(this,Ie,kx).call(this,s)},a=()=>{for(const l of s)l.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(s){wt(`paste: "${s.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),d(this,Cr)!==mt.NONE&&!this.isEditorHandlingKeyboard&&vp._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,d(this,Hc)&&(R(this,Hc,!1),F(this,Ie,$b).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(F(this,Ie,j3).call(this),F(this,Ie,Cx).call(this),F(this,Ie,Ti).call(this,{isEditing:d(this,Cr)!==mt.NONE,isEmpty:F(this,Ie,Sy).call(this),hasSomethingToUndo:d(this,to).hasSomethingToUndo(),hasSomethingToRedo:d(this,to).hasSomethingToRedo(),hasSelectedEditor:!1})):(F(this,Ie,z3).call(this),F(this,Ie,Px).call(this),F(this,Ie,Ti).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!d(this,xo)){R(this,xo,e);for(const t of d(this,xo))F(this,Ie,rl).call(this,t.defaultPropertiesToUpdate)}}getId(){return d(this,LS).id}get currentLayer(){return d(this,zr).get(d(this,Bp))}getLayer(e){return d(this,zr).get(e)}get currentPageIndex(){return d(this,Bp)}addLayer(e){d(this,zr).set(e.pageIndex,e),d(this,Gc)?e.enable():e.disable()}removeLayer(e){d(this,zr).delete(e.pageIndex)}async updateMode(e,t=null,r=!1,i=!1){var s,o,a;if(d(this,Cr)!==e&&!(d(this,no)&&(await d(this,no).promise,!d(this,no)))){if(R(this,no,Promise.withResolvers()),(s=d(this,jc))==null||s.commitOrRemove(),R(this,Cr,e),e===mt.NONE){this.setEditingState(!1),F(this,Ie,q3).call(this),(o=this._editorUndoBar)==null||o.hide(),d(this,no).resolve();return}e===mt.SIGNATURE&&await((a=d(this,Kc))==null?void 0:a.loadSignatures()),this.setEditingState(!0),await F(this,Ie,W3).call(this),this.unselectAll();for(const l of d(this,zr).values())l.updateMode(e);if(!t){r&&this.addNewEditorFromKeyboard(),d(this,no).resolve();return}for(const l of d(this,vr).values())l.annotationElementId===t||l.id===t?(this.setSelected(l),i&&l.enterInEditMode()):l.unselect();d(this,no).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==d(this,Cr)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){var r;if(d(this,xo)){switch(e){case Ot.CREATE:this.currentLayer.addNewEditor(t);return;case Ot.HIGHLIGHT_DEFAULT_COLOR:(r=d(this,zd))==null||r.updateColor(t);break;case Ot.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(d(this,cw)||R(this,cw,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const i of d(this,Zt))i.updateParams(e,t);for(const i of d(this,xo))i.updateDefaultParams(e,t)}}showAllEditors(e,t,r=!1){var s;for(const o of d(this,vr).values())o.editorType===e&&o.show(t);(((s=d(this,cw))==null?void 0:s.get(Ot.HIGHLIGHT_SHOW_ALL))??!0)!==t&&F(this,Ie,rl).call(this,[[Ot.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(d(this,aw)!==e){R(this,aw,e);for(const t of d(this,zr).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const r of d(this,vr).values())r.pageIndex===e&&t.push(r);return t}getEditor(e){return d(this,vr).get(e)}addEditor(e){d(this,vr).set(e.id,e)}removeEditor(e){var t,r;e.div.contains(document.activeElement)&&(d(this,ma)&&clearTimeout(d(this,ma)),R(this,ma,setTimeout(()=>{this.focusMainContainer(),R(this,ma,null)},0))),d(this,vr).delete(e.id),e.annotationElementId&&((t=d(this,qc))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!d(this,Bd).has(e.annotationElementId))&&((r=d(this,dl))==null||r.remove(e.id))}addDeletedAnnotationElement(e){d(this,Bd).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return d(this,Bd).has(e)}removeDeletedAnnotationElement(e){d(this,Bd).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){d(this,ps)!==e&&(R(this,ps,e),e&&F(this,Ie,rl).call(this,e.propertiesToUpdate))}updateUI(e){d(this,Ie,K3)===e&&F(this,Ie,rl).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){F(this,Ie,rl).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(d(this,Zt).has(e)){d(this,Zt).delete(e),e.unselect(),F(this,Ie,Ti).call(this,{hasSelectedEditor:this.hasSelection});return}d(this,Zt).add(e),e.select(),F(this,Ie,rl).call(this,e.propertiesToUpdate),F(this,Ie,Ti).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.id}),(t=d(this,jc))==null||t.commitOrRemove();for(const r of d(this,Zt))r!==e&&r.unselect();d(this,Zt).clear(),d(this,Zt).add(e),e.select(),F(this,Ie,rl).call(this,e.propertiesToUpdate),F(this,Ie,Ti).call(this,{hasSelectedEditor:!0})}isSelected(e){return d(this,Zt).has(e)}get firstSelectedEditor(){return d(this,Zt).values().next().value}unselect(e){e.unselect(),d(this,Zt).delete(e),F(this,Ie,Ti).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return d(this,Zt).size!==0}get isEnterHandled(){return d(this,Zt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;d(this,to).undo(),F(this,Ie,Ti).call(this,{hasSomethingToUndo:d(this,to).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:F(this,Ie,Sy).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){d(this,to).redo(),F(this,Ie,Ti).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:d(this,to).hasSomethingToRedo(),isEmpty:F(this,Ie,Sy).call(this)})}addCommands(e){d(this,to).add(e),F(this,Ie,Ti).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:F(this,Ie,Sy).call(this)})}cleanUndoStack(e){d(this,to).cleanType(e)}delete(){var s;this.commitOrRemove();const e=(s=this.currentLayer)==null?void 0:s.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...d(this,Zt)],r=()=>{var o;(o=this._editorUndoBar)==null||o.show(i,t.length===1?t[0].editorType:t.length);for(const a of t)a.remove()},i=()=>{for(const o of t)F(this,Ie,Rx).call(this,o)};this.addCommands({cmd:r,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=d(this,ps))==null||e.commitOrRemove()}hasSomethingToControl(){return d(this,ps)||this.hasSelection}selectAll(){for(const e of d(this,Zt))e.commit();F(this,Ie,kx).call(this,d(this,vr).values())}unselectAll(){var e;if(!(d(this,ps)&&(d(this,ps).commitOrRemove(),d(this,Cr)!==mt.NONE))&&!((e=d(this,jc))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of d(this,Zt))t.unselect();d(this,Zt).clear(),F(this,Ie,Ti).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,r=!1){if(r||this.commitOrRemove(),!this.hasSelection)return;d(this,Yc)[0]+=e,d(this,Yc)[1]+=t;const[i,s]=d(this,Yc),o=[...d(this,Zt)],a=1e3;d(this,ya)&&clearTimeout(d(this,ya)),R(this,ya,setTimeout(()=>{R(this,ya,null),d(this,Yc)[0]=d(this,Yc)[1]=0,this.addCommands({cmd:()=>{for(const l of o)d(this,vr).has(l.id)&&(l.translateInPage(i,s),l.translationDone())},undo:()=>{for(const l of o)d(this,vr).has(l.id)&&(l.translateInPage(-i,-s),l.translationDone())},mustExec:!1})},a));for(const l of o)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),R(this,pa,new Map);for(const e of d(this,Zt))d(this,pa).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!d(this,pa))return!1;this.disableUserSelect(!1);const e=d(this,pa);R(this,pa,null);let t=!1;for(const[{x:i,y:s,pageIndex:o},a]of e)a.newX=i,a.newY=s,a.newPageIndex=o,t||(t=i!==a.savedX||s!==a.savedY||o!==a.savedPageIndex);if(!t)return!1;const r=(i,s,o,a)=>{if(d(this,vr).has(i.id)){const l=d(this,zr).get(a);l?i._setParentAndPosition(l,s,o):(i.pageIndex=a,i.x=s,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:s,newY:o,newPageIndex:a}]of e)r(i,s,o,a)},undo:()=>{for(const[i,{savedX:s,savedY:o,savedPageIndex:a}]of e)r(i,s,o,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(d(this,pa))for(const r of d(this,pa).keys())r.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||d(this,Zt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return d(this,ps)===e}getActive(){return d(this,ps)}getMode(){return d(this,Cr)}get imageManager(){return Dt(this,"imageManager",new Ax)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let c=0,u=t.rangeCount;c<u;c++)if(!e.contains(t.getRangeAt(c).commonAncestorContainer))return null;const{x:r,y:i,width:s,height:o}=e.getBoundingClientRect();let a;switch(e.getAttribute("data-main-rotation")){case"90":a=(c,u,h,f)=>({x:(u-i)/o,y:1-(c+h-r)/s,width:f/o,height:h/s});break;case"180":a=(c,u,h,f)=>({x:1-(c+h-r)/s,y:1-(u+f-i)/o,width:h/s,height:f/o});break;case"270":a=(c,u,h,f)=>({x:1-(u+f-i)/o,y:(c-r)/s,width:f/o,height:h/s});break;default:a=(c,u,h,f)=>({x:(c-r)/s,y:(u-i)/o,width:h/s,height:f/o});break}const l=[];for(let c=0,u=t.rangeCount;c<u;c++){const h=t.getRangeAt(c);if(!h.collapsed)for(const{x:f,y:v,width:w,height:E}of h.getClientRects())w===0||E===0||l.push(a(f,v,w,E))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(d(this,Up)||R(this,Up,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=d(this,Up))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=d(this,Up))==null?void 0:i.get(e.data.id);if(!t)return;const r=d(this,dl).getRawValue(t);r&&(d(this,Cr)===mt.NONE&&!r.hasBeenModified||r.renderAnnotationElement(e))}setMissingCanvas(e,t,r){var s;const i=(s=d(this,qc))==null?void 0:s.get(e);i&&(i.setCanvas(t,r),d(this,qc).delete(e))}addMissingCanvas(e,t){(d(this,qc)||R(this,qc,new Map)).set(e,t)}};Fp=new WeakMap,ps=new WeakMap,vr=new WeakMap,zr=new WeakMap,Vp=new WeakMap,dl=new WeakMap,Up=new WeakMap,to=new WeakMap,$c=new WeakMap,jc=new WeakMap,Bp=new WeakMap,Bd=new WeakMap,pa=new WeakMap,xo=new WeakMap,$d=new WeakMap,iw=new WeakMap,sw=new WeakMap,$p=new WeakMap,ow=new WeakMap,ma=new WeakMap,zc=new WeakMap,jp=new WeakMap,Hc=new WeakMap,ga=new WeakMap,LS=new WeakMap,Gc=new WeakMap,aw=new WeakMap,Wc=new WeakMap,jd=new WeakMap,zd=new WeakMap,qc=new WeakMap,lw=new WeakMap,Cr=new WeakMap,Zt=new WeakMap,hl=new WeakMap,Kc=new WeakMap,Hd=new WeakMap,cw=new WeakMap,uw=new WeakMap,Yc=new WeakMap,ya=new WeakMap,fl=new WeakMap,dw=new WeakMap,hw=new WeakMap,no=new WeakMap,Ie=new WeakSet,Bb=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Ix=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const r of d(this,zr).values())if(r.hasTextLayer(e))return r;return null},U3=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const r=F(this,Ie,Bb).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(r);i&&(d(this,ga)||R(this,ga,new EJ(this)),d(this,ga).show(r,i,this.direction==="ltr"))},B3=function(){var s,o,a;const e=document.getSelection();if(!e||e.isCollapsed){d(this,hl)&&((s=d(this,ga))==null||s.hide(),R(this,hl,null),F(this,Ie,Ti).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===d(this,hl))return;const i=F(this,Ie,Bb).call(this,e).closest(".textLayer");if(!i){d(this,hl)&&((o=d(this,ga))==null||o.hide(),R(this,hl,null),F(this,Ie,Ti).call(this,{hasSelectedText:!1}));return}if((a=d(this,ga))==null||a.hide(),R(this,hl,t),F(this,Ie,Ti).call(this,{hasSelectedText:!0}),!(d(this,Cr)!==mt.HIGHLIGHT&&d(this,Cr)!==mt.NONE)&&(d(this,Cr)===mt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),R(this,Hc,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=d(this,Cr)===mt.HIGHLIGHT?F(this,Ie,Ix).call(this,i):null;l==null||l.toggleDrawing();const c=new AbortController,u=this.combinedSignal(c),h=f=>{f.type==="pointerup"&&f.button!==0||(c.abort(),l==null||l.toggleDrawing(!0),f.type==="pointerup"&&F(this,Ie,$b).call(this,"main_toolbar"))};window.addEventListener("pointerup",h,{signal:u}),window.addEventListener("blur",h,{signal:u})}},$b=function(e=""){d(this,Cr)===mt.HIGHLIGHT?this.highlightSelection(e):d(this,iw)&&F(this,Ie,U3).call(this)},$3=function(){document.addEventListener("selectionchange",F(this,Ie,B3).bind(this),{signal:this._signal})},j3=function(){if(d(this,zc))return;R(this,zc,new AbortController);const e=this.combinedSignal(d(this,zc));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},z3=function(){var e;(e=d(this,zc))==null||e.abort(),R(this,zc,null)},xx=function(){if(d(this,Wc))return;R(this,Wc,new AbortController);const e=this.combinedSignal(d(this,Wc));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},H3=function(){var e;(e=d(this,Wc))==null||e.abort(),R(this,Wc,null)},Cx=function(){if(d(this,$c))return;R(this,$c,new AbortController);const e=this.combinedSignal(d(this,$c));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},Px=function(){var e;(e=d(this,$c))==null||e.abort(),R(this,$c,null)},G3=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Ti=function(e){Object.entries(e).some(([r,i])=>d(this,uw)[r]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(d(this,uw),e)}),d(this,Cr)===mt.HIGHLIGHT&&e.hasSelectedEditor===!1&&F(this,Ie,rl).call(this,[[Ot.HIGHLIGHT_FREE,!0]]))},rl=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},W3=async function(){if(!d(this,Gc)){R(this,Gc,!0);const e=[];for(const t of d(this,zr).values())e.push(t.enable());await Promise.all(e);for(const t of d(this,vr).values())t.enable()}},q3=function(){if(this.unselectAll(),d(this,Gc)){R(this,Gc,!1);for(const e of d(this,zr).values())e.disable();for(const e of d(this,vr).values())e.disable()}},Rx=function(e){const t=d(this,zr).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},K3=function(){let e=null;for(e of d(this,Zt));return e},Sy=function(){if(d(this,vr).size===0)return!0;if(d(this,vr).size===1)for(const e of d(this,vr).values())return e.isEmpty();return!1},kx=function(e){for(const t of d(this,Zt))t.unselect();d(this,Zt).clear();for(const t of e)t.isEmpty()||(d(this,Zt).add(t),t.select());F(this,Ie,Ti).call(this,{hasSelectedEditor:this.hasSelection})},ge(vp,"TRANSLATE_SMALL",1),ge(vp,"TRANSLATE_BIG",10);let Ku=vp;var Pr,va,Co,zp,wa,ms,Hp,Ea,Gi,pl,Gd,ba,Qc,Ho,Ay,jb;const Ii=class Ii{constructor(e){O(this,Ho);O(this,Pr,null);O(this,va,!1);O(this,Co,null);O(this,zp,null);O(this,wa,null);O(this,ms,null);O(this,Hp,!1);O(this,Ea,null);O(this,Gi,null);O(this,pl,null);O(this,Gd,null);O(this,ba,!1);R(this,Gi,e),R(this,ba,e._uiManager.useNewAltTextFlow),d(Ii,Qc)||R(Ii,Qc,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){Ii._l10n??(Ii._l10n=e)}async render(){const e=R(this,Co,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=R(this,zp,document.createElement("span"));e.append(t),d(this,ba)?(e.classList.add("new"),e.setAttribute("data-l10n-id",d(Ii,Qc).missing),t.setAttribute("data-l10n-id",d(Ii,Qc)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const r=d(this,Gi)._uiManager._signal;e.addEventListener("contextmenu",vo,{signal:r}),e.addEventListener("pointerdown",s=>s.stopPropagation(),{signal:r});const i=s=>{s.preventDefault(),d(this,Gi)._uiManager.editAltText(d(this,Gi)),d(this,ba)&&d(this,Gi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:d(this,Ho,Ay)}})};return e.addEventListener("click",i,{capture:!0,signal:r}),e.addEventListener("keydown",s=>{s.target===e&&s.key==="Enter"&&(R(this,Hp,!0),i(s))},{signal:r}),await F(this,Ho,jb).call(this),e}finish(){d(this,Co)&&(d(this,Co).focus({focusVisible:d(this,Hp)}),R(this,Hp,!1))}isEmpty(){return d(this,ba)?d(this,Pr)===null:!d(this,Pr)&&!d(this,va)}hasData(){return d(this,ba)?d(this,Pr)!==null||!!d(this,pl):this.isEmpty()}get guessedText(){return d(this,pl)}async setGuessedText(e){d(this,Pr)===null&&(R(this,pl,e),R(this,Gd,await Ii._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),F(this,Ho,jb).call(this))}toggleAltTextBadge(e=!1){var t;if(!d(this,ba)||d(this,Pr)){(t=d(this,Ea))==null||t.remove(),R(this,Ea,null);return}if(!d(this,Ea)){const r=R(this,Ea,document.createElement("div"));r.className="noAltTextBadge",d(this,Gi).div.append(r)}d(this,Ea).classList.toggle("hidden",!e)}serialize(e){let t=d(this,Pr);return!e&&d(this,pl)===t&&(t=d(this,Gd)),{altText:t,decorative:d(this,va),guessedText:d(this,pl),textWithDisclaimer:d(this,Gd)}}get data(){return{altText:d(this,Pr),decorative:d(this,va)}}set data({altText:e,decorative:t,guessedText:r,textWithDisclaimer:i,cancel:s=!1}){r&&(R(this,pl,r),R(this,Gd,i)),!(d(this,Pr)===e&&d(this,va)===t)&&(s||(R(this,Pr,e),R(this,va,t)),F(this,Ho,jb).call(this))}toggle(e=!1){d(this,Co)&&(!e&&d(this,ms)&&(clearTimeout(d(this,ms)),R(this,ms,null)),d(this,Co).disabled=!e)}shown(){d(this,Gi)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:d(this,Ho,Ay)}})}destroy(){var e,t;(e=d(this,Co))==null||e.remove(),R(this,Co,null),R(this,zp,null),R(this,wa,null),(t=d(this,Ea))==null||t.remove(),R(this,Ea,null)}};Pr=new WeakMap,va=new WeakMap,Co=new WeakMap,zp=new WeakMap,wa=new WeakMap,ms=new WeakMap,Hp=new WeakMap,Ea=new WeakMap,Gi=new WeakMap,pl=new WeakMap,Gd=new WeakMap,ba=new WeakMap,Qc=new WeakMap,Ho=new WeakSet,Ay=function(){return d(this,Pr)&&"added"||d(this,Pr)===null&&this.guessedText&&"review"||"missing"},jb=async function(){var i,s,o;const e=d(this,Co);if(!e)return;if(d(this,ba)){if(e.classList.toggle("done",!!d(this,Pr)),e.setAttribute("data-l10n-id",d(Ii,Qc)[d(this,Ho,Ay)]),(i=d(this,zp))==null||i.setAttribute("data-l10n-id",d(Ii,Qc)[`${d(this,Ho,Ay)}-label`]),!d(this,Pr)){(s=d(this,wa))==null||s.remove();return}}else{if(!d(this,Pr)&&!d(this,va)){e.classList.remove("done"),(o=d(this,wa))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=d(this,wa);if(!t){R(this,wa,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${d(this,Gi).id}`;const a=100,l=d(this,Gi)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(d(this,ms)),R(this,ms,null)},{once:!0}),e.addEventListener("mouseenter",()=>{R(this,ms,setTimeout(()=>{R(this,ms,null),d(this,wa).classList.add("show"),d(this,Gi)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:l}),e.addEventListener("mouseleave",()=>{var c;d(this,ms)&&(clearTimeout(d(this,ms)),R(this,ms,null)),(c=d(this,wa))==null||c.classList.remove("show")},{signal:l})}d(this,va)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=d(this,Pr)),t.parentNode||e.append(t);const r=d(this,Gi).getElementForAltText();r==null||r.setAttribute("aria-describedby",t.id)},O(Ii,Qc,null),ge(Ii,"_l10n",null);let ES=Ii;var Gp,Wd,fw,pw,mw,gw,yw,ml,qd,gl,Kd,yl,Qu,Y3,Q3,X3;const jk=class jk{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:r=null,onPinchStart:i=null,onPinching:s=null,onPinchEnd:o=null,signal:a}){O(this,Qu);O(this,Gp);O(this,Wd,!1);O(this,fw,null);O(this,pw);O(this,mw);O(this,gw);O(this,yw);O(this,ml,null);O(this,qd);O(this,gl,null);O(this,Kd);O(this,yl,null);R(this,Gp,e),R(this,fw,r),R(this,pw,t),R(this,mw,i),R(this,gw,s),R(this,yw,o),R(this,Kd,new AbortController),R(this,qd,AbortSignal.any([a,d(this,Kd).signal])),e.addEventListener("touchstart",F(this,Qu,Y3).bind(this),{passive:!1,signal:d(this,qd)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Qo.pixelRatio}destroy(){var e,t;(e=d(this,Kd))==null||e.abort(),R(this,Kd,null),(t=d(this,ml))==null||t.abort(),R(this,ml,null)}};Gp=new WeakMap,Wd=new WeakMap,fw=new WeakMap,pw=new WeakMap,mw=new WeakMap,gw=new WeakMap,yw=new WeakMap,ml=new WeakMap,qd=new WeakMap,gl=new WeakMap,Kd=new WeakMap,yl=new WeakMap,Qu=new WeakSet,Y3=function(e){var i,s,o;if((i=d(this,pw))!=null&&i.call(this))return;if(e.touches.length===1){if(d(this,ml))return;const a=R(this,ml,new AbortController),l=AbortSignal.any([d(this,qd),a.signal]),c=d(this,Gp),u={capture:!0,signal:l,passive:!1},h=f=>{var v;f.pointerType==="touch"&&((v=d(this,ml))==null||v.abort(),R(this,ml,null))};c.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(tr(f),h(f))},u),c.addEventListener("pointerup",h,u),c.addEventListener("pointercancel",h,u);return}if(!d(this,yl)){R(this,yl,new AbortController);const a=AbortSignal.any([d(this,qd),d(this,yl).signal]),l=d(this,Gp),c={signal:a,capture:!1,passive:!1};l.addEventListener("touchmove",F(this,Qu,Q3).bind(this),c);const u=F(this,Qu,X3).bind(this);l.addEventListener("touchend",u,c),l.addEventListener("touchcancel",u,c),c.capture=!0,l.addEventListener("pointerdown",tr,c),l.addEventListener("pointermove",tr,c),l.addEventListener("pointercancel",tr,c),l.addEventListener("pointerup",tr,c),(s=d(this,mw))==null||s.call(this)}if(tr(e),e.touches.length!==2||(o=d(this,fw))!=null&&o.call(this)){R(this,gl,null);return}let[t,r]=e.touches;t.identifier>r.identifier&&([t,r]=[r,t]),R(this,gl,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:r.screenX,touch1Y:r.screenY})},Q3=function(e){var g;if(!d(this,gl)||e.touches.length!==2)return;tr(e);let[t,r]=e.touches;t.identifier>r.identifier&&([t,r]=[r,t]);const{screenX:i,screenY:s}=t,{screenX:o,screenY:a}=r,l=d(this,gl),{touch0X:c,touch0Y:u,touch1X:h,touch1Y:f}=l,v=h-c,w=f-u,E=o-i,A=a-s,T=Math.hypot(E,A)||1,_=Math.hypot(v,w)||1;if(!d(this,Wd)&&Math.abs(_-T)<=jk.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=s,l.touch1X=o,l.touch1Y=a,!d(this,Wd)){R(this,Wd,!0);return}const b=[(i+o)/2,(s+a)/2];(g=d(this,gw))==null||g.call(this,b,_,T)},X3=function(e){var t;e.touches.length>=2||(d(this,yl)&&(d(this,yl).abort(),R(this,yl,null),(t=d(this,yw))==null||t.call(this)),d(this,gl)&&(tr(e),R(this,gl,null),R(this,Wd,!1)))};let Hv=jk;var Yd,Po,Rn,Wp,Xc,vw,Qd,Hr,Xd,vl,Jc,ww,Jd,gs,Ew,Zd,wl,_a,qp,Kp,ro,eh,bw,OS,st,Dx,_w,Mx,zb,J3,Z3,Nx,Hb,Lx,e5,t5,n5,Ox,r5,Fx,i5,s5,o5,Vx,Ty;const It=class It{constructor(e){O(this,st);O(this,Yd,null);O(this,Po,null);O(this,Rn,null);O(this,Wp,!1);O(this,Xc,null);O(this,vw,"");O(this,Qd,!1);O(this,Hr,null);O(this,Xd,null);O(this,vl,null);O(this,Jc,null);O(this,ww,"");O(this,Jd,!1);O(this,gs,null);O(this,Ew,!1);O(this,Zd,!1);O(this,wl,!1);O(this,_a,null);O(this,qp,0);O(this,Kp,0);O(this,ro,null);O(this,eh,null);ge(this,"isSelected",!1);ge(this,"_isCopy",!1);ge(this,"_editToolbar",null);ge(this,"_initialOptions",Object.create(null));ge(this,"_initialData",null);ge(this,"_isVisible",!0);ge(this,"_uiManager",null);ge(this,"_focusEventsAllowed",!0);O(this,bw,!1);O(this,OS,It._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null;const{rotation:t,rawDims:{pageWidth:r,pageHeight:i,pageX:s,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[r,i],this.pageTranslation=[s,o];const[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=It.prototype._resizeWithKeyboard,t=Ku.TRANSLATE_SMALL,r=Ku.TRANSLATE_BIG;return Dt(this,"_resizerKeyboardManager",new eE([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-r,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[r,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-r]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,r]}],[["Escape","mac+Escape"],It.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Dt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new SJ({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(It._l10n??(It._l10n=e),It._l10nResizer||(It._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),It._borderLineWidth!==-1)return;const r=getComputedStyle(document.documentElement);It._borderLineWidth=parseFloat(r.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){hn("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return d(this,bw)}set _isDraggable(e){var t;R(this,bw,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=d(this,OS)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):F(this,st,Ty).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(d(this,Jd)?R(this,Jd,!1):this.parent.setSelected(this))}focusout(e){var r;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(r=this.parent)!=null&&r.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,r,i){const[s,o]=this.parentDimensions;[r,i]=this.screenToPageTranslation(r,i),this.x=(e+r)/s,this.y=(t+i)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[r,i]=this.parentDimensions;this.setAt(e*r,t*i,this.width*r,this.height*i),this._onTranslated()}translate(e,t){F(this,st,Dx).call(this,this.parentDimensions,e,t)}translateInPage(e,t){d(this,gs)||R(this,gs,[this.x,this.y,this.width,this.height]),F(this,st,Dx).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){d(this,gs)||R(this,gs,[this.x,this.y,this.width,this.height]);const{div:r,parentDimensions:[i,s]}=this;if(this.x+=e/i,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this;const[l,c]=this.getBaseTranslation();o+=l,a+=c;const{style:u}=r;u.left=`${(100*o).toFixed(2)}%`,u.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),r.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!d(this,gs)&&(d(this,gs)[0]!==this.x||d(this,gs)[1]!==this.y)}get _hasBeenResized(){return!!d(this,gs)&&(d(this,gs)[2]!==this.width||d(this,gs)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:r}=It,i=r/e,s=r/t;switch(this.rotation){case 90:return[-i,s];case 180:return[i,s];case 270:return[i,-s];default:return[-i,-s]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[r,i]}=this;let{x:s,y:o,width:a,height:l}=this;if(a*=r,l*=i,s*=r,o*=i,this._mustFixPosition)switch(e){case 0:s=hi(s,0,r-a),o=hi(o,0,i-l);break;case 90:s=hi(s,0,r-l),o=hi(o,a,i);break;case 180:s=hi(s,a,r),o=hi(o,l,i);break;case 270:s=hi(s,l,r),o=hi(o,0,i-a);break}this.x=s/=r,this.y=o/=i;const[c,u]=this.getBaseTranslation();s+=c,o+=u,t.left=`${(100*s).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var r;return F(r=It,_w,Mx).call(r,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var r;return F(r=It,_w,Mx).call(r,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,r]}=this;return[t*e,r*e]}setDims(e,t){const[r,i]=this.parentDimensions,{style:s}=this.div;s.width=`${(100*e/r).toFixed(2)}%`,d(this,Qd)||(s.height=`${(100*t/i).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:r}=e,i=r.endsWith("%"),s=!d(this,Qd)&&t.endsWith("%");if(i&&s)return;const[o,a]=this.parentDimensions;i||(e.width=`${(100*parseFloat(r)/o).toFixed(2)}%`),!d(this,Qd)&&!s&&(e.height=`${(100*parseFloat(t)/a).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=d(this,Rn))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||d(this,Zd))return this._editToolbar;this._editToolbar=new Sx(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,r]of e)await this._editToolbar.addButton(t,r);return this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=d(this,Rn))==null||e.destroy())}addContainer(e){var r;const t=(r=this._editToolbar)==null?void 0:r.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return d(this,Rn)||(ES.initialize(It._l10n),R(this,Rn,new ES(this)),d(this,Yd)&&(d(this,Rn).data=d(this,Yd),R(this,Yd,null))),d(this,Rn)}get altTextData(){var e;return(e=d(this,Rn))==null?void 0:e.data}set altTextData(e){d(this,Rn)&&(d(this,Rn).data=e)}get guessedAltText(){var e;return(e=d(this,Rn))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=d(this,Rn))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=d(this,Rn))==null?void 0:t.serialize(e)}hasAltText(){return!!d(this,Rn)&&!d(this,Rn).isEmpty()}hasAltTextData(){var e;return((e=d(this,Rn))==null?void 0:e.hasData())??!1}render(){var o;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=d(this,Wp)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),F(this,st,Fx).call(this);const[t,r]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*r/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/r).toFixed(2)}%`);const[i,s]=this.getInitialTranslation();return this.translate(i,s),F3(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(d(this,eh)||R(this,eh,new Hv({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:F(this,st,e5).bind(this),onPinching:F(this,st,t5).bind(this),onPinchEnd:F(this,st,n5).bind(this),signal:this._uiManager._signal}))),(o=this._uiManager._editorUndoBar)==null||o.hide(),e}pointerdown(e){const{isMac:t}=Ur.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(R(this,Jd,!0),this._isDraggable){F(this,st,r5).call(this,e);return}F(this,st,Ox).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){d(this,_a)&&clearTimeout(d(this,_a)),R(this,_a,setTimeout(()=>{var e;R(this,_a,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,r){e.changeParent(this),this.x=t,this.y=r,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,r=this.rotation){const i=this.parentScale,[s,o]=this.pageDimensions,[a,l]=this.pageTranslation,c=e/i,u=t/i,h=this.x*s,f=this.y*o,v=this.width*s,w=this.height*o;switch(r){case 0:return[h+c+a,o-f-u-w+l,h+c+v+a,o-f-u+l];case 90:return[h+u+a,o-f+c+l,h+u+w+a,o-f+c+v+l];case 180:return[h-c-v+a,o-f+u+l,h-c+a,o-f+u+w+l];case 270:return[h-u-w+a,o-f-c-v+l,h-u+a,o-f-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[r,i,s,o]=e,a=s-r,l=o-i;switch(this.rotation){case 0:return[r,t-o,a,l];case 90:return[r,t-i,l,a];case 180:return[s,t-i,a,l];case 270:return[s,t-o,l,a];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),R(this,Zd,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),R(this,Zd,!1),!0):!1}isInEditMode(){return d(this,Zd)}shouldGetKeyboardEvents(){return d(this,wl)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:r,right:i}=this.getClientDimensions(),{innerHeight:s,innerWidth:o}=window;return t<o&&i>0&&e<s&&r>0}rebuild(){F(this,st,Fx).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){hn("An editor must be serializable")}static async deserialize(e,t,r){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:r,annotationElementId:e.annotationElementId});i.rotation=e.rotation,R(i,Yd,e.accessibilityData),i._isCopy=e.isCopy||!1;const[s,o]=i.pageDimensions,[a,l,c,u]=i.getRectInCurrentCoords(e.rect,o);return i.x=a/s,i.y=l/o,i.width=c/s,i.height=u/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=d(this,Jc))==null||e.abort(),R(this,Jc,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),d(this,_a)&&(clearTimeout(d(this,_a)),R(this,_a,null)),F(this,st,Ty).call(this),this.removeEditToolbar(),d(this,ro)){for(const r of d(this,ro).values())clearTimeout(r);R(this,ro,null)}this.parent=null,(t=d(this,eh))==null||t.destroy(),R(this,eh,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(F(this,st,J3).call(this),d(this,Hr).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),R(this,vl,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=d(this,Hr).children;if(!d(this,Po)){R(this,Po,Array.from(t));const o=F(this,st,i5).bind(this),a=F(this,st,s5).bind(this),l=this._uiManager._signal;for(const c of d(this,Po)){const u=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",o,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",F(this,st,o5).bind(this,u),{signal:l}),c.setAttribute("data-l10n-id",It._l10nResizer[u])}}const r=d(this,Po)[0];let i=0;for(const o of t){if(o===r)break;i++}const s=(360-this.rotation+this.parentRotation)%360/90*(d(this,Po).length/4);if(s!==i){if(s<i)for(let a=0;a<i-s;a++)d(this,Hr).append(d(this,Hr).firstChild);else if(s>i)for(let a=0;a<s-i;a++)d(this,Hr).firstChild.before(d(this,Hr).lastChild);let o=0;for(const a of t){const c=d(this,Po)[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",It._l10nResizer[c])}}F(this,st,Vx).call(this,0),R(this,wl,!0),d(this,Hr).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){d(this,wl)&&F(this,st,Lx).call(this,d(this,ww),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){F(this,st,Ty).call(this),this.div.focus()}select(){var e,t,r;if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,s;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((s=this._editToolbar)==null||s.show())});return}(t=this._editToolbar)==null||t.show(),(r=d(this,Rn))==null||r.toggleAltTextBadge(!1)}}unselect(){var e,t,r,i,s;this.isSelected&&(this.isSelected=!1,(e=d(this,Hr))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(r=this.div)!=null&&r.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(s=d(this,Rn))==null||s.toggleAltTextBadge(!0))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return d(this,Ew)}set isEditing(e){R(this,Ew,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){R(this,Qd,!0);const r=e/t,{style:i}=this.div;i.aspectRatio=r,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){d(this,ro)||R(this,ro,new Map);const{action:r}=e;let i=d(this,ro).get(r);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),d(this,ro).delete(r),d(this,ro).size===0&&R(this,ro,null)},It._telemetryTimeout),d(this,ro).set(r,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),R(this,Wp,!1)}disable(){this.div&&(this.div.tabIndex=-1),R(this,Wp,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const r=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),r.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Yd=new WeakMap,Po=new WeakMap,Rn=new WeakMap,Wp=new WeakMap,Xc=new WeakMap,vw=new WeakMap,Qd=new WeakMap,Hr=new WeakMap,Xd=new WeakMap,vl=new WeakMap,Jc=new WeakMap,ww=new WeakMap,Jd=new WeakMap,gs=new WeakMap,Ew=new WeakMap,Zd=new WeakMap,wl=new WeakMap,_a=new WeakMap,qp=new WeakMap,Kp=new WeakMap,ro=new WeakMap,eh=new WeakMap,bw=new WeakMap,OS=new WeakMap,st=new WeakSet,Dx=function([e,t],r,i){[r,i]=this.screenToPageTranslation(r,i),this.x+=r/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},_w=new WeakSet,Mx=function(e,t,r){switch(r){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},zb=function(e){switch(e){case 90:{const[t,r]=this.pageDimensions;return[0,-t/r,r/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,r]=this.pageDimensions;return[0,t/r,-r/t,0]}default:return[1,0,0,1]}},J3=function(){if(d(this,Hr))return;R(this,Hr,document.createElement("div")),d(this,Hr).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const r of e){const i=document.createElement("div");d(this,Hr).append(i),i.classList.add("resizer",r),i.setAttribute("data-resizer-name",r),i.addEventListener("pointerdown",F(this,st,Z3).bind(this,r),{signal:t}),i.addEventListener("contextmenu",vo,{signal:t}),i.tabIndex=-1}this.div.prepend(d(this,Hr))},Z3=function(e,t){var u;t.preventDefault();const{isMac:r}=Ur.platform;if(t.button!==0||t.ctrlKey&&r)return;(u=d(this,Rn))==null||u.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,R(this,Xd,[t.screenX,t.screenY]);const s=new AbortController,o=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",F(this,st,Lx).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",tr,{passive:!1,signal:o}),window.addEventListener("contextmenu",vo,{signal:o}),R(this,vl,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const c=()=>{var h;s.abort(),this.parent.togglePointerEvents(!0),(h=d(this,Rn))==null||h.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=l,F(this,st,Hb).call(this)};window.addEventListener("pointerup",c,{signal:o}),window.addEventListener("blur",c,{signal:o})},Nx=function(e,t,r,i){this.width=r,this.height=i,this.x=e,this.y=t;const[s,o]=this.parentDimensions;this.setDims(s*r,o*i),this.fixAndSetPosition(),this._onResized()},Hb=function(){if(!d(this,vl))return;const{savedX:e,savedY:t,savedWidth:r,savedHeight:i}=d(this,vl);R(this,vl,null);const s=this.x,o=this.y,a=this.width,l=this.height;s===e&&o===t&&a===r&&l===i||this.addCommands({cmd:F(this,st,Nx).bind(this,s,o,a,l),undo:F(this,st,Nx).bind(this,e,t,r,i),mustExec:!0})},Lx=function(e,t){const[r,i]=this.parentDimensions,s=this.x,o=this.y,a=this.width,l=this.height,c=It.MIN_SIZE/r,u=It.MIN_SIZE/i,h=F(this,st,zb).call(this,this.rotation),f=($,B)=>[h[0]*$+h[2]*B,h[1]*$+h[3]*B],v=F(this,st,zb).call(this,360-this.rotation),w=($,B)=>[v[0]*$+v[2]*B,v[1]*$+v[3]*B];let E,A,T=!1,_=!1;switch(e){case"topLeft":T=!0,E=($,B)=>[0,0],A=($,B)=>[$,B];break;case"topMiddle":E=($,B)=>[$/2,0],A=($,B)=>[$/2,B];break;case"topRight":T=!0,E=($,B)=>[$,0],A=($,B)=>[0,B];break;case"middleRight":_=!0,E=($,B)=>[$,B/2],A=($,B)=>[0,B/2];break;case"bottomRight":T=!0,E=($,B)=>[$,B],A=($,B)=>[0,0];break;case"bottomMiddle":E=($,B)=>[$/2,B],A=($,B)=>[$/2,0];break;case"bottomLeft":T=!0,E=($,B)=>[0,B],A=($,B)=>[$,0];break;case"middleLeft":_=!0,E=($,B)=>[0,B/2],A=($,B)=>[$,B/2];break}const b=E(a,l),g=A(a,l);let y=f(...g);const x=It._round(s+y[0]),S=It._round(o+y[1]);let I=1,P=1,N,M;if(t.fromKeyboard)({deltaX:N,deltaY:M}=t);else{const{screenX:$,screenY:B}=t,[G,Z]=d(this,Xd);[N,M]=this.screenToPageTranslation($-G,B-Z),d(this,Xd)[0]=$,d(this,Xd)[1]=B}if([N,M]=w(N/r,M/i),T){const $=Math.hypot(a,l);I=P=Math.max(Math.min(Math.hypot(g[0]-b[0]-N,g[1]-b[1]-M)/$,1/a,1/l),c/a,u/l)}else _?I=hi(Math.abs(g[0]-b[0]-N),c,1)/a:P=hi(Math.abs(g[1]-b[1]-M),u,1)/l;const V=It._round(a*I),L=It._round(l*P);y=f(...A(V,L));const j=x-y[0],oe=S-y[1];d(this,gs)||R(this,gs,[this.x,this.y,this.width,this.height]),this.width=V,this.height=L,this.x=j,this.y=oe,this.setDims(r*V,i*L),this.fixAndSetPosition(),this._onResizing()},e5=function(){var e;R(this,vl,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=d(this,Rn))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},t5=function(e,t,r){let s=.7*(r/t)+1-.7;if(s===1)return;const o=F(this,st,zb).call(this,this.rotation),a=(x,S)=>[o[0]*x+o[2]*S,o[1]*x+o[3]*S],[l,c]=this.parentDimensions,u=this.x,h=this.y,f=this.width,v=this.height,w=It.MIN_SIZE/l,E=It.MIN_SIZE/c;s=Math.max(Math.min(s,1/f,1/v),w/f,E/v);const A=It._round(f*s),T=It._round(v*s);if(A===f&&T===v)return;d(this,gs)||R(this,gs,[u,h,f,v]);const _=a(f/2,v/2),b=It._round(u+_[0]),g=It._round(h+_[1]),y=a(A/2,T/2);this.x=b-y[0],this.y=g-y[1],this.width=A,this.height=T,this.setDims(l*A,c*T),this.fixAndSetPosition(),this._onResizing()},n5=function(){var e;(e=d(this,Rn))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),F(this,st,Hb).call(this)},Ox=function(e){const{isMac:t}=Ur.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},r5=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let r=!1;const i=new AbortController,s=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:s},a=c=>{i.abort(),R(this,Xc,null),R(this,Jd,!1),this._uiManager.endDragSession()||F(this,st,Ox).call(this,c),r&&this._onStopDragging()};t&&(R(this,qp,e.clientX),R(this,Kp,e.clientY),R(this,Xc,e.pointerId),R(this,vw,e.pointerType),window.addEventListener("pointermove",c=>{r||(r=!0,this._onStartDragging());const{clientX:u,clientY:h,pointerId:f}=c;if(f!==d(this,Xc)){tr(c);return}const[v,w]=this.screenToPageTranslation(u-d(this,qp),h-d(this,Kp));R(this,qp,u),R(this,Kp,h),this._uiManager.dragSelectedEditors(v,w)},o),window.addEventListener("touchmove",tr,o),window.addEventListener("pointerdown",c=>{c.pointerType===d(this,vw)&&(d(this,eh)||c.isPrimary)&&a(c),tr(c)},o));const l=c=>{if(!d(this,Xc)||d(this,Xc)===c.pointerId){a(c);return}tr(c)};window.addEventListener("pointerup",l,{signal:s}),window.addEventListener("blur",l,{signal:s})},Fx=function(){if(d(this,Jc)||!this.div)return;R(this,Jc,new AbortController);const e=this._uiManager.combinedSignal(d(this,Jc));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},i5=function(e){It._resizerKeyboardManager.exec(this,e)},s5=function(e){var t;d(this,wl)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==d(this,Hr)&&F(this,st,Ty).call(this)},o5=function(e){R(this,ww,d(this,wl)?e:"")},Vx=function(e){if(d(this,Po))for(const t of d(this,Po))t.tabIndex=e},Ty=function(){R(this,wl,!1),F(this,st,Vx).call(this,-1),F(this,st,Hb).call(this)},O(It,_w),ge(It,"_l10n",null),ge(It,"_l10nResizer",null),ge(It,"_borderLineWidth",-1),ge(It,"_colorManager",new Tx),ge(It,"_zIndex",1),ge(It,"_telemetryTimeout",1e3);let Sn=It;class SJ extends Sn{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const MN=3285377520,Qs=4294901760,aa=65535;class a5{constructor(e){this.h1=e?e&4294967295:MN,this.h2=e?e&4294967295:MN}update(e){let t,r;if(typeof e=="string"){t=new Uint8Array(e.length*2),r=0;for(let E=0,A=e.length;E<A;E++){const T=e.charCodeAt(E);T<=255?t[r++]=T:(t[r++]=T>>>8,t[r++]=T&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),r=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=r>>2,s=r-i*4,o=new Uint32Array(t.buffer,0,i);let a=0,l=0,c=this.h1,u=this.h2;const h=3432918353,f=461845907,v=h&aa,w=f&aa;for(let E=0;E<i;E++)E&1?(a=o[E],a=a*h&Qs|a*v&aa,a=a<<15|a>>>17,a=a*f&Qs|a*w&aa,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=o[E],l=l*h&Qs|l*v&aa,l=l<<15|l>>>17,l=l*f&Qs|l*w&aa,u^=l,u=u<<13|u>>>19,u=u*5+3864292196);switch(a=0,s){case 3:a^=t[i*4+2]<<16;case 2:a^=t[i*4+1]<<8;case 1:a^=t[i*4],a=a*h&Qs|a*v&aa,a=a<<15|a>>>17,a=a*f&Qs|a*w&aa,i&1?c^=a:u^=a}this.h1=c,this.h2=u}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Qs|e*36045&aa,t=t*4283543511&Qs|((t<<16|e>>>16)*2950163797&Qs)>>>16,e^=t>>>1,e=e*444984403&Qs|e*60499&aa,t=t*3301882366&Qs|((t<<16|e>>>16)*3120437893&Qs)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Ux=Object.freeze({map:null,hash:"",transfer:void 0});var th,nh,Gr,FS,l5;class mk{constructor(){O(this,FS);O(this,th,!1);O(this,nh,null);O(this,Gr,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const r=d(this,Gr).get(e);return r===void 0?t:Object.assign(t,r)}getRawValue(e){return d(this,Gr).get(e)}remove(e){if(d(this,Gr).delete(e),d(this,Gr).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of d(this,Gr).values())if(t instanceof Sn)return;this.onAnnotationEditor(null)}}setValue(e,t){const r=d(this,Gr).get(e);let i=!1;if(r!==void 0)for(const[s,o]of Object.entries(t))r[s]!==o&&(i=!0,r[s]=o);else i=!0,d(this,Gr).set(e,t);i&&F(this,FS,l5).call(this),t instanceof Sn&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return d(this,Gr).has(e)}get size(){return d(this,Gr).size}resetModified(){d(this,th)&&(R(this,th,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new c5(this)}get serializable(){if(d(this,Gr).size===0)return Ux;const e=new Map,t=new a5,r=[],i=Object.create(null);let s=!1;for(const[o,a]of d(this,Gr)){const l=a instanceof Sn?a.serialize(!1,i):a;l&&(e.set(o,l),t.update(`${o}:${JSON.stringify(l)}`),s||(s=!!l.bitmap))}if(s)for(const o of e.values())o.bitmap&&r.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:r}:Ux}get editorStats(){let e=null;const t=new Map;for(const r of d(this,Gr).values()){if(!(r instanceof Sn))continue;const i=r.telemetryFinalData;if(!i)continue;const{type:s}=i;t.has(s)||t.set(s,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));const o=e[s]||(e[s]=new Map);for(const[a,l]of Object.entries(i)){if(a==="type")continue;let c=o.get(a);c||(c=new Map,o.set(a,c));const u=c.get(l)??0;c.set(l,u+1)}}for(const[r,i]of t)e[r]=i.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){R(this,nh,null)}get modifiedIds(){if(d(this,nh))return d(this,nh);const e=[];for(const t of d(this,Gr).values())!(t instanceof Sn)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return R(this,nh,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return d(this,Gr).entries()}}th=new WeakMap,nh=new WeakMap,Gr=new WeakMap,FS=new WeakSet,l5=function(){d(this,th)||(R(this,th,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Sw;class c5 extends mk{constructor(t){super();O(this,Sw);const{map:r,hash:i,transfer:s}=t.serializable,o=structuredClone(r,s?{transfer:s}:null);R(this,Sw,{map:o,hash:i,transfer:s})}get print(){hn("Should not call PrintAnnotationStorage.print")}get serializable(){return d(this,Sw)}get modifiedIds(){return Dt(this,"modifiedIds",{ids:new Set,hash:""})}}Sw=new WeakMap;var Yp;class AJ{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){O(this,Yp,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),d(this,Yp).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:r}){if(!(!e||d(this,Yp).has(e.loadedName))){if(fr(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:s,style:o}=e,a=new FontFace(i,s,o);this.addNativeFontFace(a);try{await a.load(),d(this,Yp).add(i),r==null||r(e)}catch{wt(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}hn("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const r=e.createNativeFontFace();if(r){this.addNativeFontFace(r);try{await r.loaded}catch(i){throw wt(`Failed to load font '${r.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(r=>{const i=this._queueLoadingCallback(r);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return Dt(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return Dt(this,"isSyncFontLoadingSupported",Ri||Ur.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(fr(!i.done,"completeRequest() cannot be called twice."),i.done=!0;r.length>0&&r[0].done;){const s=r.shift();setTimeout(s.callback,0)}}const{loadingRequests:r}=this,i={done:!1,complete:t,callback:e};return r.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Dt(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function r(g,y){return g.charCodeAt(y)<<24|g.charCodeAt(y+1)<<16|g.charCodeAt(y+2)<<8|g.charCodeAt(y+3)&255}function i(g,y,x,S){const I=g.substring(0,y),P=g.substring(y+x);return I+S+P}let s,o;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let c=0;function u(g,y){if(++c>30){wt("Load test font never loaded."),y();return}if(l.font="30px "+g,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){y();return}setTimeout(u.bind(null,g,y))}const h=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,h.length,h);const w=16,E=1482184792;let A=r(f,w);for(s=0,o=h.length-3;s<o;s+=4)A=A-E+r(h,s)|0;s<h.length&&(A=A-E+r(h+"XXX",s)|0),f=i(f,w,4,hJ(A));const T=`url(data:font/opentype;base64,${btoa(f)});`,_=`@font-face {font-family:"${h}";src:${T}}`;this.insertRule(_);const b=this._document.createElement("div");b.style.visibility="hidden",b.style.width=b.style.height="10px",b.style.position="absolute",b.style.top=b.style.left="0px";for(const g of[e.loadedName,h]){const y=this._document.createElement("span");y.textContent="Hi",y.style.fontFamily=g,b.append(y)}this._document.body.append(b),u(h,()=>{b.remove(),t.complete()})}}Yp=new WeakMap;class TJ{constructor(e,t=null){this.compiledGlyphs=Object.create(null);for(const r in e)this[r]=e[r];this._inspectFont=t}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const r={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(r.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,r)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var r;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${x3(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(r=this._inspectFont)==null||r.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const r=this.loadedName+"_path_"+t;let i;try{i=e.get(r)}catch(o){wt(`getPathGenerator - ignoring character: "${o}".`)}const s=new Path2D(i||"");return this.fontExtraProperties||e.delete(r),this.compiledGlyphs[t]=s}}function IJ(n){if(n instanceof URL)return n.href;if(typeof n=="string"){if(Ri)return n;const e=URL.parse(n,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function xJ(n){if(Ri&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return X0(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function GE(n){if(typeof n!="string")return null;if(n.endsWith("/"))return n;throw new Error(`Invalid factory url: "${n}" must include trailing slash.`)}const Bx=n=>typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0,CJ=n=>typeof n=="object"&&typeof(n==null?void 0:n.name)=="string",u5=gJ.bind(null,Bx,CJ);var El,VS;class PJ{constructor(){O(this,El,new Map);O(this,VS,Promise.resolve())}postMessage(e,t){const r={data:structuredClone(e,t?{transfer:t}:null)};d(this,VS).then(()=>{for(const[i]of d(this,El))i.call(this,r)})}addEventListener(e,t,r=null){let i=null;if((r==null?void 0:r.signal)instanceof AbortSignal){const{signal:s}=r;if(s.aborted){wt("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);i=()=>s.removeEventListener("abort",o),s.addEventListener("abort",o)}d(this,El).set(t,i)}removeEventListener(e,t){const r=d(this,El).get(t);r==null||r(),d(this,El).delete(t)}terminate(){for(const[,e]of d(this,El))e==null||e();d(this,El).clear()}}El=new WeakMap,VS=new WeakMap;const WE={DATA:1,ERROR:2},cr={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function NN(){}function zi(n){if(n instanceof oc||n instanceof vS||n instanceof RN||n instanceof zv||n instanceof vT)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||hn('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new oc(n.message);case"InvalidPDFException":return new vS(n.message);case"PasswordException":return new RN(n.message,n.code);case"ResponseException":return new zv(n.message,n.status,n.missing);case"UnknownErrorException":return new vT(n.message,n.details)}return new vT(n.message,n.toString())}var Qp,fo,d5,h5,f5,Gb;class Iy{constructor(e,t,r){O(this,fo);O(this,Qp,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=r,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),r.addEventListener("message",F(this,fo,d5).bind(this),{signal:d(this,Qp).signal})}on(e,t){const r=this.actionHandler;if(r[e])throw new Error(`There is already an actionName called "${e}"`);r[e]=t}send(e,t,r){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},r)}sendWithPromise(e,t,r){const i=this.callbackId++,s=Promise.withResolvers();this.callbackCapabilities[i]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},r)}catch(o){s.reject(o)}return s.promise}sendWithStream(e,t,r,i){const s=this.streamId++,o=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const u=Promise.withResolvers();return this.streamControllers[s]={controller:c,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:o,targetName:a,action:e,streamId:s,data:t,desiredSize:c.desiredSize},i),u.promise},pull:c=>{const u=Promise.withResolvers();return this.streamControllers[s].pullCall=u,l.postMessage({sourceName:o,targetName:a,stream:cr.PULL,streamId:s,desiredSize:c.desiredSize}),u.promise},cancel:c=>{fr(c instanceof Error,"cancel must have a valid reason");const u=Promise.withResolvers();return this.streamControllers[s].cancelCall=u,this.streamControllers[s].isClosed=!0,l.postMessage({sourceName:o,targetName:a,stream:cr.CANCEL,streamId:s,reason:zi(c)}),u.promise}},r)}destroy(){var e;(e=d(this,Qp))==null||e.abort(),R(this,Qp,null)}}Qp=new WeakMap,fo=new WeakSet,d5=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){F(this,fo,f5).call(this,e);return}if(e.callback){const r=e.callbackId,i=this.callbackCapabilities[r];if(!i)throw new Error(`Cannot resolve callback ${r}`);if(delete this.callbackCapabilities[r],e.callback===WE.DATA)i.resolve(e.data);else if(e.callback===WE.ERROR)i.reject(zi(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const r=this.sourceName,i=e.sourceName,s=this.comObj;Promise.try(t,e.data).then(function(o){s.postMessage({sourceName:r,targetName:i,callback:WE.DATA,callbackId:e.callbackId,data:o})},function(o){s.postMessage({sourceName:r,targetName:i,callback:WE.ERROR,callbackId:e.callbackId,reason:zi(o)})});return}if(e.streamId){F(this,fo,h5).call(this,e);return}t(e.data)},h5=function(e){const t=e.streamId,r=this.sourceName,i=e.sourceName,s=this.comObj,o=this,a=this.actionHandler[e.action],l={enqueue(c,u=1,h){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=u,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),s.postMessage({sourceName:r,targetName:i,stream:cr.ENQUEUE,streamId:t,chunk:c},h)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:r,targetName:i,stream:cr.CLOSE,streamId:t}),delete o.streamSinks[t])},error(c){fr(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:r,targetName:i,stream:cr.ERROR,streamId:t,reason:zi(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){s.postMessage({sourceName:r,targetName:i,stream:cr.START_COMPLETE,streamId:t,success:!0})},function(c){s.postMessage({sourceName:r,targetName:i,stream:cr.START_COMPLETE,streamId:t,reason:zi(c)})})},f5=function(e){const t=e.streamId,r=this.sourceName,i=e.sourceName,s=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case cr.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(zi(e.reason));break;case cr.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(zi(e.reason));break;case cr.PULL:if(!a){s.postMessage({sourceName:r,targetName:i,stream:cr.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||NN).then(function(){s.postMessage({sourceName:r,targetName:i,stream:cr.PULL_COMPLETE,streamId:t,success:!0})},function(c){s.postMessage({sourceName:r,targetName:i,stream:cr.PULL_COMPLETE,streamId:t,reason:zi(c)})});break;case cr.ENQUEUE:if(fr(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case cr.CLOSE:if(fr(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),F(this,fo,Gb).call(this,o,t);break;case cr.ERROR:fr(o,"error should have stream controller"),o.controller.error(zi(e.reason)),F(this,fo,Gb).call(this,o,t);break;case cr.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(zi(e.reason)),F(this,fo,Gb).call(this,o,t);break;case cr.CANCEL:if(!a)break;const l=zi(e.reason);Promise.try(a.onCancel||NN,l).then(function(){s.postMessage({sourceName:r,targetName:i,stream:cr.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){s.postMessage({sourceName:r,targetName:i,stream:cr.CANCEL_COMPLETE,streamId:t,reason:zi(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},Gb=async function(e,t){var r,i,s;await Promise.allSettled([(r=e.startCall)==null?void 0:r.promise,(i=e.pullCall)==null?void 0:i.promise,(s=e.cancelCall)==null?void 0:s.promise]),delete this.streamControllers[t]};var Aw;class p5{constructor({enableHWA:e=!1}){O(this,Aw,!1);R(this,Aw,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const r=this._createCanvas(e,t);return{canvas:r,context:r.getContext("2d",{willReadFrequently:!d(this,Aw)})}}reset(e,t,r){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||r<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=r}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){hn("Abstract method `_createCanvas` called.")}}Aw=new WeakMap;class RJ extends p5{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const r=this._document.createElement("canvas");return r.width=e,r.height=t,r}}class m5{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(r=>({cMapData:r,isCompressed:this.isCompressed})).catch(r=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){hn("Abstract method `_fetch` called.")}}class LN extends m5{async _fetch(e){const t=await Cg(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):X0(t)}}class g5{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,r,i,s){return"none"}destroy(e=!1){}}var rh,Xp,bl,_l,ui,ih,sh,Me,li,xy,Kf,Wb,Yf,y5,$x,Qf,Cy,Py,jx,Ry;class kJ extends g5{constructor({docId:t,ownerDocument:r=globalThis.document}){super();O(this,Me);O(this,rh);O(this,Xp);O(this,bl);O(this,_l);O(this,ui);O(this,ih);O(this,sh,0);R(this,_l,t),R(this,ui,r)}addFilter(t){if(!t)return"none";let r=d(this,Me,li).get(t);if(r)return r;const[i,s,o]=F(this,Me,Wb).call(this,t),a=t.length===1?i:`${i}${s}${o}`;if(r=d(this,Me,li).get(a),r)return d(this,Me,li).set(t,r),r;const l=`g_${d(this,_l)}_transfer_map_${Si(this,sh)._++}`,c=F(this,Me,Yf).call(this,l);d(this,Me,li).set(t,c),d(this,Me,li).set(a,c);const u=F(this,Me,Qf).call(this,l);return F(this,Me,Py).call(this,i,s,o,u),c}addHCMFilter(t,r){var w;const i=`${t}-${r}`,s="base";let o=d(this,Me,xy).get(s);if((o==null?void 0:o.key)===i||(o?((w=o.filter)==null||w.remove(),o.key=i,o.url="none",o.filter=null):(o={key:i,url:"none",filter:null},d(this,Me,xy).set(s,o)),!t||!r))return o.url;const a=F(this,Me,Ry).call(this,t);t=Ke.makeHexColor(...a);const l=F(this,Me,Ry).call(this,r);if(r=Ke.makeHexColor(...l),d(this,Me,Kf).style.color="",t==="#000000"&&r==="#ffffff"||t===r)return o.url;const c=new Array(256);for(let E=0;E<=255;E++){const A=E/255;c[E]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const u=c.join(","),h=`g_${d(this,_l)}_hcm_filter`,f=o.filter=F(this,Me,Qf).call(this,h);F(this,Me,Py).call(this,u,u,u,f),F(this,Me,$x).call(this,f);const v=(E,A)=>{const T=a[E]/255,_=l[E]/255,b=new Array(A+1);for(let g=0;g<=A;g++)b[g]=T+g/A*(_-T);return b.join(",")};return F(this,Me,Py).call(this,v(0,5),v(1,5),v(2,5),f),o.url=F(this,Me,Yf).call(this,h),o.url}addAlphaFilter(t){let r=d(this,Me,li).get(t);if(r)return r;const[i]=F(this,Me,Wb).call(this,[t]),s=`alpha_${i}`;if(r=d(this,Me,li).get(s),r)return d(this,Me,li).set(t,r),r;const o=`g_${d(this,_l)}_alpha_map_${Si(this,sh)._++}`,a=F(this,Me,Yf).call(this,o);d(this,Me,li).set(t,a),d(this,Me,li).set(s,a);const l=F(this,Me,Qf).call(this,o);return F(this,Me,jx).call(this,i,l),a}addLuminosityFilter(t){let r=d(this,Me,li).get(t||"luminosity");if(r)return r;let i,s;if(t?([i]=F(this,Me,Wb).call(this,[t]),s=`luminosity_${i}`):s="luminosity",r=d(this,Me,li).get(s),r)return d(this,Me,li).set(t,r),r;const o=`g_${d(this,_l)}_luminosity_map_${Si(this,sh)._++}`,a=F(this,Me,Yf).call(this,o);d(this,Me,li).set(t,a),d(this,Me,li).set(s,a);const l=F(this,Me,Qf).call(this,o);return F(this,Me,y5).call(this,l),t&&F(this,Me,jx).call(this,i,l),a}addHighlightHCMFilter(t,r,i,s,o){var _;const a=`${r}-${i}-${s}-${o}`;let l=d(this,Me,xy).get(t);if((l==null?void 0:l.key)===a||(l?((_=l.filter)==null||_.remove(),l.key=a,l.url="none",l.filter=null):(l={key:a,url:"none",filter:null},d(this,Me,xy).set(t,l)),!r||!i))return l.url;const[c,u]=[r,i].map(F(this,Me,Ry).bind(this));let h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),f=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[v,w]=[s,o].map(F(this,Me,Ry).bind(this));f<h&&([h,f,v,w]=[f,h,w,v]),d(this,Me,Kf).style.color="";const E=(b,g,y)=>{const x=new Array(256),S=(f-h)/y,I=b/255,P=(g-b)/(255*y);let N=0;for(let M=0;M<=y;M++){const V=Math.round(h+M*S),L=I+M*P;for(let j=N;j<=V;j++)x[j]=L;N=V+1}for(let M=N;M<256;M++)x[M]=x[N-1];return x.join(",")},A=`g_${d(this,_l)}_hcm_${t}_filter`,T=l.filter=F(this,Me,Qf).call(this,A);return F(this,Me,$x).call(this,T),F(this,Me,Py).call(this,E(v[0],w[0],5),E(v[1],w[1],5),E(v[2],w[2],5),T),l.url=F(this,Me,Yf).call(this,A),l.url}destroy(t=!1){var r,i,s,o;t&&((r=d(this,ih))!=null&&r.size)||((i=d(this,bl))==null||i.parentNode.parentNode.remove(),R(this,bl,null),(s=d(this,Xp))==null||s.clear(),R(this,Xp,null),(o=d(this,ih))==null||o.clear(),R(this,ih,null),R(this,sh,0))}}rh=new WeakMap,Xp=new WeakMap,bl=new WeakMap,_l=new WeakMap,ui=new WeakMap,ih=new WeakMap,sh=new WeakMap,Me=new WeakSet,li=function(){return d(this,Xp)||R(this,Xp,new Map)},xy=function(){return d(this,ih)||R(this,ih,new Map)},Kf=function(){if(!d(this,bl)){const t=d(this,ui).createElement("div"),{style:r}=t;r.visibility="hidden",r.contain="strict",r.width=r.height=0,r.position="absolute",r.top=r.left=0,r.zIndex=-1;const i=d(this,ui).createElementNS(nl,"svg");i.setAttribute("width",0),i.setAttribute("height",0),R(this,bl,d(this,ui).createElementNS(nl,"defs")),t.append(i),i.append(d(this,bl)),d(this,ui).body.append(t)}return d(this,bl)},Wb=function(t){if(t.length===1){const c=t[0],u=new Array(256);for(let f=0;f<256;f++)u[f]=c[f]/255;const h=u.join(",");return[h,h,h]}const[r,i,s]=t,o=new Array(256),a=new Array(256),l=new Array(256);for(let c=0;c<256;c++)o[c]=r[c]/255,a[c]=i[c]/255,l[c]=s[c]/255;return[o.join(","),a.join(","),l.join(",")]},Yf=function(t){if(d(this,rh)===void 0){R(this,rh,"");const r=d(this,ui).URL;r!==d(this,ui).baseURI&&(Z0(r)?wt('#createUrl: ignore "data:"-URL for performance reasons.'):R(this,rh,dk(r,"")))}return`url(${d(this,rh)}#${t})`},y5=function(t){const r=d(this,ui).createElementNS(nl,"feColorMatrix");r.setAttribute("type","matrix"),r.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(r)},$x=function(t){const r=d(this,ui).createElementNS(nl,"feColorMatrix");r.setAttribute("type","matrix"),r.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(r)},Qf=function(t){const r=d(this,ui).createElementNS(nl,"filter");return r.setAttribute("color-interpolation-filters","sRGB"),r.setAttribute("id",t),d(this,Me,Kf).append(r),r},Cy=function(t,r,i){const s=d(this,ui).createElementNS(nl,r);s.setAttribute("type","discrete"),s.setAttribute("tableValues",i),t.append(s)},Py=function(t,r,i,s){const o=d(this,ui).createElementNS(nl,"feComponentTransfer");s.append(o),F(this,Me,Cy).call(this,o,"feFuncR",t),F(this,Me,Cy).call(this,o,"feFuncG",r),F(this,Me,Cy).call(this,o,"feFuncB",i)},jx=function(t,r){const i=d(this,ui).createElementNS(nl,"feComponentTransfer");r.append(i),F(this,Me,Cy).call(this,i,"feFuncA",t)},Ry=function(t){return d(this,Me,Kf).style.color=t,pk(getComputedStyle(d(this,Me,Kf)).getPropertyValue("color"))};class v5{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(r=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){hn("Abstract method `_fetch` called.")}}class ON extends v5{async _fetch(e){const t=await Cg(e,"arraybuffer");return new Uint8Array(t)}}class w5{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(r=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){hn("Abstract method `_fetch` called.")}}class FN extends w5{async _fetch(e){const t=await Cg(e,"arraybuffer");return new Uint8Array(t)}}Ri&&wt("Please use the `legacy` build in Node.js environments.");async function gk(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class DJ extends g5{}class MJ extends p5{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class NJ extends m5{async _fetch(e){return gk(e)}}class LJ extends v5{async _fetch(e){return gk(e)}}class OJ extends w5{async _fetch(e){return gk(e)}}const Qr={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function zx(n,e){if(!e)return;const t=e[2]-e[0],r=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,r),n.clip(i)}class yk{isModifyingCurrentTransform(){return!1}getPattern(){hn("Abstract method `getPattern` called.")}}class FJ extends yk{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const r of this._colorStops)t.addColorStop(r[0],r[1]);return t}getPattern(e,t,r,i){let s;if(i===Qr.STROKE||i===Qr.FILL){const o=t.current.getClippedPathBoundingBox(i,Fn(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,l=Math.ceil(o[3]-o[1])||1,c=t.cachedCanvases.getCanvas("pattern",a,l),u=c.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-o[0],-o[1]),r=Ke.transform(r,[1,0,0,1,o[0],o[1]]),u.transform(...t.baseTransform),this.matrix&&u.transform(...this.matrix),zx(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),s=e.createPattern(c.canvas,"no-repeat");const h=new DOMMatrix(r);s.setTransform(h)}else zx(e,this._bbox),s=this._createGradient(e);return s}}function bT(n,e,t,r,i,s,o,a){const l=e.coords,c=e.colors,u=n.data,h=n.width*4;let f;l[t+1]>l[r+1]&&(f=t,t=r,r=f,f=s,s=o,o=f),l[r+1]>l[i+1]&&(f=r,r=i,i=f,f=o,o=a,a=f),l[t+1]>l[r+1]&&(f=t,t=r,r=f,f=s,s=o,o=f);const v=(l[t]+e.offsetX)*e.scaleX,w=(l[t+1]+e.offsetY)*e.scaleY,E=(l[r]+e.offsetX)*e.scaleX,A=(l[r+1]+e.offsetY)*e.scaleY,T=(l[i]+e.offsetX)*e.scaleX,_=(l[i+1]+e.offsetY)*e.scaleY;if(w>=_)return;const b=c[s],g=c[s+1],y=c[s+2],x=c[o],S=c[o+1],I=c[o+2],P=c[a],N=c[a+1],M=c[a+2],V=Math.round(w),L=Math.round(_);let j,oe,$,B,G,Z,ee,fe;for(let ae=V;ae<=L;ae++){if(ae<A){const ie=ae<w?0:(w-ae)/(w-A);j=v-(v-E)*ie,oe=b-(b-x)*ie,$=g-(g-S)*ie,B=y-(y-I)*ie}else{let ie;ae>_?ie=1:A===_?ie=0:ie=(A-ae)/(A-_),j=E-(E-T)*ie,oe=x-(x-P)*ie,$=S-(S-N)*ie,B=I-(I-M)*ie}let _e;ae<w?_e=0:ae>_?_e=1:_e=(w-ae)/(w-_),G=v-(v-T)*_e,Z=b-(b-P)*_e,ee=g-(g-N)*_e,fe=y-(y-M)*_e;const Qe=Math.round(Math.min(j,G)),Ye=Math.round(Math.max(j,G));let gt=h*ae+Qe*4;for(let ie=Qe;ie<=Ye;ie++)_e=(j-ie)/(j-G),_e<0?_e=0:_e>1&&(_e=1),u[gt++]=oe-(oe-Z)*_e|0,u[gt++]=$-($-ee)*_e|0,u[gt++]=B-(B-fe)*_e|0,u[gt++]=255}}function VJ(n,e,t){const r=e.coords,i=e.colors;let s,o;switch(e.type){case"lattice":const a=e.verticesPerRow,l=Math.floor(r.length/a)-1,c=a-1;for(s=0;s<l;s++){let u=s*a;for(let h=0;h<c;h++,u++)bT(n,t,r[u],r[u+1],r[u+a],i[u],i[u+1],i[u+a]),bT(n,t,r[u+a+1],r[u+1],r[u+a],i[u+a+1],i[u+1],i[u+a])}break;case"triangles":for(s=0,o=r.length;s<o;s+=3)bT(n,t,r[s],r[s+1],r[s+2],i[s],i[s+1],i[s+2]);break;default:throw new Error("illegal figure")}}class UJ extends yk{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,r){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,u=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(u*e[1]*1.1)),3e3),v=c/h,w=u/f,E={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/v,scaleY:1/w},A=h+2*2,T=f+2*2,_=r.getCanvas("mesh",A,T),b=_.context,g=b.createImageData(h,f);if(t){const x=g.data;for(let S=0,I=x.length;S<I;S+=4)x[S]=t[0],x[S+1]=t[1],x[S+2]=t[2],x[S+3]=255}for(const x of this._figures)VJ(g,x,E);return b.putImageData(g,2,2),{canvas:_.canvas,offsetX:a-2*v,offsetY:l-2*w,scaleX:v,scaleY:w}}isModifyingCurrentTransform(){return!0}getPattern(e,t,r,i){zx(e,this._bbox);const s=new Float32Array(2);if(i===Qr.SHADING)Ke.singularValueDecompose2dScale(Fn(e),s);else if(this.matrix){Ke.singularValueDecompose2dScale(this.matrix,s);const[a,l]=s;Ke.singularValueDecompose2dScale(t.baseTransform,s),s[0]*=a,s[1]*=l}else Ke.singularValueDecompose2dScale(t.baseTransform,s);const o=this._createMeshCanvas(s,i===Qr.SHADING?null:this._background,t.cachedCanvases);return i!==Qr.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class BJ extends yk{getPattern(){return"hotpink"}}function $J(n){switch(n[0]){case"RadialAxial":return new FJ(n);case"Mesh":return new UJ(n);case"Dummy":return new BJ}throw new Error(`Unknown IR type: ${n[0]}`)}const VN={COLORED:1,UNCOLORED:2},US=class US{constructor(e,t,r,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=r,this.baseTransform=i}createPatternCanvas(e){const{bbox:t,operatorList:r,paintType:i,tilingType:s,color:o,canvasGraphicsFactory:a}=this;let{xstep:l,ystep:c}=this;l=Math.abs(l),c=Math.abs(c),UA("TilingType: "+s);const u=t[0],h=t[1],f=t[2],v=t[3],w=f-u,E=v-h,A=new Float32Array(2);Ke.singularValueDecompose2dScale(this.matrix,A);const[T,_]=A;Ke.singularValueDecompose2dScale(this.baseTransform,A);const b=T*A[0],g=_*A[1];let y=w,x=E,S=!1,I=!1;const P=Math.ceil(l*b),N=Math.ceil(c*g),M=Math.ceil(w*b),V=Math.ceil(E*g);P>=M?y=l:S=!0,N>=V?x=c:I=!0;const L=this.getSizeAndScale(y,this.ctx.canvas.width,b),j=this.getSizeAndScale(x,this.ctx.canvas.height,g),oe=e.cachedCanvases.getCanvas("pattern",L.size,j.size),$=oe.context,B=a.createCanvasGraphics($);if(B.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(B,i,o),$.translate(-L.scale*u,-j.scale*h),B.transform(L.scale,0,0,j.scale,0,0),$.save(),this.clipBbox(B,u,h,f,v),B.baseTransform=Fn(B.ctx),B.executeOperatorList(r),B.endDrawing(),$.restore(),S||I){const G=oe.canvas;S&&(y=l),I&&(x=c);const Z=this.getSizeAndScale(y,this.ctx.canvas.width,b),ee=this.getSizeAndScale(x,this.ctx.canvas.height,g),fe=Z.size,ae=ee.size,_e=e.cachedCanvases.getCanvas("pattern-workaround",fe,ae),Qe=_e.context,Ye=S?Math.floor(w/l):0,gt=I?Math.floor(E/c):0;for(let ie=0;ie<=Ye;ie++)for(let ot=0;ot<=gt;ot++)Qe.drawImage(G,fe*ie,ae*ot,fe,ae,0,0,fe,ae);return{canvas:_e.canvas,scaleX:Z.scale,scaleY:ee.scale,offsetX:u,offsetY:h}}return{canvas:oe.canvas,scaleX:L.scale,scaleY:j.scale,offsetX:u,offsetY:h}}getSizeAndScale(e,t,r){const i=Math.max(US.MAX_PATTERN_SIZE,t);let s=Math.ceil(e*r);return s>=i?s=i:r=s/e,{scale:r,size:s}}clipBbox(e,t,r,i,s){const o=i-t,a=s-r;e.ctx.rect(t,r,o,a),Ke.axialAlignedBoundingBox([t,r,i,s],Fn(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,r){const i=e.ctx,s=e.current;switch(t){case VN.COLORED:const{fillStyle:o,strokeStyle:a}=this.ctx;i.fillStyle=s.fillColor=o,i.strokeStyle=s.strokeColor=a;break;case VN.UNCOLORED:i.fillStyle=i.strokeStyle=r,s.fillColor=s.strokeColor=r;break;default:throw new dJ(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,r,i){let s=r;i!==Qr.SHADING&&(s=Ke.transform(s,t.baseTransform),this.matrix&&(s=Ke.transform(s,this.matrix)));const o=this.createPatternCanvas(t);let a=new DOMMatrix(s);a=a.translate(o.offsetX,o.offsetY),a=a.scale(1/o.scaleX,1/o.scaleY);const l=e.createPattern(o.canvas,"repeat");return l.setTransform(a),l}};ge(US,"MAX_PATTERN_SIZE",3e3);let Hx=US;function jJ({src:n,srcPos:e=0,dest:t,width:r,height:i,nonBlackColor:s=4294967295,inverseDecode:o=!1}){const a=Ur.isLittleEndian?4278190080:255,[l,c]=o?[s,a]:[a,s],u=r>>3,h=r&7,f=n.length;t=new Uint32Array(t.buffer);let v=0;for(let w=0;w<i;w++){for(const A=e+u;e<A;e++){const T=e<f?n[e]:255;t[v++]=T&128?c:l,t[v++]=T&64?c:l,t[v++]=T&32?c:l,t[v++]=T&16?c:l,t[v++]=T&8?c:l,t[v++]=T&4?c:l,t[v++]=T&2?c:l,t[v++]=T&1?c:l}if(h===0)continue;const E=e<f?n[e++]:255;for(let A=0;A<h;A++)t[v++]=E&1<<7-A?c:l}return{srcPos:e,destPos:v}}const UN=16,BN=100,zJ=15,$N=10,Ki=16,_T=new DOMMatrix,Rs=new Float32Array(2),fp=new Float32Array([1/0,1/0,-1/0,-1/0]);function HJ(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(t,r){e.translate(t,r),this.__originalTranslate(t,r)},n.scale=function(t,r){e.scale(t,r),this.__originalScale(t,r)},n.transform=function(t,r,i,s,o,a){e.transform(t,r,i,s,o,a),this.__originalTransform(t,r,i,s,o,a)},n.setTransform=function(t,r,i,s,o,a){e.setTransform(t,r,i,s,o,a),this.__originalSetTransform(t,r,i,s,o,a)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(t){e.rotate(t),this.__originalRotate(t)},n.clip=function(t){e.clip(t),this.__originalClip(t)},n.moveTo=function(t,r){e.moveTo(t,r),this.__originalMoveTo(t,r)},n.lineTo=function(t,r){e.lineTo(t,r),this.__originalLineTo(t,r)},n.bezierCurveTo=function(t,r,i,s,o,a){e.bezierCurveTo(t,r,i,s,o,a),this.__originalBezierCurveTo(t,r,i,s,o,a)},n.rect=function(t,r,i,s){e.rect(t,r,i,s),this.__originalRect(t,r,i,s)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class GJ{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,r){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,r)):(i=this.canvasFactory.create(t,r),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function qE(n,e,t,r,i,s,o,a,l,c){const[u,h,f,v,w,E]=Fn(n);if(h===0&&f===0){const _=o*u+w,b=Math.round(_),g=a*v+E,y=Math.round(g),x=(o+l)*u+w,S=Math.abs(Math.round(x)-b)||1,I=(a+c)*v+E,P=Math.abs(Math.round(I)-y)||1;return n.setTransform(Math.sign(u),0,0,Math.sign(v),b,y),n.drawImage(e,t,r,i,s,0,0,S,P),n.setTransform(u,h,f,v,w,E),[S,P]}if(u===0&&v===0){const _=a*f+w,b=Math.round(_),g=o*h+E,y=Math.round(g),x=(a+c)*f+w,S=Math.abs(Math.round(x)-b)||1,I=(o+l)*h+E,P=Math.abs(Math.round(I)-y)||1;return n.setTransform(0,Math.sign(h),Math.sign(f),0,b,y),n.drawImage(e,t,r,i,s,0,0,P,S),n.setTransform(u,h,f,v,w,E),[P,S]}n.drawImage(e,t,r,i,s,o,a,l,c);const A=Math.hypot(u,h),T=Math.hypot(f,v);return[A*l,T*c]}class jN{constructor(e,t){ge(this,"alphaIsShape",!1);ge(this,"fontSize",0);ge(this,"fontSizeScale",1);ge(this,"textMatrix",null);ge(this,"textMatrixScale",1);ge(this,"fontMatrix",bx);ge(this,"leading",0);ge(this,"x",0);ge(this,"y",0);ge(this,"lineX",0);ge(this,"lineY",0);ge(this,"charSpacing",0);ge(this,"wordSpacing",0);ge(this,"textHScale",1);ge(this,"textRenderingMode",ai.FILL);ge(this,"textRise",0);ge(this,"fillColor","#000000");ge(this,"strokeColor","#000000");ge(this,"patternFill",!1);ge(this,"patternStroke",!1);ge(this,"fillAlpha",1);ge(this,"strokeAlpha",1);ge(this,"lineWidth",1);ge(this,"activeSMask",null);ge(this,"transferMaps","none");this.clipBox=new Float32Array([0,0,e,t]),this.minMax=fp.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Qr.FILL,t=null){const r=this.minMax.slice();if(e===Qr.STROKE){t||hn("Stroke bounding box must include transform."),Ke.singularValueDecompose2dScale(t,Rs);const i=Rs[0]*this.lineWidth/2,s=Rs[1]*this.lineWidth/2;r[0]-=i,r[1]-=s,r[2]+=i,r[3]+=s}return r}updateClipFromPath(){const e=Ke.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(fp,0)}getClippedPathBoundingBox(e=Qr.FILL,t=null){return Ke.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function zN(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,r=e.width,i=t%Ki,s=(t-i)/Ki,o=i===0?s:s+1,a=n.createImageData(r,Ki);let l=0,c;const u=e.data,h=a.data;let f,v,w,E;if(e.kind===av.GRAYSCALE_1BPP){const A=u.byteLength,T=new Uint32Array(h.buffer,0,h.byteLength>>2),_=T.length,b=r+7>>3,g=4294967295,y=Ur.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(w=f<s?Ki:i,c=0,v=0;v<w;v++){const x=A-l;let S=0;const I=x>b?r:x*8-7,P=I&-8;let N=0,M=0;for(;S<P;S+=8)M=u[l++],T[c++]=M&128?g:y,T[c++]=M&64?g:y,T[c++]=M&32?g:y,T[c++]=M&16?g:y,T[c++]=M&8?g:y,T[c++]=M&4?g:y,T[c++]=M&2?g:y,T[c++]=M&1?g:y;for(;S<I;S++)N===0&&(M=u[l++],N=128),T[c++]=M&N?g:y,N>>=1}for(;c<_;)T[c++]=0;n.putImageData(a,0,f*Ki)}}else if(e.kind===av.RGBA_32BPP){for(v=0,E=r*Ki*4,f=0;f<s;f++)h.set(u.subarray(l,l+E)),l+=E,n.putImageData(a,0,v),v+=Ki;f<o&&(E=r*i*4,h.set(u.subarray(l,l+E)),n.putImageData(a,0,v))}else if(e.kind===av.RGB_24BPP)for(w=Ki,E=r*w,f=0;f<o;f++){for(f>=s&&(w=i,E=r*w),c=0,v=E;v--;)h[c++]=u[l++],h[c++]=u[l++],h[c++]=u[l++],h[c++]=255;n.putImageData(a,0,f*Ki)}else throw new Error(`bad image kind: ${e.kind}`)}function HN(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,r=e.width,i=t%Ki,s=(t-i)/Ki,o=i===0?s:s+1,a=n.createImageData(r,Ki);let l=0;const c=e.data,u=a.data;for(let h=0;h<o;h++){const f=h<s?Ki:i;({srcPos:l}=jJ({src:c,srcPos:l,dest:u,width:r,height:f,nonBlackColor:0})),n.putImageData(a,0,h*Ki)}}function ey(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const r of t)n[r]!==void 0&&(e[r]=n[r]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function KE(n){n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0);const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}function GN(n,e){if(e)return!0;Ke.singularValueDecompose2dScale(n,Rs);const t=Math.fround(Qo.pixelRatio*ac.PDF_TO_CSS_UNITS);return Rs[0]<=t&&Rs[1]<=t}const WJ=["butt","round","square"],qJ=["miter","round","bevel"],KJ={},WN={};var Xo,Gx,Wx,qx;const zk=class zk{constructor(e,t,r,i,s,{optionalContentConfig:o,markedContentStack:a=null},l,c){O(this,Xo);this.ctx=e,this.current=new jN(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=r,this.canvasFactory=i,this.filterFactory=s,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new GJ(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:r=!1,background:i=null}){const s=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,s,o),this.ctx.fillStyle=a,r){const l=this.cachedCanvases.getCanvas("transparent",s,o);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Fn(this.compositeCtx))}this.ctx.save(),KE(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Fn(this.ctx)}executeOperatorList(e,t,r,i){const s=e.argsArray,o=e.fnArray;let a=t||0;const l=s.length;if(l===a)return a;const c=l-a>$N&&typeof r=="function",u=c?Date.now()+zJ:0;let h=0;const f=this.commonObjs,v=this.objs;let w;for(;;){if(i!==void 0&&a===i.nextBreakPoint)return i.breakIt(a,r),a;if(w=o[a],w!==jv.dependency)this[w].apply(this,s[a]);else for(const E of s[a]){const A=E.startsWith("g_")?f:v;if(!A.has(E))return A.get(E,r),a}if(a++,a===l)return a;if(c&&++h>$N){if(Date.now()>u)return r(),a;h=0}}}endDrawing(){F(this,Xo,Gx).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),F(this,Xo,Wx).call(this)}_scaleImage(e,t){const r=e.width??e.displayWidth,i=e.height??e.displayHeight;let s=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=r,l=i,c="prescale1",u,h;for(;s>2&&a>1||o>2&&l>1;){let f=a,v=l;s>2&&a>1&&(f=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),s/=a/f),o>2&&l>1&&(v=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,o/=l/v),u=this.cachedCanvases.getCanvas(c,f,v),h=u.context,h.clearRect(0,0,f,v),h.drawImage(e,0,0,a,l,0,0,f,v),e=u.canvas,a=f,l=v,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:r,height:i}=e,s=this.current.fillColor,o=this.current.patternFill,a=Fn(t);let l,c,u,h;if((e.bitmap||e.data)&&e.count>1){const P=e.bitmap||e.data.buffer;c=JSON.stringify(o?a:[a.slice(0,4),s]),l=this._cachedBitmapsMap.get(P),l||(l=new Map,this._cachedBitmapsMap.set(P,l));const N=l.get(c);if(N&&!o){const M=Math.round(Math.min(a[0],a[2])+a[4]),V=Math.round(Math.min(a[1],a[3])+a[5]);return{canvas:N,offsetX:M,offsetY:V}}u=N}u||(h=this.cachedCanvases.getCanvas("maskCanvas",r,i),HN(h.context,e));let f=Ke.transform(a,[1/r,0,0,-1/i,0,0]);f=Ke.transform(f,[1,0,0,1,0,-i]);const v=fp.slice();Ke.axialAlignedBoundingBox([0,0,r,i],f,v);const[w,E,A,T]=v,_=Math.round(A-w)||1,b=Math.round(T-E)||1,g=this.cachedCanvases.getCanvas("fillCanvas",_,b),y=g.context,x=w,S=E;y.translate(-x,-S),y.transform(...f),u||(u=this._scaleImage(h.canvas,oa(y)),u=u.img,l&&o&&l.set(c,u)),y.imageSmoothingEnabled=GN(Fn(y),e.interpolate),qE(y,u,0,0,u.width,u.height,0,0,r,i),y.globalCompositeOperation="source-in";const I=Ke.transform(oa(y),[1,0,0,1,-x,-S]);return y.fillStyle=o?s.getPattern(t,this,I,Qr.FILL):s,y.fillRect(0,0,r,i),l&&!o&&(this.cachedCanvases.delete("fillCanvas"),l.set(c,g.canvas)),{canvas:g.canvas,offsetX:Math.round(x),offsetY:Math.round(S)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=WJ[e]}setLineJoin(e){this.ctx.lineJoin=qJ[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(e),r.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,r]of e)switch(t){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r[0],r[1]);break;case"CA":this.current.strokeAlpha=r;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=r;break;case"BM":this.ctx.globalCompositeOperation=r;break;case"SMask":this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(r,e,t);this.suspendedCtx=this.ctx;const s=this.ctx=i.context;s.setTransform(this.suspendedCtx.getTransform()),ey(this.suspendedCtx,s),HJ(s,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ey(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,r=this.suspendedCtx;this.composeSMask(r,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,r,i){const s=i[0],o=i[1],a=i[2]-s,l=i[3]-o;a===0||l===0||(this.genericComposeSMask(t.context,r,a,l,t.subtype,t.backdrop,t.transferMap,s,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(r.canvas,0,0),e.restore())}genericComposeSMask(e,t,r,i,s,o,a,l,c,u,h){let f=e.canvas,v=l-u,w=c-h;if(o)if(v<0||w<0||v+r>f.width||w+i>f.height){const A=this.cachedCanvases.getCanvas("maskExtension",r,i),T=A.context;T.drawImage(f,-v,-w),T.globalCompositeOperation="destination-atop",T.fillStyle=o,T.fillRect(0,0,r,i),T.globalCompositeOperation="source-over",f=A.canvas,v=w=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const A=new Path2D;A.rect(v,w,r,i),e.clip(A),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(v,w,r,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),s==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):s==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));const E=new Path2D;E.rect(l,c,r,i),t.clip(E),t.globalCompositeOperation="destination-in",t.drawImage(f,v,w,r,i,l,c,r,i),t.restore()}save(){this.inSMaskMode&&ey(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&ey(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,r,i,s,o){this.ctx.transform(e,t,r,i,s,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,r){let[i]=t;if(!r){i||(i=t[0]=new Path2D),this[e](i);return}if(!(i instanceof Path2D)){const s=t[0]=new Path2D;for(let o=0,a=i.length;o<a;)switch(i[o++]){case HE.moveTo:s.moveTo(i[o++],i[o++]);break;case HE.lineTo:s.lineTo(i[o++],i[o++]);break;case HE.curveTo:s.bezierCurveTo(i[o++],i[o++],i[o++],i[o++],i[o++],i[o++]);break;case HE.closePath:s.closePath();break;default:wt(`Unrecognized drawing path operator: ${i[o-1]}`);break}i=s}Ke.axialAlignedBoundingBox(r,Fn(this.ctx),this.current.minMax),this[e](i)}closePath(){this.ctx.closePath()}stroke(e,t=!0){const r=this.ctx,i=this.current.strokeColor;if(r.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof i=="object"&&(i!=null&&i.getPattern)){const s=i.isModifyingCurrentTransform()?r.getTransform():null;if(r.save(),r.strokeStyle=i.getPattern(r,this,oa(r),Qr.STROKE),s){const o=new Path2D;o.addPath(e,r.getTransform().invertSelf().multiplySelf(s)),e=o}this.rescaleAndStroke(e,!1),r.restore()}else this.rescaleAndStroke(e,!0);t&&this.consumePath(e,this.current.getClippedPathBoundingBox(Qr.STROKE,Fn(this.ctx))),r.globalAlpha=this.current.fillAlpha}closeStroke(e){this.stroke(e)}fill(e,t=!0){const r=this.ctx,i=this.current.fillColor,s=this.current.patternFill;let o=!1;if(s){const l=i.isModifyingCurrentTransform()?r.getTransform():null;if(r.save(),r.fillStyle=i.getPattern(r,this,oa(r),Qr.FILL),l){const c=new Path2D;c.addPath(e,r.getTransform().invertSelf().multiplySelf(l)),e=c}o=!0}const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(r.fill(e,"evenodd"),this.pendingEOFill=!1):r.fill(e)),o&&r.restore(),t&&this.consumePath(e,a)}eoFill(e){this.pendingEOFill=!0,this.fill(e)}fillStroke(e){this.fill(e,!1),this.stroke(e,!1),this.consumePath(e)}eoFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}closeFillStroke(e){this.fillStroke(e)}closeEOFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}endPath(e){this.consumePath(e)}rawFillPath(e){this.ctx.fill(e)}clip(){this.pendingClip=KJ}eoClip(){this.pendingClip=WN}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0)return;const r=new Path2D,i=t.getTransform().invertSelf();for(const{transform:s,x:o,y:a,fontSize:l,path:c}of e)r.addPath(c,new DOMMatrix(s).preMultiplySelf(i).translate(o,a).scale(l,-l));t.clip(r),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var u;const r=this.commonObjs.get(e),i=this.current;if(!r)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=r.fontMatrix||bx,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&wt("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=r,this.current.fontSize=t,r.isType3Font)return;const s=r.loadedName||"sans-serif",o=((u=r.systemFontInfo)==null?void 0:u.css)||`"${s}", ${r.fallbackName}`;let a="normal";r.black?a="900":r.bold&&(a="bold");const l=r.italic?"italic":"normal";let c=t;t<UN?c=UN:t>BN&&(c=BN),this.current.fontSizeScale=t/c,this.ctx.font=`${l} ${a} ${c}px ${o}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e){const{current:t}=this;t.textMatrix=e,t.textMatrixScale=Math.hypot(e[0],e[1]),t.x=t.lineX=0,t.y=t.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,r,i,s){const o=this.ctx,a=this.current,l=a.font,c=a.textRenderingMode,u=a.fontSize/a.fontSizeScale,h=c&ai.FILL_STROKE_MASK,f=!!(c&ai.ADD_TO_PATH_FLAG),v=a.patternFill&&!l.missingFile,w=a.patternStroke&&!l.missingFile;let E;if((l.disableFontFace||f||v||w)&&(E=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||v||w){o.save(),o.translate(t,r),o.scale(u,-u);let A;if((h===ai.FILL||h===ai.FILL_STROKE)&&(i?(A=o.getTransform(),o.setTransform(...i),o.fill(F(this,Xo,qx).call(this,E,A,i))):o.fill(E)),h===ai.STROKE||h===ai.FILL_STROKE)if(s){A||(A=o.getTransform()),o.setTransform(...s);const{a:T,b:_,c:b,d:g}=A,y=Ke.inverseTransform(s),x=Ke.transform([T,_,b,g,0,0],y);Ke.singularValueDecompose2dScale(x,Rs),o.lineWidth*=Math.max(Rs[0],Rs[1])/u,o.stroke(F(this,Xo,qx).call(this,E,A,s))}else o.lineWidth/=u,o.stroke(E);o.restore()}else(h===ai.FILL||h===ai.FILL_STROKE)&&o.fillText(e,t,r),(h===ai.STROKE||h===ai.FILL_STROKE)&&o.strokeText(e,t,r);f&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Fn(o),x:t,y:r,fontSize:u,path:E})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let r=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){r=!0;break}return Dt(this,"isFontSubpixelAAEnabled",r)}showText(e){const t=this.current,r=t.font;if(r.isType3Font)return this.showType3Text(e);const i=t.fontSize;if(i===0)return;const s=this.ctx,o=t.fontSizeScale,a=t.charSpacing,l=t.wordSpacing,c=t.fontDirection,u=t.textHScale*c,h=e.length,f=r.vertical,v=f?1:-1,w=r.defaultVMetrics,E=i*t.fontMatrix[0],A=t.textRenderingMode===ai.FILL&&!r.disableFontFace&&!t.patternFill;s.save(),t.textMatrix&&s.transform(...t.textMatrix),s.translate(t.x,t.y+t.textRise),c>0?s.scale(u,-1):s.scale(u,1);let T,_;if(t.patternFill){s.save();const S=t.fillColor.getPattern(s,this,oa(s),Qr.FILL);T=Fn(s),s.restore(),s.fillStyle=S}if(t.patternStroke){s.save();const S=t.strokeColor.getPattern(s,this,oa(s),Qr.STROKE);_=Fn(s),s.restore(),s.strokeStyle=S}let b=t.lineWidth;const g=t.textMatrixScale;if(g===0||b===0){const S=t.textRenderingMode&ai.FILL_STROKE_MASK;(S===ai.STROKE||S===ai.FILL_STROKE)&&(b=this.getSinglePixelWidth())}else b/=g;if(o!==1&&(s.scale(o,o),b/=o),s.lineWidth=b,r.isInvalidPDFjsFont){const S=[];let I=0;for(const P of e)S.push(P.unicode),I+=P.width;s.fillText(S.join(""),0,0),t.x+=I*E*u,s.restore(),this.compose();return}let y=0,x;for(x=0;x<h;++x){const S=e[x];if(typeof S=="number"){y+=v*S*i/1e3;continue}let I=!1;const P=(S.isSpace?l:0)+a,N=S.fontChar,M=S.accent;let V,L,j=S.width;if(f){const $=S.vmetric||w,B=-(S.vmetric?$[1]:j*.5)*E,G=$[2]*E;j=$?-$[0]:j,V=B/o,L=(y+G)/o}else V=y/o,L=0;if(r.remeasure&&j>0){const $=s.measureText(N).width*1e3/i*o;if(j<$&&this.isFontSubpixelAAEnabled){const B=j/$;I=!0,s.save(),s.scale(B,1),V/=B}else j!==$&&(V+=(j-$)/2e3*i/o)}if(this.contentVisible&&(S.isInFont||r.missingFile)){if(A&&!M)s.fillText(N,V,L);else if(this.paintChar(N,V,L,T,_),M){const $=V+i*M.offset.x/o,B=L-i*M.offset.y/o;this.paintChar(M.fontChar,$,B,T,_)}}const oe=f?j*E-P*c:j*E+P*c;y+=oe,I&&s.restore()}f?t.y-=y:t.x+=y*u,s.restore(),this.compose()}showType3Text(e){const t=this.ctx,r=this.current,i=r.font,s=r.fontSize,o=r.fontDirection,a=i.vertical?1:-1,l=r.charSpacing,c=r.wordSpacing,u=r.textHScale*o,h=r.fontMatrix||bx,f=e.length,v=r.textRenderingMode===ai.INVISIBLE;let w,E,A,T;if(!(v||s===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),r.textMatrix&&t.transform(...r.textMatrix),t.translate(r.x,r.y+r.textRise),t.scale(u,o),w=0;w<f;++w){if(E=e[w],typeof E=="number"){T=a*E*s/1e3,this.ctx.translate(T,0),r.x+=T*u;continue}const _=(E.isSpace?c:0)+l,b=i.charProcOperatorList[E.operatorListId];b?this.contentVisible&&(this.save(),t.scale(s,s),t.transform(...h),this.executeOperatorList(b),this.restore()):wt(`Type3 character "${E.operatorListId}" is not available.`);const g=[E.width,0];Ke.applyTransform(g,h),A=g[0]*s+_,t.translate(A,0),r.x+=A*u}t.restore()}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,r,i,s,o){const a=new Path2D;a.rect(r,i,s-r,o-i),this.ctx.clip(a),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const r=this.baseTransform||Fn(this.ctx),i={createCanvasGraphics:s=>new zk(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Hx(e,this.ctx,i,r)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e){this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e){this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let r;return this.cachedPatterns.has(e)?r=this.cachedPatterns.get(e):(r=$J(this.getObject(e)),this.cachedPatterns.set(e,r)),t&&(r.matrix=t),r}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const r=this._getPattern(e);t.fillStyle=r.getPattern(t,this,oa(t),Qr.SHADING);const i=oa(t);if(i){const{width:s,height:o}=t.canvas,a=fp.slice();Ke.axialAlignedBoundingBox([0,0,s,o],i,a);const[l,c,u,h]=a;this.ctx.fillRect(l,c,u-l,h-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){hn("Should not call beginInlineImage")}beginImageData(){hn("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Fn(this.ctx),t)){Ke.axialAlignedBoundingBox(t,this.baseTransform,this.current.minMax);const[r,i,s,o]=t,a=new Path2D;a.rect(r,i,s-r,o-i),this.ctx.clip(a),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||UA("TODO: Support non-isolated groups."),e.knockout&&wt("Knockout groups not supported.");const r=Fn(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=fp.slice();Ke.axialAlignedBoundingBox(e.bbox,Fn(t),i);const s=[0,0,t.canvas.width,t.canvas.height];i=Ke.intersect(i,s)||[0,0,0,0];const o=Math.floor(i[0]),a=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-o,1),c=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,l,c]);let u="groupAt"+this.groupLevel;e.smask&&(u+="_smask_"+this.smaskCounter++%2);const h=this.cachedCanvases.getCanvas(u,l,c),f=h.context;f.translate(-o,-a),f.transform(...r);let v=new Path2D;const[w,E,A,T]=e.bbox;if(v.rect(w,E,A-w,T-E),e.matrix){const _=new Path2D;_.addPath(v,new DOMMatrix(e.matrix)),v=_}f.clip(v),e.smask?this.smaskStack.push({canvas:h.canvas,context:f,offsetX:o,offsetY:a,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(o,a),t.save()),ey(t,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=Fn(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const s=fp.slice();Ke.axialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],i,s),this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(s)}}beginAnnotation(e,t,r,i,s){if(F(this,Xo,Gx).call(this),KE(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const o=t[2]-t[0],a=t[3]-t[1];if(s&&this.annotationCanvasMap){r=r.slice(),r[4]-=t[0],r[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=o,t[3]=a,Ke.singularValueDecompose2dScale(Fn(this.ctx),Rs);const{viewportScale:l}=this,c=Math.ceil(o*this.outputScaleX*l),u=Math.ceil(a*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(c,u);const{canvas:h,context:f}=this.annotationCanvas;this.annotationCanvasMap.set(e,h),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(Rs[0],0,0,-Rs[1],0,a*Rs[1]),KE(this.ctx)}else{KE(this.ctx),this.endPath();const l=new Path2D;l.rect(t[0],t[1],o,a),this.ctx.clip(l)}}this.current=new jN(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...r),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),F(this,Xo,Wx).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const r=this.ctx,i=this._createMaskCanvas(e),s=i.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(s,i.offsetX,i.offsetY),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,r=0,i=0,s,o){if(!this.contentVisible)return;e=this.getObject(e.data,e);const a=this.ctx;a.save();const l=Fn(a);a.transform(t,r,i,s,0,0);const c=this._createMaskCanvas(e);a.setTransform(1,0,0,1,c.offsetX-l[4],c.offsetY-l[5]);for(let u=0,h=o.length;u<h;u+=2){const f=Ke.transform(l,[t,r,i,s,o[u],o[u+1]]);a.drawImage(c.canvas,f[4],f[5])}a.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,r=this.current.fillColor,i=this.current.patternFill;for(const s of e){const{data:o,width:a,height:l,transform:c}=s,u=this.cachedCanvases.getCanvas("maskCanvas",a,l),h=u.context;h.save();const f=this.getObject(o,s);HN(h,f),h.globalCompositeOperation="source-in",h.fillStyle=i?r.getPattern(h,this,oa(t),Qr.FILL):r,h.fillRect(0,0,a,l),h.restore(),t.save(),t.transform(...c),t.scale(1,-1),qE(t,u.canvas,0,0,a,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){wt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,r,i){if(!this.contentVisible)return;const s=this.getObject(e);if(!s){wt("Dependent image isn't ready yet");return}const o=s.width,a=s.height,l=[];for(let c=0,u=i.length;c<u;c+=2)l.push({transform:[t,0,0,r,i[c],i[c+1]],x:0,y:0,w:o,h:a});this.paintInlineImageXObjectGroup(s,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:r,height:i}=e,s=this.cachedCanvases.getCanvas("inlineImage",r,i),o=s.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",s.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,r=e.height,i=this.ctx;this.save();const{filter:s}=i;s!=="none"&&s!==""&&(i.filter="none"),i.scale(1/t,-1/r);let o;if(e.bitmap)o=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)o=e;else{const c=this.cachedCanvases.getCanvas("inlineImage",t,r).context;zN(c,e),o=this.applyTransferMapsToCanvas(c)}const a=this._scaleImage(o,oa(i));i.imageSmoothingEnabled=GN(Fn(i),e.interpolate),qE(i,a.img,0,0,a.paintWidth,a.paintHeight,0,-r,t,r),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const r=this.ctx;let i;if(e.bitmap)i=e.bitmap;else{const s=e.width,o=e.height,l=this.cachedCanvases.getCanvas("inlineImage",s,o).context;zN(l,e),i=this.applyTransferMapsToCanvas(l)}for(const s of t)r.save(),r.transform(...s.transform),r.scale(1,-1),qE(r,i,s.x,s.y,s.w,s.h,0,-1,1,1),r.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e,t){const r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const i=this.ctx;this.pendingClip&&(r||(this.pendingClip===WN?i.clip(e,"evenodd"):i.clip(e)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Fn(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),r=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(r,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:r,c:i,d:s}=this.ctx.getTransform();let o,a;if(r===0&&i===0){const l=Math.abs(t),c=Math.abs(s);if(l===c)if(e===0)o=a=1/l;else{const u=l*e;o=a=u<1?1/u:1}else if(e===0)o=1/l,a=1/c;else{const u=l*e,h=c*e;o=u<1?1/u:1,a=h<1?1/h:1}}else{const l=Math.abs(t*s-r*i),c=Math.hypot(t,r),u=Math.hypot(i,s);if(e===0)o=u/l,a=c/l;else{const h=e*l;o=u>h?u/h:1,a=c>h?c/h:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:r,current:{lineWidth:i}}=this,[s,o]=this.getScaleForStroking();if(s===o){r.lineWidth=(i||1)*s,r.stroke(e);return}const a=r.getLineDash();t&&r.save(),r.scale(s,o),_T.a=1/s,_T.d=1/o;const l=new Path2D;if(l.addPath(e,_T),a.length>0){const c=Math.max(s,o);r.setLineDash(a.map(u=>u/c)),r.lineDashOffset/=c}r.lineWidth=i||1,r.stroke(l),t&&r.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Xo=new WeakSet,Gx=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Wx=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},qx=function(e,t,r){const i=new Path2D;return i.addPath(e,new DOMMatrix(r).invertSelf().multiplySelf(t)),i};let kp=zk;for(const n in jv)kp.prototype[n]!==void 0&&(kp.prototype[jv[n]]=kp.prototype[n]);var Tw,Iw;class Di{static get workerPort(){return d(this,Tw)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");R(this,Tw,e)}static get workerSrc(){return d(this,Iw)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");R(this,Iw,e)}}Tw=new WeakMap,Iw=new WeakMap,O(Di,Tw,null),O(Di,Iw,"");var Jp,xw;class YJ{constructor({parsedData:e,rawData:t}){O(this,Jp);O(this,xw);R(this,Jp,e),R(this,xw,t)}getRaw(){return d(this,xw)}get(e){return d(this,Jp).get(e)??null}[Symbol.iterator](){return d(this,Jp).entries()}}Jp=new WeakMap,xw=new WeakMap;const Xf=Symbol("INTERNAL");var Cw,Pw,Rw,Zp;class QJ{constructor(e,{name:t,intent:r,usage:i,rbGroups:s}){O(this,Cw,!1);O(this,Pw,!1);O(this,Rw,!1);O(this,Zp,!0);R(this,Cw,!!(e&Cs.DISPLAY)),R(this,Pw,!!(e&Cs.PRINT)),this.name=t,this.intent=r,this.usage=i,this.rbGroups=s}get visible(){if(d(this,Rw))return d(this,Zp);if(!d(this,Zp))return!1;const{print:e,view:t}=this.usage;return d(this,Cw)?(t==null?void 0:t.viewState)!=="OFF":d(this,Pw)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,r=!1){e!==Xf&&hn("Internal method `_setVisible` called."),R(this,Rw,r),R(this,Zp,t)}}Cw=new WeakMap,Pw=new WeakMap,Rw=new WeakMap,Zp=new WeakMap;var Zc,cn,em,tm,kw,Kx;class XJ{constructor(e,t=Cs.DISPLAY){O(this,kw);O(this,Zc,null);O(this,cn,new Map);O(this,em,null);O(this,tm,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,R(this,tm,e.order);for(const r of e.groups)d(this,cn).set(r.id,new QJ(t,r));if(e.baseState==="OFF")for(const r of d(this,cn).values())r._setVisible(Xf,!1);for(const r of e.on)d(this,cn).get(r)._setVisible(Xf,!0);for(const r of e.off)d(this,cn).get(r)._setVisible(Xf,!1);R(this,em,this.getHash())}}isVisible(e){if(d(this,cn).size===0)return!0;if(!e)return UA("Optional content group not defined."),!0;if(e.type==="OCG")return d(this,cn).has(e.id)?d(this,cn).get(e.id).visible:(wt(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return F(this,kw,Kx).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!d(this,cn).has(t))return wt(`Optional content group not found: ${t}`),!0;if(d(this,cn).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!d(this,cn).has(t))return wt(`Optional content group not found: ${t}`),!0;if(!d(this,cn).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!d(this,cn).has(t))return wt(`Optional content group not found: ${t}`),!0;if(!d(this,cn).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!d(this,cn).has(t))return wt(`Optional content group not found: ${t}`),!0;if(d(this,cn).get(t).visible)return!1}return!0}return wt(`Unknown optional content policy ${e.policy}.`),!0}return wt(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,r=!0){var s;const i=d(this,cn).get(e);if(!i){wt(`Optional content group not found: ${e}`);return}if(r&&t&&i.rbGroups.length)for(const o of i.rbGroups)for(const a of o)a!==e&&((s=d(this,cn).get(a))==null||s._setVisible(Xf,!1,!0));i._setVisible(Xf,!!t,!0),R(this,Zc,null)}setOCGState({state:e,preserveRB:t}){let r;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":r=i;continue}const s=d(this,cn).get(i);if(s)switch(r){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!s.visible,t);break}}R(this,Zc,null)}get hasInitialVisibility(){return d(this,em)===null||this.getHash()===d(this,em)}getOrder(){return d(this,cn).size?d(this,tm)?d(this,tm).slice():[...d(this,cn).keys()]:null}getGroup(e){return d(this,cn).get(e)||null}getHash(){if(d(this,Zc)!==null)return d(this,Zc);const e=new a5;for(const[t,r]of d(this,cn))e.update(`${t}:${r.visible}`);return R(this,Zc,e.hexdigest())}[Symbol.iterator](){return d(this,cn).entries()}}Zc=new WeakMap,cn=new WeakMap,em=new WeakMap,tm=new WeakMap,kw=new WeakSet,Kx=function(e){const t=e.length;if(t<2)return!0;const r=e[0];for(let i=1;i<t;i++){const s=e[i];let o;if(Array.isArray(s))o=F(this,kw,Kx).call(this,s);else if(d(this,cn).has(s))o=d(this,cn).get(s).visible;else return wt(`Optional content group not found: ${s}`),!0;switch(r){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return r==="And"};class JJ{constructor(e,{disableRange:t=!1,disableStream:r=!1}){fr(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:s,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,(s==null?void 0:s.length)>0){const l=s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength?s.buffer:new Uint8Array(s).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!r,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,c)=>{this._onReceiveData({begin:l,chunk:c})}),e.addProgressListener((l,c)=>{this._onProgress({loaded:l,total:c})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const r=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(r):this._queuedChunks.push(r);else{const i=this._rangeReaders.some(function(s){return s._begin!==e?!1:(s._enqueue(r),!0)});fr(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,r,i,s;e.total===void 0?(r=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||r.call(t,{loaded:e.loaded}):(s=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||s.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){fr(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new ZJ(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new eZ(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(r),r}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const r of this._rangeReaders.slice(0))r.cancel(e);this._pdfDataRangeTransport.abort()}}class ZJ{constructor(e,t,r=!1,i=null){this._stream=e,this._done=r||!1,this._filename=$A(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const s of this._queuedChunks)this._loaded+=s.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class eZ{constructor(e,t,r){this._stream=e,this._begin=t,this._end=r,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function tZ(n){let e=!0,t=r("filename\\*","i").exec(n);if(t){t=t[1];let u=a(t);return u=unescape(u),u=l(u),u=c(u),s(u)}if(t=o(n),t){const u=c(t);return s(u)}if(t=r("filename","i").exec(n),t){t=t[1];let u=a(t);return u=c(u),s(u)}function r(u,h){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function i(u,h){if(u){if(!/^[\x00-\xFF]+$/.test(h))return h;try{const f=new TextDecoder(u,{fatal:!0}),v=X0(h);h=f.decode(v),e=!1}catch{}}return h}function s(u){return e&&/[\x80-\xff]/.test(u)&&(u=i("utf-8",u),e&&(u=i("iso-8859-1",u))),u}function o(u){const h=[];let f;const v=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=v.exec(u))!==null;){let[,E,A,T]=f;if(E=parseInt(E,10),E in h){if(E===0)break;continue}h[E]=[A,T]}const w=[];for(let E=0;E<h.length&&E in h;++E){let[A,T]=h[E];T=a(T),A&&(T=unescape(T),E===0&&(T=l(T))),w.push(T)}return w.join("")}function a(u){if(u.startsWith('"')){const h=u.slice(1).split('\\"');for(let f=0;f<h.length;++f){const v=h[f].indexOf('"');v!==-1&&(h[f]=h[f].slice(0,v),h.length=f+1),h[f]=h[f].replaceAll(/\\(.)/g,"$1")}u=h.join('"')}return u}function l(u){const h=u.indexOf("'");if(h===-1)return u;const f=u.slice(0,h),w=u.slice(h+1).replace(/^[^']*'/,"");return i(f,w)}function c(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,f,v,w){if(v==="q"||v==="Q")return w=w.replaceAll("_"," "),w=w.replaceAll(/=([0-9a-fA-F]{2})/g,function(E,A){return String.fromCharCode(parseInt(A,16))}),i(f,w);try{w=atob(w)}catch{}return i(f,w)})}return""}function E5(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const r in e){const i=e[r];i!==void 0&&t.append(r,i)}return t}function zA(n){var e;return((e=URL.parse(n))==null?void 0:e.origin)??null}function b5({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:r}){const i={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(n.get("Content-Length"),10);return!Number.isInteger(s)||(i.suggestedLength=s,s<=2*t)||r||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function _5(n){const e=n.get("Content-Disposition");if(e){let t=tZ(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if($A(t))return t}return null}function tE(n,e){return new zv(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n,n===404||n===0&&e.startsWith("file:"))}function S5(n){return n===200||n===206}function A5(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function T5(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(wt(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class nZ{constructor(e){ge(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=E5(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return fr(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new rZ(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new iZ(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const r of this._rangeRequestReaders.slice(0))r.cancel(e)}}class rZ{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const r=new Headers(e.headers),i=t.url;fetch(i,A5(r,this._withCredentials,this._abortController)).then(s=>{if(e._responseOrigin=zA(s.url),!S5(s.status))throw tE(s.status,i);this._reader=s.body.getReader(),this._headersCapability.resolve();const o=s.headers,{allowRangeRequests:a,suggestedLength:l}=b5({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=l||this._contentLength,this._filename=_5(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new oc("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var r;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(r=this.onProgress)==null||r.call(this,{loaded:this._loaded,total:this._contentLength}),{value:T5(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class iZ{constructor(e,t,r){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const s=new Headers(e.headers);s.append("Range",`bytes=${t}-${r-1}`);const o=i.url;fetch(o,A5(s,this._withCredentials,this._abortController)).then(a=>{const l=zA(a.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!S5(a.status))throw tE(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var r;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(r=this.onProgress)==null||r.call(this,{loaded:this._loaded}),{value:T5(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const ST=200,AT=206;function sZ(n){const e=n.response;return typeof e!="string"?e:X0(e).buffer}class oZ{constructor({url:e,httpHeaders:t,withCredentials:r}){ge(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=E5(this.isHttp,t),this.withCredentials=r||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,r=this.currXhrId++,i=this.pendingRequests[r]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[s,o]of this.headers)t.setRequestHeader(s,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=AT):i.expectedStatus=ST,t.responseType="arraybuffer",fr(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,r),t.onprogress=this.onProgress.bind(this,r),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),r}onProgress(e,t){var i;const r=this.pendingRequests[e];r&&((i=r.onProgress)==null||i.call(r,t))}onStateChange(e,t){const r=this.pendingRequests[e];if(!r)return;const i=r.xhr;if(i.readyState>=2&&r.onHeadersReceived&&(r.onHeadersReceived(),delete r.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){r.onError(i.status);return}const s=i.status||ST;if(!(s===ST&&r.expectedStatus===AT)&&s!==r.expectedStatus){r.onError(i.status);return}const a=sZ(i);if(s===AT){const l=i.getResponseHeader("Content-Range"),c=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);c?r.onDone({begin:parseInt(c[1],10),chunk:a}):(wt('Missing or invalid "Content-Range" header.'),r.onError(0))}else a?r.onDone({begin:0,chunk:a}):r.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class aZ{constructor(e){this._source=e,this._manager=new oZ(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return fr(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new lZ(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const r=new cZ(this._manager,e,t);return r.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(r),r}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const r of this._rangeRequestReaders.slice(0))r.cancel(e)}}class lZ{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=zA(t.responseURL);const r=t.getAllResponseHeaders(),i=new Headers(r?r.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[l,...c]=a.split(": ");return[l,c.join(": ")]}):[]),{allowRangeRequests:s,suggestedLength:o}=b5({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=_5(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=tE(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class cZ{constructor(e,t,r){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:r,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=zA((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const r of this._requests)r.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=tE(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const uZ=/^[a-z][a-z0-9\-+.]+:/i;function dZ(n){if(uZ.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class hZ{constructor(e){this.source=e,this.url=dZ(e.url),fr(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return fr(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new fZ(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const r=new pZ(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const r of this._rangeRequestReaders.slice(0))r.cancel(e)}}class fZ{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const r=process.getBuiltinModule("fs");r.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(r.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=tE(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var r;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(r=this.onProgress)==null||r.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new oc("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class pZ{constructor(e,t,r){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const s=process.getBuiltinModule("fs");this._setReadableStream(s.createReadStream(this._url,{start:t,end:r-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var r;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(r=this.onProgress)==null||r.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const ty=Symbol("INITIAL_DATA");var ys,Dw,Yx;class I5{constructor(){O(this,Dw);O(this,ys,Object.create(null))}get(e,t=null){if(t){const i=F(this,Dw,Yx).call(this,e);return i.promise.then(()=>t(i.data)),null}const r=d(this,ys)[e];if(!r||r.data===ty)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return r.data}has(e){const t=d(this,ys)[e];return!!t&&t.data!==ty}delete(e){const t=d(this,ys)[e];return!t||t.data===ty?!1:(delete d(this,ys)[e],!0)}resolve(e,t=null){const r=F(this,Dw,Yx).call(this,e);r.data=t,r.resolve()}clear(){var e;for(const t in d(this,ys)){const{data:r}=d(this,ys)[t];(e=r==null?void 0:r.bitmap)==null||e.close()}R(this,ys,Object.create(null))}*[Symbol.iterator](){for(const e in d(this,ys)){const{data:t}=d(this,ys)[e];t!==ty&&(yield[e,t])}}}ys=new WeakMap,Dw=new WeakSet,Yx=function(e){var t;return(t=d(this,ys))[e]||(t[e]={...Promise.withResolvers(),data:ty})};const mZ=1e5,qN=30;var _O,eu,Wi,Mw,Nw,oh,Sl,Lw,Ow,ah,nm,rm,tu,im,Fw,sm,lh,Vw,Uw,qn,om,ch,Bw,nu,am,lc,x5,C5,Qx,Vs,qb,Xx,P5,R5;let Gv=(qn=class{constructor({textContentSource:e,container:t,viewport:r}){O(this,lc);O(this,eu,Promise.withResolvers());O(this,Wi,null);O(this,Mw,!1);O(this,Nw,!!((_O=globalThis.FontInspector)!=null&&_O.enabled));O(this,oh,null);O(this,Sl,null);O(this,Lw,0);O(this,Ow,0);O(this,ah,null);O(this,nm,null);O(this,rm,0);O(this,tu,0);O(this,im,Object.create(null));O(this,Fw,[]);O(this,sm,null);O(this,lh,[]);O(this,Vw,new WeakMap);O(this,Uw,null);var l;if(e instanceof ReadableStream)R(this,sm,e);else if(typeof e=="object")R(this,sm,new ReadableStream({start(c){c.enqueue(e),c.close()}}));else throw new Error('No "textContentSource" parameter specified.');R(this,Wi,R(this,nm,t)),R(this,tu,r.scale*Qo.pixelRatio),R(this,rm,r.rotation),R(this,Sl,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:s,pageX:o,pageY:a}=r.rawDims;R(this,Uw,[1,0,0,-1,-o,a+s]),R(this,Ow,i),R(this,Lw,s),F(l=qn,Vs,P5).call(l),qu(t,r),d(this,eu).promise.finally(()=>{d(qn,am).delete(this),R(this,Sl,null),R(this,im,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Ur.platform;return Dt(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{d(this,ah).read().then(({value:t,done:r})=>{if(r){d(this,eu).resolve();return}d(this,oh)??R(this,oh,t.lang),Object.assign(d(this,im),t.styles),F(this,lc,x5).call(this,t.items),e()},d(this,eu).reject)};return R(this,ah,d(this,sm).getReader()),d(qn,am).add(this),e(),d(this,eu).promise}update({viewport:e,onBefore:t=null}){var s;const r=e.scale*Qo.pixelRatio,i=e.rotation;if(i!==d(this,rm)&&(t==null||t(),R(this,rm,i),qu(d(this,nm),{rotation:i})),r!==d(this,tu)){t==null||t(),R(this,tu,r);const o={div:null,properties:null,ctx:F(s=qn,Vs,qb).call(s,d(this,oh))};for(const a of d(this,lh))o.properties=d(this,Vw).get(a),o.div=a,F(this,lc,Qx).call(this,o)}}cancel(){var t;const e=new oc("TextLayer task cancelled.");(t=d(this,ah))==null||t.cancel(e).catch(()=>{}),R(this,ah,null),d(this,eu).reject(e)}get textDivs(){return d(this,lh)}get textContentItemsStr(){return d(this,Fw)}static cleanup(){if(!(d(this,am).size>0)){d(this,om).clear();for(const{canvas:e}of d(this,ch).values())e.remove();d(this,ch).clear()}}},eu=new WeakMap,Wi=new WeakMap,Mw=new WeakMap,Nw=new WeakMap,oh=new WeakMap,Sl=new WeakMap,Lw=new WeakMap,Ow=new WeakMap,ah=new WeakMap,nm=new WeakMap,rm=new WeakMap,tu=new WeakMap,im=new WeakMap,Fw=new WeakMap,sm=new WeakMap,lh=new WeakMap,Vw=new WeakMap,Uw=new WeakMap,om=new WeakMap,ch=new WeakMap,Bw=new WeakMap,nu=new WeakMap,am=new WeakMap,lc=new WeakSet,x5=function(e){var i,s;if(d(this,Mw))return;(s=d(this,Sl)).ctx??(s.ctx=F(i=qn,Vs,qb).call(i,d(this,oh)));const t=d(this,lh),r=d(this,Fw);for(const o of e){if(t.length>mZ){wt("Ignoring additional textDivs for performance reasons."),R(this,Mw,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const a=d(this,Wi);R(this,Wi,document.createElement("span")),d(this,Wi).classList.add("markedContent"),o.id!==null&&d(this,Wi).setAttribute("id",`${o.id}`),a.append(d(this,Wi))}else o.type==="endMarkedContent"&&R(this,Wi,d(this,Wi).parentNode);continue}r.push(o.str),F(this,lc,C5).call(this,o)}},C5=function(e){var E;const t=document.createElement("span"),r={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};d(this,lh).push(t);const i=Ke.transform(d(this,Uw),e.transform);let s=Math.atan2(i[1],i[0]);const o=d(this,im)[e.fontName];o.vertical&&(s+=Math.PI/2);let a=d(this,Nw)&&o.fontSubstitution||o.fontFamily;a=qn.fontFamilyMap.get(a)||a;const l=Math.hypot(i[2],i[3]),c=l*F(E=qn,Vs,R5).call(E,a,o,d(this,oh));let u,h;s===0?(u=i[4],h=i[5]-c):(u=i[4]+c*Math.sin(s),h=i[5]-c*Math.cos(s));const f="calc(var(--total-scale-factor) *",v=t.style;d(this,Wi)===d(this,nm)?(v.left=`${(100*u/d(this,Ow)).toFixed(2)}%`,v.top=`${(100*h/d(this,Lw)).toFixed(2)}%`):(v.left=`${f}${u.toFixed(2)}px)`,v.top=`${f}${h.toFixed(2)}px)`),v.fontSize=`${f}${(d(qn,nu)*l).toFixed(2)}px)`,v.fontFamily=a,r.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,d(this,Nw)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),s!==0&&(r.angle=s*(180/Math.PI));let w=!1;if(e.str.length>1)w=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const A=Math.abs(e.transform[0]),T=Math.abs(e.transform[3]);A!==T&&Math.max(A,T)/Math.min(A,T)>1.5&&(w=!0)}if(w&&(r.canvasWidth=o.vertical?e.height:e.width),d(this,Vw).set(t,r),d(this,Sl).div=t,d(this,Sl).properties=r,F(this,lc,Qx).call(this,d(this,Sl)),r.hasText&&d(this,Wi).append(t),r.hasEOL){const A=document.createElement("br");A.setAttribute("role","presentation"),d(this,Wi).append(A)}},Qx=function(e){var a;const{div:t,properties:r,ctx:i}=e,{style:s}=t;let o="";if(d(qn,nu)>1&&(o=`scale(${1/d(qn,nu)})`),r.canvasWidth!==0&&r.hasText){const{fontFamily:l}=s,{canvasWidth:c,fontSize:u}=r;F(a=qn,Vs,Xx).call(a,i,u*d(this,tu),l);const{width:h}=i.measureText(t.textContent);h>0&&(o=`scaleX(${c*d(this,tu)/h}) ${o}`)}r.angle!==0&&(o=`rotate(${r.angle}deg) ${o}`),o.length>0&&(s.transform=o)},Vs=new WeakSet,qb=function(e=null){let t=d(this,ch).get(e||(e=""));if(!t){const r=document.createElement("canvas");r.className="hiddenCanvasElement",r.lang=e,document.body.append(r),t=r.getContext("2d",{alpha:!1,willReadFrequently:!0}),d(this,ch).set(e,t),d(this,Bw).set(t,{size:0,family:""})}return t},Xx=function(e,t,r){const i=d(this,Bw).get(e);t===i.size&&r===i.family||(e.font=`${t}px ${r}`,i.size=t,i.family=r)},P5=function(){if(d(this,nu)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),R(this,nu,e.getBoundingClientRect().height),e.remove()},R5=function(e,t,r){const i=d(this,om).get(e);if(i)return i;const s=F(this,Vs,qb).call(this,r);s.canvas.width=s.canvas.height=qN,F(this,Vs,Xx).call(this,s,qN,e);const o=s.measureText(""),a=o.fontBoundingBoxAscent,l=Math.abs(o.fontBoundingBoxDescent);s.canvas.width=s.canvas.height=0;let c=.8;return a?c=a/(a+l):(Ur.platform.isFirefox&&wt("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?c=t.ascent:t.descent&&(c=1+t.descent)),d(this,om).set(e,c),c},O(qn,Vs),O(qn,om,new Map),O(qn,ch,new Map),O(qn,Bw,new WeakMap),O(qn,nu,null),O(qn,am,new Set),qn);class Wv{static textContent(e){const t=[],r={items:t,styles:Object.create(null)};function i(s){var l;if(!s)return;let o=null;const a=s.name;if(a==="#text")o=s.value;else if(Wv.shouldBuildText(a))(l=s==null?void 0:s.attributes)!=null&&l.textContent?o=s.attributes.textContent:s.value&&(o=s.value);else return;if(o!==null&&t.push({str:o}),!!s.children)for(const c of s.children)i(c)}return i(e),r}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const gZ=100;function vk(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new Jx,{docId:t}=e,r=n.url?IJ(n.url):null,i=n.data?xJ(n.data):null,s=n.httpHeaders||null,o=n.withCredentials===!0,a=n.password??null,l=n.range instanceof wk?n.range:null,c=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:2**16;let u=n.worker instanceof ug?n.worker:null;const h=n.verbosity,f=typeof n.docBaseUrl=="string"&&!Z0(n.docBaseUrl)?n.docBaseUrl:null,v=GE(n.cMapUrl),w=n.cMapPacked!==!1,E=n.CMapReaderFactory||(Ri?NJ:LN),A=GE(n.iccUrl),T=GE(n.standardFontDataUrl),_=n.StandardFontDataFactory||(Ri?LJ:ON),b=GE(n.wasmUrl),g=n.WasmFactory||(Ri?OJ:FN),y=n.stopAtErrors!==!0,x=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,S=n.isEvalSupported!==!1,I=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!Ri,P=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!Ri&&(Ur.platform.isFirefox||!globalThis.chrome),N=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,M=typeof n.disableFontFace=="boolean"?n.disableFontFace:Ri,V=n.fontExtraProperties===!0,L=n.enableXfa===!0,j=n.ownerDocument||globalThis.document,oe=n.disableRange===!0,$=n.disableStream===!0,B=n.disableAutoFetch===!0,G=n.pdfBug===!0,Z=n.CanvasFactory||(Ri?MJ:RJ),ee=n.FilterFactory||(Ri?DJ:kJ),fe=n.enableHWA===!0,ae=n.useWasm!==!1,_e=l?l.length:n.length??NaN,Qe=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!Ri&&!M,Ye=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:!!(E===LN&&_===ON&&g===FN&&v&&T&&b&&by(v,document.baseURI)&&by(T,document.baseURI)&&by(b,document.baseURI)),gt=null;lJ(h);const ie={canvasFactory:new Z({ownerDocument:j,enableHWA:fe}),filterFactory:new ee({docId:t,ownerDocument:j}),cMapReaderFactory:Ye?null:new E({baseUrl:v,isCompressed:w}),standardFontDataFactory:Ye?null:new _({baseUrl:T}),wasmFactory:Ye?null:new g({baseUrl:b})};u||(u=ug.create({verbosity:h,port:Di.workerPort}),e._worker=u);const ot={docId:t,apiVersion:"5.3.93",data:i,password:a,disableAutoFetch:B,rangeChunkSize:c,length:_e,docBaseUrl:f,enableXfa:L,evaluatorOptions:{maxImageSize:x,disableFontFace:M,ignoreErrors:y,isEvalSupported:S,isOffscreenCanvasSupported:I,isImageDecoderSupported:P,canvasMaxAreaInBytes:N,fontExtraProperties:V,useSystemFonts:Qe,useWasm:ae,useWorkerFetch:Ye,cMapUrl:v,iccUrl:A,standardFontDataUrl:T,wasmUrl:b}},et={ownerDocument:j,pdfBug:G,styleElement:gt,loadingParams:{disableAutoFetch:B,enableXfa:L}};return u.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const ze=u.messageHandler.sendWithPromise("GetDocRequest",ot,i?[i.buffer]:null);let tt;if(l)tt=new JJ(l,{disableRange:oe,disableStream:$});else if(!i){if(!r)throw new Error("getDocument - no `url` parameter provided.");const Xe=by(r)?nZ:Ri?hZ:aZ;tt=new Xe({url:r,length:_e,httpHeaders:s,withCredentials:o,rangeChunkSize:c,disableRange:oe,disableStream:$})}return ze.then(Xe=>{if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const Je=new Iy(t,Xe,u.port),dt=new wZ(Je,e,tt,et,ie);e._transport=dt,Je.send("Ready",null)})}).catch(e._capability.reject),e}var BS;const $S=class $S{constructor(){ge(this,"_capability",Promise.withResolvers());ge(this,"_transport",null);ge(this,"_worker",null);ge(this,"docId",`d${Si($S,BS)._++}`);ge(this,"destroyed",!1);ge(this,"onPassword",null);ge(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,r,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(s){throw(r=this._worker)!=null&&r.port&&delete this._worker._pendingDestroy,s}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};BS=new WeakMap,O($S,BS,0);let Jx=$S;var uh,$w,jw,zw,Hw,SO;let wk=(SO=class{constructor(e,t,r=!1,i=null){O(this,uh,Promise.withResolvers());O(this,$w,[]);O(this,jw,[]);O(this,zw,[]);O(this,Hw,[]);this.length=e,this.initialData=t,this.progressiveDone=r,this.contentDispositionFilename=i}addRangeListener(e){d(this,Hw).push(e)}addProgressListener(e){d(this,zw).push(e)}addProgressiveReadListener(e){d(this,jw).push(e)}addProgressiveDoneListener(e){d(this,$w).push(e)}onDataRange(e,t){for(const r of d(this,Hw))r(e,t)}onDataProgress(e,t){d(this,uh).promise.then(()=>{for(const r of d(this,zw))r(e,t)})}onDataProgressiveRead(e){d(this,uh).promise.then(()=>{for(const t of d(this,jw))t(e)})}onDataProgressiveDone(){d(this,uh).promise.then(()=>{for(const e of d(this,$w))e()})}transportReady(){d(this,uh).resolve()}requestDataRange(e,t){hn("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}},uh=new WeakMap,$w=new WeakMap,jw=new WeakMap,zw=new WeakMap,Hw=new WeakMap,SO);class yZ{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Dt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Al,dh,ky;class vZ{constructor(e,t,r,i=!1){O(this,dh);O(this,Al,!1);this._pageIndex=e,this._pageInfo=t,this._transport=r,this._stats=i?new DN:null,this._pdfBug=i,this.commonObjs=r.commonObjs,this.objs=new I5,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:r=0,offsetY:i=0,dontFlip:s=!1}={}){return new J0({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:r,offsetY:i,dontFlip:s})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Dt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:r="display",annotationMode:i=Da.ENABLE,transform:s=null,background:o=null,optionalContentConfigPromise:a=null,annotationCanvasMap:l=null,pageColors:c=null,printAnnotationStorage:u=null,isEditing:h=!1}){var g,y;(g=this._stats)==null||g.time("Overall");const f=this._transport.getRenderingIntent(r,i,u,h),{renderingIntent:v,cacheKey:w}=f;R(this,Al,!1),a||(a=this._transport.getOptionalContentConfig(v));let E=this._intentStates.get(w);E||(E=Object.create(null),this._intentStates.set(w,E)),E.streamReaderCancelTimeout&&(clearTimeout(E.streamReaderCancelTimeout),E.streamReaderCancelTimeout=null);const A=!!(v&Cs.PRINT);E.displayReadyCapability||(E.displayReadyCapability=Promise.withResolvers(),E.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(y=this._stats)==null||y.time("Page Request"),this._pumpOperatorList(f));const T=x=>{var S;E.renderTasks.delete(_),A&&R(this,Al,!0),F(this,dh,ky).call(this),x?(_.capability.reject(x),this._abortOperatorList({intentState:E,reason:x instanceof Error?x:new Error(x)})):_.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(S=globalThis.Stats)!=null&&S.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},_=new Zx({callback:T,params:{canvasContext:e,viewport:t,transform:s,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:E.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!A,pdfBug:this._pdfBug,pageColors:c});(E.renderTasks||(E.renderTasks=new Set)).add(_);const b=_.task;return Promise.all([E.displayReadyCapability.promise,a]).then(([x,S])=>{var I;if(this.destroyed){T();return}if((I=this._stats)==null||I.time("Rendering"),!(S.renderingIntent&v))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");_.initializeGraphics({transparency:x,optionalContentConfig:S}),_.operatorListChanged()}).catch(T),b}getOperatorList({intent:e="display",annotationMode:t=Da.ENABLE,printAnnotationStorage:r=null,isEditing:i=!1}={}){var c;function s(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const o=this._transport.getRenderingIntent(e,t,r,i,!0);let a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=s,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(c=this._stats)==null||c.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(r=>Wv.textContent(r));const t=this.streamTextContent(e);return new Promise(function(r,i){function s(){o.read().then(function({value:l,done:c}){if(c){r(a);return}a.lang??(a.lang=l.lang),Object.assign(a.styles,l.styles),a.items.push(...l.items),s()},i)}const o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};s()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const r of t.renderTasks)e.push(r.completed),r.cancel();return this.objs.clear(),R(this,Al,!1),Promise.all(e)}cleanup(e=!1){R(this,Al,!0);const t=F(this,dh,ky).call(this);return e&&t&&this._stats&&(this._stats=new DN),t}_startRenderPage(e,t){var i,s;const r=this._intentStates.get(t);r&&((i=this._stats)==null||i.timeEnd("Page Request"),(s=r.displayReadyCapability)==null||s.resolve(e))}_renderPageChunk(e,t){for(let r=0,i=e.length;r<i;r++)t.operatorList.fnArray.push(e.fnArray[r]),t.operatorList.argsArray.push(e.argsArray[r]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const r of t.renderTasks)r.operatorListChanged();e.lastChunk&&F(this,dh,ky).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:r,modifiedIds:i}){const{map:s,transfer:o}=r,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:s,modifiedIds:i},o).getReader(),c=this._intentStates.get(t);c.streamReader=l;const u=()=>{l.read().then(({value:h,done:f})=>{if(f){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,c),u())},h=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const f of c.renderTasks)f.operatorListChanged();F(this,dh,ky).call(this)}if(c.displayReadyCapability)c.displayReadyCapability.reject(h);else if(c.opListReadCapability)c.opListReadCapability.reject(h);else throw h}})};u()}_abortOperatorList({intentState:e,reason:t,force:r=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!r){if(e.renderTasks.size>0)return;if(t instanceof BA){let i=gZ;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new oc(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,s]of this._intentStates)if(s===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}Al=new WeakMap,dh=new WeakSet,ky=function(){if(!d(this,Al)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),R(this,Al,!1),!0};var ru,Ro,Tl,hh,jS,fh,ph,Ni,Kb,k5,D5,Dy,lm,Yb;const Pn=class Pn{constructor({name:e=null,port:t=null,verbosity:r=cJ()}={}){O(this,Ni);O(this,ru,Promise.withResolvers());O(this,Ro,null);O(this,Tl,null);O(this,hh,null);if(this.name=e,this.destroyed=!1,this.verbosity=r,t){if(d(Pn,ph).has(t))throw new Error("Cannot use more than one PDFWorker per port.");d(Pn,ph).set(t,this),F(this,Ni,k5).call(this,t)}else F(this,Ni,D5).call(this)}get promise(){return d(this,ru).promise}get port(){return d(this,Tl)}get messageHandler(){return d(this,Ro)}destroy(){var e,t;this.destroyed=!0,(e=d(this,hh))==null||e.terminate(),R(this,hh,null),d(Pn,ph).delete(d(this,Tl)),R(this,Tl,null),(t=d(this,Ro))==null||t.destroy(),R(this,Ro,null)}static create(e){const t=d(this,ph).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Pn(e)}static get workerSrc(){if(Di.workerSrc)return Di.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Dt(this,"_setupFakeWorkerGlobal",(async()=>d(this,lm,Yb)?d(this,lm,Yb):(await import(this.workerSrc)).WorkerMessageHandler)())}};ru=new WeakMap,Ro=new WeakMap,Tl=new WeakMap,hh=new WeakMap,jS=new WeakMap,fh=new WeakMap,ph=new WeakMap,Ni=new WeakSet,Kb=function(){d(this,ru).resolve(),d(this,Ro).send("configure",{verbosity:this.verbosity})},k5=function(e){R(this,Tl,e),R(this,Ro,new Iy("main","worker",e)),d(this,Ro).on("ready",()=>{}),F(this,Ni,Kb).call(this)},D5=function(){if(d(Pn,fh)||d(Pn,lm,Yb)){F(this,Ni,Dy).call(this);return}let{workerSrc:e}=Pn;try{Pn._isSameOrigin(window.location,e)||(e=Pn._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),r=new Iy("main","worker",t),i=()=>{s.abort(),r.destroy(),t.terminate(),this.destroyed?d(this,ru).reject(new Error("Worker was destroyed")):F(this,Ni,Dy).call(this)},s=new AbortController;t.addEventListener("error",()=>{d(this,hh)||i()},{signal:s.signal}),r.on("test",a=>{if(s.abort(),this.destroyed||!a){i();return}R(this,Ro,r),R(this,Tl,t),R(this,hh,t),F(this,Ni,Kb).call(this)}),r.on("ready",a=>{if(s.abort(),this.destroyed){i();return}try{o()}catch{F(this,Ni,Dy).call(this)}});const o=()=>{const a=new Uint8Array;r.send("test",a,[a.buffer])};o();return}catch{UA("The worker has been disabled.")}F(this,Ni,Dy).call(this)},Dy=function(){d(Pn,fh)||(wt("Setting up fake worker."),R(Pn,fh,!0)),Pn._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){d(this,ru).reject(new Error("Worker was destroyed"));return}const t=new PJ;R(this,Tl,t);const r=`fake${Si(Pn,jS)._++}`,i=new Iy(r+"_worker",r,t);e.setup(i,t),R(this,Ro,new Iy(r,r+"_worker",t)),F(this,Ni,Kb).call(this)}).catch(e=>{d(this,ru).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},lm=new WeakSet,Yb=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},O(Pn,lm),O(Pn,jS,0),O(Pn,fh,!1),O(Pn,ph,new WeakMap),Ri&&(R(Pn,fh,!0),Di.workerSrc||(Di.workerSrc="./pdf.worker.mjs")),Pn._isSameOrigin=(e,t)=>{const r=URL.parse(e);if(!(r!=null&&r.origin)||r.origin==="null")return!1;const i=new URL(t,r);return r.origin===i.origin},Pn._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},Pn.fromPort=e=>{if(vJ("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return Pn.create(e)};let ug=Pn;var Il,Sa,cm,um,xl,mh,My;class wZ{constructor(e,t,r,i,s){O(this,mh);O(this,Il,new Map);O(this,Sa,new Map);O(this,cm,new Map);O(this,um,new Map);O(this,xl,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new I5,this.fontLoader=new AJ({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=s.canvasFactory,this.filterFactory=s.filterFactory,this.cMapReaderFactory=s.cMapReaderFactory,this.standardFontDataFactory=s.standardFontDataFactory,this.wasmFactory=s.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Dt(this,"annotationStorage",new mk)}getRenderingIntent(e,t=Da.ENABLE,r=null,i=!1,s=!1){let o=Cs.DISPLAY,a=Ux;switch(e){case"any":o=Cs.ANY;break;case"display":break;case"print":o=Cs.PRINT;break;default:wt(`getRenderingIntent - invalid intent: ${e}`)}const l=o&Cs.PRINT&&r instanceof c5?r:this.annotationStorage;switch(t){case Da.DISABLE:o+=Cs.ANNOTATIONS_DISABLE;break;case Da.ENABLE:break;case Da.ENABLE_FORMS:o+=Cs.ANNOTATIONS_FORMS;break;case Da.ENABLE_STORAGE:o+=Cs.ANNOTATIONS_STORAGE,a=l.serializable;break;default:wt(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(o+=Cs.IS_EDITING),s&&(o+=Cs.OPLIST);const{ids:c,hash:u}=l.modifiedIds,h=[o,a.hash,u];return{renderingIntent:o,cacheKey:h.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){var r;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(r=d(this,xl))==null||r.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of d(this,Sa).values())e.push(i._destroy());d(this,Sa).clear(),d(this,cm).clear(),d(this,um).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,s;this.commonObjs.clear(),this.fontLoader.clear(),d(this,Il).clear(),this.filterFactory.destroy(),Gv.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new oc("Worker was terminated.")),(s=this.messageHandler)==null||s.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(r,i)=>{fr(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=s=>{this._lastProgress={loaded:s.loaded,total:s.total}},i.onPull=()=>{this._fullReader.read().then(function({value:s,done:o}){if(o){i.close();return}fr(s instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(s),1,[s])}).catch(s=>{i.error(s)})},i.onCancel=s=>{this._fullReader.cancel(s),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async r=>{var a;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:s,contentLength:o}=this._fullReader;return(!i||!s)&&(this._lastProgress&&((a=t.onProgress)==null||a.call(t,this._lastProgress)),this._fullReader.onProgress=l=>{var c;(c=t.onProgress)==null||c.call(t,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:s,contentLength:o}}),e.on("GetRangeReader",(r,i)=>{fr(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(r.begin,r.end);if(!s){i.close();return}i.onPull=()=>{s.read().then(function({value:o,done:a}){if(a){i.close();return}fr(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{s.cancel(o),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:r})=>{this._numPages=r.numPages,this._htmlForXfa=r.htmlForXfa,delete r.htmlForXfa,t._capability.resolve(new yZ(r,this))}),e.on("DocException",r=>{t._capability.reject(zi(r))}),e.on("PasswordRequest",r=>{R(this,xl,Promise.withResolvers());try{if(!t.onPassword)throw zi(r);const i=s=>{s instanceof Error?d(this,xl).reject(s):d(this,xl).resolve({password:s})};t.onPassword(i,r.code)}catch(i){d(this,xl).reject(i)}return d(this,xl).promise}),e.on("DataLoaded",r=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:r.length,total:r.length}),this.downloadInfoCapability.resolve(r)}),e.on("StartRenderPage",r=>{if(this.destroyed)return;d(this,Sa).get(r.pageIndex)._startRenderPage(r.transparency,r.cacheKey)}),e.on("commonobj",([r,i,s])=>{var o;if(this.destroyed||this.commonObjs.has(r))return null;switch(i){case"Font":if("error"in s){const u=s.error;wt(`Error during font loading: ${u}`),this.commonObjs.resolve(r,u);break}const a=this._params.pdfBug&&((o=globalThis.FontInspector)!=null&&o.enabled)?(u,h)=>globalThis.FontInspector.fontAdded(u,h):null,l=new TJ(s,a);this.fontLoader.bind(l).catch(()=>e.sendWithPromise("FontFallback",{id:r})).finally(()=>{!l.fontExtraProperties&&l.data&&(l.data=null),this.commonObjs.resolve(r,l)});break;case"CopyLocalImage":const{imageRef:c}=s;fr(c,"The imageRef must be defined.");for(const u of d(this,Sa).values())for(const[,h]of u.objs)if((h==null?void 0:h.ref)===c)return h.dataLen?(this.commonObjs.resolve(r,structuredClone(h)),h.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(r,s);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([r,i,s,o])=>{var l;if(this.destroyed)return;const a=d(this,Sa).get(i);if(!a.objs.has(r)){if(a._intentStates.size===0){(l=o==null?void 0:o.bitmap)==null||l.close();return}switch(s){case"Image":case"Pattern":a.objs.resolve(r,o);break;default:throw new Error(`Got unknown object type ${s}`)}}}),e.on("DocProgress",r=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:r.loaded,total:r.total})}),e.on("FetchBinaryData",async r=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[r.type];if(!i)throw new Error(`${r.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(r)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var r;this.annotationStorage.size<=0&&wt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((r=this._fullReader)==null?void 0:r.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,r=d(this,cm).get(t);if(r)return r;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(s=>{if(this.destroyed)throw new Error("Transport destroyed");s.refStr&&d(this,um).set(s.refStr,e);const o=new vZ(t,s,this,this._params.pdfBug);return d(this,Sa).set(t,o),o});return d(this,cm).set(t,i),i}getPageIndex(e){return Bx(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return F(this,mh,My).call(this,"GetFieldObjects")}hasJSActions(){return F(this,mh,My).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return F(this,mh,My).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return F(this,mh,My).call(this,"GetOptionalContentConfig").then(t=>new XJ(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=d(this,Il).get(e);if(t)return t;const r=this.messageHandler.sendWithPromise(e,null).then(i=>{var s,o;return{info:i[0],metadata:i[1]?new YJ(i[1]):null,contentDispositionFilename:((s=this._fullReader)==null?void 0:s.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return d(this,Il).set(e,r),r}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of d(this,Sa).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),d(this,Il).clear(),this.filterFactory.destroy(!0),Gv.cleanup()}}cachedPageNumber(e){if(!Bx(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return d(this,um).get(t)??null}}Il=new WeakMap,Sa=new WeakMap,cm=new WeakMap,um=new WeakMap,xl=new WeakMap,mh=new WeakSet,My=function(e,t=null){const r=d(this,Il).get(e);if(r)return r;const i=this.messageHandler.sendWithPromise(e,t);return d(this,Il).set(e,i),i};var iu;class EZ{constructor(e){O(this,iu,null);ge(this,"onContinue",null);ge(this,"onError",null);R(this,iu,e)}get promise(){return d(this,iu).capability.promise}cancel(e=0){d(this,iu).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=d(this,iu).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=d(this,iu);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}iu=new WeakMap;var su,gh;const kd=class kd{constructor({callback:e,params:t,objs:r,commonObjs:i,annotationCanvasMap:s,operatorList:o,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:u=!1,pdfBug:h=!1,pageColors:f=null}){O(this,su,null);this.callback=e,this.params=t,this.objs=r,this.commonObjs=i,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=h,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new EZ(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var a,l;if(this.cancelled)return;if(this._canvas){if(d(kd,gh).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");d(kd,gh).add(this._canvas)}this._pdfBug&&((a=globalThis.StepperManager)!=null&&a.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:r,viewport:i,transform:s,background:o}=this.params;this.gfx=new kp(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:i,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(e=null,t=0){var r,i,s;this.running=!1,this.cancelled=!0,(r=this.gfx)==null||r.endDrawing(),d(this,su)&&(window.cancelAnimationFrame(d(this,su)),R(this,su,null)),d(kd,gh).delete(this._canvas),e||(e=new BA(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(s=(i=this.task).onError)==null||s.call(i,e)}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?R(this,su,window.requestAnimationFrame(()=>{R(this,su,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),d(kd,gh).delete(this._canvas),this.callback())))}};su=new WeakMap,gh=new WeakMap,O(kd,gh,new WeakSet);let Zx=kd;const Ek="5.3.93",M5="cbeef3233";function KN(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function ny(n){return Math.max(0,Math.min(255,255*n))}class YN{static CMYK_G([e,t,r,i]){return["G",1-Math.min(1,.3*e+.59*r+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=ny(e),[e,e,e]}static G_HTML([e]){const t=KN(e);return`#${t}${t}${t}`}static RGB_G([e,t,r]){return["G",.3*e+.59*t+.11*r]}static RGB_rgb(e){return e.map(ny)}static RGB_HTML(e){return`#${e.map(KN).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,r,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,r+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,r,i]){return[ny(1-Math.min(1,e+i)),ny(1-Math.min(1,r+i)),ny(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,r]){const i=1-e,s=1-t,o=1-r,a=Math.min(i,s,o);return["CMYK",i,s,o,a]}}class bZ{create(e,t,r=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),r||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){hn("Abstract method `_createSVG` called.")}}class qv extends bZ{_createSVG(e){return document.createElementNS(nl,e)}}class bk{static setupStorage(e,t,r,i,s){const o=i.getValue(t,{value:null});switch(r.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),s==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})});break;case"input":if(r.attributes.type==="radio"||r.attributes.type==="checkbox"){if(o.value===r.attributes.xfaOn?e.setAttribute("checked",!0):o.value===r.attributes.xfaOff&&e.removeAttribute("checked"),s==="print")break;e.addEventListener("change",a=>{i.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),s==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const a of r.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{const l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:r=null,intent:i,linkService:s}){const{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[l,c]of Object.entries(o))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}a&&s.addLinkAttributes(e,o.href,o.newWindow),r&&o.dataId&&this.setupStorage(e,o.dataId,t,r)}static render(e){var h,f;const t=e.annotationStorage,r=e.linkService,i=e.xfaHtml,s=e.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:s,linkService:r});const a=s!=="richText",l=e.div;if(l.append(o),e.viewport){const v=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=v}a&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(i.children.length===0){if(i.value){const v=document.createTextNode(i.value);o.append(v),a&&Wv.shouldBuildText(i.name)&&c.push(v)}return{textDivs:c}}const u=[[i,-1,o]];for(;u.length>0;){const[v,w,E]=u.at(-1);if(w+1===v.children.length){u.pop();continue}const A=v.children[++u.at(-1)[1]];if(A===null)continue;const{name:T}=A;if(T==="#text"){const b=document.createTextNode(A.value);c.push(b),E.append(b);continue}const _=(h=A==null?void 0:A.attributes)!=null&&h.xmlns?document.createElementNS(A.attributes.xmlns,T):document.createElement(T);if(E.append(_),A.attributes&&this.setAttributes({html:_,element:A,storage:t,intent:s,linkService:r}),((f=A.children)==null?void 0:f.length)>0)u.push([A,-1,_]);else if(A.value){const b=document.createTextNode(A.value);a&&Wv.shouldBuildText(T)&&c.push(b),_.append(b)}}for(const v of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))v.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const _Z=9,ff=new WeakSet;class QN{static create(e){switch(e.data.annotationType){case Jn.LINK:return new N5(e);case Jn.TEXT:return new SZ(e);case Jn.WIDGET:switch(e.data.fieldType){case"Tx":return new AZ(e);case"Btn":return e.data.radioButton?new F5(e):e.data.checkBox?new IZ(e):new xZ(e);case"Ch":return new CZ(e);case"Sig":return new TZ(e)}return new Sf(e);case Jn.POPUP:return new tC(e);case Jn.FREETEXT:return new j5(e);case Jn.LINE:return new RZ(e);case Jn.SQUARE:return new kZ(e);case Jn.CIRCLE:return new DZ(e);case Jn.POLYLINE:return new z5(e);case Jn.CARET:return new NZ(e);case Jn.INK:return new _k(e);case Jn.POLYGON:return new MZ(e);case Jn.HIGHLIGHT:return new H5(e);case Jn.UNDERLINE:return new LZ(e);case Jn.SQUIGGLY:return new OZ(e);case Jn.STRIKEOUT:return new FZ(e);case Jn.STAMP:return new G5(e);case Jn.FILEATTACHMENT:return new VZ(e);default:return new or(e)}}}var yh,dm,hm,Gw,eC;const Hk=class Hk{constructor(e,{isRenderable:t=!1,ignoreBorder:r=!1,createQuadrilaterals:i=!1}={}){O(this,Gw);O(this,yh,null);O(this,dm,!1);O(this,hm,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(r)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Hk._hasPopupData(this.data)}updateEdited(e){var r;if(!this.container)return;d(this,yh)||R(this,yh,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&F(this,Gw,eC).call(this,t),(r=d(this,hm))==null||r.popup.updateEdited(e)}resetEdited(){var e;d(this,yh)&&(F(this,Gw,eC).call(this,d(this,yh).rect),(e=d(this,hm))==null||e.popup.resetEdited(),R(this,yh,null))}_createContainer(e){const{data:t,parent:{page:r,viewport:i}}=this,s=document.createElement("section");s.setAttribute("data-annotation-id",t.id),this instanceof Sf||(s.tabIndex=0);const{style:o}=s;if(o.zIndex=this.parent.zIndex++,t.alternativeText&&(s.title=t.alternativeText),t.noRotate&&s.classList.add("norotate"),!t.rect||this instanceof tC){const{rotation:E}=t;return!t.hasOwnCanvas&&E!==0&&this.setRotation(E,s),s}const{width:a,height:l}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const E=t.borderStyle.horizontalCornerRadius,A=t.borderStyle.verticalCornerRadius;if(E>0||A>0){const _=`calc(${E}px * var(--total-scale-factor)) / calc(${A}px * var(--total-scale-factor))`;o.borderRadius=_}else if(this instanceof F5){const _=`calc(${a}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;o.borderRadius=_}switch(t.borderStyle.style){case qf.SOLID:o.borderStyle="solid";break;case qf.DASHED:o.borderStyle="dashed";break;case qf.BEVELED:wt("Unimplemented border style: beveled");break;case qf.INSET:wt("Unimplemented border style: inset");break;case qf.UNDERLINE:o.borderBottomStyle="solid";break}const T=t.borderColor||null;T?(R(this,dm,!0),o.borderColor=Ke.makeHexColor(T[0]|0,T[1]|0,T[2]|0)):o.borderWidth=0}const c=Ke.normalizeRect([t.rect[0],r.view[3]-t.rect[1]+r.view[1],t.rect[2],r.view[3]-t.rect[3]+r.view[1]]),{pageWidth:u,pageHeight:h,pageX:f,pageY:v}=i.rawDims;o.left=`${100*(c[0]-f)/u}%`,o.top=`${100*(c[1]-v)/h}%`;const{rotation:w}=t;return t.hasOwnCanvas||w===0?(o.width=`${100*a/u}%`,o.height=`${100*l/h}%`):this.setRotation(w,s),s}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:r,pageHeight:i}=this.parent.viewport.rawDims;let{width:s,height:o}=this;e%180!==0&&([s,o]=[o,s]),t.style.width=`${100*s/r}%`,t.style.height=`${100*o/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,r,i)=>{const s=i.detail[t],o=s[0],a=s.slice(1);i.target.style[r]=YN[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[r]:YN[`${o}_rgb`](a)})};return Dt(this,"_commonActions",{display:t=>{const{display:r}=t.detail,i=r%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:r===1||r===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:r}=t.detail;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:r,noView:r})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const r=t.detail.rotation;this.setRotation(r),this.annotationStorage.setValue(this.data.id,{rotation:r})}})}_dispatchEventFromSandbox(e,t){const r=this._commonActions;for(const i of Object.keys(t.detail)){const s=e[i]||r[i];s==null||s(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const r=this._commonActions;for(const[i,s]of Object.entries(t)){const o=r[i];if(o){const a={detail:{[i]:s},target:e};o(a),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,r,i,s]=this.data.rect.map(E=>Math.fround(E));if(e.length===8){const[E,A,T,_]=e.subarray(2,6);if(i===E&&s===A&&t===T&&r===_)return}const{style:o}=this.container;let a;if(d(this,dm)){const{borderColor:E,borderWidth:A}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${E}" stroke-width="${A}">`],this.container.classList.add("hasBorder")}const l=i-t,c=s-r,{svgFactory:u}=this,h=u.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0),h.role="none";const f=u.createElement("defs");h.append(f);const v=u.createElement("clipPath"),w=`clippath_${this.data.id}`;v.setAttribute("id",w),v.setAttribute("clipPathUnits","objectBoundingBox"),f.append(v);for(let E=2,A=e.length;E<A;E+=8){const T=e[E],_=e[E+1],b=e[E+2],g=e[E+3],y=u.createElement("rect"),x=(b-t)/l,S=(s-_)/c,I=(T-b)/l,P=(_-g)/c;y.setAttribute("x",x),y.setAttribute("y",S),y.setAttribute("width",I),y.setAttribute("height",P),v.append(y),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${x}" y="${S}" width="${I}" height="${P}"/>`)}d(this,dm)&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(h),this.container.style.clipPath=`url(#${w})`}_createPopup(){const{data:e}=this,t=R(this,hm,new tC({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){hn("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const r=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:s,id:o,exportValues:a}of i){if(s===-1||o===t)continue;const l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${o}"]`);if(c&&!ff.has(c)){wt(`_getElementsByName - element not allowed: ${o}`);continue}r.push({id:o,exportValue:l,domElement:c})}return r}for(const i of document.getElementsByName(e)){const{exportValue:s}=i,o=i.getAttribute("data-element-id");o!==t&&ff.has(i)&&r.push({id:o,exportValue:s,domElement:i})}return r}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var r;(r=this.linkService.eventBus)==null||r.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};yh=new WeakMap,dm=new WeakMap,hm=new WeakMap,Gw=new WeakSet,eC=function(e){const{container:{style:t},data:{rect:r,rotation:i},parent:{viewport:{rawDims:{pageWidth:s,pageHeight:o,pageX:a,pageY:l}}}}=this;r==null||r.splice(0,4,...e),t.left=`${100*(e[0]-a)/s}%`,t.top=`${100*(o-e[3]+l)/o}%`,i===0?(t.width=`${100*(e[2]-e[0])/s}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(i)};let or=Hk;var ks,Sd,L5,O5;class N5 extends or{constructor(t,r=null){super(t,{isRenderable:!0,ignoreBorder:!!(r!=null&&r.ignoreBorder),createQuadrilaterals:!0});O(this,ks);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:r}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let s=!1;return t.url?(r.addLinkAttributes(i,t.url,t.newWindow),s=!0):t.action?(this._bindNamedAction(i,t.action),s=!0):t.attachment?(F(this,ks,L5).call(this,i,t.attachment,t.attachmentDest),s=!0):t.setOCGState?(F(this,ks,O5).call(this,i,t.setOCGState),s=!0):t.dest?(this._bindLink(i,t.dest),s=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),s=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(i),this.container}_bindLink(t,r){t.href=this.linkService.getDestinationHash(r),t.onclick=()=>(r&&this.linkService.goToDestination(r),!1),(r||r==="")&&F(this,ks,Sd).call(this)}_bindNamedAction(t,r){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(r),!1),F(this,ks,Sd).call(this)}_bindJSAction(t,r){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(r.actions)){const o=i.get(s);o&&(t[o]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:r.id,name:s}}),!1})}t.onclick||(t.onclick=()=>!1),F(this,ks,Sd).call(this)}_bindResetFormAction(t,r){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),F(this,ks,Sd).call(this),!this._fieldObjects){wt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var h;i==null||i();const{fields:s,refs:o,include:a}=r,l=[];if(s.length!==0||o.length!==0){const f=new Set(o);for(const v of s){const w=this._fieldObjects[v]||[];for(const{id:E}of w)f.add(E)}for(const v of Object.values(this._fieldObjects))for(const w of v)f.has(w.id)===a&&l.push(w)}else for(const f of Object.values(this._fieldObjects))l.push(...f);const c=this.annotationStorage,u=[];for(const f of l){const{id:v}=f;switch(u.push(v),f.type){case"text":{const E=f.defaultValue||"";c.setValue(v,{value:E});break}case"checkbox":case"radiobutton":{const E=f.defaultValue===f.exportValues;c.setValue(v,{value:E});break}case"combobox":case"listbox":{const E=f.defaultValue||"";c.setValue(v,{value:E});break}default:continue}const w=document.querySelector(`[data-element-id="${v}"]`);if(w){if(!ff.has(w)){wt(`_bindResetFormAction - element not allowed: ${v}`);continue}}else continue;w.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((h=this.linkService.eventBus)==null||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}})),!1}}}ks=new WeakSet,Sd=function(){this.container.setAttribute("data-internal-link","")},L5=function(t,r,i=null){t.href=this.linkService.getAnchorUrl(""),r.description&&(t.title=r.description),t.onclick=()=>{var s;return(s=this.downloadManager)==null||s.openOrDownloadData(r.content,r.filename,i),!1},F(this,ks,Sd).call(this)},O5=function(t,r){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(r),!1),F(this,ks,Sd).call(this)};class SZ extends or{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class Sf extends or{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Ur.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,r,i,s){r.includes("mouse")?e.addEventListener(r,o=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(r,o=>{var a;if(r==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(r==="focus"){if(t.focused)return;t.focused=!0}s&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:s(o)}}))})}_setEventListeners(e,t,r,i){var s,o,a;for(const[l,c]of r)(c==="Action"||(s=this.data.actions)!=null&&s[c])&&((c==="Focus"||c==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,l,c,i),c==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):c==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Ke.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:r}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||_Z,s=e.style;let o;const a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),u=Math.round(c/(yT*i))||1,h=c/u;o=Math.min(i,l(h/yT))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(i,l(c/yT))}s.fontSize=`calc(${o}px * var(--total-scale-factor))`,s.color=Ke.makeHexColor(r[0],r[1],r[2]),this.data.textAlignment!==null&&(s.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class AZ extends Sf{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,r,i){const s=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=r),s.setValue(o.id,{[i]:r})}render(){var i,s;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let r=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let a=o.value||"";const l=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;l&&a.length>l&&(a=a.slice(0,l));let c=o.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const u={userValue:a,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(r=document.createElement("textarea"),r.textContent=c??a,this.data.doNotScroll&&(r.style.overflowY="hidden")):(r=document.createElement("input"),r.type=this.data.password?"password":"text",r.setAttribute("value",c??a),this.data.doNotScroll&&(r.style.overflowX="hidden")),this.data.hasOwnCanvas&&(r.hidden=!0),ff.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,r.name=this.data.fieldName,r.tabIndex=0;const h=this.data.dateFormat||this.data.timeFormat;h&&(r.title=h),this._setRequired(r,this.data.required),l&&(r.maxLength=l),r.addEventListener("input",v=>{e.setValue(t,{value:v.target.value}),this.setPropertyOnSiblings(r,"value",v.target.value,"value"),u.formattedValue=null}),r.addEventListener("resetform",v=>{const w=this.data.defaultFieldValue??"";r.value=u.userValue=w,u.formattedValue=null});let f=v=>{const{formattedValue:w}=u;w!=null&&(v.target.value=w),v.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){r.addEventListener("focus",w=>{var A;if(u.focused)return;const{target:E}=w;u.userValue&&(E.value=u.userValue),u.lastCommittedValue=E.value,u.commitKey=1,(A=this.data.actions)!=null&&A.Focus||(u.focused=!0)}),r.addEventListener("updatefromsandbox",w=>{this.showElementAndHideCanvas(w.target);const E={value(A){u.userValue=A.detail.value??"",e.setValue(t,{value:u.userValue.toString()}),A.target.value=u.userValue},formattedValue(A){const{formattedValue:T}=A.detail;u.formattedValue=T,T!=null&&A.target!==document.activeElement&&(A.target.value=T),e.setValue(t,{formattedValue:T})},selRange(A){A.target.setSelectionRange(...A.detail.selRange)},charLimit:A=>{var g;const{charLimit:T}=A.detail,{target:_}=A;if(T===0){_.removeAttribute("maxLength");return}_.setAttribute("maxLength",T);let b=u.userValue;!b||b.length<=T||(b=b.slice(0,T),_.value=u.userValue=b,e.setValue(t,{value:b}),(g=this.linkService.eventBus)==null||g.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:b,willCommit:!0,commitKey:1,selStart:_.selectionStart,selEnd:_.selectionEnd}}))}};this._dispatchEventFromSandbox(E,w)}),r.addEventListener("keydown",w=>{var T;u.commitKey=1;let E=-1;if(w.key==="Escape"?E=0:w.key==="Enter"&&!this.data.multiLine?E=2:w.key==="Tab"&&(u.commitKey=3),E===-1)return;const{value:A}=w.target;u.lastCommittedValue!==A&&(u.lastCommittedValue=A,u.userValue=A,(T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:A,willCommit:!0,commitKey:E,selStart:w.target.selectionStart,selEnd:w.target.selectionEnd}}))});const v=f;f=null,r.addEventListener("blur",w=>{var A,T;if(!u.focused||!w.relatedTarget)return;(A=this.data.actions)!=null&&A.Blur||(u.focused=!1);const{value:E}=w.target;u.userValue=E,u.lastCommittedValue!==E&&((T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,willCommit:!0,commitKey:u.commitKey,selStart:w.target.selectionStart,selEnd:w.target.selectionEnd}})),v(w)}),(s=this.data.actions)!=null&&s.Keystroke&&r.addEventListener("beforeinput",w=>{var x;u.lastCommittedValue=null;const{data:E,target:A}=w,{value:T,selectionStart:_,selectionEnd:b}=A;let g=_,y=b;switch(w.inputType){case"deleteWordBackward":{const S=T.substring(0,_).match(/\w*[^\w]*$/);S&&(g-=S[0].length);break}case"deleteWordForward":{const S=T.substring(_).match(/^[^\w]*\w*/);S&&(y+=S[0].length);break}case"deleteContentBackward":_===b&&(g-=1);break;case"deleteContentForward":_===b&&(y+=1);break}w.preventDefault(),(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:T,change:E||"",willCommit:!1,selStart:g,selEnd:y}})}),this._setEventListeners(r,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],w=>w.target.value)}if(f&&r.addEventListener("blur",f),this.data.comb){const w=(this.data.rect[2]-this.data.rect[0])/l;r.classList.add("comb"),r.style.letterSpacing=`calc(${w}px * var(--total-scale-factor) - 1ch)`}}else r=document.createElement("div"),r.textContent=this.data.fieldValue,r.style.verticalAlign="middle",r.style.display="table-cell",this.data.hasOwnCanvas&&(r.hidden=!0);return this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class TZ extends Sf{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class IZ extends Sf{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,r=t.id;let i=e.getValue(r,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(r,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const s=document.createElement("input");return ff.add(s),s.setAttribute("data-element-id",r),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="checkbox",s.name=t.fieldName,i&&s.setAttribute("checked",!0),s.setAttribute("exportValue",t.exportValue),s.tabIndex=0,s.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const c of this._getElementsByName(a,r)){const u=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=u),e.setValue(c.id,{value:u})}e.setValue(r,{value:l})}),s.addEventListener("resetform",o=>{const a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(s.addEventListener("updatefromsandbox",o=>{const a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(r,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class F5 extends Sf{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,r=t.id;let i=e.getValue(r,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(r,{value:i})),i)for(const o of this._getElementsByName(t.fieldName,r))e.setValue(o.id,{value:!1});const s=document.createElement("input");if(ff.add(s),s.setAttribute("data-element-id",r),s.disabled=t.readOnly,this._setRequired(s,this.data.required),s.type="radio",s.name=t.fieldName,i&&s.setAttribute("checked",!0),s.tabIndex=0,s.addEventListener("change",o=>{const{name:a,checked:l}=o.target;for(const c of this._getElementsByName(a,r))e.setValue(c.id,{value:!1});e.setValue(r,{value:l})}),s.addEventListener("resetform",o=>{const a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;s.addEventListener("updatefromsandbox",a=>{const l={value:c=>{const u=o===c.detail.value;for(const h of this._getElementsByName(c.target.name)){const f=u&&h.id===r;h.domElement&&(h.domElement.checked=f),e.setValue(h.id,{value:f})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(s,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class xZ extends N5{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",r=>{this._dispatchEventFromSandbox({},r)})),e}}class CZ extends Sf{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,r=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");ff.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let s=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",u=>{const h=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===h});for(const u of this.data.options){const h=document.createElement("option");h.textContent=u.displayValue,h.value=u.exportValue,r.value.includes(u.exportValue)&&(h.setAttribute("selected",!0),s=!1),i.append(h)}let o=null;if(s){const u=document.createElement("option");u.value=" ",u.setAttribute("hidden",!0),u.setAttribute("selected",!0),i.prepend(u),o=()=>{u.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const a=u=>{const h=u?"value":"textContent",{options:f,multiple:v}=i;return v?Array.prototype.filter.call(f,w=>w.selected).map(w=>w[h]):f.selectedIndex===-1?null:f[f.selectedIndex][h]};let l=a(!1);const c=u=>{const h=u.target.options;return Array.prototype.map.call(h,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",u=>{const h={value(f){o==null||o();const v=f.detail.value,w=new Set(Array.isArray(v)?v:[v]);for(const E of i.options)E.selected=w.has(E.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(f){i.multiple=!0},remove(f){const v=i.options,w=f.detail.remove;v[w].selected=!1,i.remove(w),v.length>0&&Array.prototype.findIndex.call(v,A=>A.selected)===-1&&(v[0].selected=!0),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(f){const{index:v,displayValue:w,exportValue:E}=f.detail.insert,A=i.children[v],T=document.createElement("option");T.textContent=w,T.value=E,A?A.before(T):i.append(T),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},items(f){const{items:v}=f.detail;for(;i.length!==0;)i.remove(0);for(const w of v){const{displayValue:E,exportValue:A}=w,T=document.createElement("option");T.textContent=E,T.value=A,i.append(T)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},indices(f){const v=new Set(f.detail.indices);for(const w of f.target.options)w.selected=v.has(w.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(h,u)}),i.addEventListener("input",u=>{var v;const h=a(!0),f=a(!1);e.setValue(t,{value:h}),u.preventDefault(),(v=this.linkService.eventBus)==null||v.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],u=>u.target.value)):i.addEventListener("input",function(u){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class tC extends or{constructor(e){const{data:t,elements:r}=e;super(e,{isRenderable:or._hasPopupData(t)}),this.elements=r,this.popup=null}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=new PZ({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),r=[];for(const i of this.elements)i.popup=t,i.container.ariaHasPopup="dialog",r.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",r.map(i=>`${fk}${i}`).join(",")),this.container}}var fm,zS,HS,pm,mm,Wn,Cl,vh,Ww,qw,gm,Pl,ko,Rl,Kw,kl,Yw,wh,Eh,mn,Qb,nC,V5,U5,B5,$5,Xb,Jb,rC;class PZ{constructor({container:e,color:t,elements:r,titleObj:i,modificationDate:s,contentsObj:o,richText:a,parent:l,rect:c,parentRect:u,open:h}){O(this,mn);O(this,fm,F(this,mn,B5).bind(this));O(this,zS,F(this,mn,rC).bind(this));O(this,HS,F(this,mn,Jb).bind(this));O(this,pm,F(this,mn,Xb).bind(this));O(this,mm,null);O(this,Wn,null);O(this,Cl,null);O(this,vh,null);O(this,Ww,null);O(this,qw,null);O(this,gm,null);O(this,Pl,!1);O(this,ko,null);O(this,Rl,null);O(this,Kw,null);O(this,kl,null);O(this,Yw,null);O(this,wh,null);O(this,Eh,!1);var f;R(this,Wn,e),R(this,Yw,i),R(this,Cl,o),R(this,kl,a),R(this,qw,l),R(this,mm,t),R(this,Kw,c),R(this,gm,u),R(this,Ww,r),R(this,vh,jA.toDateObject(s)),this.trigger=r.flatMap(v=>v.getElementsToTriggerPopup());for(const v of this.trigger)v.addEventListener("click",d(this,pm)),v.addEventListener("mouseenter",d(this,HS)),v.addEventListener("mouseleave",d(this,zS)),v.classList.add("popupTriggerArea");for(const v of r)(f=v.container)==null||f.addEventListener("keydown",d(this,fm));d(this,Wn).hidden=!0,h&&F(this,mn,Xb).call(this)}render(){if(d(this,ko))return;const e=R(this,ko,document.createElement("div"));if(e.className="popup",d(this,mm)){const s=e.style.outlineColor=Ke.makeHexColor(...d(this,mm));e.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const t=document.createElement("span");t.className="header";const r=document.createElement("h1");if(t.append(r),{dir:r.dir,str:r.textContent}=d(this,Yw),e.append(t),d(this,vh)){const s=document.createElement("time");s.classList.add("popupDate"),s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:d(this,vh).valueOf()})),s.dateTime=d(this,vh).toISOString(),t.append(s)}const i=d(this,mn,Qb);if(i)bk.render({xfaHtml:i,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const s=this._formatContents(d(this,Cl));e.append(s)}d(this,Wn).append(e)}_formatContents({str:e,dir:t}){const r=document.createElement("p");r.classList.add("popupContent"),r.dir=t;const i=e.split(/(?:\r\n?|\n)/);for(let s=0,o=i.length;s<o;++s){const a=i[s];r.append(document.createTextNode(a)),s<o-1&&r.append(document.createElement("br"))}return r}updateEdited({rect:e,popupContent:t}){var r;d(this,wh)||R(this,wh,{contentsObj:d(this,Cl),richText:d(this,kl)}),e&&R(this,Rl,null),t&&(R(this,kl,F(this,mn,U5).call(this,t)),R(this,Cl,null)),(r=d(this,ko))==null||r.remove(),R(this,ko,null)}resetEdited(){var e;d(this,wh)&&({contentsObj:Si(this,Cl)._,richText:Si(this,kl)._}=d(this,wh),R(this,wh,null),(e=d(this,ko))==null||e.remove(),R(this,ko,null),R(this,Rl,null))}forceHide(){R(this,Eh,this.isVisible),d(this,Eh)&&(d(this,Wn).hidden=!0)}maybeShow(){d(this,Eh)&&(d(this,ko)||F(this,mn,Jb).call(this),R(this,Eh,!1),d(this,Wn).hidden=!1)}get isVisible(){return d(this,Wn).hidden===!1}}fm=new WeakMap,zS=new WeakMap,HS=new WeakMap,pm=new WeakMap,mm=new WeakMap,Wn=new WeakMap,Cl=new WeakMap,vh=new WeakMap,Ww=new WeakMap,qw=new WeakMap,gm=new WeakMap,Pl=new WeakMap,ko=new WeakMap,Rl=new WeakMap,Kw=new WeakMap,kl=new WeakMap,Yw=new WeakMap,wh=new WeakMap,Eh=new WeakMap,mn=new WeakSet,Qb=function(){const e=d(this,kl),t=d(this,Cl);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&d(this,kl).html||null},nC=function(){var e,t,r;return((r=(t=(e=d(this,mn,Qb))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:r.fontSize)||0},V5=function(){var e,t,r;return((r=(t=(e=d(this,mn,Qb))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:r.color)||null},U5=function(e){const t=[],r={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:d(this,mn,V5),fontSize:d(this,mn,nC)?`calc(${d(this,mn,nC)}px * var(--total-scale-factor))`:""}};for(const s of e.split(`
`))t.push({name:"span",value:s,attributes:i});return r},B5=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&d(this,Pl))&&F(this,mn,Xb).call(this)},$5=function(){if(d(this,Rl)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:r,pageX:i,pageY:s}}}=d(this,qw);let o=!!d(this,gm),a=o?d(this,gm):d(this,Kw);for(const w of d(this,Ww))if(!a||Ke.intersect(w.data.rect,a)!==null){a=w.data.rect,o=!0;break}const l=Ke.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),u=o?a[2]-a[0]+5:0,h=l[0]+u,f=l[1];R(this,Rl,[100*(h-i)/t,100*(f-s)/r]);const{style:v}=d(this,Wn);v.left=`${d(this,Rl)[0]}%`,v.top=`${d(this,Rl)[1]}%`},Xb=function(){R(this,Pl,!d(this,Pl)),d(this,Pl)?(F(this,mn,Jb).call(this),d(this,Wn).addEventListener("click",d(this,pm)),d(this,Wn).addEventListener("keydown",d(this,fm))):(F(this,mn,rC).call(this),d(this,Wn).removeEventListener("click",d(this,pm)),d(this,Wn).removeEventListener("keydown",d(this,fm)))},Jb=function(){d(this,ko)||this.render(),this.isVisible?d(this,Pl)&&d(this,Wn).classList.add("focused"):(F(this,mn,$5).call(this),d(this,Wn).hidden=!1,d(this,Wn).style.zIndex=parseInt(d(this,Wn).style.zIndex)+1e3)},rC=function(){d(this,Wn).classList.remove("focused"),!(d(this,Pl)||!this.isVisible)&&(d(this,Wn).hidden=!0,d(this,Wn).style.zIndex=parseInt(d(this,Wn).style.zIndex)-1e3)};class j5 extends or{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=mt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const r=document.createElement("span");r.textContent=t,e.append(r)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Qw;class RZ extends or{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});O(this,Qw,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:r,height:i}=this,s=this.svgFactory.create(r,i,!0),o=R(this,Qw,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),s.append(o),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,Qw)}addHighlightArea(){this.container.classList.add("highlightArea")}}Qw=new WeakMap;var Xw;class kZ extends or{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});O(this,Xw,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:r,height:i}=this,s=this.svgFactory.create(r,i,!0),o=t.borderStyle.width,a=R(this,Xw,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",o/2),a.setAttribute("y",o/2),a.setAttribute("width",r-o),a.setAttribute("height",i-o),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,Xw)}addHighlightArea(){this.container.classList.add("highlightArea")}}Xw=new WeakMap;var Jw;class DZ extends or{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});O(this,Jw,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:r,height:i}=this,s=this.svgFactory.create(r,i,!0),o=t.borderStyle.width,a=R(this,Jw,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",r/2),a.setAttribute("cy",i/2),a.setAttribute("rx",r/2-o/2),a.setAttribute("ry",i/2-o/2),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,Jw)}addHighlightArea(){this.container.classList.add("highlightArea")}}Jw=new WeakMap;var Zw;class z5 extends or{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});O(this,Zw,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:r,borderStyle:i,popupRef:s},width:o,height:a}=this;if(!r)return this.container;const l=this.svgFactory.create(o,a,!0);let c=[];for(let h=0,f=r.length;h<f;h+=2){const v=r[h]-t[0],w=t[3]-r[h+1];c.push(`${v},${w}`)}c=c.join(" ");const u=R(this,Zw,this.svgFactory.createElement(this.svgElementName));return u.setAttribute("points",c),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),l.append(u),this.container.append(l),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return d(this,Zw)}addHighlightArea(){this.container.classList.add("highlightArea")}}Zw=new WeakMap;class MZ extends z5{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class NZ extends or{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var e0,bh,t0,iC;class _k extends or{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});O(this,t0);O(this,e0,null);O(this,bh,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?mt.HIGHLIGHT:mt.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:r,inkLists:i,borderStyle:s,popupRef:o}}=this,{transform:a,width:l,height:c}=F(this,t0,iC).call(this,r,t),u=this.svgFactory.create(l,c,!0),h=R(this,e0,this.svgFactory.createElement("svg:g"));u.append(h),h.setAttribute("stroke-width",s.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",a);for(let f=0,v=i.length;f<v;f++){const w=this.svgFactory.createElement(this.svgElementName);d(this,bh).push(w),w.setAttribute("points",i[f].join(",")),h.append(w)}return!o&&this.hasPopupData&&this._createPopup(),this.container.append(u),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:r,points:i,rect:s}=t,o=d(this,e0);if(r>=0&&o.setAttribute("stroke-width",r||1),i)for(let a=0,l=d(this,bh).length;a<l;a++)d(this,bh)[a].setAttribute("points",i[a].join(","));if(s){const{transform:a,width:l,height:c}=F(this,t0,iC).call(this,this.data.rotation,s);o.parentElement.setAttribute("viewBox",`0 0 ${l} ${c}`),o.setAttribute("transform",a)}}getElementsToTriggerPopup(){return d(this,bh)}addHighlightArea(){this.container.classList.add("highlightArea")}}e0=new WeakMap,bh=new WeakMap,t0=new WeakSet,iC=function(t,r){switch(t){case 90:return{transform:`rotate(90) translate(${-r[0]},${r[1]}) scale(1,-1)`,width:r[3]-r[1],height:r[2]-r[0]};case 180:return{transform:`rotate(180) translate(${-r[2]},${r[1]}) scale(1,-1)`,width:r[2]-r[0],height:r[3]-r[1]};case 270:return{transform:`rotate(270) translate(${-r[2]},${r[3]}) scale(1,-1)`,width:r[3]-r[1],height:r[2]-r[0]};default:return{transform:`translate(${-r[0]},${r[3]}) scale(1,-1)`,width:r[2]-r[0],height:r[3]-r[1]}}};class H5 extends or{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=mt.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const r=document.createElement("mark");r.classList.add("overlaidText"),r.textContent=e,this.container.append(r)}return this.container}}class LZ extends or{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),e){const r=document.createElement("u");r.classList.add("overlaidText"),r.textContent=e,this.container.append(r)}return this.container}}class OZ extends or{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),e){const r=document.createElement("u");r.classList.add("overlaidText"),r.textContent=e,this.container.append(r)}return this.container}}class FZ extends or{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),e){const r=document.createElement("s");r.classList.add("overlaidText"),r.textContent=e,this.container.append(r)}return this.container}}class G5 extends or{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=mt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var n0,r0,sC;class VZ extends or{constructor(t){var i;super(t,{isRenderable:!0});O(this,r0);O(this,n0,null);const{file:r}=this.data;this.filename=r.filename,this.content=r.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...r})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:r}=this;let i;r.hasAppearance||r.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(r.name)?"paperclip":"pushpin"}.svg`,r.fillAlpha&&r.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(r.fillAlpha*100)}%);`)),i.addEventListener("dblclick",F(this,r0,sC).bind(this)),R(this,n0,i);const{isMac:s}=Ur.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(s?o.metaKey:o.ctrlKey)&&F(this,r0,sC).call(this)}),!r.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return d(this,n0)}addHighlightArea(){this.container.classList.add("highlightArea")}}n0=new WeakMap,r0=new WeakSet,sC=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var i0,_h,ou,s0,Xu,oC,aC,ym;let Sk=(ym=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:r,annotationEditorUIManager:i,page:s,viewport:o,structTreeLayer:a}){O(this,Xu);O(this,i0,null);O(this,_h,null);O(this,ou,new Map);O(this,s0,null);this.div=e,R(this,i0,t),R(this,_h,r),R(this,s0,a||null),this.page=s,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return d(this,ou).size>0}async render(e){var o;const{annotations:t}=e,r=this.div;qu(r,this.viewport);const i=new Map,s={data:null,layer:r,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new qv,annotationStorage:e.annotationStorage||new mk,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const a of t){if(a.noHTML)continue;const l=a.annotationType===Jn.POPUP;if(l){const h=i.get(a.id);if(!h)continue;s.elements=h}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;s.data=a;const c=QN.create(s);if(!c.isRenderable)continue;if(!l&&a.popupRef){const h=i.get(a.popupRef);h?h.push(c):i.set(a.popupRef,[c])}const u=c.render();a.hidden&&(u.style.visibility="hidden"),await F(this,Xu,oC).call(this,u,a.id,s.elements),c._isEditable&&(d(this,ou).set(c.data.id,c),(o=this._annotationEditorUIManager)==null||o.renderAnnotationElement(c))}F(this,Xu,aC).call(this)}async addLinkAnnotations(e,t){const r={data:null,layer:this.div,linkService:t,svgFactory:new qv,parent:this};for(const i of e){i.borderStyle||(i.borderStyle=ym._defaultBorderStyle),r.data=i;const s=QN.create(r);if(!s.isRenderable)continue;const o=s.render();await F(this,Xu,oC).call(this,o,i.id,null)}}update({viewport:e}){const t=this.div;this.viewport=e,qu(t,{rotation:e.rotation}),F(this,Xu,aC).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(d(this,ou).values())}getEditableAnnotation(e){return d(this,ou).get(e)}static get _defaultBorderStyle(){return Dt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:qf.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}},i0=new WeakMap,_h=new WeakMap,ou=new WeakMap,s0=new WeakMap,Xu=new WeakSet,oC=async function(e,t,r){var a,l;const i=e.firstChild||e,s=i.id=`${fk}${t}`,o=await((a=d(this,s0))==null?void 0:a.getAriaAttributes(s));if(o)for(const[c,u]of o)i.setAttribute(c,u);r?r.at(-1).container.after(e):(this.div.append(e),(l=d(this,i0))==null||l.moveElementInDOM(this.div,e,i,!1))},aC=function(){var t;if(!d(this,_h))return;const e=this.div;for(const[r,i]of d(this,_h)){const s=e.querySelector(`[data-annotation-id="${r}"]`);if(!s)continue;i.className="annotationContent";const{firstChild:o}=s;o?o.nodeName==="CANVAS"?o.replaceWith(i):o.classList.contains("annotationContent")?o.after(i):o.before(i):s.append(i);const a=d(this,ou).get(r);a&&(a._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(r,s.id,i),a._hasNoCanvas=!1):a.canvas=i)}d(this,_h).clear()},ym);const YE=/\r\n?|\n/g;var Do,vs,o0,Sh,ws,pr,W5,q5,K5,Zb,Ql,e_,t_,Y5,cC,Q5;const bn=class bn extends Sn{constructor(t){super({...t,name:"freeTextEditor"});O(this,pr);O(this,Do);O(this,vs,"");O(this,o0,`${this.id}-editor`);O(this,Sh,null);O(this,ws);R(this,Do,t.color||bn._defaultColor||Sn._defaultLineColor),R(this,ws,t.fontSize||bn._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static get _keyboardManager(){const t=bn.prototype,r=o=>o.isEmpty(),i=Ku.TRANSLATE_SMALL,s=Ku.TRANSLATE_BIG;return Dt(this,"_keyboardManager",new eE([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:r}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:r}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:r}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[s,0],checker:r}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:r}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:r}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:r}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,s],checker:r}]]))}static initialize(t,r){Sn.initialize(t,r);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,r){switch(t){case Ot.FREETEXT_SIZE:bn._defaultFontSize=r;break;case Ot.FREETEXT_COLOR:bn._defaultColor=r;break}}updateParams(t,r){switch(t){case Ot.FREETEXT_SIZE:F(this,pr,W5).call(this,r);break;case Ot.FREETEXT_COLOR:F(this,pr,q5).call(this,r);break}}static get defaultPropertiesToUpdate(){return[[Ot.FREETEXT_SIZE,bn._defaultFontSize],[Ot.FREETEXT_COLOR,bn._defaultColor||Sn._defaultLineColor]]}get propertiesToUpdate(){return[[Ot.FREETEXT_SIZE,d(this,ws)],[Ot.FREETEXT_COLOR,d(this,Do)]]}_translateEmpty(t,r){this._uiManager.translateSelectedEditors(t,r,!0)}getInitialTranslation(){const t=this.parentScale;return[-bn._internalPadding*t,-(bn._internalPadding+d(this,ws))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),R(this,Sh,new AbortController);const t=this._uiManager.combinedSignal(d(this,Sh));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",d(this,o0)),this._isDraggable=!0,(t=d(this,Sh))==null||t.abort(),R(this,Sh,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var r;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(r=this._initialOptions)!=null&&r.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=d(this,vs),r=R(this,vs,F(this,pr,K5).call(this).trimEnd());if(t===r)return;const i=s=>{if(R(this,vs,s),!s){this.remove();return}F(this,pr,t_).call(this),this._uiManager.rebuild(this),F(this,pr,Zb).call(this)};this.addCommands({cmd:()=>{i(r)},undo:()=>{i(t)},mustExec:!1}),F(this,pr,Zb).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){bn._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,r;(this._isCopy||this.annotationElementId)&&(t=this.x,r=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",d(this,o0)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${d(this,ws)}px * var(--total-scale-factor))`,i.color=d(this,Do),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[s,o]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[l,c]=this.getInitialTranslation();[l,c]=this.pageTranslationToScreen(l,c);const[u,h]=this.pageDimensions,[f,v]=this.pageTranslation;let w,E;switch(this.rotation){case 0:w=t+(a[0]-f)/u,E=r+this.height-(a[1]-v)/h;break;case 90:w=t+(a[0]-f)/u,E=r-(a[1]-v)/h,[l,c]=[c,-l];break;case 180:w=t-this.width+(a[0]-f)/u,E=r-(a[1]-v)/h,[l,c]=[-l,-c];break;case 270:w=t+(a[0]-f-this.height*h)/u,E=r+(a[1]-v-this.width*u)/h,[l,c]=[-c,l];break}this.setAt(w*s,E*o,l,c)}else this._moveAfterPaste(t,r);F(this,pr,t_).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var w,E,A;const r=t.clipboardData||window.clipboardData,{types:i}=r;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const s=F(w=bn,Ql,cC).call(w,r.getData("text")||"").replaceAll(YE,`
`);if(!s)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const a=o.getRangeAt(0);if(!s.includes(`
`)){a.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:l,startOffset:c}=a,u=[],h=[];if(l.nodeType===Node.TEXT_NODE){const T=l.parentElement;if(h.push(l.nodeValue.slice(c).replaceAll(YE,"")),T!==this.editorDiv){let _=u;for(const b of this.editorDiv.childNodes){if(b===T){_=h;continue}_.push(F(E=bn,Ql,e_).call(E,b))}}u.push(l.nodeValue.slice(0,c).replaceAll(YE,""))}else if(l===this.editorDiv){let T=u,_=0;for(const b of this.editorDiv.childNodes)_++===c&&(T=h),T.push(F(A=bn,Ql,e_).call(A,b))}R(this,vs,`${u.join(`
`)}${s}${h.join(`
`)}`),F(this,pr,t_).call(this);const f=new Range;let v=Math.sumPrecise(u.map(T=>T.length));for(const{firstChild:T}of this.editorDiv.childNodes)if(T.nodeType===Node.TEXT_NODE){const _=T.nodeValue.length;if(v<=_){f.setStart(T,v),f.setEnd(T,v);break}v-=_}o.removeAllRanges(),o.addRange(f)}get contentDiv(){return this.editorDiv}static async deserialize(t,r,i){var a;let s=null;if(t instanceof j5){const{data:{defaultAppearanceData:{fontSize:l,fontColor:c},rect:u,rotation:h,id:f,popupRef:v},textContent:w,textPosition:E,parent:{page:{pageNumber:A}}}=t;if(!w||w.length===0)return null;s=t={annotationType:mt.FREETEXT,color:Array.from(c),fontSize:l,value:w.join(`
`),position:E,pageIndex:A-1,rect:u.slice(0),rotation:h,annotationElementId:f,id:f,deleted:!1,popupRef:v}}const o=await super.deserialize(t,r,i);return R(o,ws,t.fontSize),R(o,Do,Ke.makeHexColor(...t.color)),R(o,vs,F(a=bn,Ql,cC).call(a,t.value)),o._initialData=s,o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r=bn._internalPadding*this.parentScale,i=this.getRect(r,r),s=Sn._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:d(this,Do)),o={annotationType:mt.FREETEXT,color:s,fontSize:d(this,ws),value:F(this,pr,Y5).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(o.isCopy=!0,o):this.annotationElementId&&!F(this,pr,Q5).call(this,o)?null:(o.id=this.annotationElementId,o)}renderAnnotationElement(t){const r=super.renderAnnotationElement(t);if(this.deleted)return r;const{style:i}=r;i.fontSize=`calc(${d(this,ws)}px * var(--total-scale-factor))`,i.color=d(this,Do),r.replaceChildren();for(const o of d(this,vs).split(`
`)){const a=document.createElement("div");a.append(o?document.createTextNode(o):document.createElement("br")),r.append(a)}const s=bn._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(s,s),popupContent:d(this,vs)}),r}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Do=new WeakMap,vs=new WeakMap,o0=new WeakMap,Sh=new WeakMap,ws=new WeakMap,pr=new WeakSet,W5=function(t){const r=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--total-scale-factor))`,this.translate(0,-(s-d(this,ws))*this.parentScale),R(this,ws,s),F(this,pr,Zb).call(this)},i=d(this,ws);this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},q5=function(t){const r=s=>{R(this,Do,this.editorDiv.style.color=s)},i=d(this,Do);this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},K5=function(){var i;const t=[];this.editorDiv.normalize();let r=null;for(const s of this.editorDiv.childNodes)(r==null?void 0:r.nodeType)===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(F(i=bn,Ql,e_).call(i,s)),r=s);return t.join(`
`)},Zb=function(){const[t,r]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:s,div:o}=this,a=o.style.display,l=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",s.div.append(this.div),i=o.getBoundingClientRect(),o.remove(),o.style.display=a,o.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/r):(this.width=i.height/t,this.height=i.width/r),this.fixAndSetPosition()},Ql=new WeakSet,e_=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(YE,"")},t_=function(){if(this.editorDiv.replaceChildren(),!!d(this,vs))for(const t of d(this,vs).split(`
`)){const r=document.createElement("div");r.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(r)}},Y5=function(){return d(this,vs).replaceAll("Â "," ")},cC=function(t){return t.replaceAll(" ","Â ")},Q5=function(t){const{value:r,fontSize:i,color:s,pageIndex:o}=this._initialData;return this._hasBeenMoved||t.value!==r||t.fontSize!==i||t.color.some((a,l)=>a!==s[l])||t.pageIndex!==o},O(bn,Ql),ge(bn,"_freeTextDefaultContent",""),ge(bn,"_internalPadding",0),ge(bn,"_defaultColor",null),ge(bn,"_defaultFontSize",10),ge(bn,"_type","freetext"),ge(bn,"_editorType",mt.FREETEXT);let lC=bn;class Ne{toSVGPath(){hn("Abstract method `toSVGPath` must be implemented.")}get box(){hn("Abstract getter `box` must be implemented.")}serialize(e,t){hn("Abstract method `serialize` must be implemented.")}static _rescale(e,t,r,i,s,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a]*i,o[a+1]=r+e[a+1]*s;return o}static _rescaleAndSwap(e,t,r,i,s,o){o||(o=new Float32Array(e.length));for(let a=0,l=e.length;a<l;a+=2)o[a]=t+e[a+1]*i,o[a+1]=r+e[a]*s;return o}static _translate(e,t,r,i){i||(i=new Float32Array(e.length));for(let s=0,o=e.length;s<o;s+=2)i[s]=t+e[s],i[s+1]=r+e[s+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,r,i,s){switch(s){case 90:return[1-t/r,e/i];case 180:return[1-e/r,1-t/i];case 270:return[t/r,1-e/i];default:return[e/r,t/i]}}static _normalizePagePoint(e,t,r){switch(r){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,r,i,s,o){return[(e+5*r)/6,(t+5*i)/6,(5*r+s)/6,(5*i+o)/6,(r+s)/2,(i+o)/2]}}ge(Ne,"PRECISION",1e-4);var Es,Mo,vm,wm,Aa,Rt,Ah,Th,a0,l0,Em,bm,au,c0,GS,WS,Sr,Ny,X5,J5,Z5,e$,t$,n$;const cl=class cl{constructor({x:e,y:t},r,i,s,o,a=0){O(this,Sr);O(this,Es);O(this,Mo,[]);O(this,vm);O(this,wm);O(this,Aa,[]);O(this,Rt,new Float32Array(18));O(this,Ah);O(this,Th);O(this,a0);O(this,l0);O(this,Em);O(this,bm);O(this,au,[]);R(this,Es,r),R(this,bm,s*i),R(this,wm,o),d(this,Rt).set([NaN,NaN,NaN,NaN,e,t],6),R(this,vm,a),R(this,l0,d(cl,c0)*i),R(this,a0,d(cl,WS)*i),R(this,Em,i),d(this,au).push(e,t)}isEmpty(){return isNaN(d(this,Rt)[8])}add({x:e,y:t}){var P;R(this,Ah,e),R(this,Th,t);const[r,i,s,o]=d(this,Es);let[a,l,c,u]=d(this,Rt).subarray(8,12);const h=e-c,f=t-u,v=Math.hypot(h,f);if(v<d(this,a0))return!1;const w=v-d(this,l0),E=w/v,A=E*h,T=E*f;let _=a,b=l;a=c,l=u,c+=A,u+=T,(P=d(this,au))==null||P.push(e,t);const g=-T/w,y=A/w,x=g*d(this,bm),S=y*d(this,bm);return d(this,Rt).set(d(this,Rt).subarray(2,8),0),d(this,Rt).set([c+x,u+S],4),d(this,Rt).set(d(this,Rt).subarray(14,18),12),d(this,Rt).set([c-x,u-S],16),isNaN(d(this,Rt)[6])?(d(this,Aa).length===0&&(d(this,Rt).set([a+x,l+S],2),d(this,Aa).push(NaN,NaN,NaN,NaN,(a+x-r)/s,(l+S-i)/o),d(this,Rt).set([a-x,l-S],14),d(this,Mo).push(NaN,NaN,NaN,NaN,(a-x-r)/s,(l-S-i)/o)),d(this,Rt).set([_,b,a,l,c,u],6),!this.isEmpty()):(d(this,Rt).set([_,b,a,l,c,u],6),Math.abs(Math.atan2(b-l,_-a)-Math.atan2(T,A))<Math.PI/2?([a,l,c,u]=d(this,Rt).subarray(2,6),d(this,Aa).push(NaN,NaN,NaN,NaN,((a+c)/2-r)/s,((l+u)/2-i)/o),[a,l,_,b]=d(this,Rt).subarray(14,18),d(this,Mo).push(NaN,NaN,NaN,NaN,((_+a)/2-r)/s,((b+l)/2-i)/o),!0):([_,b,a,l,c,u]=d(this,Rt).subarray(0,6),d(this,Aa).push(((_+5*a)/6-r)/s,((b+5*l)/6-i)/o,((5*a+c)/6-r)/s,((5*l+u)/6-i)/o,((a+c)/2-r)/s,((l+u)/2-i)/o),[c,u,a,l,_,b]=d(this,Rt).subarray(12,18),d(this,Mo).push(((_+5*a)/6-r)/s,((b+5*l)/6-i)/o,((5*a+c)/6-r)/s,((5*l+u)/6-i)/o,((a+c)/2-r)/s,((l+u)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=d(this,Aa),t=d(this,Mo);if(isNaN(d(this,Rt)[6])&&!this.isEmpty())return F(this,Sr,X5).call(this);const r=[];r.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?r.push(`L${e[i+4]} ${e[i+5]}`):r.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);F(this,Sr,Z5).call(this,r);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?r.push(`L${t[i+4]} ${t[i+5]}`):r.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return F(this,Sr,J5).call(this,r),r.join(" ")}newFreeDrawOutline(e,t,r,i,s,o){return new r$(e,t,r,i,s,o)}getOutlines(){var h;const e=d(this,Aa),t=d(this,Mo),r=d(this,Rt),[i,s,o,a]=d(this,Es),l=new Float32Array((((h=d(this,au))==null?void 0:h.length)??0)+2);for(let f=0,v=l.length-2;f<v;f+=2)l[f]=(d(this,au)[f]-i)/o,l[f+1]=(d(this,au)[f+1]-s)/a;if(l[l.length-2]=(d(this,Ah)-i)/o,l[l.length-1]=(d(this,Th)-s)/a,isNaN(r[6])&&!this.isEmpty())return F(this,Sr,e$).call(this,l);const c=new Float32Array(d(this,Aa).length+24+d(this,Mo).length);let u=e.length;for(let f=0;f<u;f+=2){if(isNaN(e[f])){c[f]=c[f+1]=NaN;continue}c[f]=e[f],c[f+1]=e[f+1]}u=F(this,Sr,n$).call(this,c,u);for(let f=t.length-6;f>=6;f-=6)for(let v=0;v<6;v+=2){if(isNaN(t[f+v])){c[u]=c[u+1]=NaN,u+=2;continue}c[u]=t[f+v],c[u+1]=t[f+v+1],u+=2}return F(this,Sr,t$).call(this,c,u),this.newFreeDrawOutline(c,l,d(this,Es),d(this,Em),d(this,vm),d(this,wm))}};Es=new WeakMap,Mo=new WeakMap,vm=new WeakMap,wm=new WeakMap,Aa=new WeakMap,Rt=new WeakMap,Ah=new WeakMap,Th=new WeakMap,a0=new WeakMap,l0=new WeakMap,Em=new WeakMap,bm=new WeakMap,au=new WeakMap,c0=new WeakMap,GS=new WeakMap,WS=new WeakMap,Sr=new WeakSet,Ny=function(){const e=d(this,Rt).subarray(4,6),t=d(this,Rt).subarray(16,18),[r,i,s,o]=d(this,Es);return[(d(this,Ah)+(e[0]-t[0])/2-r)/s,(d(this,Th)+(e[1]-t[1])/2-i)/o,(d(this,Ah)+(t[0]-e[0])/2-r)/s,(d(this,Th)+(t[1]-e[1])/2-i)/o]},X5=function(){const[e,t,r,i]=d(this,Es),[s,o,a,l]=F(this,Sr,Ny).call(this);return`M${(d(this,Rt)[2]-e)/r} ${(d(this,Rt)[3]-t)/i} L${(d(this,Rt)[4]-e)/r} ${(d(this,Rt)[5]-t)/i} L${s} ${o} L${a} ${l} L${(d(this,Rt)[16]-e)/r} ${(d(this,Rt)[17]-t)/i} L${(d(this,Rt)[14]-e)/r} ${(d(this,Rt)[15]-t)/i} Z`},J5=function(e){const t=d(this,Mo);e.push(`L${t[4]} ${t[5]} Z`)},Z5=function(e){const[t,r,i,s]=d(this,Es),o=d(this,Rt).subarray(4,6),a=d(this,Rt).subarray(16,18),[l,c,u,h]=F(this,Sr,Ny).call(this);e.push(`L${(o[0]-t)/i} ${(o[1]-r)/s} L${l} ${c} L${u} ${h} L${(a[0]-t)/i} ${(a[1]-r)/s}`)},e$=function(e){const t=d(this,Rt),[r,i,s,o]=d(this,Es),[a,l,c,u]=F(this,Sr,Ny).call(this),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-r)/s,(t[3]-i)/o,NaN,NaN,NaN,NaN,(t[4]-r)/s,(t[5]-i)/o,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,u,NaN,NaN,NaN,NaN,(t[16]-r)/s,(t[17]-i)/o,NaN,NaN,NaN,NaN,(t[14]-r)/s,(t[15]-i)/o],0),this.newFreeDrawOutline(h,e,d(this,Es),d(this,Em),d(this,vm),d(this,wm))},t$=function(e,t){const r=d(this,Mo);return e.set([NaN,NaN,NaN,NaN,r[4],r[5]],t),t+=6},n$=function(e,t){const r=d(this,Rt).subarray(4,6),i=d(this,Rt).subarray(16,18),[s,o,a,l]=d(this,Es),[c,u,h,f]=F(this,Sr,Ny).call(this);return e.set([NaN,NaN,NaN,NaN,(r[0]-s)/a,(r[1]-o)/l,NaN,NaN,NaN,NaN,c,u,NaN,NaN,NaN,NaN,h,f,NaN,NaN,NaN,NaN,(i[0]-s)/a,(i[1]-o)/l],t),t+=24},O(cl,c0,8),O(cl,GS,2),O(cl,WS,d(cl,c0)+d(cl,GS));let bS=cl;var _m,Ih,Dl,u0,bs,d0,er,qS,i$;class r$ extends Ne{constructor(t,r,i,s,o,a){super();O(this,qS);O(this,_m);O(this,Ih,new Float32Array(4));O(this,Dl);O(this,u0);O(this,bs);O(this,d0);O(this,er);R(this,er,t),R(this,bs,r),R(this,_m,i),R(this,d0,s),R(this,Dl,o),R(this,u0,a),this.lastPoint=[NaN,NaN],F(this,qS,i$).call(this,a);const[l,c,u,h]=d(this,Ih);for(let f=0,v=t.length;f<v;f+=2)t[f]=(t[f]-l)/u,t[f+1]=(t[f+1]-c)/h;for(let f=0,v=r.length;f<v;f+=2)r[f]=(r[f]-l)/u,r[f+1]=(r[f+1]-c)/h}toSVGPath(){const t=[`M${d(this,er)[4]} ${d(this,er)[5]}`];for(let r=6,i=d(this,er).length;r<i;r+=6){if(isNaN(d(this,er)[r])){t.push(`L${d(this,er)[r+4]} ${d(this,er)[r+5]}`);continue}t.push(`C${d(this,er)[r]} ${d(this,er)[r+1]} ${d(this,er)[r+2]} ${d(this,er)[r+3]} ${d(this,er)[r+4]} ${d(this,er)[r+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,r,i,s],o){const a=i-t,l=s-r;let c,u;switch(o){case 0:c=Ne._rescale(d(this,er),t,s,a,-l),u=Ne._rescale(d(this,bs),t,s,a,-l);break;case 90:c=Ne._rescaleAndSwap(d(this,er),t,r,a,l),u=Ne._rescaleAndSwap(d(this,bs),t,r,a,l);break;case 180:c=Ne._rescale(d(this,er),i,r,-a,l),u=Ne._rescale(d(this,bs),i,r,-a,l);break;case 270:c=Ne._rescaleAndSwap(d(this,er),i,s,-a,-l),u=Ne._rescaleAndSwap(d(this,bs),i,s,-a,-l);break}return{outline:Array.from(c),points:[Array.from(u)]}}get box(){return d(this,Ih)}newOutliner(t,r,i,s,o,a=0){return new bS(t,r,i,s,o,a)}getNewOutline(t,r){const[i,s,o,a]=d(this,Ih),[l,c,u,h]=d(this,_m),f=o*u,v=a*h,w=i*u+l,E=s*h+c,A=this.newOutliner({x:d(this,bs)[0]*f+w,y:d(this,bs)[1]*v+E},d(this,_m),d(this,d0),t,d(this,u0),r??d(this,Dl));for(let T=2;T<d(this,bs).length;T+=2)A.add({x:d(this,bs)[T]*f+w,y:d(this,bs)[T+1]*v+E});return A.getOutlines()}}_m=new WeakMap,Ih=new WeakMap,Dl=new WeakMap,u0=new WeakMap,bs=new WeakMap,d0=new WeakMap,er=new WeakMap,qS=new WeakSet,i$=function(t){const r=d(this,er);let i=r[4],s=r[5];const o=[i,s,i,s];let a=i,l=s;const c=t?Math.max:Math.min;for(let h=6,f=r.length;h<f;h+=6){const v=r[h+4],w=r[h+5];if(isNaN(r[h]))Ke.pointBoundingBox(v,w,o),l<w?(a=v,l=w):l===w&&(a=c(a,v));else{const E=[1/0,1/0,-1/0,-1/0];Ke.bezierBoundingBox(i,s,...r.slice(h,h+6),E),Ke.rectBoundingBox(...E,o),l<E[3]?(a=E[2],l=E[3]):l===E[3]&&(a=c(a,E[2]))}i=v,s=w}const u=d(this,Ih);u[0]=o[0]-d(this,Dl),u[1]=o[1]-d(this,Dl),u[2]=o[2]-o[0]+2*d(this,Dl),u[3]=o[3]-o[1]+2*d(this,Dl),this.lastPoint=[a,l]};var h0,f0,lu,No,Ui,s$,n_,o$,a$,dC;class uC{constructor(e,t=0,r=0,i=!0){O(this,Ui);O(this,h0);O(this,f0);O(this,lu,[]);O(this,No,[]);const s=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:v,y:w,width:E,height:A}of e){const T=Math.floor((v-t)/o)*o,_=Math.ceil((v+E+t)/o)*o,b=Math.floor((w-t)/o)*o,g=Math.ceil((w+A+t)/o)*o,y=[T,b,g,!0],x=[_,b,g,!1];d(this,lu).push(y,x),Ke.rectBoundingBox(T,b,_,g,s)}const a=s[2]-s[0]+2*r,l=s[3]-s[1]+2*r,c=s[0]-r,u=s[1]-r,h=d(this,lu).at(i?-1:-2),f=[h[0],h[2]];for(const v of d(this,lu)){const[w,E,A]=v;v[0]=(w-c)/a,v[1]=(E-u)/l,v[2]=(A-u)/l}R(this,h0,new Float32Array([c,u,a,l])),R(this,f0,f)}getOutlines(){d(this,lu).sort((t,r)=>t[0]-r[0]||t[1]-r[1]||t[2]-r[2]);const e=[];for(const t of d(this,lu))t[3]?(e.push(...F(this,Ui,dC).call(this,t)),F(this,Ui,o$).call(this,t)):(F(this,Ui,a$).call(this,t),e.push(...F(this,Ui,dC).call(this,t)));return F(this,Ui,s$).call(this,e)}}h0=new WeakMap,f0=new WeakMap,lu=new WeakMap,No=new WeakMap,Ui=new WeakSet,s$=function(e){const t=[],r=new Set;for(const o of e){const[a,l,c]=o;t.push([a,l,o],[a,c,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){const l=t[o][2],c=t[o+1][2];l.push(c),c.push(l),r.add(l),r.add(c)}const i=[];let s;for(;r.size>0;){const o=r.values().next().value;let[a,l,c,u,h]=o;r.delete(o);let f=a,v=l;for(s=[a,c],i.push(s);;){let w;if(r.has(u))w=u;else if(r.has(h))w=h;else break;r.delete(w),[a,l,c,u,h]=w,f!==a&&(s.push(f,v,a,v===l?l:c),f=a),v=v===l?c:l}s.push(f,v)}return new UZ(i,d(this,h0),d(this,f0))},n_=function(e){const t=d(this,No);let r=0,i=t.length-1;for(;r<=i;){const s=r+i>>1,o=t[s][0];if(o===e)return s;o<e?r=s+1:i=s-1}return i+1},o$=function([,e,t]){const r=F(this,Ui,n_).call(this,e);d(this,No).splice(r,0,[e,t])},a$=function([,e,t]){const r=F(this,Ui,n_).call(this,e);for(let i=r;i<d(this,No).length;i++){const[s,o]=d(this,No)[i];if(s!==e)break;if(s===e&&o===t){d(this,No).splice(i,1);return}}for(let i=r-1;i>=0;i--){const[s,o]=d(this,No)[i];if(s!==e)break;if(s===e&&o===t){d(this,No).splice(i,1);return}}},dC=function(e){const[t,r,i]=e,s=[[t,r,i]],o=F(this,Ui,n_).call(this,i);for(let a=0;a<o;a++){const[l,c]=d(this,No)[a];for(let u=0,h=s.length;u<h;u++){const[,f,v]=s[u];if(!(c<=f||v<=l)){if(f>=l){if(v>c)s[u][1]=c;else{if(h===1)return[];s.splice(u,1),u--,h--}continue}s[u][2]=l,v>c&&s.push([t,c,v])}}}return s};var p0,Sm;class UZ extends Ne{constructor(t,r,i){super();O(this,p0);O(this,Sm);R(this,Sm,t),R(this,p0,r),this.lastPoint=i}toSVGPath(){const t=[];for(const r of d(this,Sm)){let[i,s]=r;t.push(`M${i} ${s}`);for(let o=2;o<r.length;o+=2){const a=r[o],l=r[o+1];a===i?(t.push(`V${l}`),s=l):l===s&&(t.push(`H${a}`),i=a)}t.push("Z")}return t.join(" ")}serialize([t,r,i,s],o){const a=[],l=i-t,c=s-r;for(const u of d(this,Sm)){const h=new Array(u.length);for(let f=0;f<u.length;f+=2)h[f]=t+u[f]*l,h[f+1]=s-u[f+1]*c;a.push(h)}return a}get box(){return d(this,p0)}get classNamesForOutlining(){return["highlightOutline"]}}p0=new WeakMap,Sm=new WeakMap;class hC extends bS{newFreeDrawOutline(e,t,r,i,s,o){return new BZ(e,t,r,i,s,o)}}class BZ extends r${newOutliner(e,t,r,i,s,o=0){return new hC(e,t,r,i,s,o)}}var _s,xh,Am,wr,m0,Tm,Ml,g0,cu,Lo,Im,y0,dn,fC,pC,mC,Ad,l$,Ac;const Hi=class Hi{constructor({editor:e=null,uiManager:t=null}){O(this,dn);O(this,_s,null);O(this,xh,null);O(this,Am);O(this,wr,null);O(this,m0,!1);O(this,Tm,!1);O(this,Ml,null);O(this,g0);O(this,cu,null);O(this,Lo,null);O(this,Im);var r,i;e?(R(this,Tm,!1),R(this,Im,Ot.HIGHLIGHT_COLOR),R(this,Ml,e)):(R(this,Tm,!0),R(this,Im,Ot.HIGHLIGHT_DEFAULT_COLOR)),R(this,Lo,(e==null?void 0:e._uiManager)||t),R(this,g0,d(this,Lo)._eventBus),R(this,Am,((r=e==null?void 0:e.color)==null?void 0:r.toUpperCase())||((i=d(this,Lo))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),d(Hi,y0)||R(Hi,y0,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Dt(this,"_keyboardManager",new eE([[["Escape","mac+Escape"],Hi.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Hi.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Hi.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Hi.prototype._moveToPrevious],[["Home","mac+Home"],Hi.prototype._moveToBeginning],[["End","mac+End"],Hi.prototype._moveToEnd]]))}renderButton(){const e=R(this,_s,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",d(this,Ml)&&(e.ariaControls=`${d(this,Ml).id}_colorpicker_dropdown`);const t=d(this,Lo)._signal;e.addEventListener("click",F(this,dn,Ad).bind(this),{signal:t}),e.addEventListener("keydown",F(this,dn,mC).bind(this),{signal:t});const r=R(this,xh,document.createElement("span"));return r.className="swatch",r.ariaHidden="true",r.style.backgroundColor=d(this,Am),e.append(r),e}renderMainDropdown(){const e=R(this,wr,F(this,dn,fC).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===d(this,_s)){F(this,dn,Ad).call(this,e);return}const t=e.target.getAttribute("data-color");t&&F(this,dn,pC).call(this,t,e)}_moveToNext(e){var t,r;if(!d(this,dn,Ac)){F(this,dn,Ad).call(this,e);return}if(e.target===d(this,_s)){(t=d(this,wr).firstChild)==null||t.focus();return}(r=e.target.nextSibling)==null||r.focus()}_moveToPrevious(e){var t,r;if(e.target===((t=d(this,wr))==null?void 0:t.firstChild)||e.target===d(this,_s)){d(this,dn,Ac)&&this._hideDropdownFromKeyboard();return}d(this,dn,Ac)||F(this,dn,Ad).call(this,e),(r=e.target.previousSibling)==null||r.focus()}_moveToBeginning(e){var t;if(!d(this,dn,Ac)){F(this,dn,Ad).call(this,e);return}(t=d(this,wr).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!d(this,dn,Ac)){F(this,dn,Ad).call(this,e);return}(t=d(this,wr).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=d(this,wr))==null||e.classList.add("hidden"),d(this,_s).ariaExpanded="false",(t=d(this,cu))==null||t.abort(),R(this,cu,null)}_hideDropdownFromKeyboard(){var e;if(!d(this,Tm)){if(!d(this,dn,Ac)){(e=d(this,Ml))==null||e.unselect();return}this.hideDropdown(),d(this,_s).focus({preventScroll:!0,focusVisible:d(this,m0)})}}updateColor(e){if(d(this,xh)&&(d(this,xh).style.backgroundColor=e),!d(this,wr))return;const t=d(this,Lo).highlightColors.values();for(const r of d(this,wr).children)r.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=d(this,_s))==null||e.remove(),R(this,_s,null),R(this,xh,null),(t=d(this,wr))==null||t.remove(),R(this,wr,null)}};_s=new WeakMap,xh=new WeakMap,Am=new WeakMap,wr=new WeakMap,m0=new WeakMap,Tm=new WeakMap,Ml=new WeakMap,g0=new WeakMap,cu=new WeakMap,Lo=new WeakMap,Im=new WeakMap,y0=new WeakMap,dn=new WeakSet,fC=function(){const e=document.createElement("div"),t=d(this,Lo)._signal;e.addEventListener("contextmenu",vo,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),d(this,Ml)&&(e.id=`${d(this,Ml).id}_colorpicker_dropdown`);for(const[r,i]of d(this,Lo).highlightColors){const s=document.createElement("button");s.tabIndex="0",s.role="option",s.setAttribute("data-color",i),s.title=r,s.setAttribute("data-l10n-id",d(Hi,y0)[r]);const o=document.createElement("span");s.append(o),o.className="swatch",o.style.backgroundColor=i,s.ariaSelected=i===d(this,Am),s.addEventListener("click",F(this,dn,pC).bind(this,i),{signal:t}),e.append(s)}return e.addEventListener("keydown",F(this,dn,mC).bind(this),{signal:t}),e},pC=function(e,t){t.stopPropagation(),d(this,g0).dispatch("switchannotationeditorparams",{source:this,type:d(this,Im),value:e})},mC=function(e){Hi._keyboardManager.exec(this,e)},Ad=function(e){if(d(this,dn,Ac)){this.hideDropdown();return}if(R(this,m0,e.detail===0),d(this,cu)||(R(this,cu,new AbortController),window.addEventListener("pointerdown",F(this,dn,l$).bind(this),{signal:d(this,Lo).combinedSignal(d(this,cu))})),d(this,_s).ariaExpanded="true",d(this,wr)){d(this,wr).classList.remove("hidden");return}const t=R(this,wr,F(this,dn,fC).call(this));d(this,_s).append(t)},l$=function(e){var t;(t=d(this,wr))!=null&&t.contains(e.target)||this.hideDropdown()},Ac=function(){return d(this,wr)&&!d(this,wr).classList.contains("hidden")},O(Hi,y0,null);let Kv=Hi;var xm,v0,Nl,Ch,w0,qi,E0,b0,Ph,io,Ss,Wr,Cm,Ll,di,Pm,so,_0,St,gC,r_,c$,u$,d$,yC,Td,co,Jf,h$,i_,Ly,f$,p$,m$,g$,y$;const Yt=class Yt extends Sn{constructor(t){super({...t,name:"highlightEditor"});O(this,St);O(this,xm,null);O(this,v0,0);O(this,Nl);O(this,Ch,null);O(this,w0,null);O(this,qi,null);O(this,E0,null);O(this,b0,0);O(this,Ph,null);O(this,io,null);O(this,Ss,null);O(this,Wr,!1);O(this,Cm,null);O(this,Ll);O(this,di,null);O(this,Pm,"");O(this,so);O(this,_0,"");this.color=t.color||Yt._defaultColor,R(this,so,t.thickness||Yt._defaultThickness),R(this,Ll,t.opacity||Yt._defaultOpacity),R(this,Nl,t.boxes||null),R(this,_0,t.methodOfCreation||""),R(this,Pm,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(R(this,Wr,!0),F(this,St,r_).call(this,t),F(this,St,Td).call(this)):d(this,Nl)&&(R(this,xm,t.anchorNode),R(this,v0,t.anchorOffset),R(this,E0,t.focusNode),R(this,b0,t.focusOffset),F(this,St,gC).call(this),F(this,St,Td).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=Yt.prototype;return Dt(this,"_keyboardManager",new eE([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:d(this,Wr)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:d(this,so),methodOfCreation:d(this,_0)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,r){var i;Sn.initialize(t,r),Yt._defaultColor||(Yt._defaultColor=((i=r.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,r){switch(t){case Ot.HIGHLIGHT_DEFAULT_COLOR:Yt._defaultColor=r;break;case Ot.HIGHLIGHT_THICKNESS:Yt._defaultThickness=r;break}}translateInPage(t,r){}get toolbarPosition(){return d(this,Cm)}updateParams(t,r){switch(t){case Ot.HIGHLIGHT_COLOR:F(this,St,c$).call(this,r);break;case Ot.HIGHLIGHT_THICKNESS:F(this,St,u$).call(this,r);break}}static get defaultPropertiesToUpdate(){return[[Ot.HIGHLIGHT_DEFAULT_COLOR,Yt._defaultColor],[Ot.HIGHLIGHT_THICKNESS,Yt._defaultThickness]]}get propertiesToUpdate(){return[[Ot.HIGHLIGHT_COLOR,this.color||Yt._defaultColor],[Ot.HIGHLIGHT_THICKNESS,d(this,so)||Yt._defaultThickness],[Ot.HIGHLIGHT_FREE,d(this,Wr)]]}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",R(this,w0,new Kv({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(F(this,St,Ly).call(this))}getBaseTranslation(){return[0,0]}getRect(t,r){return super.getRect(t,r,F(this,St,Ly).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){F(this,St,yC).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(F(this,St,Td).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let r=!1;this.parent&&!t?F(this,St,yC).call(this):t&&(F(this,St,Td).call(this,t),r=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),r&&this.select()}rotate(t){var s,o,a;const{drawLayer:r}=this.parent;let i;d(this,Wr)?(t=(t-this.rotation+360)%360,i=F(s=Yt,co,Jf).call(s,d(this,io).box,t)):i=F(o=Yt,co,Jf).call(o,[this.x,this.y,this.width,this.height],t),r.updateProperties(d(this,Ss),{bbox:i,root:{"data-main-rotation":t}}),r.updateProperties(d(this,di),{bbox:F(a=Yt,co,Jf).call(a,d(this,qi).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();d(this,Pm)&&(t.setAttribute("aria-label",d(this,Pm)),t.setAttribute("role","mark")),d(this,Wr)?t.classList.add("free"):this.div.addEventListener("keydown",F(this,St,h$).bind(this),{signal:this._uiManager._signal});const r=R(this,Ph,document.createElement("div"));t.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",r.style.clipPath=d(this,Ch);const[i,s]=this.parentDimensions;return this.setDims(this.width*i,this.height*s),F3(this,d(this,Ph),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(d(this,di),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(d(this,di),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:F(this,St,i_).call(this,!0);break;case 1:case 3:F(this,St,i_).call(this,!1);break}}select(){var t;super.select(),d(this,di)&&((t=this.parent)==null||t.drawLayer.updateProperties(d(this,di),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),d(this,di)&&((t=this.parent)==null||t.drawLayer.updateProperties(d(this,di),{rootClass:{selected:!1}}),d(this,Wr)||F(this,St,i_).call(this,!1))}get _mustFixPosition(){return!d(this,Wr)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(d(this,Ss),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(d(this,di),{rootClass:{hidden:!t}}))}static startHighlighting(t,r,{target:i,x:s,y:o}){const{x:a,y:l,width:c,height:u}=i.getBoundingClientRect(),h=new AbortController,f=t.combinedSignal(h),v=w=>{h.abort(),F(this,co,g$).call(this,t,w)};window.addEventListener("blur",v,{signal:f}),window.addEventListener("pointerup",v,{signal:f}),window.addEventListener("pointerdown",tr,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",vo,{signal:f}),i.addEventListener("pointermove",F(this,co,m$).bind(this,t),{signal:f}),this._freeHighlight=new hC({x:s,y:o},[a,l,c,u],t.scale,this._defaultThickness/2,r,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,r,i){var E,A,T,_;let s=null;if(t instanceof H5){const{data:{quadPoints:b,rect:g,rotation:y,id:x,color:S,opacity:I,popupRef:P},parent:{page:{pageNumber:N}}}=t;s=t={annotationType:mt.HIGHLIGHT,color:Array.from(S),opacity:I,quadPoints:b,boxes:null,pageIndex:N-1,rect:g.slice(0),rotation:y,annotationElementId:x,id:x,deleted:!1,popupRef:P}}else if(t instanceof _k){const{data:{inkLists:b,rect:g,rotation:y,id:x,color:S,borderStyle:{rawWidth:I},popupRef:P},parent:{page:{pageNumber:N}}}=t;s=t={annotationType:mt.HIGHLIGHT,color:Array.from(S),thickness:I,inkLists:b,boxes:null,pageIndex:N-1,rect:g.slice(0),rotation:y,annotationElementId:x,id:x,deleted:!1,popupRef:P}}const{color:o,quadPoints:a,inkLists:l,opacity:c}=t,u=await super.deserialize(t,r,i);u.color=Ke.makeHexColor(...o),R(u,Ll,c||1),l&&R(u,so,t.thickness),u._initialData=s;const[h,f]=u.pageDimensions,[v,w]=u.pageTranslation;if(a){const b=R(u,Nl,[]);for(let g=0;g<a.length;g+=8)b.push({x:(a[g]-v)/h,y:1-(a[g+1]-w)/f,width:(a[g+2]-a[g])/h,height:(a[g+1]-a[g+5])/f});F(E=u,St,gC).call(E),F(A=u,St,Td).call(A),u.rotate(u.rotation)}else if(l){R(u,Wr,!0);const b=l[0],g={x:b[0]-v,y:f-(b[1]-w)},y=new hC(g,[0,0,h,f],1,d(u,so)/2,!0,.001);for(let I=0,P=b.length;I<P;I+=2)g.x=b[I]-v,g.y=f-(b[I+1]-w),y.add(g);const{id:x,clipPathId:S}=r.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:y.toSVGPath()}},!0,!0);F(T=u,St,r_).call(T,{highlightOutlines:y.getOutlines(),highlightId:x,clipPathId:S}),F(_=u,St,Td).call(_),u.rotate(u.parentRotation)}return u}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const r=this.getRect(0,0),i=Sn._colorManager.convert(this.color),s={annotationType:mt.HIGHLIGHT,color:i,opacity:d(this,Ll),thickness:d(this,so),quadPoints:F(this,St,f$).call(this),outlines:F(this,St,p$).call(this,r),pageIndex:this.pageIndex,rect:r,rotation:F(this,St,Ly).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!F(this,St,y$).call(this,s)?null:(s.id=this.annotationElementId,s)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};xm=new WeakMap,v0=new WeakMap,Nl=new WeakMap,Ch=new WeakMap,w0=new WeakMap,qi=new WeakMap,E0=new WeakMap,b0=new WeakMap,Ph=new WeakMap,io=new WeakMap,Ss=new WeakMap,Wr=new WeakMap,Cm=new WeakMap,Ll=new WeakMap,di=new WeakMap,Pm=new WeakMap,so=new WeakMap,_0=new WeakMap,St=new WeakSet,gC=function(){const t=new uC(d(this,Nl),.001);R(this,io,t.getOutlines()),[this.x,this.y,this.width,this.height]=d(this,io).box;const r=new uC(d(this,Nl),.0025,.001,this._uiManager.direction==="ltr");R(this,qi,r.getOutlines());const{lastPoint:i}=d(this,qi);R(this,Cm,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},r_=function({highlightOutlines:t,highlightId:r,clipPathId:i}){var h,f;if(R(this,io,t),R(this,qi,t.getNewOutline(d(this,so)/2+1.5,.0025)),r>=0)R(this,Ss,r),R(this,Ch,i),this.parent.drawLayer.finalizeDraw(r,{bbox:t.box,path:{d:t.toSVGPath()}}),R(this,di,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:d(this,qi).box,path:{d:d(this,qi).toSVGPath()}},!0));else if(this.parent){const v=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(d(this,Ss),{bbox:F(h=Yt,co,Jf).call(h,d(this,io).box,(v-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(d(this,di),{bbox:F(f=Yt,co,Jf).call(f,d(this,qi).box,v),path:{d:d(this,qi).toSVGPath()}})}const[o,a,l,c]=t.box;switch(this.rotation){case 0:this.x=o,this.y=a,this.width=l,this.height=c;break;case 90:{const[v,w]=this.parentDimensions;this.x=a,this.y=1-o,this.width=l*w/v,this.height=c*v/w;break}case 180:this.x=1-o,this.y=1-a,this.width=l,this.height=c;break;case 270:{const[v,w]=this.parentDimensions;this.x=1-a,this.y=o,this.width=l*w/v,this.height=c*v/w;break}}const{lastPoint:u}=d(this,qi);R(this,Cm,[(u[0]-o)/l,(u[1]-a)/c])},c$=function(t){const r=(o,a)=>{var l,c;this.color=o,R(this,Ll,a),(l=this.parent)==null||l.drawLayer.updateProperties(d(this,Ss),{root:{fill:o,"fill-opacity":a}}),(c=d(this,w0))==null||c.updateColor(o)},i=this.color,s=d(this,Ll);this.addCommands({cmd:r.bind(this,t,Yt._defaultOpacity),undo:r.bind(this,i,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},u$=function(t){const r=d(this,so),i=s=>{R(this,so,s),F(this,St,d$).call(this,s)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ot.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},d$=function(t){if(!d(this,Wr))return;F(this,St,r_).call(this,{highlightOutlines:d(this,io).getNewOutline(t/2)}),this.fixAndSetPosition();const[r,i]=this.parentDimensions;this.setDims(this.width*r,this.height*i)},yC=function(){d(this,Ss)===null||!this.parent||(this.parent.drawLayer.remove(d(this,Ss)),R(this,Ss,null),this.parent.drawLayer.remove(d(this,di)),R(this,di,null))},Td=function(t=this.parent){d(this,Ss)===null&&({id:Si(this,Ss)._,clipPathId:Si(this,Ch)._}=t.drawLayer.draw({bbox:d(this,io).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":d(this,Ll)},rootClass:{highlight:!0,free:d(this,Wr)},path:{d:d(this,io).toSVGPath()}},!1,!0),R(this,di,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:d(this,Wr)},bbox:d(this,qi).box,path:{d:d(this,qi).toSVGPath()}},d(this,Wr))),d(this,Ph)&&(d(this,Ph).style.clipPath=d(this,Ch)))},co=new WeakSet,Jf=function([t,r,i,s],o){switch(o){case 90:return[1-r-s,t,s,i];case 180:return[1-t-i,1-r-s,i,s];case 270:return[r,1-t-i,s,i]}return[t,r,i,s]},h$=function(t){Yt._keyboardManager.exec(this,t)},i_=function(t){if(!d(this,xm))return;const r=window.getSelection();t?r.setPosition(d(this,xm),d(this,v0)):r.setPosition(d(this,E0),d(this,b0))},Ly=function(){return d(this,Wr)?this.rotation:0},f$=function(){if(d(this,Wr))return null;const[t,r]=this.pageDimensions,[i,s]=this.pageTranslation,o=d(this,Nl),a=new Float32Array(o.length*8);let l=0;for(const{x:c,y:u,width:h,height:f}of o){const v=c*t+i,w=(1-u)*r+s;a[l]=a[l+4]=v,a[l+1]=a[l+3]=w,a[l+2]=a[l+6]=v+h*t,a[l+5]=a[l+7]=w-f*r,l+=8}return a},p$=function(t){return d(this,io).serialize(t,F(this,St,Ly).call(this))},m$=function(t,r){this._freeHighlight.add(r)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},g$=function(t,r){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(r,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},y$=function(t){const{color:r}=this._initialData;return t.color.some((i,s)=>i!==r[s])},O(Yt,co),ge(Yt,"_defaultColor",null),ge(Yt,"_defaultOpacity",1),ge(Yt,"_defaultThickness",12),ge(Yt,"_type","highlight"),ge(Yt,"_editorType",mt.HIGHLIGHT),ge(Yt,"_freeHighlightId",-1),ge(Yt,"_freeHighlight",null),ge(Yt,"_freeHighlightClipId","");let _S=Yt;var Rh;class v${constructor(){O(this,Rh,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,r]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,r)}updateSVGProperty(e,t){d(this,Rh)[e]=t}toSVGProperties(){const e=d(this,Rh);return R(this,Rh,Object.create(null)),{root:e}}reset(){R(this,Rh,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){hn("Not implemented")}}Rh=new WeakMap;var As,Rm,Rr,kh,Dh,uu,du,hu,Mh,Ht,vC,wC,EC,Oy,w$,s_,Fy,Zf;const Oe=class Oe extends Sn{constructor(t){super(t);O(this,Ht);O(this,As,null);O(this,Rm);ge(this,"_drawId",null);R(this,Rm,t.mustBeCommitted||!1),this._addOutlines(t)}_addOutlines(t){t.drawOutlines&&(F(this,Ht,vC).call(this,t),F(this,Ht,Oy).call(this))}static _mergeSVGProperties(t,r){const i=new Set(Object.keys(t));for(const[s,o]of Object.entries(r))i.has(s)?Object.assign(t[s],o):t[s]=o;return t}static getDefaultDrawingOptions(t){hn("Not implemented")}static get typesMap(){hn("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,r){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,r),this._currentParent&&(d(Oe,Rr).updateProperty(i,r),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,r){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,r)}static get defaultPropertiesToUpdate(){const t=[],r=this._defaultDrawingOptions;for(const[i,s]of this.typesMap)t.push([i,r[s]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:r}=this;for(const[i,s]of this.constructor.typesMap)t.push([i,r[s]]);return t}_updateProperty(t,r,i){const s=this._drawingOptions,o=s[r],a=l=>{var u;s.updateProperty(r,l);const c=d(this,As).updateProperty(r,l);c&&F(this,Ht,Fy).call(this,c),(u=this.parent)==null||u.drawLayer.updateProperties(this._drawId,s.toSVGProperties())};this.addCommands({cmd:a.bind(this,i),undo:a.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Oe._mergeSVGProperties(d(this,As).getPathResizingSVGProperties(F(this,Ht,s_).call(this)),{bbox:F(this,Ht,Zf).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Oe._mergeSVGProperties(d(this,As).getPathResizedSVGProperties(F(this,Ht,s_).call(this)),{bbox:F(this,Ht,Zf).call(this)}))}_onTranslating(t,r){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:F(this,Ht,Zf).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Oe._mergeSVGProperties(d(this,As).getPathTranslatedSVGProperties(F(this,Ht,s_).call(this),this.parentDimensions),{bbox:F(this,Ht,Zf).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,d(this,Rm)&&(R(this,Rm,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){F(this,Ht,EC).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(F(this,Ht,Oy).call(this),F(this,Ht,Fy).call(this,d(this,As).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let r=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),F(this,Ht,EC).call(this)):t&&(this._uiManager.addShouldRescale(this),F(this,Ht,Oy).call(this,t),r=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),r&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Oe._mergeSVGProperties({bbox:F(this,Ht,Zf).call(this)},d(this,As).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&F(this,Ht,Fy).call(this,d(this,As).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,r;this._isCopy&&(t=this.x,r=this.y);const i=super.render();i.classList.add("draw");const s=document.createElement("div");i.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";const[o,a]=this.parentDimensions;return this.setDims(this.width*o,this.height*a),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,r),i}static createDrawerInstance(t,r,i,s,o){hn("Not implemented")}static startDrawing(t,r,i,s){var A;const{target:o,offsetX:a,offsetY:l,pointerId:c,pointerType:u}=s;if(d(Oe,du)&&d(Oe,du)!==u)return;const{viewport:{rotation:h}}=t,{width:f,height:v}=o.getBoundingClientRect(),w=R(Oe,kh,new AbortController),E=t.combinedSignal(w);if(d(Oe,uu)||R(Oe,uu,c),d(Oe,du)??R(Oe,du,u),window.addEventListener("pointerup",T=>{var _;d(Oe,uu)===T.pointerId?this._endDraw(T):(_=d(Oe,hu))==null||_.delete(T.pointerId)},{signal:E}),window.addEventListener("pointercancel",T=>{var _;d(Oe,uu)===T.pointerId?this._currentParent.endDrawingSession():(_=d(Oe,hu))==null||_.delete(T.pointerId)},{signal:E}),window.addEventListener("pointerdown",T=>{d(Oe,du)===T.pointerType&&((d(Oe,hu)||R(Oe,hu,new Set)).add(T.pointerId),d(Oe,Rr).isCancellable()&&(d(Oe,Rr).removeLastElement(),d(Oe,Rr).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:E}),window.addEventListener("contextmenu",vo,{signal:E}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:E}),o.addEventListener("touchmove",T=>{T.timeStamp===d(Oe,Mh)&&tr(T)},{signal:E}),t.toggleDrawing(),(A=r._editorUndoBar)==null||A.hide(),d(Oe,Rr)){t.drawLayer.updateProperties(this._currentDrawId,d(Oe,Rr).startNew(a,l,f,v,h));return}r.updateUIForDefaultProperties(this),R(Oe,Rr,this.createDrawerInstance(a,l,f,v,h)),R(Oe,Dh,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(d(Oe,Dh).toSVGProperties(),d(Oe,Rr).defaultSVGProperties),!0,!1)}static _drawMove(t){var o;if(R(Oe,Mh,-1),!d(Oe,Rr))return;const{offsetX:r,offsetY:i,pointerId:s}=t;if(d(Oe,uu)===s){if(((o=d(Oe,hu))==null?void 0:o.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,d(Oe,Rr).add(r,i)),R(Oe,Mh,t.timeStamp),tr(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,R(Oe,Rr,null),R(Oe,Dh,null),R(Oe,du,null),R(Oe,Mh,NaN)),d(Oe,kh)&&(d(Oe,kh).abort(),R(Oe,kh,null),R(Oe,uu,NaN),R(Oe,hu,null))}static _endDraw(t){const r=this._currentParent;if(r){if(r.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===r.div&&r.drawLayer.updateProperties(this._currentDrawId,d(Oe,Rr).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=d(Oe,Rr),s=this._currentDrawId,o=i.getLastElement();r.addCommands({cmd:()=>{r.drawLayer.updateProperties(s,i.setLastElement(o))},undo:()=>{r.drawLayer.updateProperties(s,i.removeLastElement())},mustExec:!1,type:Ot.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const r=this._currentParent;if(!r)return null;if(r.toggleDrawing(!0),r.cleanUndoStack(Ot.DRAW_STEP),!d(Oe,Rr).isEmpty()){const{pageDimensions:[i,s],scale:o}=r,a=r.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:d(Oe,Rr).getOutlines(i*o,s*o,o,this._INNER_MARGIN),drawingOptions:d(Oe,Dh),mustBeCommitted:!t});return this._cleanup(!0),a}return r.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,r,i,s,o,a){hn("Not implemented")}static async deserialize(t,r,i){var h,f;const{rawDims:{pageWidth:s,pageHeight:o,pageX:a,pageY:l}}=r.viewport,c=this.deserializeDraw(a,l,s,o,this._INNER_MARGIN,t),u=await super.deserialize(t,r,i);return u.createDrawingOptions(t),F(h=u,Ht,vC).call(h,{drawOutlines:c}),F(f=u,Ht,Oy).call(f),u.onScaleChanging(),u.rotate(),u}serializeDraw(t){const[r,i]=this.pageTranslation,[s,o]=this.pageDimensions;return d(this,As).serialize([r,i,s,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};As=new WeakMap,Rm=new WeakMap,Rr=new WeakMap,kh=new WeakMap,Dh=new WeakMap,uu=new WeakMap,du=new WeakMap,hu=new WeakMap,Mh=new WeakMap,Ht=new WeakSet,vC=function({drawOutlines:t,drawId:r,drawingOptions:i}){R(this,As,t),this._drawingOptions||(this._drawingOptions=i),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),r>=0?(this._drawId=r,this.parent.drawLayer.finalizeDraw(r,t.defaultProperties)):this._drawId=F(this,Ht,wC).call(this,t,this.parent),F(this,Ht,Fy).call(this,t.box)},wC=function(t,r){const{id:i}=r.drawLayer.draw(Oe._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},EC=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Oy=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=F(this,Ht,wC).call(this,d(this,As),t)}},w$=function([t,r,i,s]){const{parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[r,1-t,i*(a/o),s*(o/a)];case 180:return[1-t,1-r,i,s];case 270:return[1-r,t,i*(a/o),s*(o/a)];default:return[t,r,i,s]}},s_=function(){const{x:t,y:r,width:i,height:s,parentDimensions:[o,a],rotation:l}=this;switch(l){case 90:return[1-r,t,i*(o/a),s*(a/o)];case 180:return[1-t,1-r,i,s];case 270:return[r,1-t,i*(o/a),s*(a/o)];default:return[t,r,i,s]}},Fy=function(t){if([this.x,this.y,this.width,this.height]=F(this,Ht,w$).call(this,t),this.div){this.fixAndSetPosition();const[r,i]=this.parentDimensions;this.setDims(this.width*r,this.height*i)}this._onResized()},Zf=function(){const{x:t,y:r,width:i,height:s,rotation:o,parentRotation:a,parentDimensions:[l,c]}=this;switch((o*4+a)/90){case 1:return[1-r-s,t,s,i];case 2:return[1-t-i,1-r-s,i,s];case 3:return[r,1-t-i,s,i];case 4:return[t,r-i*(l/c),s*(c/l),i*(l/c)];case 5:return[1-r,t,i*(l/c),s*(c/l)];case 6:return[1-t-s*(c/l),1-r,s*(c/l),i*(l/c)];case 7:return[r-i*(l/c),1-t-s*(c/l),i*(l/c),s*(c/l)];case 8:return[t-i,r-s,i,s];case 9:return[1-r,t-i,s,i];case 10:return[1-t,1-r,i,s];case 11:return[r-s,1-t,s,i];case 12:return[t-s*(c/l),r,s*(c/l),i*(l/c)];case 13:return[1-r-i*(l/c),t-s*(c/l),i*(l/c),s*(c/l)];case 14:return[1-t,1-r-i*(l/c),s*(c/l),i*(l/c)];case 15:return[r,1-t,i*(l/c),s*(c/l)];default:return[t,r,i,s]}},ge(Oe,"_currentDrawId",-1),ge(Oe,"_currentParent",null),O(Oe,Rr,null),O(Oe,kh,null),O(Oe,Dh,null),O(Oe,uu,NaN),O(Oe,du,null),O(Oe,hu,null),O(Oe,Mh,NaN),ge(Oe,"_INNER_MARGIN",3);let SS=Oe;var Ta,kr,Dr,Nh,km,xi,qr,oo,Lh,Oh,Fh,Dm,o_;class $Z{constructor(e,t,r,i,s,o){O(this,Dm);O(this,Ta,new Float64Array(6));O(this,kr);O(this,Dr);O(this,Nh);O(this,km);O(this,xi);O(this,qr,"");O(this,oo,0);O(this,Lh,new nE);O(this,Oh);O(this,Fh);R(this,Oh,r),R(this,Fh,i),R(this,Nh,s),R(this,km,o),[e,t]=F(this,Dm,o_).call(this,e,t);const a=R(this,kr,[NaN,NaN,NaN,NaN,e,t]);R(this,xi,[e,t]),R(this,Dr,[{line:a,points:d(this,xi)}]),d(this,Ta).set(a,0)}updateProperty(e,t){e==="stroke-width"&&R(this,km,t)}isEmpty(){return!d(this,Dr)||d(this,Dr).length===0}isCancellable(){return d(this,xi).length<=10}add(e,t){[e,t]=F(this,Dm,o_).call(this,e,t);const[r,i,s,o]=d(this,Ta).subarray(2,6),a=e-s,l=t-o;return Math.hypot(d(this,Oh)*a,d(this,Fh)*l)<=2?null:(d(this,xi).push(e,t),isNaN(r)?(d(this,Ta).set([s,o,e,t],2),d(this,kr).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(d(this,Ta)[0])&&d(this,kr).splice(6,6),d(this,Ta).set([r,i,s,o,e,t],0),d(this,kr).push(...Ne.createBezierPoints(r,i,s,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const r=this.add(e,t);return r||(d(this,xi).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,r,i,s){R(this,Oh,r),R(this,Fh,i),R(this,Nh,s),[e,t]=F(this,Dm,o_).call(this,e,t);const o=R(this,kr,[NaN,NaN,NaN,NaN,e,t]);R(this,xi,[e,t]);const a=d(this,Dr).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),d(this,Dr).push({line:o,points:d(this,xi)}),d(this,Ta).set(o,0),R(this,oo,0),this.toSVGPath(),null}getLastElement(){return d(this,Dr).at(-1)}setLastElement(e){return d(this,Dr)?(d(this,Dr).push(e),R(this,kr,e.line),R(this,xi,e.points),R(this,oo,0),{path:{d:this.toSVGPath()}}):d(this,Lh).setLastElement(e)}removeLastElement(){if(!d(this,Dr))return d(this,Lh).removeLastElement();d(this,Dr).pop(),R(this,qr,"");for(let e=0,t=d(this,Dr).length;e<t;e++){const{line:r,points:i}=d(this,Dr)[e];R(this,kr,r),R(this,xi,i),R(this,oo,0),this.toSVGPath()}return{path:{d:d(this,qr)}}}toSVGPath(){const e=Ne.svgRound(d(this,kr)[4]),t=Ne.svgRound(d(this,kr)[5]);if(d(this,xi).length===2)return R(this,qr,`${d(this,qr)} M ${e} ${t} Z`),d(this,qr);if(d(this,xi).length<=6){const i=d(this,qr).lastIndexOf("M");R(this,qr,`${d(this,qr).slice(0,i)} M ${e} ${t}`),R(this,oo,6)}if(d(this,xi).length===4){const i=Ne.svgRound(d(this,kr)[10]),s=Ne.svgRound(d(this,kr)[11]);return R(this,qr,`${d(this,qr)} L ${i} ${s}`),R(this,oo,12),d(this,qr)}const r=[];d(this,oo)===0&&(r.push(`M ${e} ${t}`),R(this,oo,6));for(let i=d(this,oo),s=d(this,kr).length;i<s;i+=6){const[o,a,l,c,u,h]=d(this,kr).slice(i,i+6).map(Ne.svgRound);r.push(`C${o} ${a} ${l} ${c} ${u} ${h}`)}return R(this,qr,d(this,qr)+r.join(" ")),R(this,oo,d(this,kr).length),d(this,qr)}getOutlines(e,t,r,i){const s=d(this,Dr).at(-1);return s.line=new Float32Array(s.line),s.points=new Float32Array(s.points),d(this,Lh).build(d(this,Dr),e,t,r,d(this,Nh),d(this,km),i),R(this,Ta,null),R(this,kr,null),R(this,Dr,null),R(this,qr,null),d(this,Lh)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Ta=new WeakMap,kr=new WeakMap,Dr=new WeakMap,Nh=new WeakMap,km=new WeakMap,xi=new WeakMap,qr=new WeakMap,oo=new WeakMap,Lh=new WeakMap,Oh=new WeakMap,Fh=new WeakMap,Dm=new WeakSet,o_=function(e,t){return Ne._normalizePoint(e,t,d(this,Oh),d(this,Fh),d(this,Nh))};var Ci,S0,A0,Ts,Ia,xa,Mm,Nm,Vh,Xr,il,E$,b$,_$;class nE extends Ne{constructor(){super(...arguments);O(this,Xr);O(this,Ci);O(this,S0,0);O(this,A0);O(this,Ts);O(this,Ia);O(this,xa);O(this,Mm);O(this,Nm);O(this,Vh)}build(t,r,i,s,o,a,l){R(this,Ia,r),R(this,xa,i),R(this,Mm,s),R(this,Nm,o),R(this,Vh,a),R(this,A0,l??0),R(this,Ts,t),F(this,Xr,b$).call(this)}get thickness(){return d(this,Vh)}setLastElement(t){return d(this,Ts).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return d(this,Ts).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:r}of d(this,Ts)){if(t.push(`M${Ne.svgRound(r[4])} ${Ne.svgRound(r[5])}`),r.length===6){t.push("Z");continue}if(r.length===12&&isNaN(r[6])){t.push(`L${Ne.svgRound(r[10])} ${Ne.svgRound(r[11])}`);continue}for(let i=6,s=r.length;i<s;i+=6){const[o,a,l,c,u,h]=r.subarray(i,i+6).map(Ne.svgRound);t.push(`C${o} ${a} ${l} ${c} ${u} ${h}`)}}return t.join("")}serialize([t,r,i,s],o){const a=[],l=[],[c,u,h,f]=F(this,Xr,E$).call(this);let v,w,E,A,T,_,b,g,y;switch(d(this,Nm)){case 0:y=Ne._rescale,v=t,w=r+s,E=i,A=-s,T=t+c*i,_=r+(1-u-f)*s,b=t+(c+h)*i,g=r+(1-u)*s;break;case 90:y=Ne._rescaleAndSwap,v=t,w=r,E=i,A=s,T=t+u*i,_=r+c*s,b=t+(u+f)*i,g=r+(c+h)*s;break;case 180:y=Ne._rescale,v=t+i,w=r,E=-i,A=s,T=t+(1-c-h)*i,_=r+u*s,b=t+(1-c)*i,g=r+(u+f)*s;break;case 270:y=Ne._rescaleAndSwap,v=t+i,w=r+s,E=-i,A=-s,T=t+(1-u-f)*i,_=r+(1-c-h)*s,b=t+(1-u)*i,g=r+(1-c)*s;break}for(const{line:x,points:S}of d(this,Ts))a.push(y(x,v,w,E,A,o?new Array(x.length):null)),l.push(y(S,v,w,E,A,o?new Array(S.length):null));return{lines:a,points:l,rect:[T,_,b,g]}}static deserialize(t,r,i,s,o,{paths:{lines:a,points:l},rotation:c,thickness:u}){const h=[];let f,v,w,E,A;switch(c){case 0:A=Ne._rescale,f=-t/i,v=r/s+1,w=1/i,E=-1/s;break;case 90:A=Ne._rescaleAndSwap,f=-r/s,v=-t/i,w=1/s,E=1/i;break;case 180:A=Ne._rescale,f=t/i+1,v=-r/s,w=-1/i,E=1/s;break;case 270:A=Ne._rescaleAndSwap,f=r/s+1,v=t/i+1,w=-1/s,E=-1/i;break}if(!a){a=[];for(const _ of l){const b=_.length;if(b===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1]]));continue}if(b===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1],NaN,NaN,NaN,NaN,_[2],_[3]]));continue}const g=new Float32Array(3*(b-2));a.push(g);let[y,x,S,I]=_.subarray(0,4);g.set([NaN,NaN,NaN,NaN,y,x],0);for(let P=4;P<b;P+=2){const N=_[P],M=_[P+1];g.set(Ne.createBezierPoints(y,x,S,I,N,M),(P-2)*3),[y,x,S,I]=[S,I,N,M]}}}for(let _=0,b=a.length;_<b;_++)h.push({line:A(a[_].map(g=>g??NaN),f,v,w,E),points:A(l[_].map(g=>g??NaN),f,v,w,E)});const T=new this.prototype.constructor;return T.build(h,i,s,1,c,u,o),T}get box(){return d(this,Ci)}updateProperty(t,r){return t==="stroke-width"?F(this,Xr,_$).call(this,r):null}updateParentDimensions([t,r],i){const[s,o]=F(this,Xr,il).call(this);R(this,Ia,t),R(this,xa,r),R(this,Mm,i);const[a,l]=F(this,Xr,il).call(this),c=a-s,u=l-o,h=d(this,Ci);return h[0]-=c,h[1]-=u,h[2]+=2*c,h[3]+=2*u,h}updateRotation(t){return R(this,S0,t),{path:{transform:this.rotationTransform}}}get viewBox(){return d(this,Ci).map(Ne.svgRound).join(" ")}get defaultProperties(){const[t,r]=d(this,Ci);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ne.svgRound(t)} ${Ne.svgRound(r)}`}}}get rotationTransform(){const[,,t,r]=d(this,Ci);let i=0,s=0,o=0,a=0,l=0,c=0;switch(d(this,S0)){case 90:s=r/t,o=-t/r,l=t;break;case 180:i=-1,a=-1,l=t,c=r;break;case 270:s=-r/t,o=t/r,c=r;break;default:return""}return`matrix(${i} ${s} ${o} ${a} ${Ne.svgRound(l)} ${Ne.svgRound(c)})`}getPathResizingSVGProperties([t,r,i,s]){const[o,a]=F(this,Xr,il).call(this),[l,c,u,h]=d(this,Ci);if(Math.abs(u-o)<=Ne.PRECISION||Math.abs(h-a)<=Ne.PRECISION){const A=t+i/2-(l+u/2),T=r+s/2-(c+h/2);return{path:{"transform-origin":`${Ne.svgRound(t)} ${Ne.svgRound(r)}`,transform:`${this.rotationTransform} translate(${A} ${T})`}}}const f=(i-2*o)/(u-2*o),v=(s-2*a)/(h-2*a),w=u/i,E=h/s;return{path:{"transform-origin":`${Ne.svgRound(l)} ${Ne.svgRound(c)}`,transform:`${this.rotationTransform} scale(${w} ${E}) translate(${Ne.svgRound(o)} ${Ne.svgRound(a)}) scale(${f} ${v}) translate(${Ne.svgRound(-o)} ${Ne.svgRound(-a)})`}}}getPathResizedSVGProperties([t,r,i,s]){const[o,a]=F(this,Xr,il).call(this),l=d(this,Ci),[c,u,h,f]=l;if(l[0]=t,l[1]=r,l[2]=i,l[3]=s,Math.abs(h-o)<=Ne.PRECISION||Math.abs(f-a)<=Ne.PRECISION){const T=t+i/2-(c+h/2),_=r+s/2-(u+f/2);for(const{line:b,points:g}of d(this,Ts))Ne._translate(b,T,_,b),Ne._translate(g,T,_,g);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ne.svgRound(t)} ${Ne.svgRound(r)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const v=(i-2*o)/(h-2*o),w=(s-2*a)/(f-2*a),E=-v*(c+o)+t+o,A=-w*(u+a)+r+a;if(v!==1||w!==1||E!==0||A!==0)for(const{line:T,points:_}of d(this,Ts))Ne._rescale(T,E,A,v,w,T),Ne._rescale(_,E,A,v,w,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${Ne.svgRound(t)} ${Ne.svgRound(r)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,r],i){const[s,o]=i,a=d(this,Ci),l=t-a[0],c=r-a[1];if(d(this,Ia)===s&&d(this,xa)===o)for(const{line:u,points:h}of d(this,Ts))Ne._translate(u,l,c,u),Ne._translate(h,l,c,h);else{const u=d(this,Ia)/s,h=d(this,xa)/o;R(this,Ia,s),R(this,xa,o);for(const{line:f,points:v}of d(this,Ts))Ne._rescale(f,l,c,u,h,f),Ne._rescale(v,l,c,u,h,v);a[2]*=u,a[3]*=h}return a[0]=t,a[1]=r,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${Ne.svgRound(t)} ${Ne.svgRound(r)}`}}}get defaultSVGProperties(){const t=d(this,Ci);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${Ne.svgRound(t[0])} ${Ne.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}Ci=new WeakMap,S0=new WeakMap,A0=new WeakMap,Ts=new WeakMap,Ia=new WeakMap,xa=new WeakMap,Mm=new WeakMap,Nm=new WeakMap,Vh=new WeakMap,Xr=new WeakSet,il=function(t=d(this,Vh)){const r=d(this,A0)+t/2*d(this,Mm);return d(this,Nm)%180===0?[r/d(this,Ia),r/d(this,xa)]:[r/d(this,xa),r/d(this,Ia)]},E$=function(){const[t,r,i,s]=d(this,Ci),[o,a]=F(this,Xr,il).call(this,0);return[t+o,r+a,i-2*o,s-2*a]},b$=function(){const t=R(this,Ci,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:s}of d(this,Ts)){if(s.length<=12){for(let l=4,c=s.length;l<c;l+=6)Ke.pointBoundingBox(s[l],s[l+1],t);continue}let o=s[4],a=s[5];for(let l=6,c=s.length;l<c;l+=6){const[u,h,f,v,w,E]=s.subarray(l,l+6);Ke.bezierBoundingBox(o,a,u,h,f,v,w,E,t),o=w,a=E}}const[r,i]=F(this,Xr,il).call(this);t[0]=hi(t[0]-r,0,1),t[1]=hi(t[1]-i,0,1),t[2]=hi(t[2]+r,0,1),t[3]=hi(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]},_$=function(t){const[r,i]=F(this,Xr,il).call(this);R(this,Vh,t);const[s,o]=F(this,Xr,il).call(this),[a,l]=[s-r,o-i],c=d(this,Ci);return c[0]-=a,c[1]-=l,c[2]+=2*a,c[3]+=2*l,c};class HA extends v${constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Sn._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new HA(this._viewParameters);return e.updateAll(this),e}}var KS,S$;const wp=class wp extends SS{constructor(t){super({...t,name:"inkEditor"});O(this,KS);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,r){Sn.initialize(t,r),this._defaultDrawingOptions=new HA(r.viewParameters)}static getDefaultDrawingOptions(t){const r=this._defaultDrawingOptions.clone();return r.updateProperties(t),r}static get supportMultipleDrawings(){return!0}static get typesMap(){return Dt(this,"typesMap",new Map([[Ot.INK_THICKNESS,"stroke-width"],[Ot.INK_COLOR,"stroke"],[Ot.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,r,i,s,o){return new $Z(t,r,i,s,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,r,i,s,o,a){return nE.deserialize(t,r,i,s,o,a)}static async deserialize(t,r,i){let s=null;if(t instanceof _k){const{data:{inkLists:a,rect:l,rotation:c,id:u,color:h,opacity:f,borderStyle:{rawWidth:v},popupRef:w},parent:{page:{pageNumber:E}}}=t;s=t={annotationType:mt.INK,color:Array.from(h),thickness:v,opacity:f,paths:{points:a},boxes:null,pageIndex:E-1,rect:l.slice(0),rotation:c,annotationElementId:u,id:u,deleted:!1,popupRef:w}}const o=await super.deserialize(t,r,i);return o._initialData=s,o}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:r,parent:i}=this;r.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,r.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:r,opacity:i}){this._drawingOptions=wp.getDefaultDrawingOptions({stroke:Ke.makeHexColor(...t),"stroke-width":r,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:r,points:i,rect:s}=this.serializeDraw(t),{_drawingOptions:{stroke:o,"stroke-opacity":a,"stroke-width":l}}=this,c={annotationType:mt.INK,color:Sn._colorManager.convert(o),opacity:a,thickness:l,paths:{lines:r,points:i},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(c.isCopy=!0,c):this.annotationElementId&&!F(this,KS,S$).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){const{points:r,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:r}),null}};KS=new WeakSet,S$=function(t){const{color:r,thickness:i,opacity:s,pageIndex:o}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((a,l)=>a!==r[l])||t.thickness!==i||t.opacity!==s||t.pageIndex!==o},ge(wp,"_type","ink"),ge(wp,"_editorType",mt.INK),ge(wp,"_defaultDrawingOptions",null);let bC=wp;class _C extends nE{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const QE=8,ry=3;var Uh,Jt,SC,Oo,A$,T$,AC,a_,I$,x$,C$,TC,IC,P$;class Ma{static extractContoursFromText(e,{fontFamily:t,fontStyle:r,fontWeight:i},s,o,a,l){let c=new OffscreenCanvas(1,1),u=c.getContext("2d",{alpha:!1});const h=200,f=u.font=`${r} ${i} ${h}px ${t}`,{actualBoundingBoxLeft:v,actualBoundingBoxRight:w,actualBoundingBoxAscent:E,actualBoundingBoxDescent:A,fontBoundingBoxAscent:T,fontBoundingBoxDescent:_,width:b}=u.measureText(e),g=1.5,y=Math.ceil(Math.max(Math.abs(v)+Math.abs(w)||0,b)*g),x=Math.ceil(Math.max(Math.abs(E)+Math.abs(A)||h,Math.abs(T)+Math.abs(_)||h)*g);c=new OffscreenCanvas(y,x),u=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),u.font=f,u.filter="grayscale(1)",u.fillStyle="white",u.fillRect(0,0,y,x),u.fillStyle="black",u.fillText(e,y*(g-1)/2,x*(3-g)/2);const S=F(this,Jt,TC).call(this,u.getImageData(0,0,y,x).data),I=F(this,Jt,C$).call(this,S),P=F(this,Jt,IC).call(this,I),N=F(this,Jt,AC).call(this,S,y,x,P);return this.processDrawnLines({lines:{curves:N,width:y,height:x},pageWidth:s,pageHeight:o,rotation:a,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,r,i,s){const[o,a,l]=F(this,Jt,P$).call(this,e),[c,u]=F(this,Jt,x$).call(this,o,a,l,Math.hypot(a,l)*d(this,Uh).sigmaSFactor,d(this,Uh).sigmaR,d(this,Uh).kernelSize),h=F(this,Jt,IC).call(this,u),f=F(this,Jt,AC).call(this,c,a,l,h);return this.processDrawnLines({lines:{curves:f,width:a,height:l},pageWidth:t,pageHeight:r,rotation:i,innerMargin:s,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:r,rotation:i,innerMargin:s,mustSmooth:o,areContours:a}){i%180!==0&&([t,r]=[r,t]);const{curves:l,width:c,height:u}=e,h=e.thickness??0,f=[],v=Math.min(t/c,r/u),w=v/t,E=v/r,A=[];for(const{points:_}of l){const b=o?F(this,Jt,I$).call(this,_):_;if(!b)continue;A.push(b);const g=b.length,y=new Float32Array(g),x=new Float32Array(3*(g===2?2:g-2));if(f.push({line:x,points:y}),g===2){y[0]=b[0]*w,y[1]=b[1]*E,x.set([NaN,NaN,NaN,NaN,y[0],y[1]],0);continue}let[S,I,P,N]=b;S*=w,I*=E,P*=w,N*=E,y.set([S,I,P,N],0),x.set([NaN,NaN,NaN,NaN,S,I],0);for(let M=4;M<g;M+=2){const V=y[M]=b[M]*w,L=y[M+1]=b[M+1]*E;x.set(Ne.createBezierPoints(S,I,P,N,V,L),(M-2)*3),[S,I,P,N]=[P,N,V,L]}}if(f.length===0)return null;const T=a?new _C:new nE;return T.build(f,t,r,1,i,a?0:h,s),{outline:T,newCurves:A,areContours:a,thickness:h,width:c,height:u}}static async compressSignature({outlines:e,areContours:t,thickness:r,width:i,height:s}){let o=1/0,a=-1/0,l=0;for(const b of e){l+=b.length;for(let g=2,y=b.length;g<y;g++){const x=b[g]-b[g-2];o=Math.min(o,x),a=Math.max(a,x)}}let c;o>=-128&&a<=127?c=Int8Array:o>=-32768&&a<=32767?c=Int16Array:c=Int32Array;const u=e.length,h=QE+ry*u,f=new Uint32Array(h);let v=0;f[v++]=h*Uint32Array.BYTES_PER_ELEMENT+(l-2*u)*c.BYTES_PER_ELEMENT,f[v++]=0,f[v++]=i,f[v++]=s,f[v++]=t?0:1,f[v++]=Math.max(0,Math.floor(r??0)),f[v++]=u,f[v++]=c.BYTES_PER_ELEMENT;for(const b of e)f[v++]=b.length-2,f[v++]=b[0],f[v++]=b[1];const w=new CompressionStream("deflate-raw"),E=w.writable.getWriter();await E.ready,E.write(f);const A=c.prototype.constructor;for(const b of e){const g=new A(b.length-2);for(let y=2,x=b.length;y<x;y++)g[y-2]=b[y]-b[y-2];E.write(g)}E.close();const T=await new Response(w.readable).arrayBuffer(),_=new Uint8Array(T);return x3(_)}static async decompressSignature(e){try{const t=yJ(e),{readable:r,writable:i}=new DecompressionStream("deflate-raw"),s=i.getWriter();await s.ready,s.write(t).then(async()=>{await s.ready,await s.close()}).catch(()=>{});let o=null,a=0;for await(const b of r)o||(o=new Uint8Array(new Uint32Array(b.buffer,0,4)[0])),o.set(b,a),a+=b.length;const l=new Uint32Array(o.buffer,0,o.length>>2),c=l[1];if(c!==0)throw new Error(`Invalid version: ${c}`);const u=l[2],h=l[3],f=l[4]===0,v=l[5],w=l[6],E=l[7],A=[],T=(QE+ry*w)*Uint32Array.BYTES_PER_ELEMENT;let _;switch(E){case Int8Array.BYTES_PER_ELEMENT:_=new Int8Array(o.buffer,T);break;case Int16Array.BYTES_PER_ELEMENT:_=new Int16Array(o.buffer,T);break;case Int32Array.BYTES_PER_ELEMENT:_=new Int32Array(o.buffer,T);break}a=0;for(let b=0;b<w;b++){const g=l[ry*b+QE],y=new Float32Array(g+2);A.push(y);for(let x=0;x<ry-1;x++)y[x]=l[ry*b+QE+x+1];for(let x=0;x<g;x++)y[x+2]=y[x]+_[a++]}return{areContours:f,thickness:v,outlines:A,width:u,height:h}}catch(t){return wt(`decompressSignature: ${t}`),null}}}Uh=new WeakMap,Jt=new WeakSet,SC=function(e,t,r,i){return r-=e,i-=t,r===0?i>0?0:4:r===1?i+6:2-i},Oo=new WeakMap,A$=function(e,t,r,i,s,o,a){const l=F(this,Jt,SC).call(this,r,i,s,o);for(let c=0;c<8;c++){const u=(-c+l-a+16)%8,h=d(this,Oo)[2*u],f=d(this,Oo)[2*u+1];if(e[(r+h)*t+(i+f)]!==0)return u}return-1},T$=function(e,t,r,i,s,o,a){const l=F(this,Jt,SC).call(this,r,i,s,o);for(let c=0;c<8;c++){const u=(c+l+a+16)%8,h=d(this,Oo)[2*u],f=d(this,Oo)[2*u+1];if(e[(r+h)*t+(i+f)]!==0)return u}return-1},AC=function(e,t,r,i){const s=e.length,o=new Int32Array(s);for(let u=0;u<s;u++)o[u]=e[u]<=i?1:0;for(let u=1;u<r-1;u++)o[u*t]=o[u*t+t-1]=0;for(let u=0;u<t;u++)o[u]=o[t*r-1-u]=0;let a=1,l;const c=[];for(let u=1;u<r-1;u++){l=1;for(let h=1;h<t-1;h++){const f=u*t+h,v=o[f];if(v===0)continue;let w=u,E=h;if(v===1&&o[f-1]===0)a+=1,E-=1;else if(v>=1&&o[f+1]===0)a+=1,E+=1,v>1&&(l=v);else{v!==1&&(l=Math.abs(v));continue}const A=[h,u],T=E===h+1,_={isHole:T,points:A,id:a,parent:0};c.push(_);let b;for(const M of c)if(M.id===l){b=M;break}b?b.isHole?_.parent=T?b.parent:l:_.parent=T?l:b.parent:_.parent=T?l:0;const g=F(this,Jt,A$).call(this,o,t,u,h,w,E,0);if(g===-1){o[f]=-a,o[f]!==1&&(l=Math.abs(o[f]));continue}let y=d(this,Oo)[2*g],x=d(this,Oo)[2*g+1];const S=u+y,I=h+x;w=S,E=I;let P=u,N=h;for(;;){const M=F(this,Jt,T$).call(this,o,t,P,N,w,E,1);y=d(this,Oo)[2*M],x=d(this,Oo)[2*M+1];const V=P+y,L=N+x;A.push(L,V);const j=P*t+N;if(o[j+1]===0?o[j]=-a:o[j]===1&&(o[j]=a),V===u&&L===h&&P===S&&N===I){o[f]!==1&&(l=Math.abs(o[f]));break}else w=P,E=N,P=V,N=L}}}return c},a_=function(e,t,r,i){if(r-t<=4){for(let S=t;S<r-2;S+=2)i.push(e[S],e[S+1]);return}const s=e[t],o=e[t+1],a=e[r-4]-s,l=e[r-3]-o,c=Math.hypot(a,l),u=a/c,h=l/c,f=u*o-h*s,v=l/a,w=1/c,E=Math.atan(v),A=Math.cos(E),T=Math.sin(E),_=w*(Math.abs(A)+Math.abs(T)),b=w*(1-_+_**2),g=Math.max(Math.atan(Math.abs(T+A)*b),Math.atan(Math.abs(T-A)*b));let y=0,x=t;for(let S=t+2;S<r-2;S+=2){const I=Math.abs(f-u*e[S+1]+h*e[S]);I>y&&(x=S,y=I)}y>(c*g)**2?(F(this,Jt,a_).call(this,e,t,x+2,i),F(this,Jt,a_).call(this,e,x,r,i)):i.push(s,o)},I$=function(e){const t=[],r=e.length;return F(this,Jt,a_).call(this,e,0,r,t),t.push(e[r-2],e[r-1]),t.length<=4?null:t},x$=function(e,t,r,i,s,o){const a=new Float32Array(o**2),l=-2*i**2,c=o>>1;for(let E=0;E<o;E++){const A=(E-c)**2;for(let T=0;T<o;T++)a[E*o+T]=Math.exp((A+(T-c)**2)/l)}const u=new Float32Array(256),h=-2*s**2;for(let E=0;E<256;E++)u[E]=Math.exp(E**2/h);const f=e.length,v=new Uint8Array(f),w=new Uint32Array(256);for(let E=0;E<r;E++)for(let A=0;A<t;A++){const T=E*t+A,_=e[T];let b=0,g=0;for(let x=0;x<o;x++){const S=E+x-c;if(!(S<0||S>=r))for(let I=0;I<o;I++){const P=A+I-c;if(P<0||P>=t)continue;const N=e[S*t+P],M=a[x*o+I]*u[Math.abs(N-_)];b+=N*M,g+=M}}const y=v[T]=Math.round(b/g);w[y]++}return[v,w]},C$=function(e){const t=new Uint32Array(256);for(const r of e)t[r]++;return t},TC=function(e){const t=e.length,r=new Uint8ClampedArray(t>>2);let i=-1/0,s=1/0;for(let a=0,l=r.length;a<l;a++){if(e[(a<<2)+3]===0){i=r[a]=255;continue}const u=r[a]=e[a<<2];u>i&&(i=u),u<s&&(s=u)}const o=255/(i-s);for(let a=0;a<t;a++)r[a]=(r[a]-s)*o;return r},IC=function(e){let t,r=-1/0,i=-1/0;const s=e.findIndex(l=>l!==0);let o=s,a=s;for(t=s;t<256;t++){const l=e[t];l>r&&(t-o>i&&(i=t-o,a=t-1),r=l,o=t)}for(t=a-1;t>=0&&!(e[t]>e[t+1]);t--);return t},P$=function(e){const t=e,{width:r,height:i}=e,{maxDim:s}=d(this,Uh);let o=r,a=i;if(r>s||i>s){let f=r,v=i,w=Math.log2(Math.max(r,i)/s);const E=Math.floor(w);w=w===E?E-1:E;for(let T=0;T<w;T++){o=Math.ceil(f/2),a=Math.ceil(v/2);const _=new OffscreenCanvas(o,a);_.getContext("2d").drawImage(e,0,0,f,v,0,0,o,a),f=o,v=a,e!==t&&e.close(),e=_.transferToImageBitmap()}const A=Math.min(s/o,s/a);o=Math.round(o*A),a=Math.round(a*A)}const c=new OffscreenCanvas(o,a).getContext("2d",{willReadFrequently:!0});c.filter="grayscale(1)",c.drawImage(e,0,0,e.width,e.height,0,0,o,a);const u=c.getImageData(0,0,o,a).data;return[F(this,Jt,TC).call(this,u),o,a]},O(Ma,Jt),O(Ma,Uh,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),O(Ma,Oo,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Ak extends v${constructor(){super(),super.updateProperties({fill:Sn._defaultLineColor,"stroke-width":0})}clone(){const e=new Ak;return e.updateAll(this),e}}class Tk extends HA{constructor(e){super(e),super.updateProperties({stroke:Sn._defaultLineColor,"stroke-width":1})}clone(){const e=new Tk(this._viewParameters);return e.updateAll(this),e}}var fu,Ca,pu,Bh;const fs=class fs extends SS{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});O(this,fu,!1);O(this,Ca,null);O(this,pu,null);O(this,Bh,null);this._willKeepAspectRatio=!0,R(this,pu,t.signatureData||null),R(this,Ca,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,r){Sn.initialize(t,r),this._defaultDrawingOptions=new Ak,this._defaultDrawnSignatureOptions=new Tk(r.viewParameters)}static getDefaultDrawingOptions(t){const r=this._defaultDrawingOptions.clone();return r.updateProperties(t),r}static get supportMultipleDrawings(){return!1}static get typesMap(){return Dt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!d(this,Ca)}}static computeTelemetryFinalData(t){const r=t.get("hasDescription");return{hasAltText:r.get(!0)??0,hasNoAltText:r.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,r;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,r=this.y),super.render(),this._drawId===null)if(d(this,pu)){const{lines:s,mustSmooth:o,areContours:a,description:l,uuid:c,heightInPage:u}=d(this,pu),{rawDims:{pageWidth:h,pageHeight:f},rotation:v}=this.parent.viewport,w=Ma.processDrawnLines({lines:s,pageWidth:h,pageHeight:f,rotation:v,innerMargin:fs._INNER_MARGIN,mustSmooth:o,areContours:a});this.addSignature(w,u,l,c)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return i&&(this._isCopy=!0,this._moveAfterPaste(t,r)),this.div}setUuid(t){R(this,Bh,t),this.addEditToolbar()}getUuid(){return d(this,Bh)}get description(){return d(this,Ca)}set description(t){R(this,Ca,t),super.addEditToolbar().then(r=>{r==null||r.updateEditSignatureButton(t)})}getSignaturePreview(){const{newCurves:t,areContours:r,thickness:i,width:s,height:o}=d(this,pu),a=Math.max(s,o),l=Ma.processDrawnLines({lines:{curves:t.map(c=>({points:c})),thickness:i,width:s,height:o},pageWidth:a,pageHeight:a,rotation:0,innerMargin:0,mustSmooth:!1,areContours:r});return{areContours:r,outline:l.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,r,i,s){const{x:o,y:a}=this,{outline:l}=R(this,pu,t);R(this,fu,l instanceof _C),this.description=i,this.div.setAttribute("data-l10n-args",JSON.stringify({description:i}));let c;d(this,fu)?c=fs.getDefaultDrawingOptions():(c=fs._defaultDrawnSignatureOptions.clone(),c.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:c});const[u,h]=this.parentDimensions,[,f]=this.pageDimensions;let v=r/f;v=v>=1?.5:v,this.width*=v/this.height,this.width>=1&&(v*=.9/this.width,this.width=.9),this.height=v,this.setDims(u*this.width,h*this.height),this.x=o,this.y=a,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(s),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!s,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:r,pageHeight:i},rotation:s}=this.parent.viewport;return Ma.process(t,r,i,s,fs._INNER_MARGIN)}getFromText(t,r){const{rawDims:{pageWidth:i,pageHeight:s},rotation:o}=this.parent.viewport;return Ma.extractContoursFromText(t,r,i,s,o,fs._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:r,pageHeight:i},rotation:s}=this.parent.viewport;return Ma.processDrawnLines({lines:t,pageWidth:r,pageHeight:i,rotation:s,innerMargin:fs._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:r}){t?this._drawingOptions=fs.getDefaultDrawingOptions():(this._drawingOptions=fs._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":r}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:r,points:i,rect:s}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":o}}=this,a={annotationType:mt.SIGNATURE,isSignature:!0,areContours:d(this,fu),color:[0,0,0],thickness:d(this,fu)?0:o,pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?(a.paths={lines:r,points:i},a.uuid=d(this,Bh),a.isCopy=!0):a.lines=r,d(this,Ca)&&(a.accessibilityData={type:"Figure",alt:d(this,Ca)}),a}static deserializeDraw(t,r,i,s,o,a){return a.areContours?_C.deserialize(t,r,i,s,o,a):nE.deserialize(t,r,i,s,o,a)}static async deserialize(t,r,i){var o;const s=await super.deserialize(t,r,i);return R(s,fu,t.areContours),R(s,Ca,((o=t.accessibilityData)==null?void 0:o.alt)||""),R(s,Bh,t.uuid),s}};fu=new WeakMap,Ca=new WeakMap,pu=new WeakMap,Bh=new WeakMap,ge(fs,"_type","signature"),ge(fs,"_editorType",mt.SIGNATURE),ge(fs,"_defaultDrawingOptions",null);let xC=fs;var kn,Mr,mu,Ol,gu,Lm,Fl,$h,Pa,Is,Om,Gt,Vy,Uy,l_,c_,u_,PC,d_,R$;class CC extends Sn{constructor(t){super({...t,name:"stampEditor"});O(this,Gt);O(this,kn,null);O(this,Mr,null);O(this,mu,null);O(this,Ol,null);O(this,gu,null);O(this,Lm,"");O(this,Fl,null);O(this,$h,!1);O(this,Pa,null);O(this,Is,!1);O(this,Om,!1);R(this,Ol,t.bitmapUrl),R(this,gu,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,r){Sn.initialize(t,r)}static isHandlingMimeForPasting(t){return wS.includes(t)}static paste(t,r){r.pasteEditor({mode:mt.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const r=t.get("hasAltText");return{hasAltText:r.get(!0)??0,hasNoAltText:r.get(!1)??0}}async mlGuessAltText(t=null,r=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:o,height:a}=t||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:s,width:o,height:a,channels:s.length/(o*a)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const c=l.output;return await this.setGuessedAltText(c),r&&!this.hasAltTextData()&&(this.altTextData={alt:c,decorative:!1}),c}remove(){var t;d(this,Mr)&&(R(this,kn,null),this._uiManager.imageManager.deleteId(d(this,Mr)),(t=d(this,Fl))==null||t.remove(),R(this,Fl,null),d(this,Pa)&&(clearTimeout(d(this,Pa)),R(this,Pa,null))),super.remove()}rebuild(){if(!this.parent){d(this,Mr)&&F(this,Gt,l_).call(this);return}super.rebuild(),this.div!==null&&(d(this,Mr)&&d(this,Fl)===null&&F(this,Gt,l_).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(d(this,mu)||d(this,kn)||d(this,Ol)||d(this,gu)||d(this,Mr)||d(this,$h))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,r;return this._isCopy&&(t=this.x,r=this.y),super.render(),this.div.hidden=!0,this.createAltText(),d(this,$h)||(d(this,kn)?F(this,Gt,c_).call(this):F(this,Gt,l_).call(this)),this._isCopy&&this._moveAfterPaste(t,r),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,r){const{id:i,bitmap:s}=this._uiManager.imageManager.getFromCanvas(t,r);r.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(R(this,Mr,i),s&&R(this,kn,s),R(this,$h,!1),F(this,Gt,c_).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;d(this,Pa)!==null&&clearTimeout(d(this,Pa)),R(this,Pa,setTimeout(()=>{R(this,Pa,null),F(this,Gt,PC).call(this)},200))}copyCanvas(t,r,i=!1){var v;t||(t=224);const{width:s,height:o}=d(this,kn),a=new Qo;let l=d(this,kn),c=s,u=o,h=null;if(r){if(s>r||o>r){const I=Math.min(r/s,r/o);c=Math.floor(s*I),u=Math.floor(o*I)}h=document.createElement("canvas");const w=h.width=Math.ceil(c*a.sx),E=h.height=Math.ceil(u*a.sy);d(this,Is)||(l=F(this,Gt,u_).call(this,w,E));const A=h.getContext("2d");A.filter=this._uiManager.hcmFilter;let T="white",_="#cfcfd8";this._uiManager.hcmFilter!=="none"?_="black":(v=window.matchMedia)!=null&&v.call(window,"(prefers-color-scheme: dark)").matches&&(T="#8f8f9d",_="#42414d");const b=15,g=b*a.sx,y=b*a.sy,x=new OffscreenCanvas(g*2,y*2),S=x.getContext("2d");S.fillStyle=T,S.fillRect(0,0,g*2,y*2),S.fillStyle=_,S.fillRect(0,0,g,y),S.fillRect(g,y,g,y),A.fillStyle=A.createPattern(x,"repeat"),A.fillRect(0,0,w,E),A.drawImage(l,0,0,l.width,l.height,0,0,w,E)}let f=null;if(i){let w,E;if(a.symmetric&&l.width<t&&l.height<t)w=l.width,E=l.height;else if(l=d(this,kn),s>t||o>t){const _=Math.min(t/s,t/o);w=Math.floor(s*_),E=Math.floor(o*_),d(this,Is)||(l=F(this,Gt,u_).call(this,w,E))}const T=new OffscreenCanvas(w,E).getContext("2d",{willReadFrequently:!0});T.drawImage(l,0,0,l.width,l.height,0,0,w,E),f={width:w,height:E,data:T.getImageData(0,0,w,E).data}}return{canvas:h,width:c,height:u,imageData:f}}static async deserialize(t,r,i){var A;let s=null,o=!1;if(t instanceof G5){const{data:{rect:T,rotation:_,id:b,structParent:g,popupRef:y},container:x,parent:{page:{pageNumber:S}},canvas:I}=t;let P,N;I?(delete t.canvas,{id:P,bitmap:N}=i.imageManager.getFromCanvas(x.id,I),I.remove()):(o=!0,t._hasNoCanvas=!0);const M=((A=await r._structTree.getAriaAttributes(`${fk}${b}`))==null?void 0:A.get("aria-label"))||"";s=t={annotationType:mt.STAMP,bitmapId:P,bitmap:N,pageIndex:S-1,rect:T.slice(0),rotation:_,annotationElementId:b,id:b,deleted:!1,accessibilityData:{decorative:!1,altText:M},isSvg:!1,structParent:g,popupRef:y}}const a=await super.deserialize(t,r,i),{rect:l,bitmap:c,bitmapUrl:u,bitmapId:h,isSvg:f,accessibilityData:v}=t;o?(i.addMissingCanvas(t.id,a),R(a,$h,!0)):h&&i.imageManager.isValidId(h)?(R(a,Mr,h),c&&R(a,kn,c)):R(a,Ol,u),R(a,Is,f);const[w,E]=a.pageDimensions;return a.width=(l[2]-l[0])/w,a.height=(l[3]-l[1])/E,v&&(a.altTextData=v),a._initialData=s,R(a,Om,!!s),a}serialize(t=!1,r=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:mt.STAMP,bitmapId:d(this,Mr),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:d(this,Is),structTreeParentId:this._structTreeParentId};if(t)return i.bitmapUrl=F(this,Gt,d_).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:s,altText:o}=this.serializeAltText(!1);if(!s&&o&&(i.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const l=F(this,Gt,R$).call(this,i);if(l.isSame)return null;l.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,r===null)return i;r.stamps||(r.stamps=new Map);const a=d(this,Is)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!r.stamps.has(d(this,Mr)))r.stamps.set(d(this,Mr),{area:a,serialized:i}),i.bitmap=F(this,Gt,d_).call(this,!1);else if(d(this,Is)){const l=r.stamps.get(d(this,Mr));a>l.area&&(l.area=a,l.serialized.bitmap.close(),l.serialized.bitmap=F(this,Gt,d_).call(this,!1))}return i}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}kn=new WeakMap,Mr=new WeakMap,mu=new WeakMap,Ol=new WeakMap,gu=new WeakMap,Lm=new WeakMap,Fl=new WeakMap,$h=new WeakMap,Pa=new WeakMap,Is=new WeakMap,Om=new WeakMap,Gt=new WeakSet,Vy=function(t,r=!1){if(!t){this.remove();return}R(this,kn,t.bitmap),r||(R(this,Mr,t.id),R(this,Is,t.isSvg)),t.file&&R(this,Lm,t.file.name),F(this,Gt,c_).call(this)},Uy=function(){if(R(this,mu,null),this._uiManager.enableWaiting(!1),!!d(this,Fl)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,kn)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&d(this,kn)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},l_=function(){if(d(this,Mr)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(d(this,Mr)).then(i=>F(this,Gt,Vy).call(this,i,!0)).finally(()=>F(this,Gt,Uy).call(this));return}if(d(this,Ol)){const i=d(this,Ol);R(this,Ol,null),this._uiManager.enableWaiting(!0),R(this,mu,this._uiManager.imageManager.getFromUrl(i).then(s=>F(this,Gt,Vy).call(this,s)).finally(()=>F(this,Gt,Uy).call(this)));return}if(d(this,gu)){const i=d(this,gu);R(this,gu,null),this._uiManager.enableWaiting(!0),R(this,mu,this._uiManager.imageManager.getFromFile(i).then(s=>F(this,Gt,Vy).call(this,s)).finally(()=>F(this,Gt,Uy).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=wS.join(",");const r=this._uiManager._signal;R(this,mu,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),F(this,Gt,Vy).call(this,s)}i()},{signal:r}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:r})}).finally(()=>F(this,Gt,Uy).call(this))),t.click()},c_=function(){var h;const{div:t}=this;let{width:r,height:i}=d(this,kn);const[s,o]=this.pageDimensions,a=.75;if(this.width)r=this.width*s,i=this.height*o;else if(r>a*s||i>a*o){const f=Math.min(a*s/r,a*o/i);r*=f,i*=f}const[l,c]=this.parentDimensions;this.setDims(r*l/s,i*c/o),this._uiManager.enableWaiting(!1);const u=R(this,Fl,document.createElement("canvas"));u.setAttribute("role","img"),this.addContainer(u),this.width=r/s,this.height=i/o,(h=this._initialOptions)!=null&&h.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),F(this,Gt,PC).call(this),d(this,Om)||(this.parent.addUndoableEditor(this),R(this,Om,!0)),this._reportTelemetry({action:"inserted_image"}),d(this,Lm)&&this.div.setAttribute("aria-description",d(this,Lm)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},u_=function(t,r){const{width:i,height:s}=d(this,kn);let o=i,a=s,l=d(this,kn);for(;o>2*t||a>2*r;){const c=o,u=a;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),a>2*r&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const h=new OffscreenCanvas(o,a);h.getContext("2d").drawImage(l,0,0,c,u,0,0,o,a),l=h.transferToImageBitmap()}return l},PC=function(){const[t,r]=this.parentDimensions,{width:i,height:s}=this,o=new Qo,a=Math.ceil(i*t*o.sx),l=Math.ceil(s*r*o.sy),c=d(this,Fl);if(!c||c.width===a&&c.height===l)return;c.width=a,c.height=l;const u=d(this,Is)?d(this,kn):F(this,Gt,u_).call(this,a,l),h=c.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(u,0,0,u.width,u.height,0,0,a,l)},d_=function(t){if(t){if(d(this,Is)){const s=this._uiManager.imageManager.getSvgUrl(d(this,Mr));if(s)return s}const r=document.createElement("canvas");return{width:r.width,height:r.height}=d(this,kn),r.getContext("2d").drawImage(d(this,kn),0,0),r.toDataURL()}if(d(this,Is)){const[r,i]=this.pageDimensions,s=Math.round(this.width*r*ac.PDF_TO_CSS_UNITS),o=Math.round(this.height*i*ac.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(s,o);return a.getContext("2d").drawImage(d(this,kn),0,0,d(this,kn).width,d(this,kn).height,0,0,s,o),a.transferToImageBitmap()}return structuredClone(d(this,kn))},R$=function(t){var a;const{pageIndex:r,accessibilityData:{altText:i}}=this._initialData,s=t.pageIndex===r,o=(((a=t.accessibilityData)==null?void 0:a.alt)||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&s&&o,isSameAltText:o}},ge(CC,"_type","stamp"),ge(CC,"_editorType",mt.STAMP);var jh,Fm,Ra,yu,Vl,xs,vu,Vm,zh,Fo,Ul,Nr,Bl,wu,Um,Ge,Eu,Mn,k$,da,RC,kC,h_;const To=class To{constructor({uiManager:e,pageIndex:t,div:r,structTreeLayer:i,accessibilityManager:s,annotationLayer:o,drawLayer:a,textLayer:l,viewport:c,l10n:u}){O(this,Mn);O(this,jh);O(this,Fm,!1);O(this,Ra,null);O(this,yu,null);O(this,Vl,null);O(this,xs,new Map);O(this,vu,!1);O(this,Vm,!1);O(this,zh,!1);O(this,Fo,null);O(this,Ul,null);O(this,Nr,null);O(this,Bl,null);O(this,wu,null);O(this,Um,-1);O(this,Ge);const h=[...d(To,Eu).values()];if(!To._initialized){To._initialized=!0;for(const f of h)f.initialize(u,e)}e.registerEditorTypes(h),R(this,Ge,e),this.pageIndex=t,this.div=r,R(this,jh,s),R(this,Ra,o),this.viewport=c,R(this,Nr,l),this.drawLayer=a,this._structTree=i,d(this,Ge).addLayer(this)}get isEmpty(){return d(this,xs).size===0}get isInvisible(){return this.isEmpty&&d(this,Ge).getMode()===mt.NONE}updateToolbar(e){d(this,Ge).updateToolbar(e)}updateMode(e=d(this,Ge).getMode()){switch(F(this,Mn,h_).call(this),e){case mt.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case mt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case mt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const r of d(To,Eu).values())t.toggle(`${r._type}Editing`,e===r._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=d(this,Nr))==null?void 0:t.div)}setEditingState(e){d(this,Ge).setEditingState(e)}addCommands(e){d(this,Ge).addCommands(e)}cleanUndoStack(e){d(this,Ge).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=d(this,Ra))==null||t.div.classList.toggle("disabled",!e)}async enable(){var r;R(this,zh,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),(r=d(this,wu))==null||r.abort(),R(this,wu,null);const e=new Set;for(const i of d(this,xs).values())i.enableEditing(),i.show(!0),i.annotationElementId&&(d(this,Ge).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));if(!d(this,Ra)){R(this,zh,!1);return}const t=d(this,Ra).getEditableAnnotations();for(const i of t){if(i.hide(),d(this,Ge).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const s=await this.deserialize(i);s&&(this.addOrRebuild(s),s.enableEditing())}R(this,zh,!1)}disable(){var i;if(R(this,Vm,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),d(this,Nr)&&!d(this,wu)){R(this,wu,new AbortController);const s=d(this,Ge).combinedSignal(d(this,wu));d(this,Nr).div.addEventListener("pointerdown",o=>{const{clientX:l,clientY:c,timeStamp:u}=o,h=d(this,Um);if(u-h>500){R(this,Um,u);return}R(this,Um,-1);const{classList:f}=this.div;f.toggle("getElements",!0);const v=document.elementsFromPoint(l,c);if(f.toggle("getElements",!1),!this.div.contains(v[0]))return;let w;const E=new RegExp(`^${_3}[0-9]+$`);for(const T of v)if(E.test(T.id)){w=T.id;break}if(!w)return;const A=d(this,xs).get(w);(A==null?void 0:A.annotationElementId)===null&&(o.stopPropagation(),o.preventDefault(),A.dblclick())},{signal:s,capture:!0})}const e=new Map,t=new Map;for(const s of d(this,xs).values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){e.set(s.annotationElementId,s);continue}else t.set(s.annotationElementId,s);(i=this.getEditableAnnotation(s.annotationElementId))==null||i.show(),s.remove()}if(d(this,Ra)){const s=d(this,Ra).getEditableAnnotations();for(const o of s){const{id:a}=o.data;if(d(this,Ge).isDeletedAnnotationElement(a))continue;let l=t.get(a);if(l){l.resetAnnotationElement(o),l.show(!1),o.show();continue}l=e.get(a),l&&(d(this,Ge).addChangedExistingAnnotation(l),l.renderAnnotationElement(o)&&l.show(!1)),o.show()}}F(this,Mn,h_).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:r}=this.div;for(const s of d(To,Eu).values())r.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),R(this,Vm,!1)}getEditableAnnotation(e){var t;return((t=d(this,Ra))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){d(this,Ge).getActive()!==e&&d(this,Ge).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=d(this,Nr))!=null&&e.div&&!d(this,Bl)){R(this,Bl,new AbortController);const t=d(this,Ge).combinedSignal(d(this,Bl));d(this,Nr).div.addEventListener("pointerdown",F(this,Mn,k$).bind(this),{signal:t}),d(this,Nr).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=d(this,Nr))!=null&&e.div&&d(this,Bl)&&(d(this,Bl).abort(),R(this,Bl,null),d(this,Nr).div.classList.remove("highlighting"))}enableClick(){if(d(this,yu))return;R(this,yu,new AbortController);const e=d(this,Ge).combinedSignal(d(this,yu));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=d(this,yu))==null||e.abort(),R(this,yu,null)}attach(e){d(this,xs).set(e.id,e);const{annotationElementId:t}=e;t&&d(this,Ge).isDeletedAnnotationElement(t)&&d(this,Ge).removeDeletedAnnotationElement(e)}detach(e){var t;d(this,xs).delete(e.id),(t=d(this,jh))==null||t.removePointerInTextLayer(e.contentDiv),!d(this,Vm)&&e.annotationElementId&&d(this,Ge).addDeletedAnnotationElement(e)}remove(e){this.detach(e),d(this,Ge).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(d(this,Ge).addDeletedAnnotationElement(e.annotationElementId),Sn.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),d(this,Ge).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!d(this,zh)),d(this,Ge).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var r;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!d(this,Vl)&&(e._focusEventsAllowed=!1,R(this,Vl,setTimeout(()=>{R(this,Vl,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:d(this,Ge)._signal}),t.focus())},0))),e._structTreeParentId=(r=d(this,jh))==null?void 0:r.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),r=()=>{e.remove()};this.addCommands({cmd:t,undo:r,mustExec:!1})}getNextId(){return d(this,Ge).getId()}combinedSignal(e){return d(this,Ge).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=d(this,Mn,da))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await d(this,Ge).updateMode(e.mode);const{offsetX:r,offsetY:i}=F(this,Mn,kC).call(this),s=this.getNextId(),o=F(this,Mn,RC).call(this,{parent:this,id:s,x:r,y:i,uiManager:d(this,Ge),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=d(To,Eu).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,d(this,Ge)))||null}createAndAddNewEditor(e,t,r={}){const i=this.getNextId(),s=F(this,Mn,RC).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:d(this,Ge),isCentered:t,...r});return s&&this.add(s),s}addNewEditor(e={}){this.createAndAddNewEditor(F(this,Mn,kC).call(this),!0,e)}setSelected(e){d(this,Ge).setSelected(e)}toggleSelected(e){d(this,Ge).toggleSelected(e)}unselect(e){d(this,Ge).unselect(e)}pointerup(e){var i;const{isMac:t}=Ur.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!d(this,vu)||(R(this,vu,!1),(i=d(this,Mn,da))!=null&&i.isDrawer&&d(this,Mn,da).supportMultipleDrawings))return;if(!d(this,Fm)){R(this,Fm,!0);return}const r=d(this,Ge).getMode();if(r===mt.STAMP||r===mt.SIGNATURE){d(this,Ge).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var i;if(d(this,Ge).getMode()===mt.HIGHLIGHT&&this.enableTextSelection(),d(this,vu)){R(this,vu,!1);return}const{isMac:t}=Ur.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(R(this,vu,!0),(i=d(this,Mn,da))!=null&&i.isDrawer){this.startDrawingSession(e);return}const r=d(this,Ge).getActive();R(this,Fm,!r||r.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),d(this,Fo)){d(this,Mn,da).startDrawing(this,d(this,Ge),!1,e);return}d(this,Ge).setCurrentDrawingSession(this),R(this,Fo,new AbortController);const t=d(this,Ge).combinedSignal(d(this,Fo));this.div.addEventListener("blur",({relatedTarget:r})=>{r&&!this.div.contains(r)&&(R(this,Ul,null),this.commitOrRemove())},{signal:t}),d(this,Mn,da).startDrawing(this,d(this,Ge),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&R(this,Ul,t);return}d(this,Ul)&&setTimeout(()=>{var t;(t=d(this,Ul))==null||t.focus(),R(this,Ul,null)},0)}endDrawingSession(e=!1){return d(this,Fo)?(d(this,Ge).setCurrentDrawingSession(null),d(this,Fo).abort(),R(this,Fo,null),R(this,Ul,null),d(this,Mn,da).endDrawing(e)):null}findNewParent(e,t,r){const i=d(this,Ge).findParent(t,r);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return d(this,Fo)?(this.endDrawingSession(),!0):!1}onScaleChanging(){d(this,Fo)&&d(this,Mn,da).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=d(this,Ge).getActive())==null?void 0:e.parent)===this&&(d(this,Ge).commitOrRemove(),d(this,Ge).setActiveEditor(null)),d(this,Vl)&&(clearTimeout(d(this,Vl)),R(this,Vl,null));for(const r of d(this,xs).values())(t=d(this,jh))==null||t.removePointerInTextLayer(r.contentDiv),r.setParent(null),r.isAttachedToDOM=!1,r.div.remove();this.div=null,d(this,xs).clear(),d(this,Ge).removeLayer(this)}render({viewport:e}){this.viewport=e,qu(this.div,e);for(const t of d(this,Ge).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){d(this,Ge).commitOrRemove(),F(this,Mn,h_).call(this);const t=this.viewport.rotation,r=e.rotation;if(this.viewport=e,qu(this.div,{rotation:r}),t!==r)for(const i of d(this,xs).values())i.rotate(r)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return d(this,Ge).viewParameters.realScale}};jh=new WeakMap,Fm=new WeakMap,Ra=new WeakMap,yu=new WeakMap,Vl=new WeakMap,xs=new WeakMap,vu=new WeakMap,Vm=new WeakMap,zh=new WeakMap,Fo=new WeakMap,Ul=new WeakMap,Nr=new WeakMap,Bl=new WeakMap,wu=new WeakMap,Um=new WeakMap,Ge=new WeakMap,Eu=new WeakMap,Mn=new WeakSet,k$=function(e){d(this,Ge).unselectAll();const{target:t}=e;if(t===d(this,Nr).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&d(this,Nr).div.contains(t)){const{isMac:r}=Ur.platform;if(e.button!==0||e.ctrlKey&&r)return;d(this,Ge).showAllEditors("highlight",!0,!0),d(this,Nr).div.classList.add("free"),this.toggleDrawing(),_S.startHighlighting(this,d(this,Ge).direction==="ltr",{target:d(this,Nr).div,x:e.x,y:e.y}),d(this,Nr).div.addEventListener("pointerup",()=>{d(this,Nr).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:d(this,Ge)._signal}),e.preventDefault()}},da=function(){return d(To,Eu).get(d(this,Ge).getMode())},RC=function(e){const t=d(this,Mn,da);return t?new t.prototype.constructor(e):null},kC=function(){const{x:e,y:t,width:r,height:i}=this.div.getBoundingClientRect(),s=Math.max(0,e),o=Math.max(0,t),a=Math.min(window.innerWidth,e+r),l=Math.min(window.innerHeight,t+i),c=(s+a)/2-e,u=(o+l)/2-t,[h,f]=this.viewport.rotation%180===0?[c,u]:[u,c];return{offsetX:h,offsetY:f}},h_=function(){for(const e of d(this,xs).values())e.isEmpty()&&e.remove()},ge(To,"_initialized",!1),O(To,Eu,new Map([lC,bC,CC,_S,xC].map(e=>[e._editorType,e])));let AS=To;var Vo,Pi,Hh,T0,YS,D$,Wa,DC,M$,MC;const yr=class yr{constructor({pageIndex:e}){O(this,Wa);O(this,Vo,null);O(this,Pi,new Map);O(this,Hh,new Map);this.pageIndex=e}setParent(e){if(!d(this,Vo)){R(this,Vo,e);return}if(d(this,Vo)!==e){if(d(this,Pi).size>0)for(const t of d(this,Pi).values())t.remove(),e.append(t);R(this,Vo,e)}}static get _svgFactory(){return Dt(this,"_svgFactory",new qv)}draw(e,t=!1,r=!1){const i=Si(yr,T0)._++,s=F(this,Wa,DC).call(this),o=yr._svgFactory.createElement("defs");s.append(o);const a=yr._svgFactory.createElement("path");o.append(a);const l=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&d(this,Hh).set(i,a);const c=r?F(this,Wa,M$).call(this,o,l):null,u=yr._svgFactory.createElement("use");return s.append(u),u.setAttribute("href",`#${l}`),this.updateProperties(s,e),d(this,Pi).set(i,s),{id:i,clipPathId:`url(#${c})`}}drawOutline(e,t){const r=Si(yr,T0)._++,i=F(this,Wa,DC).call(this),s=yr._svgFactory.createElement("defs");i.append(s);const o=yr._svgFactory.createElement("path");s.append(o);const a=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const h=yr._svgFactory.createElement("mask");s.append(h),l=`mask_p${this.pageIndex}_${r}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");const f=yr._svgFactory.createElement("rect");h.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const v=yr._svgFactory.createElement("use");h.append(v),v.setAttribute("href",`#${a}`),v.setAttribute("stroke","none"),v.setAttribute("fill","black"),v.setAttribute("fill-rule","nonzero"),v.classList.add("mask")}const c=yr._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);const u=c.cloneNode();return i.append(u),c.classList.add("mainOutline"),u.classList.add("secondaryOutline"),this.updateProperties(i,e),d(this,Pi).set(r,i),r}finalizeDraw(e,t){d(this,Hh).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var l;if(!t)return;const{root:r,bbox:i,rootClass:s,path:o}=t,a=typeof e=="number"?d(this,Pi).get(e):e;if(a){if(r&&F(this,Wa,MC).call(this,a,r),i&&F(l=yr,YS,D$).call(l,a,i),s){const{classList:c}=a;for(const[u,h]of Object.entries(s))c.toggle(u,h)}if(o){const u=a.firstChild.firstChild;F(this,Wa,MC).call(this,u,o)}}}updateParent(e,t){if(t===this)return;const r=d(this,Pi).get(e);r&&(d(t,Vo).append(r),d(this,Pi).delete(e),d(t,Pi).set(e,r))}remove(e){d(this,Hh).delete(e),d(this,Vo)!==null&&(d(this,Pi).get(e).remove(),d(this,Pi).delete(e))}destroy(){R(this,Vo,null);for(const e of d(this,Pi).values())e.remove();d(this,Pi).clear(),d(this,Hh).clear()}};Vo=new WeakMap,Pi=new WeakMap,Hh=new WeakMap,T0=new WeakMap,YS=new WeakSet,D$=function(e,[t,r,i,s]){const{style:o}=e;o.top=`${100*r}%`,o.left=`${100*t}%`,o.width=`${100*i}%`,o.height=`${100*s}%`},Wa=new WeakSet,DC=function(){const e=yr._svgFactory.create(1,1,!0);return d(this,Vo).append(e),e.setAttribute("aria-hidden",!0),e},M$=function(e,t){const r=yr._svgFactory.createElement("clipPath");e.append(r);const i=`clip_${t}`;r.setAttribute("id",i),r.setAttribute("clipPathUnits","objectBoundingBox");const s=yr._svgFactory.createElement("use");return r.append(s),s.setAttribute("href",`#${t}`),s.classList.add("clip"),i},MC=function(e,t){for(const[r,i]of Object.entries(t))i===null?e.removeAttribute(r):e.setAttribute(r,i)},O(yr,YS),O(yr,T0,0);let TS=yr;globalThis._pdfjsTestingUtils={HighlightOutliner:uC};globalThis.pdfjsLib={AbortException:oc,AnnotationEditorLayer:AS,AnnotationEditorParamsType:Ot,AnnotationEditorType:mt,AnnotationEditorUIManager:Ku,AnnotationLayer:Sk,AnnotationMode:Da,AnnotationType:Jn,build:M5,ColorPicker:Kv,createValidAbsoluteUrl:uk,DOMSVGFactory:qv,DrawLayer:TS,FeatureTest:Ur,fetchData:Cg,getDocument:vk,getFilenameFromUrl:C3,getPdfFilenameFromUrl:P3,getUuid:hk,getXfaPageViewport:R3,GlobalWorkerOptions:Di,ImageKind:av,InvalidPDFException:vS,isDataScheme:Z0,isPdfFile:$A,isValidExplicitDest:u5,MathClamp:hi,noContextMenu:vo,normalizeUnicode:I3,OPS:jv,OutputScale:Qo,PasswordResponses:A3,PDFDataRangeTransport:wk,PDFDateString:jA,PDFWorker:ug,PermissionFlag:S3,PixelsPerInch:ac,RenderingCancelledException:BA,ResponseException:zv,setLayerDimensions:qu,shadow:Dt,SignatureExtractor:Ma,stopEvent:tr,SupportedImageMimeTypes:wS,TextLayer:Gv,TouchManager:Hv,updateUrlHash:dk,Util:Ke,VerbosityLevel:Q0,version:Ek,XfaLayer:bk};const jZ=Object.freeze(Object.defineProperty({__proto__:null,AbortException:oc,AnnotationEditorLayer:AS,AnnotationEditorParamsType:Ot,AnnotationEditorType:mt,AnnotationEditorUIManager:Ku,AnnotationLayer:Sk,AnnotationMode:Da,AnnotationType:Jn,ColorPicker:Kv,DOMSVGFactory:qv,DrawLayer:TS,FeatureTest:Ur,GlobalWorkerOptions:Di,ImageKind:av,InvalidPDFException:vS,MathClamp:hi,OPS:jv,OutputScale:Qo,PDFDataRangeTransport:wk,PDFDateString:jA,PDFWorker:ug,PasswordResponses:A3,PermissionFlag:S3,PixelsPerInch:ac,RenderingCancelledException:BA,ResponseException:zv,SignatureExtractor:Ma,SupportedImageMimeTypes:wS,TextLayer:Gv,TouchManager:Hv,Util:Ke,VerbosityLevel:Q0,XfaLayer:bk,build:M5,createValidAbsoluteUrl:uk,fetchData:Cg,getDocument:vk,getFilenameFromUrl:C3,getPdfFilenameFromUrl:P3,getUuid:hk,getXfaPageViewport:R3,isDataScheme:Z0,isPdfFile:$A,isValidExplicitDest:u5,noContextMenu:vo,normalizeUnicode:I3,setLayerDimensions:qu,shadow:Dt,stopEvent:tr,updateUrlHash:dk,version:Ek},Symbol.toStringTag,{value:"Module"}));var N$={exports:{}},GA={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zZ=D,HZ=Symbol.for("react.element"),GZ=Symbol.for("react.fragment"),WZ=Object.prototype.hasOwnProperty,qZ=zZ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,KZ={key:!0,ref:!0,__self:!0,__source:!0};function L$(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)WZ.call(e,r)&&!KZ.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:HZ,type:n,key:s,ref:o,props:i,_owner:qZ.current}}GA.Fragment=GZ;GA.jsx=L$;GA.jsxs=L$;N$.exports=GA;var Yn=N$.exports;function O$(n){var e,t,r="";if(typeof n=="string"||typeof n=="number")r+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(e=0;e<i;e++)n[e]&&(t=O$(n[e]))&&(r&&(r+=" "),r+=t)}else for(t in n)n[t]&&(r&&(r+=" "),r+=t);return r}function WA(){for(var n,e,t=0,r="",i=arguments.length;t<i;t++)(n=arguments[t])&&(e=O$(n))&&(r&&(r+=" "),r+=e);return r}var XN=Object.prototype.hasOwnProperty;function JN(n,e,t){for(t of n.keys())if(Dp(t,e))return t}function Dp(n,e){var t,r,i;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((r=n.length)===e.length)for(;r--&&Dp(n[r],e[r]););return r===-1}if(t===Set){if(n.size!==e.size)return!1;for(r of n)if(i=r,i&&typeof i=="object"&&(i=JN(e,i),!i)||!e.has(i))return!1;return!0}if(t===Map){if(n.size!==e.size)return!1;for(r of n)if(i=r[0],i&&typeof i=="object"&&(i=JN(e,i),!i)||!Dp(r[1],e.get(i)))return!1;return!0}if(t===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(t===DataView){if((r=n.byteLength)===e.byteLength)for(;r--&&n.getInt8(r)===e.getInt8(r););return r===-1}if(ArrayBuffer.isView(n)){if((r=n.byteLength)===e.byteLength)for(;r--&&n[r]===e[r];);return r===-1}if(!t||typeof n=="object"){r=0;for(t in n)if(XN.call(n,t)&&++r&&!XN.call(e,t)||!(t in e)||!Dp(n[t],e[t]))return!1;return Object.keys(e).length===r}}return n!==n&&e!==e}function rE(n){let e=!1;return{promise:new Promise((r,i)=>{n.then(s=>!e&&r(s)).catch(s=>!e&&i(s))}),cancel(){e=!0}}}const YZ=["onCopy","onCut","onPaste"],QZ=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],XZ=["onFocus","onBlur"],JZ=["onInput","onInvalid","onReset","onSubmit"],ZZ=["onLoad","onError"],eee=["onKeyDown","onKeyPress","onKeyUp"],tee=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],nee=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],ree=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],iee=["onSelect"],see=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],oee=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],aee=["onScroll"],lee=["onWheel"],cee=["onAnimationStart","onAnimationEnd","onAnimationIteration"],uee=["onTransitionEnd"],dee=["onToggle"],hee=["onChange"],fee=[...YZ,...QZ,...XZ,...JZ,...ZZ,...eee,...tee,...nee,...ree,...iee,...see,...oee,...aee,...lee,...cee,...uee,...hee,...dee];function F$(n,e){const t={};for(const r of fee){const i=n[r];i&&(e?t[r]=s=>i(s,e(r)):t[r]=i)}return t}var pee="Invariant failed";function En(n,e){if(!n)throw new Error(pee)}var mee=function(){},gee=mee;const yi=_g(gee),V$=D.createContext(null),yee="noopener noreferrer nofollow";class vee{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(e){this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setExternalLinkRel(e){this.externalLinkRel=e}setExternalLinkTarget(e){this.externalLinkTarget=e}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return En(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(e){En(this.pdfViewer),this.pdfViewer.currentPageNumber=e}get rotation(){return 0}set rotation(e){}goToDestination(e){return new Promise(t=>{En(this.pdfDocument),En(e),typeof e=="string"?this.pdfDocument.getDestination(e).then(t):Array.isArray(e)?t(e):e.then(t)}).then(t=>{En(Array.isArray(t));const r=t[0];new Promise(i=>{En(this.pdfDocument),r instanceof Object?this.pdfDocument.getPageIndex(r).then(s=>{i(s)}).catch(()=>{En(!1)}):typeof r=="number"?i(r):En(!1)}).then(i=>{const s=i+1;En(this.pdfViewer),En(s>=1&&s<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:t,pageIndex:i,pageNumber:s})})})}navigateTo(e){this.goToDestination(e)}goToPage(e){const t=e-1;En(this.pdfViewer),En(e>=1&&e<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:t,pageNumber:e})}addLinkAttributes(e,t,r){e.href=t,e.rel=this.externalLinkRel||yee,e.target=r?"_blank":this.externalLinkTarget||""}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}setHash(){}executeNamedAction(){}cachePageRef(){}isPageVisible(){return!0}isPageCached(){return!0}executeSetOCGState(){}}function Mp({children:n,type:e}){return Yn.jsx("div",{className:`react-pdf__message react-pdf__message--${e}`,children:n})}const ZN={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};function wee(n,e){switch(e.type){case"RESOLVE":return{value:e.value,error:void 0};case"REJECT":return{value:!1,error:e.error};case"RESET":return{value:void 0,error:void 0};default:return n}}function dg(){return D.useReducer(wee,{value:void 0,error:void 0})}const qA=typeof window<"u",U$=qA&&window.location.protocol==="file:";function Eee(n){return typeof n<"u"}function md(n){return Eee(n)&&n!==null}function bee(n){return typeof n=="string"}function _ee(n){return n instanceof ArrayBuffer}function See(n){return En(qA),n instanceof Blob}function NC(n){return bee(n)&&/^data:/.test(n)}function eL(n){En(NC(n));const[e="",t=""]=n.split(",");return e.split(";").indexOf("base64")!==-1?atob(t):unescape(t)}function Aee(){return qA&&window.devicePixelRatio||1}const B$="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function tL(){yi(!U$,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${B$}`)}function Tee(){yi(!U$,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${B$}`)}function pf(n){n!=null&&n.cancel&&n.cancel()}function LC(n,e){return Object.defineProperty(n,"width",{get(){return this.view[2]*e},configurable:!0}),Object.defineProperty(n,"height",{get(){return this.view[3]*e},configurable:!0}),Object.defineProperty(n,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(n,"originalHeight",{get(){return this.view[3]},configurable:!0}),n}function Iee(n){return n.name==="RenderingCancelledException"}function xee(n){return new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{if(!r.result)return t(new Error("Error while reading a file."));e(r.result)},r.onerror=i=>{if(!i.target)return t(new Error("Error while reading a file."));const{error:s}=i.target;if(!s)return t(new Error("Error while reading a file."));switch(s.code){case s.NOT_FOUND_ERR:return t(new Error("Error while reading a file: File not found."));case s.SECURITY_ERR:return t(new Error("Error while reading a file: Security error."));case s.ABORT_ERR:return t(new Error("Error while reading a file: Aborted."));default:return t(new Error("Error while reading a file."))}},r.readAsArrayBuffer(n)})}const{PDFDataRangeTransport:Cee}=jZ,Pee=(n,e)=>{switch(e){case ZN.NEED_PASSWORD:{const t=prompt("Enter the password to open this PDF file.");n(t);break}case ZN.INCORRECT_PASSWORD:{const t=prompt("Invalid password. Please try again.");n(t);break}}};function nL(n){return typeof n=="object"&&n!==null&&("data"in n||"range"in n||"url"in n)}const OC=D.forwardRef(function({children:e,className:t,error:r="Failed to load PDF file.",externalLinkRel:i,externalLinkTarget:s,file:o,inputRef:a,imageResourcesPath:l,loading:c="Loading PDFâ€¦",noData:u="No PDF file specified.",onItemClick:h,onLoadError:f,onLoadProgress:v,onLoadSuccess:w,onPassword:E=Pee,onSourceError:A,onSourceSuccess:T,options:_,renderMode:b,rotate:g,scale:y,...x},S){const[I,P]=dg(),{value:N,error:M}=I,[V,L]=dg(),{value:j,error:oe}=V,$=D.useRef(new vee),B=D.useRef([]),G=D.useRef(void 0),Z=D.useRef(void 0);o&&o!==G.current&&nL(o)&&(yi(!Dp(o,G.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),G.current=o),_&&_!==Z.current&&(yi(!Dp(_,Z.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),Z.current=_);const ee=D.useRef({scrollPageIntoView:Je=>{const{dest:dt,pageNumber:Ct,pageIndex:Ut=Ct-1}=Je;if(h){h({dest:dt,pageIndex:Ut,pageNumber:Ct});return}const Ir=B.current[Ut];if(Ir){Ir.scrollIntoView();return}yi(!1,`An internal link leading to page ${Ct} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});D.useImperativeHandle(S,()=>({linkService:$,pages:B,viewer:ee}),[]);function fe(){T&&T()}function ae(){M&&(yi(!1,M.toString()),A&&A(M))}function _e(){P({type:"RESET"})}D.useEffect(_e,[o,P]);const Qe=D.useCallback(async()=>{if(!o)return null;if(typeof o=="string")return NC(o)?{data:eL(o)}:(tL(),{url:o});if(o instanceof Cee)return{range:o};if(_ee(o))return{data:o};if(qA&&See(o))return{data:await xee(o)};if(En(typeof o=="object"),En(nL(o)),"url"in o&&typeof o.url=="string"){if(NC(o.url)){const{url:Je,...dt}=o;return{data:eL(Je),...dt}}tL()}return o},[o]);D.useEffect(()=>{const Je=rE(Qe());return Je.promise.then(dt=>{P({type:"RESOLVE",value:dt})}).catch(dt=>{P({type:"REJECT",error:dt})}),()=>{pf(Je)}},[Qe,P]),D.useEffect(()=>{if(!(typeof N>"u")){if(N===!1){ae();return}fe()}},[N]);function Ye(){j&&(w&&w(j),B.current=new Array(j.numPages),$.current.setDocument(j))}function gt(){oe&&(yi(!1,oe.toString()),f&&f(oe))}D.useEffect(function(){L({type:"RESET"})},[L,N]),D.useEffect(function(){if(!N)return;const dt=_?{...N,..._}:N,Ct=vk(dt);v&&(Ct.onProgress=v),E&&(Ct.onPassword=E);const Ut=Ct,Ir=Ut.promise.then(ue=>{L({type:"RESOLVE",value:ue})}).catch(ue=>{Ut.destroyed||L({type:"REJECT",error:ue})});return()=>{Ir.finally(()=>Ut.destroy())}},[_,L,N]),D.useEffect(()=>{if(!(typeof j>"u")){if(j===!1){gt();return}Ye()}},[j]),D.useEffect(function(){$.current.setViewer(ee.current),$.current.setExternalLinkRel(i),$.current.setExternalLinkTarget(s)},[i,s]);const ie=D.useCallback((Je,dt)=>{B.current[Je]=dt},[]),ot=D.useCallback(Je=>{delete B.current[Je]},[]),et=D.useMemo(()=>({imageResourcesPath:l,linkService:$.current,onItemClick:h,pdf:j,registerPage:ie,renderMode:b,rotate:g,scale:y,unregisterPage:ot}),[l,h,j,ie,b,g,y,ot]),ze=D.useMemo(()=>F$(x,()=>j),[x,j]);function tt(){function Je(Ct){return!!(Ct!=null&&Ct.pdf)}if(!Je(et))throw new Error("pdf is undefined");const dt=typeof e=="function"?e(et):e;return Yn.jsx(V$.Provider,{value:et,children:dt})}function Xe(){return o?j==null?Yn.jsx(Mp,{type:"loading",children:typeof c=="function"?c():c}):j===!1?Yn.jsx(Mp,{type:"error",children:typeof r=="function"?r():r}):tt():Yn.jsx(Mp,{type:"no-data",children:typeof u=="function"?u():u})}return Yn.jsx("div",{className:WA("react-pdf__Document",t),ref:a,...ze,children:Xe()})});function $$(){return D.useContext(V$)}function j$(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=n.filter(Boolean);if(t.length<=1){var r=t[0];return r||null}return function(s){for(var o=0,a=t;o<a.length;o++){var l=a[o];typeof l=="function"?l(s):l&&(l.current=s)}}}const z$=D.createContext(null);function KA(){return D.useContext(z$)}function Ree(){const n=$$(),e=KA();En(e);const t={...n,...e},{imageResourcesPath:r,linkService:i,onGetAnnotationsError:s,onGetAnnotationsSuccess:o,onRenderAnnotationLayerError:a,onRenderAnnotationLayerSuccess:l,page:c,pdf:u,renderForms:h,rotate:f,scale:v=1}=t;En(u),En(c),En(i);const[w,E]=dg(),{value:A,error:T}=w,_=D.useRef(null);yi(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function b(){A&&o&&o(A)}function g(){T&&(yi(!1,T.toString()),s&&s(T))}D.useEffect(function(){E({type:"RESET"})},[E,c]),D.useEffect(function(){if(!c)return;const P=rE(c.getAnnotations()),N=P;return P.promise.then(M=>{E({type:"RESOLVE",value:M})}).catch(M=>{E({type:"REJECT",error:M})}),()=>{pf(N)}},[E,c]),D.useEffect(()=>{if(A!==void 0){if(A===!1){g();return}b()}},[A]);function y(){l&&l()}function x(I){yi(!1,`${I}`),a&&a(I)}const S=D.useMemo(()=>c.getViewport({scale:v,rotation:f}),[c,f,v]);return D.useEffect(function(){if(!u||!c||!i||!A)return;const{current:P}=_;if(!P)return;const N=S.clone({dontFlip:!0}),M={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,div:P,l10n:null,page:c,structTreeLayer:null,viewport:N},V={annotations:A,annotationStorage:u.annotationStorage,div:P,imageResourcesPath:r,linkService:i,page:c,renderForms:h,viewport:N};P.innerHTML="";try{new Sk(M).render(V),y()}catch(L){x(L)}return()=>{}},[A,r,i,c,u,h,S]),Yn.jsx("div",{className:WA("react-pdf__Page__annotations","annotationLayer"),ref:_})}const H$={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},kee=/^H(\d+)$/;function Dee(n){return n in H$}function YA(n){return"children"in n}function G$(n){return YA(n)?n.children.length===1&&0 in n.children&&"id"in n.children[0]:!1}function Mee(n){const e={};if(YA(n)){const{role:t}=n,r=t.match(kee);if(r)e.role="heading",e["aria-level"]=Number(r[1]);else if(Dee(t)){const i=H$[t];i&&(e.role=i)}}return e}function W$(n){const e={};if(YA(n)){if(n.alt!==void 0&&(e["aria-label"]=n.alt),n.lang!==void 0&&(e.lang=n.lang),G$(n)){const[t]=n.children;if(t){const r=W$(t);return{...e,...r}}}}else"id"in n&&(e["aria-owns"]=n.id);return e}function Nee(n){return n?{...Mee(n),...W$(n)}:null}function q$({className:n,node:e}){const t=D.useMemo(()=>Nee(e),[e]),r=D.useMemo(()=>!YA(e)||G$(e)?null:e.children.map((i,s)=>Yn.jsx(q$,{node:i},s)),[e]);return Yn.jsx("span",{className:n,...t,children:r})}function Lee(){const n=KA();En(n);const{onGetStructTreeError:e,onGetStructTreeSuccess:t}=n,[r,i]=dg(),{value:s,error:o}=r,{customTextRenderer:a,page:l}=n;function c(){s&&t&&t(s)}function u(){o&&(yi(!1,o.toString()),e&&e(o))}return D.useEffect(function(){i({type:"RESET"})},[i,l]),D.useEffect(function(){if(a||!l)return;const f=rE(l.getStructTree()),v=f;return f.promise.then(w=>{i({type:"RESOLVE",value:w})}).catch(w=>{i({type:"REJECT",error:w})}),()=>pf(v)},[a,l,i]),D.useEffect(()=>{if(s!==void 0){if(s===!1){u();return}c()}},[s]),s?Yn.jsx(q$,{className:"react-pdf__Page__structTree structTree",node:s}):null}const rL=Da;function Oee(n){const e=KA();En(e);const t={...e,...n},{_className:r,canvasBackground:i,devicePixelRatio:s=Aee(),onRenderError:o,onRenderSuccess:a,page:l,renderForms:c,renderTextLayer:u,rotate:h,scale:f}=t,{canvasRef:v}=n;En(l);const w=D.useRef(null);function E(){l&&a&&a(LC(l,f))}function A(g){Iee(g)||(yi(!1,g.toString()),o&&o(g))}const T=D.useMemo(()=>l.getViewport({scale:f*s,rotation:h}),[s,l,h,f]),_=D.useMemo(()=>l.getViewport({scale:f,rotation:h}),[l,h,f]);D.useEffect(function(){if(!l)return;l.cleanup();const{current:y}=w;if(!y)return;y.width=T.width,y.height=T.height,y.style.width=`${Math.floor(_.width)}px`,y.style.height=`${Math.floor(_.height)}px`,y.style.visibility="hidden";const x={annotationMode:c?rL.ENABLE_FORMS:rL.ENABLE,canvasContext:y.getContext("2d",{alpha:!1}),viewport:T};i&&(x.background=i);const S=l.render(x),I=S;return S.promise.then(()=>{y.style.visibility="",E()}).catch(A),()=>pf(I)},[i,l,c,T,_]);const b=D.useCallback(()=>{const{current:g}=w;g&&(g.width=0,g.height=0)},[]);return D.useEffect(()=>b,[b]),Yn.jsx("canvas",{className:`${r}__canvas`,dir:"ltr",ref:j$(v,w),style:{display:"block",userSelect:"none"},children:u?Yn.jsx(Lee,{}):null})}function Fee(n){return"str"in n}function Vee(){const n=KA();En(n);const{customTextRenderer:e,onGetTextError:t,onGetTextSuccess:r,onRenderTextLayerError:i,onRenderTextLayerSuccess:s,page:o,pageIndex:a,pageNumber:l,rotate:c,scale:u}=n;En(o);const[h,f]=dg(),{value:v,error:w}=h,E=D.useRef(null);yi(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function A(){v&&r&&r(v)}function T(){w&&(yi(!1,w.toString()),t&&t(w))}D.useEffect(function(){f({type:"RESET"})},[o,f]),D.useEffect(function(){if(!o)return;const I=rE(o.getTextContent()),P=I;return I.promise.then(N=>{f({type:"RESOLVE",value:N})}).catch(N=>{f({type:"REJECT",error:N})}),()=>pf(P)},[o,f]),D.useEffect(()=>{if(v!==void 0){if(v===!1){T();return}A()}},[v]);const _=D.useCallback(()=>{s&&s()},[s]),b=D.useCallback(S=>{yi(!1,S.toString()),i&&i(S)},[i]);function g(){const S=E.current;S&&S.classList.add("selecting")}function y(){const S=E.current;S&&S.classList.remove("selecting")}const x=D.useMemo(()=>o.getViewport({scale:u,rotation:c}),[o,c,u]);return D.useLayoutEffect(function(){if(!o||!v)return;const{current:I}=E;if(!I)return;I.innerHTML="";const P=o.streamTextContent({includeMarkedContent:!0}),N={container:I,textContentSource:P,viewport:x},M=new Gv(N),V=M;return M.render().then(()=>{const L=document.createElement("div");L.className="endOfContent",I.append(L);const j=I.querySelectorAll('[role="presentation"]');if(e){let oe=0;v.items.forEach(($,B)=>{if(!Fee($))return;const G=j[oe];if(!G)return;const Z=e({pageIndex:a,pageNumber:l,itemIndex:B,...$});G.innerHTML=Z,oe+=$.str&&$.hasEOL?2:1})}_()}).catch(b),()=>pf(V)},[e,b,_,o,a,l,v,x]),Yn.jsx("div",{className:WA("react-pdf__Page__textContent","textLayer"),onMouseUp:y,onMouseDown:g,ref:E})}const iL=1;function FC(n){const t={...$$(),...n},{_className:r="react-pdf__Page",_enableRegisterUnregisterPage:i=!0,canvasBackground:s,canvasRef:o,children:a,className:l,customRenderer:c,customTextRenderer:u,devicePixelRatio:h,error:f="Failed to load the page.",height:v,inputRef:w,loading:E="Loading pageâ€¦",noData:A="No page specified.",onGetAnnotationsError:T,onGetAnnotationsSuccess:_,onGetStructTreeError:b,onGetStructTreeSuccess:g,onGetTextError:y,onGetTextSuccess:x,onLoadError:S,onLoadSuccess:I,onRenderAnnotationLayerError:P,onRenderAnnotationLayerSuccess:N,onRenderError:M,onRenderSuccess:V,onRenderTextLayerError:L,onRenderTextLayerSuccess:j,pageIndex:oe,pageNumber:$,pdf:B,registerPage:G,renderAnnotationLayer:Z=!0,renderForms:ee=!1,renderMode:fe="canvas",renderTextLayer:ae=!0,rotate:_e,scale:Qe=iL,unregisterPage:Ye,width:gt,...ie}=t,[ot,et]=dg(),{value:ze,error:tt}=ot,Xe=D.useRef(null);En(B);const Je=md($)?$-1:oe??null,dt=$??(md(oe)?oe+1:null),Ct=_e??(ze?ze.rotate:null),Ut=D.useMemo(()=>{if(!ze)return null;let z=1;const le=Qe??iL;if(gt||v){const te=ze.getViewport({scale:1,rotation:Ct});gt?z=gt/te.width:v&&(z=v/te.height)}return le*z},[v,ze,Ct,Qe,gt]);D.useEffect(function(){return()=>{md(Je)&&i&&Ye&&Ye(Je)}},[i,B,Je,Ye]);function Ir(){if(I){if(!ze||!Ut)return;I(LC(ze,Ut))}if(i&&G){if(!md(Je)||!Xe.current)return;G(Je,Xe.current)}}function ue(){tt&&(yi(!1,tt.toString()),S&&S(tt))}D.useEffect(function(){et({type:"RESET"})},[et,B,Je]),D.useEffect(function(){if(!B||!dt)return;const le=rE(B.getPage(dt)),te=le;return le.promise.then(Ee=>{et({type:"RESOLVE",value:Ee})}).catch(Ee=>{et({type:"REJECT",error:Ee})}),()=>pf(te)},[et,B,dt]),D.useEffect(()=>{if(ze!==void 0){if(ze===!1){ue();return}Ir()}},[ze,Ut]);const ye=D.useMemo(()=>md(Je)&&dt&&md(Ct)&&md(Ut)?{_className:r,canvasBackground:s,customTextRenderer:u,devicePixelRatio:h,onGetAnnotationsError:T,onGetAnnotationsSuccess:_,onGetStructTreeError:b,onGetStructTreeSuccess:g,onGetTextError:y,onGetTextSuccess:x,onRenderAnnotationLayerError:P,onRenderAnnotationLayerSuccess:N,onRenderError:M,onRenderSuccess:V,onRenderTextLayerError:L,onRenderTextLayerSuccess:j,page:ze,pageIndex:Je,pageNumber:dt,renderForms:ee,renderTextLayer:ae,rotate:Ct,scale:Ut}:null,[r,s,u,h,T,_,b,g,y,x,P,N,M,V,L,j,ze,Je,dt,ee,ae,Ct,Ut]),De=D.useMemo(()=>F$(ie,()=>ze&&(Ut?LC(ze,Ut):void 0)),[ie,ze,Ut]),Tt=`${Je}@${Ut}/${Ct}`;function Se(){switch(fe){case"custom":return En(c),Yn.jsx(c,{},`${Tt}_custom`);case"none":return null;case"canvas":default:return Yn.jsx(Oee,{canvasRef:o},`${Tt}_canvas`)}}function Be(){return ae?Yn.jsx(Vee,{},`${Tt}_text`):null}function kt(){return Z?Yn.jsx(Ree,{},`${Tt}_annotations`):null}function Bt(){function z(te){return!!(te!=null&&te.page)}if(!z(ye))throw new Error("page is undefined");const le=typeof a=="function"?a(ye):a;return Yn.jsxs(z$.Provider,{value:ye,children:[Se(),Be(),kt(),le]})}function W(){return dt?B===null||ze===void 0||ze===null?Yn.jsx(Mp,{type:"loading",children:typeof E=="function"?E():E}):B===!1||ze===!1?Yn.jsx(Mp,{type:"error",children:typeof f=="function"?f():f}):Bt():Yn.jsx(Mp,{type:"no-data",children:typeof A=="function"?A():A})}return Yn.jsx("div",{className:WA(r,l),"data-page-number":dt,ref:j$(w,Xe),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${Ut}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:s||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...De,children:W()})}Tee();Di.workerSrc="pdf.worker.mjs";Di.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${Ek}/pdf.worker.min.js`;try{Di.workerSrc||(Di.workerSrc=new URL("/assets/pdf.worker.min-r-TJsTTt.mjs",import.meta.url).toString())}catch{}function Uee(){const{nivel:n}=RX(),[e,t]=ck(),r=e.get("asig")||"",i=e.get("u")||"",[s,o]=D.useState([]),[a,l]=D.useState(r),[c,u]=D.useState(i),[h,f]=D.useState(""),[v,w]=D.useState(null);D.useEffect(()=>{let _=!1;return(async()=>{const g=Bo(tn(X,"mineduc_pdfs"),fi("nivel","==",n)),y=await $n(g);if(_)return;const x=y.docs.map(S=>({id:S.id,...S.data()}));o(x)})(),()=>{_=!0}},[n]),D.useEffect(()=>{l(e.get("asig")||""),u(e.get("u")||"")},[n,e]);const E=D.useMemo(()=>Array.from(new Set(s.map(_=>_.asignatura))).sort(),[s]),A=D.useMemo(()=>{const _=s.filter(b=>a?b.asignatura===a:!0).map(b=>b.unidad).filter(Boolean);return Array.from(new Set(_))},[s,a]),T=D.useCallback(()=>{if(!s.length)return;const _=s[0];l(b=>b||_.asignatura||""),u(b=>b||_.unidad||"")},[s]);return D.useEffect(()=>{(!a||!c)&&T()},[a,c,T]),D.useEffect(()=>{if(!a){f(""),t(b=>{const g=new URLSearchParams(b);return g.delete("asig"),g.delete("u"),g},{replace:!0});return}t(b=>{const g=new URLSearchParams(b);return g.set("asig",a),c?g.set("u",c):g.delete("u"),g},{replace:!0});const _=s.find(b=>b.asignatura===a&&(c?b.unidad===c:!0))||s.find(b=>b.asignatura===a)||null;f(_?_.url:"")},[a,c,s,t]),m.createElement("div",{className:"w-full min-h-screen p-4"},m.createElement("header",{className:"mb-3 flex flex-wrap items-center gap-2"},m.createElement("h1",{className:"text-xl font-bold mr-4"},n," Â· Programas MINEDUC"),m.createElement("select",{value:a,onChange:_=>{l(_.target.value),u("")},className:"border rounded px-2 py-1"},m.createElement("option",{value:""},"Selecciona asignatura"),E.map(_=>m.createElement("option",{key:_,value:_},_))),m.createElement("select",{value:c,onChange:_=>u(_.target.value),className:"border rounded px-2 py-1",disabled:!a},m.createElement("option",{value:""},"(Todas las unidades)"),A.map(_=>m.createElement("option",{key:_,value:_},_))),h?m.createElement("a",{href:h,target:"_blank",rel:"noreferrer",className:"ml-auto text-sm underline text-blue-700",title:"Abrir PDF en pestaÃ±a nueva"},"Abrir PDF â†—"):null),h?m.createElement(Bee,{url:h,onNumPages:w}):m.createElement("p",{className:"text-sm text-slate-600"},"Selecciona una asignatura/unidadâ€¦"))}function Bee({url:n,onNumPages:e}){const[t,r]=D.useState(null),i=({numPages:s})=>{r(s),typeof e=="function"&&e(s)};return m.createElement("div",{className:"flex flex-col gap-3"},m.createElement(OC,{file:n,onLoadSuccess:i,loading:m.createElement(sL,null),onLoadError:s=>console.error("PDF load error:",s)},t?m.createElement(b3,{width:800,height:1e3,className:"shadow-lg"},Array.from({length:t}).map((s,o)=>m.createElement("div",{key:`page-${o}`,className:"bg-white p-2"},m.createElement(FC,{pageNumber:o+1,renderTextLayer:!1,renderAnnotationLayer:!1})))):m.createElement(sL,null)))}function sL(){return m.createElement("div",{className:"text-sm text-slate-500"},"Cargando documentoâ€¦")}var QA={},K$={exports:{}},$ee="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",jee=$ee,zee=jee;function Y$(){}function Q$(){}Q$.resetWarningCache=Y$;var Hee=function(){function n(r,i,s,o,a,l){if(l!==zee){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Q$,resetWarningCache:Y$};return t.PropTypes=t,t};K$.exports=Hee();var Ik=K$.exports;const jt=_g(Ik);var X$={L:1,M:0,Q:3,H:2},J$={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},Gee=J$;function Z$(n){this.mode=Gee.MODE_8BIT_BYTE,this.data=n}Z$.prototype={getLength:function(n){return this.data.length},write:function(n){for(var e=0;e<this.data.length;e++)n.put(this.data.charCodeAt(e),8)}};var Wee=Z$,XE=X$;function Na(n,e){this.totalCount=n,this.dataCount=e}Na.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];Na.getRSBlocks=function(n,e){var t=Na.getRsBlockTable(n,e);if(t==null)throw new Error("bad rs block @ typeNumber:"+n+"/errorCorrectLevel:"+e);for(var r=t.length/3,i=new Array,s=0;s<r;s++)for(var o=t[s*3+0],a=t[s*3+1],l=t[s*3+2],c=0;c<o;c++)i.push(new Na(a,l));return i};Na.getRsBlockTable=function(n,e){switch(e){case XE.L:return Na.RS_BLOCK_TABLE[(n-1)*4+0];case XE.M:return Na.RS_BLOCK_TABLE[(n-1)*4+1];case XE.Q:return Na.RS_BLOCK_TABLE[(n-1)*4+2];case XE.H:return Na.RS_BLOCK_TABLE[(n-1)*4+3];default:return}};var qee=Na;function ej(){this.buffer=new Array,this.length=0}ej.prototype={get:function(n){var e=Math.floor(n/8);return(this.buffer[e]>>>7-n%8&1)==1},put:function(n,e){for(var t=0;t<e;t++)this.putBit((n>>>e-t-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(n){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),n&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var Kee=ej,jo={glog:function(n){if(n<1)throw new Error("glog("+n+")");return jo.LOG_TABLE[n]},gexp:function(n){for(;n<0;)n+=255;for(;n>=256;)n-=255;return jo.EXP_TABLE[n]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var Jr=0;Jr<8;Jr++)jo.EXP_TABLE[Jr]=1<<Jr;for(var Jr=8;Jr<256;Jr++)jo.EXP_TABLE[Jr]=jo.EXP_TABLE[Jr-4]^jo.EXP_TABLE[Jr-5]^jo.EXP_TABLE[Jr-6]^jo.EXP_TABLE[Jr-8];for(var Jr=0;Jr<255;Jr++)jo.LOG_TABLE[jo.EXP_TABLE[Jr]]=Jr;var tj=jo,gd=tj;function f_(n,e){if(n.length==null)throw new Error(n.length+"/"+e);for(var t=0;t<n.length&&n[t]==0;)t++;this.num=new Array(n.length-t+e);for(var r=0;r<n.length-t;r++)this.num[r]=n[r+t]}f_.prototype={get:function(n){return this.num[n]},getLength:function(){return this.num.length},multiply:function(n){for(var e=new Array(this.getLength()+n.getLength()-1),t=0;t<this.getLength();t++)for(var r=0;r<n.getLength();r++)e[t+r]^=gd.gexp(gd.glog(this.get(t))+gd.glog(n.get(r)));return new f_(e,0)},mod:function(n){if(this.getLength()-n.getLength()<0)return this;for(var e=gd.glog(this.get(0))-gd.glog(n.get(0)),t=new Array(this.getLength()),r=0;r<this.getLength();r++)t[r]=this.get(r);for(var r=0;r<n.getLength();r++)t[r]^=gd.gexp(gd.glog(n.get(r))+e);return new f_(t,0).mod(n)}};var nj=f_,Xs=J$,oL=nj,Yee=tj,Ec={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},jr={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(n){for(var e=n<<10;jr.getBCHDigit(e)-jr.getBCHDigit(jr.G15)>=0;)e^=jr.G15<<jr.getBCHDigit(e)-jr.getBCHDigit(jr.G15);return(n<<10|e)^jr.G15_MASK},getBCHTypeNumber:function(n){for(var e=n<<12;jr.getBCHDigit(e)-jr.getBCHDigit(jr.G18)>=0;)e^=jr.G18<<jr.getBCHDigit(e)-jr.getBCHDigit(jr.G18);return n<<12|e},getBCHDigit:function(n){for(var e=0;n!=0;)e++,n>>>=1;return e},getPatternPosition:function(n){return jr.PATTERN_POSITION_TABLE[n-1]},getMask:function(n,e,t){switch(n){case Ec.PATTERN000:return(e+t)%2==0;case Ec.PATTERN001:return e%2==0;case Ec.PATTERN010:return t%3==0;case Ec.PATTERN011:return(e+t)%3==0;case Ec.PATTERN100:return(Math.floor(e/2)+Math.floor(t/3))%2==0;case Ec.PATTERN101:return e*t%2+e*t%3==0;case Ec.PATTERN110:return(e*t%2+e*t%3)%2==0;case Ec.PATTERN111:return(e*t%3+(e+t)%2)%2==0;default:throw new Error("bad maskPattern:"+n)}},getErrorCorrectPolynomial:function(n){for(var e=new oL([1],0),t=0;t<n;t++)e=e.multiply(new oL([1,Yee.gexp(t)],0));return e},getLengthInBits:function(n,e){if(1<=e&&e<10)switch(n){case Xs.MODE_NUMBER:return 10;case Xs.MODE_ALPHA_NUM:return 9;case Xs.MODE_8BIT_BYTE:return 8;case Xs.MODE_KANJI:return 8;default:throw new Error("mode:"+n)}else if(e<27)switch(n){case Xs.MODE_NUMBER:return 12;case Xs.MODE_ALPHA_NUM:return 11;case Xs.MODE_8BIT_BYTE:return 16;case Xs.MODE_KANJI:return 10;default:throw new Error("mode:"+n)}else if(e<41)switch(n){case Xs.MODE_NUMBER:return 14;case Xs.MODE_ALPHA_NUM:return 13;case Xs.MODE_8BIT_BYTE:return 16;case Xs.MODE_KANJI:return 12;default:throw new Error("mode:"+n)}else throw new Error("type:"+e)},getLostPoint:function(n){for(var e=n.getModuleCount(),t=0,r=0;r<e;r++)for(var i=0;i<e;i++){for(var s=0,o=n.isDark(r,i),a=-1;a<=1;a++)if(!(r+a<0||e<=r+a))for(var l=-1;l<=1;l++)i+l<0||e<=i+l||a==0&&l==0||o==n.isDark(r+a,i+l)&&s++;s>5&&(t+=3+s-5)}for(var r=0;r<e-1;r++)for(var i=0;i<e-1;i++){var c=0;n.isDark(r,i)&&c++,n.isDark(r+1,i)&&c++,n.isDark(r,i+1)&&c++,n.isDark(r+1,i+1)&&c++,(c==0||c==4)&&(t+=3)}for(var r=0;r<e;r++)for(var i=0;i<e-6;i++)n.isDark(r,i)&&!n.isDark(r,i+1)&&n.isDark(r,i+2)&&n.isDark(r,i+3)&&n.isDark(r,i+4)&&!n.isDark(r,i+5)&&n.isDark(r,i+6)&&(t+=40);for(var i=0;i<e;i++)for(var r=0;r<e-6;r++)n.isDark(r,i)&&!n.isDark(r+1,i)&&n.isDark(r+2,i)&&n.isDark(r+3,i)&&n.isDark(r+4,i)&&!n.isDark(r+5,i)&&n.isDark(r+6,i)&&(t+=40);for(var u=0,i=0;i<e;i++)for(var r=0;r<e;r++)n.isDark(r,i)&&u++;var h=Math.abs(100*u/e/e-50)/5;return t+=h*10,t}},Qee=jr,Xee=Wee,rj=qee,ij=Kee,ad=Qee,Jee=nj;function Fa(n,e){this.typeNumber=n,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}var Gs=Fa.prototype;Gs.addData=function(n){var e=new Xee(n);this.dataList.push(e),this.dataCache=null};Gs.isDark=function(n,e){if(n<0||this.moduleCount<=n||e<0||this.moduleCount<=e)throw new Error(n+","+e);return this.modules[n][e]};Gs.getModuleCount=function(){return this.moduleCount};Gs.make=function(){if(this.typeNumber<1){var n=1;for(n=1;n<40;n++){for(var e=rj.getRSBlocks(n,this.errorCorrectLevel),t=new ij,r=0,i=0;i<e.length;i++)r+=e[i].dataCount;for(var i=0;i<this.dataList.length;i++){var s=this.dataList[i];t.put(s.mode,4),t.put(s.getLength(),ad.getLengthInBits(s.mode,n)),s.write(t)}if(t.getLengthInBits()<=r*8)break}this.typeNumber=n}this.makeImpl(!1,this.getBestMaskPattern())};Gs.makeImpl=function(n,e){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var t=0;t<this.moduleCount;t++){this.modules[t]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[t][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(n,e),this.typeNumber>=7&&this.setupTypeNumber(n),this.dataCache==null&&(this.dataCache=Fa.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,e)};Gs.setupPositionProbePattern=function(n,e){for(var t=-1;t<=7;t++)if(!(n+t<=-1||this.moduleCount<=n+t))for(var r=-1;r<=7;r++)e+r<=-1||this.moduleCount<=e+r||(0<=t&&t<=6&&(r==0||r==6)||0<=r&&r<=6&&(t==0||t==6)||2<=t&&t<=4&&2<=r&&r<=4?this.modules[n+t][e+r]=!0:this.modules[n+t][e+r]=!1)};Gs.getBestMaskPattern=function(){for(var n=0,e=0,t=0;t<8;t++){this.makeImpl(!0,t);var r=ad.getLostPoint(this);(t==0||n>r)&&(n=r,e=t)}return e};Gs.createMovieClip=function(n,e,t){var r=n.createEmptyMovieClip(e,t),i=1;this.make();for(var s=0;s<this.modules.length;s++)for(var o=s*i,a=0;a<this.modules[s].length;a++){var l=a*i,c=this.modules[s][a];c&&(r.beginFill(0,100),r.moveTo(l,o),r.lineTo(l+i,o),r.lineTo(l+i,o+i),r.lineTo(l,o+i),r.endFill())}return r};Gs.setupTimingPattern=function(){for(var n=8;n<this.moduleCount-8;n++)this.modules[n][6]==null&&(this.modules[n][6]=n%2==0);for(var e=8;e<this.moduleCount-8;e++)this.modules[6][e]==null&&(this.modules[6][e]=e%2==0)};Gs.setupPositionAdjustPattern=function(){for(var n=ad.getPatternPosition(this.typeNumber),e=0;e<n.length;e++)for(var t=0;t<n.length;t++){var r=n[e],i=n[t];if(this.modules[r][i]==null)for(var s=-2;s<=2;s++)for(var o=-2;o<=2;o++)s==-2||s==2||o==-2||o==2||s==0&&o==0?this.modules[r+s][i+o]=!0:this.modules[r+s][i+o]=!1}};Gs.setupTypeNumber=function(n){for(var e=ad.getBCHTypeNumber(this.typeNumber),t=0;t<18;t++){var r=!n&&(e>>t&1)==1;this.modules[Math.floor(t/3)][t%3+this.moduleCount-8-3]=r}for(var t=0;t<18;t++){var r=!n&&(e>>t&1)==1;this.modules[t%3+this.moduleCount-8-3][Math.floor(t/3)]=r}};Gs.setupTypeInfo=function(n,e){for(var t=this.errorCorrectLevel<<3|e,r=ad.getBCHTypeInfo(t),i=0;i<15;i++){var s=!n&&(r>>i&1)==1;i<6?this.modules[i][8]=s:i<8?this.modules[i+1][8]=s:this.modules[this.moduleCount-15+i][8]=s}for(var i=0;i<15;i++){var s=!n&&(r>>i&1)==1;i<8?this.modules[8][this.moduleCount-i-1]=s:i<9?this.modules[8][15-i-1+1]=s:this.modules[8][15-i-1]=s}this.modules[this.moduleCount-8][8]=!n};Gs.mapData=function(n,e){for(var t=-1,r=this.moduleCount-1,i=7,s=0,o=this.moduleCount-1;o>0;o-=2)for(o==6&&o--;;){for(var a=0;a<2;a++)if(this.modules[r][o-a]==null){var l=!1;s<n.length&&(l=(n[s]>>>i&1)==1);var c=ad.getMask(e,r,o-a);c&&(l=!l),this.modules[r][o-a]=l,i--,i==-1&&(s++,i=7)}if(r+=t,r<0||this.moduleCount<=r){r-=t,t=-t;break}}};Fa.PAD0=236;Fa.PAD1=17;Fa.createData=function(n,e,t){for(var r=rj.getRSBlocks(n,e),i=new ij,s=0;s<t.length;s++){var o=t[s];i.put(o.mode,4),i.put(o.getLength(),ad.getLengthInBits(o.mode,n)),o.write(i)}for(var a=0,s=0;s<r.length;s++)a+=r[s].dataCount;if(i.getLengthInBits()>a*8)throw new Error("code length overflow. ("+i.getLengthInBits()+">"+a*8+")");for(i.getLengthInBits()+4<=a*8&&i.put(0,4);i.getLengthInBits()%8!=0;)i.putBit(!1);for(;!(i.getLengthInBits()>=a*8||(i.put(Fa.PAD0,8),i.getLengthInBits()>=a*8));)i.put(Fa.PAD1,8);return Fa.createBytes(i,r)};Fa.createBytes=function(n,e){for(var t=0,r=0,i=0,s=new Array(e.length),o=new Array(e.length),a=0;a<e.length;a++){var l=e[a].dataCount,c=e[a].totalCount-l;r=Math.max(r,l),i=Math.max(i,c),s[a]=new Array(l);for(var u=0;u<s[a].length;u++)s[a][u]=255&n.buffer[u+t];t+=l;var h=ad.getErrorCorrectPolynomial(c),f=new Jee(s[a],h.getLength()-1),v=f.mod(h);o[a]=new Array(h.getLength()-1);for(var u=0;u<o[a].length;u++){var w=u+v.getLength()-o[a].length;o[a][u]=w>=0?v.get(w):0}}for(var E=0,u=0;u<e.length;u++)E+=e[u].totalCount;for(var A=new Array(E),T=0,u=0;u<r;u++)for(var a=0;a<e.length;a++)u<s[a].length&&(A[T++]=s[a][u]);for(var u=0;u<i;u++)for(var a=0;a<e.length;a++)u<o[a].length&&(A[T++]=o[a][u]);return A};var Zee=Fa,xk={};Object.defineProperty(xk,"__esModule",{value:!0});var ete=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},tte=Ik,Js=oj(tte),sj=D,JE=oj(sj);function oj(n){return n&&n.__esModule?n:{default:n}}function nte(n,e){var t={};for(var r in n)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}var rte={bgColor:Js.default.oneOfType([Js.default.object,Js.default.string]).isRequired,bgD:Js.default.string.isRequired,fgColor:Js.default.oneOfType([Js.default.object,Js.default.string]).isRequired,fgD:Js.default.string.isRequired,size:Js.default.number.isRequired,title:Js.default.string,viewBoxSize:Js.default.number.isRequired,xmlns:Js.default.string},Ck=(0,sj.forwardRef)(function(n,e){var t=n.bgColor,r=n.bgD,i=n.fgD,s=n.fgColor,o=n.size,a=n.title,l=n.viewBoxSize,c=n.xmlns,u=c===void 0?"http://www.w3.org/2000/svg":c,h=nte(n,["bgColor","bgD","fgD","fgColor","size","title","viewBoxSize","xmlns"]);return JE.default.createElement("svg",ete({},h,{height:o,ref:e,viewBox:"0 0 "+l+" "+l,width:o,xmlns:u}),a?JE.default.createElement("title",null,a):null,JE.default.createElement("path",{d:r,fill:t}),JE.default.createElement("path",{d:i,fill:s}))});Ck.displayName="QRCodeSvg";Ck.propTypes=rte;xk.default=Ck;Object.defineProperty(QA,"__esModule",{value:!0});QA.QRCode=void 0;var ite=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ste=Ik,Ja=iE(ste),ote=X$,ate=iE(ote),lte=Zee,cte=iE(lte),aj=D,ute=iE(aj),dte=xk,hte=iE(dte);function iE(n){return n&&n.__esModule?n:{default:n}}function fte(n,e){var t={};for(var r in n)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}var pte={bgColor:Ja.default.oneOfType([Ja.default.object,Ja.default.string]),fgColor:Ja.default.oneOfType([Ja.default.object,Ja.default.string]),level:Ja.default.string,size:Ja.default.number,value:Ja.default.string.isRequired},XA=(0,aj.forwardRef)(function(n,e){var t=n.bgColor,r=t===void 0?"#FFFFFF":t,i=n.fgColor,s=i===void 0?"#000000":i,o=n.level,a=o===void 0?"L":o,l=n.size,c=l===void 0?256:l,u=n.value,h=fte(n,["bgColor","fgColor","level","size","value"]),f=new cte.default(-1,ate.default[a]);f.addData(u),f.make();var v=f.modules;return ute.default.createElement(hte.default,ite({},h,{bgColor:r,bgD:v.map(function(w,E){return w.map(function(A,T){return A?"":"M "+T+" "+E+" l 1 0 0 1 -1 0 Z"}).join(" ")}).join(" "),fgColor:s,fgD:v.map(function(w,E){return w.map(function(A,T){return A?"M "+T+" "+E+" l 1 0 0 1 -1 0 Z":""}).join(" ")}).join(" "),ref:e,size:c,viewBoxSize:v.length}))});QA.QRCode=XA;XA.displayName="QRCode";XA.propTypes=pte;var lj=QA.default=XA,JA={};function cj(n,e){e=e||{};var t=e.preserveNumbers,r=function(s){return s.trim()},i={};return gte(n).map(r).filter(Boolean).forEach(function(s){var o=s.indexOf(":"),a=s.substr(0,o).trim(),l=s.substr(o+1).trim();t&&mte(l)&&(l=Number(l)),i[a]=l}),i}function mte(n){return!isNaN(parseFloat(n))&&isFinite(n)}function gte(n){for(var e=[],t=0,r=";",i=/url\([^\)]+$/,s="",o;t<n.length;){if(o=n.indexOf(r,t),o===-1&&(o=n.length),s+=n.substring(t,o),i.test(s)){s+=";",t=o+1;continue}e.push(s),s="",t=o+1}return e}function uj(n){return Object.keys(n).map(function(e){return e+":"+n[e]}).join(";")}function yte(n,e){return uj(cj(n,e))}JA.parse=cj;JA.stringify=uj;JA.normalize=yte;var dj={exports:{}},vte=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,wte=/^(?:button|input|object|select|textarea)$/i,Ete=/^a(?:rea)?$/i,bte=/:|^on/,hj={},Pk,$l={tabindex:{get:function(n){var e=n.getAttributeNode("tabindex");return e&&e.specified?parseInt(e.value,10):wte.test(n.nodeName)||Ete.test(n.nodeName)&&n.href?0:void 0}}},_te={get:function(n,e){return n[Pk[e]||e]?e.toLowerCase():void 0}},IS={};$l.style={get:function(n){return n.style.cssText}};Pk={hidefocus:"hideFocus",tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"};var Ste=typeof navigator<"u"?navigator.userAgent:"",Yv=typeof document<"u"?document:{};function Ate(n){var e=0;return parseFloat(n.replace(/\./g,function(){return e++===0?".":""}))}function Tte(){var n,e;if((n=Ste.match(/MSIE ([^;]*)|Trident.*; rv(?:\s|:)?([0-9.]+)/))&&(e=n[1]||n[2]))return Yv.documentMode||Ate(e)}function aL(n,e){for(var t in e)n[t]=e[t]}function Ite(n,e){for(var t=0,r=n.length;t<r&&e(n[t],t)!==!1;t++);}var Qv=Tte();Qv&&Qv<8&&($l.style.set=function(n,e){n.style.cssText=e},aL(IS,{get:function(n,e){var t=n.getAttributeNode(e);return t&&(t.specified||t.nodeValue)?t.nodeValue:void 0}}),aL(hj,Pk),$l.tabIndex=$l.tabindex,Ite(["href","src","width","height","colSpan","rowSpan"],function(n){$l[n]={get:function(e){var t=e.getAttribute(n,2);return t===null?void 0:t}}}),$l.placeholder={get:function(n,e){return n[e]||IS.get(n,e)}});if(Qv){var xte=$l.href=$l.href||{};xte.set=function(n,e,t){var r=n.childNodes,i,s=r.length,o=s>0;for(s=s-1;s>=0;s--)r[s].nodeType!==3&&(o=0);o&&(i=n.ownerDocument.createElement("b"),i.style.display="none",n.appendChild(i)),n.setAttribute(t,""+e),i&&n.removeChild(i)}}var Cte=/^[\s\xa0]+|[\s\xa0]+$/g,lL=String.prototype.trim,iy=" ",Rk;Rk=function(n,e){return e.getElementsByTagName(n)};if(Yv.createElement){var cL=Yv.createElement("div");cL.appendChild(document.createComment("")),cL.getElementsByTagName("*").length&&(Rk=function(n,e){var t=e.getElementsByTagName(n),r=n==="*";if(r||typeof t.length!="number"){for(var i=[],s=0,o;o=t[s++];)(!r||o.nodeType===1)&&i.push(o);return i}else return t})}var Pte="sourceIndex"in(Yv&&Yv.documentElement||{})?function(n,e){return n.sourceIndex-e.sourceIndex}:function(n,e){if(!n.compareDocumentPosition||!e.compareDocumentPosition)return n.compareDocumentPosition?-1:1;var t=n.compareDocumentPosition(e)&4;return t?-1:1},Rte=dj.exports={ie:Qv,unique:function(){var n,e=!0;[0,0].sort(function(){return e=!1,0});function t(r,i){return r===i?(n=!0,0):Pte(r,i)}return function(r){if(n=e,r.sort(t),n)for(var i=1,s=r.length;i<s;)r[i]===r[i-1]?(r.splice(i,1),--s):i++;return r}}(),getElementsByTagName:Rk,getSimpleAttr:function(n,e){var t=n&&n.getAttributeNode(e);if(t&&t.specified)return"value"in t?t.value:t.nodeValue},contains:Qv?function(n,e){return n.nodeType===9&&(n=n.documentElement),e=e.parentNode,n===e?!0:e&&e.nodeType===1?n.contains&&n.contains(e):!1}:function(n,e){return!!(n.compareDocumentPosition(e)&16)},isTag:function(n,e){return e==="*"||n.nodeName.toLowerCase()===e.toLowerCase()},hasSingleClass:function(n,e){var t=n&&Rte.getSimpleAttr(n,"class");return t&&(t=t.replace(/[\r\t\n]/g,iy))&&(iy+t+iy).indexOf(iy+e+iy)>-1},startsWith:function(n,e){return n.lastIndexOf(e,0)===0},endsWith:function(n,e){var t=n.length-e.length;return t>=0&&n.indexOf(e,t)===t},trim:lL?function(n){return n==null?"":lL.call(n)}:function(n){return n==null?"":(n+"").replace(Cte,"")},attr:function(n,e){var t,r;if(e=e.toLowerCase(),e=hj[e]||e,vte.test(e)?t=_te:bte.test(e)?t=IS:t=$l[e],n&&n.nodeType===1){if(n.nodeName.toLowerCase()==="form"&&(t=IS),t&&t.get)return t.get(n,e);if(r=n.getAttribute(e),r===""){var i=n.getAttributeNode(e);if(!i||!i.specified)return}return r===null?void 0:r}}},kte=dj.exports,fj={exports:{}};(function(n){var e=function(t){var r={},i={SHIFT_TYPE:1,REDUCE_TYPE:2,ACCEPT_TYPE:0,TYPE_INDEX:0,PRODUCTION_INDEX:1,TO_INDEX:2};function s(h,f){for(var v in f)h[v]=f[v]}function o(h){return Object.prototype.toString.call(h)==="[object Array]"}function a(h,f,v){if(h){var w,E,A,T=0;if(v=v||null,o(h))for(A=h.length,E=h[0];T<A&&f.call(v,E,T,h)!==!1;E=h[++T]);else for(w in h)if(f.call(v,h[w],w,h)===!1)break}}function l(h,f){for(var v=0,w=f.length;v<w;v++)if(f[v]===h)return!0;return!1}var c=function(f){var v=this;v.rules=[],s(v,f),v.resetInput(v.input)};c.prototype={resetInput:function(h){s(this,{input:h,matched:"",stateStack:[c.STATIC.INITIAL],match:"",text:"",firstLine:1,lineNumber:1,lastLine:1,firstColumn:1,lastColumn:1})},getCurrentRules:function(){var h=this,f=h.stateStack[h.stateStack.length-1],v=[];return h.mapState&&(f=h.mapState(f)),a(h.rules,function(w){var E=w.state||w[3];E?l(f,E)&&v.push(w):f===c.STATIC.INITIAL&&v.push(w)}),v},pushState:function(h){this.stateStack.push(h)},popState:function(h){h=h||1;for(var f;h--;)f=this.stateStack.pop();return f},showDebugInfo:function(){var h=this,f=c.STATIC.DEBUG_CONTEXT_LIMIT,v=h.matched,w=h.match,E=h.input;v=v.slice(0,v.length-w.length);var A=(v.length>f?"...":"")+v.slice(0-f).replace(/\n/," "),T=w+E;return T=T.slice(0,f)+(T.length>f?"...":""),A+T+`
`+new Array(A.length+1).join("-")+"^"},mapSymbol:function(f){return this.symbolMap[f]},mapReverseSymbol:function(h){var f=this,v=f.symbolMap,w,E=f.reverseSymbolMap;if(!E&&v){E=f.reverseSymbolMap={};for(w in v)E[v[w]]=w}return E?E[h]:h},lex:function(){var h=this,f=h.input,v,w,E,A,T,_=h.getCurrentRules();if(h.match=h.text="",!f)return h.mapSymbol(c.STATIC.END_TAG);for(v=0;v<_.length;v++){w=_[v];var b=w.regexp||w[1],g=w.token||w[0],y=w.action||w[2]||t;if(E=f.match(b)){T=E[0].match(/\n.*/g),T&&(h.lineNumber+=T.length),s(h,{firstLine:h.lastLine,lastLine:h.lineNumber+1,firstColumn:h.lastColumn,lastColumn:T?T[T.length-1].length-1:h.lastColumn+E[0].length});var x;return x=h.match=E[0],h.matches=E,h.text=x,h.matched+=x,A=y&&y.call(h),A===t?A=g:A=h.mapSymbol(A),f=f.slice(x.length),h.input=f,A||h.lex()}}}},c.STATIC={INITIAL:"I",DEBUG_CONTEXT_LIMIT:20,END_TAG:"$EOF"};var u=new c({rules:[["b",/^\[(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["c",/^(?:[\t\r\n\f\x20]*)\]/,function(){this.text=this.yy.trim(this.text)}],["d",/^(?:[\t\r\n\f\x20]*)~=(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["e",/^(?:[\t\r\n\f\x20]*)\|=(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["f",/^(?:[\t\r\n\f\x20]*)\^=(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["g",/^(?:[\t\r\n\f\x20]*)\$=(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["h",/^(?:[\t\r\n\f\x20]*)\*=(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["i",/^(?:[\t\r\n\f\x20]*)\=(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["j",/^(?:(?:[\w]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))(?:[\w\d-]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))*)\(/,function(){this.text=this.yy.trim(this.text).slice(0,-1),this.pushState("fn")}],["k",/^[^\)]*/,function(){this.popState()},["fn"]],["l",/^(?:[\t\r\n\f\x20]*)\)/,function(){this.text=this.yy.trim(this.text)}],["m",/^:not\((?:[\t\r\n\f\x20]*)/i,function(){this.text=this.yy.trim(this.text)}],["n",/^(?:(?:[\w]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))(?:[\w\d-]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))*)/,function(){this.text=this.yy.unEscape(this.text)}],["o",/^"(\\"|[^"])*"/,function(){this.text=this.yy.unEscapeStr(this.text)}],["o",/^'(\\'|[^'])*'/,function(){this.text=this.yy.unEscapeStr(this.text)}],["p",/^#(?:(?:[\w\d-]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))+)/,function(){this.text=this.yy.unEscape(this.text.slice(1))}],["q",/^\.(?:(?:[\w]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))(?:[\w\d-]|[^\x00-\xa0]|(?:\\[^\n\r\f0-9a-f]))*)/,function(){this.text=this.yy.unEscape(this.text.slice(1))}],["r",/^(?:[\t\r\n\f\x20]*),(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["s",/^::?/,0],["t",/^(?:[\t\r\n\f\x20]*)\+(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["u",/^(?:[\t\r\n\f\x20]*)>(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["v",/^(?:[\t\r\n\f\x20]*)~(?:[\t\r\n\f\x20]*)/,function(){this.text=this.yy.trim(this.text)}],["w",/^\*/,0],["x",/^(?:[\t\r\n\f\x20]+)/,0],["y",/^./,0]]});return r.lexer=u,u.symbolMap={$EOF:"a",LEFT_BRACKET:"b",RIGHT_BRACKET:"c",INCLUDES:"d",DASH_MATCH:"e",PREFIX_MATCH:"f",SUFFIX_MATCH:"g",SUBSTRING_MATCH:"h",ALL_MATCH:"i",FUNCTION:"j",PARAMETER:"k",RIGHT_PARENTHESES:"l",NOT:"m",IDENT:"n",STRING:"o",HASH:"p",CLASS:"q",COMMA:"r",COLON:"s",PLUS:"t",GREATER:"u",TILDE:"v",UNIVERSAL:"w",S:"x",INVALID:"y",$START:"z",selectors_group:"aa",selector:"ab",simple_selector_sequence:"ac",combinator:"ad",type_selector:"ae",id_selector:"af",class_selector:"ag",attrib_match:"ah",attrib:"ai",attrib_val:"aj",pseudo:"ak",negation:"al",negation_arg:"am",suffix_selector:"an",suffix_selectors:"ao"},r.productions=[["z",["aa"]],["aa",["ab"],function(){return[this.$1]}],["aa",["aa","r","ab"],function(){this.$1.push(this.$3)}],["ab",["ac"]],["ab",["ab","ad","ac"],function(){this.$1.nextCombinator=this.$3.prevCombinator=this.$2;var h;return h=this.$1.order=this.$1.order||0,this.$3.order=h+1,this.$3.prev=this.$1,this.$1.next=this.$3,this.$3}],["ad",["t"]],["ad",["u"]],["ad",["v"]],["ad",["x"],function(){return" "}],["ae",["n"],function(){return{t:"tag",value:this.$1}}],["ae",["w"],function(){return{t:"tag",value:this.$1}}],["af",["p"],function(){return{t:"id",value:this.$1}}],["ag",["q"],function(){return{t:"cls",value:this.$1}}],["ah",["f"]],["ah",["g"]],["ah",["h"]],["ah",["i"]],["ah",["d"]],["ah",["e"]],["ai",["b","n","c"],function(){return{t:"attrib",value:{ident:this.$2}}}],["aj",["n"]],["aj",["o"]],["ai",["b","n","ah","aj","c"],function(){return{t:"attrib",value:{ident:this.$2,match:this.$3,value:this.$4}}}],["ak",["s","j","k","l"],function(){return{t:"pseudo",value:{fn:this.$2.toLowerCase(),param:this.$3}}}],["ak",["s","n"],function(){return{t:"pseudo",value:{ident:this.$2.toLowerCase()}}}],["al",["m","am","l"],function(){return{t:"pseudo",value:{fn:"not",param:this.$2}}}],["am",["ae"]],["am",["af"]],["am",["ag"]],["am",["ai"]],["am",["ak"]],["an",["af"]],["an",["ag"]],["an",["ai"]],["an",["ak"]],["an",["al"]],["ao",["an"],function(){return[this.$1]}],["ao",["ao","an"],function(){this.$1.push(this.$2)}],["ac",["ae"]],["ac",["ao"],function(){return{suffix:this.$1}}],["ac",["ae","ao"],function(){return{t:"tag",value:this.$1.value,suffix:this.$2}}]],r.table={gotos:{0:{aa:8,ab:9,ae:10,af:11,ag:12,ai:13,ak:14,al:15,an:16,ao:17,ac:18},2:{ae:20,af:21,ag:22,ai:23,ak:24,am:25},9:{ad:33},10:{af:11,ag:12,ai:13,ak:14,al:15,an:16,ao:34},17:{af:11,ag:12,ai:13,ak:14,al:15,an:35},19:{ah:43},28:{ab:46,ae:10,af:11,ag:12,ai:13,ak:14,al:15,an:16,ao:17,ac:18},33:{ae:10,af:11,ag:12,ai:13,ak:14,al:15,an:16,ao:17,ac:47},34:{af:11,ag:12,ai:13,ak:14,al:15,an:35},43:{aj:50},46:{ad:33}},action:{0:{b:[1,t,1],m:[1,t,2],n:[1,t,3],p:[1,t,4],q:[1,t,5],s:[1,t,6],w:[1,t,7]},1:{n:[1,t,19]},2:{b:[1,t,1],n:[1,t,3],p:[1,t,4],q:[1,t,5],s:[1,t,6],w:[1,t,7]},3:{a:[2,9],r:[2,9],t:[2,9],u:[2,9],v:[2,9],x:[2,9],p:[2,9],q:[2,9],b:[2,9],s:[2,9],m:[2,9],l:[2,9]},4:{a:[2,11],r:[2,11],t:[2,11],u:[2,11],v:[2,11],x:[2,11],p:[2,11],q:[2,11],b:[2,11],s:[2,11],m:[2,11],l:[2,11]},5:{a:[2,12],r:[2,12],t:[2,12],u:[2,12],v:[2,12],x:[2,12],p:[2,12],q:[2,12],b:[2,12],s:[2,12],m:[2,12],l:[2,12]},6:{j:[1,t,26],n:[1,t,27]},7:{a:[2,10],r:[2,10],t:[2,10],u:[2,10],v:[2,10],x:[2,10],p:[2,10],q:[2,10],b:[2,10],s:[2,10],m:[2,10],l:[2,10]},8:{a:[0],r:[1,t,28]},9:{a:[2,1],r:[2,1],t:[1,t,29],u:[1,t,30],v:[1,t,31],x:[1,t,32]},10:{a:[2,38],r:[2,38],t:[2,38],u:[2,38],v:[2,38],x:[2,38],b:[1,t,1],m:[1,t,2],p:[1,t,4],q:[1,t,5],s:[1,t,6]},11:{a:[2,31],r:[2,31],t:[2,31],u:[2,31],v:[2,31],x:[2,31],p:[2,31],q:[2,31],b:[2,31],s:[2,31],m:[2,31]},12:{a:[2,32],r:[2,32],t:[2,32],u:[2,32],v:[2,32],x:[2,32],p:[2,32],q:[2,32],b:[2,32],s:[2,32],m:[2,32]},13:{a:[2,33],r:[2,33],t:[2,33],u:[2,33],v:[2,33],x:[2,33],p:[2,33],q:[2,33],b:[2,33],s:[2,33],m:[2,33]},14:{a:[2,34],r:[2,34],t:[2,34],u:[2,34],v:[2,34],x:[2,34],p:[2,34],q:[2,34],b:[2,34],s:[2,34],m:[2,34]},15:{a:[2,35],r:[2,35],t:[2,35],u:[2,35],v:[2,35],x:[2,35],p:[2,35],q:[2,35],b:[2,35],s:[2,35],m:[2,35]},16:{a:[2,36],r:[2,36],t:[2,36],u:[2,36],v:[2,36],x:[2,36],p:[2,36],q:[2,36],b:[2,36],s:[2,36],m:[2,36]},17:{a:[2,39],r:[2,39],t:[2,39],u:[2,39],v:[2,39],x:[2,39],b:[1,t,1],m:[1,t,2],p:[1,t,4],q:[1,t,5],s:[1,t,6]},18:{a:[2,3],r:[2,3],t:[2,3],u:[2,3],v:[2,3],x:[2,3]},19:{c:[1,t,36],d:[1,t,37],e:[1,t,38],f:[1,t,39],g:[1,t,40],h:[1,t,41],i:[1,t,42]},20:{l:[2,26]},21:{l:[2,27]},22:{l:[2,28]},23:{l:[2,29]},24:{l:[2,30]},25:{l:[1,t,44]},26:{k:[1,t,45]},27:{a:[2,24],r:[2,24],t:[2,24],u:[2,24],v:[2,24],x:[2,24],p:[2,24],q:[2,24],b:[2,24],s:[2,24],m:[2,24],l:[2,24]},28:{b:[1,t,1],m:[1,t,2],n:[1,t,3],p:[1,t,4],q:[1,t,5],s:[1,t,6],w:[1,t,7]},29:{n:[2,5],w:[2,5],p:[2,5],q:[2,5],b:[2,5],s:[2,5],m:[2,5]},30:{n:[2,6],w:[2,6],p:[2,6],q:[2,6],b:[2,6],s:[2,6],m:[2,6]},31:{n:[2,7],w:[2,7],p:[2,7],q:[2,7],b:[2,7],s:[2,7],m:[2,7]},32:{n:[2,8],w:[2,8],p:[2,8],q:[2,8],b:[2,8],s:[2,8],m:[2,8]},33:{b:[1,t,1],m:[1,t,2],n:[1,t,3],p:[1,t,4],q:[1,t,5],s:[1,t,6],w:[1,t,7]},34:{a:[2,40],r:[2,40],t:[2,40],u:[2,40],v:[2,40],x:[2,40],b:[1,t,1],m:[1,t,2],p:[1,t,4],q:[1,t,5],s:[1,t,6]},35:{a:[2,37],r:[2,37],t:[2,37],u:[2,37],v:[2,37],x:[2,37],p:[2,37],q:[2,37],b:[2,37],s:[2,37],m:[2,37]},36:{a:[2,19],r:[2,19],t:[2,19],u:[2,19],v:[2,19],x:[2,19],p:[2,19],q:[2,19],b:[2,19],s:[2,19],m:[2,19],l:[2,19]},37:{n:[2,17],o:[2,17]},38:{n:[2,18],o:[2,18]},39:{n:[2,13],o:[2,13]},40:{n:[2,14],o:[2,14]},41:{n:[2,15],o:[2,15]},42:{n:[2,16],o:[2,16]},43:{n:[1,t,48],o:[1,t,49]},44:{a:[2,25],r:[2,25],t:[2,25],u:[2,25],v:[2,25],x:[2,25],p:[2,25],q:[2,25],b:[2,25],s:[2,25],m:[2,25]},45:{l:[1,t,51]},46:{a:[2,2],r:[2,2],t:[1,t,29],u:[1,t,30],v:[1,t,31],x:[1,t,32]},47:{a:[2,4],r:[2,4],t:[2,4],u:[2,4],v:[2,4],x:[2,4]},48:{c:[2,20]},49:{c:[2,21]},50:{c:[1,t,52]},51:{a:[2,23],r:[2,23],t:[2,23],u:[2,23],v:[2,23],x:[2,23],p:[2,23],q:[2,23],b:[2,23],s:[2,23],m:[2,23],l:[2,23]},52:{a:[2,22],r:[2,22],t:[2,22],u:[2,22],v:[2,22],x:[2,22],p:[2,22],q:[2,22],b:[2,22],s:[2,22],m:[2,22],l:[2,22]}}},r.parse=function(f,v){var w=this,E=w.lexer,A,T,_,b=w.table,g=b.gotos,y=b.action,x=w.productions,S=[null],I=v?"in file: "+v+" ":"",P=[0];for(E.resetInput(f);;){if(A=P[P.length-1],T||(T=E.lex()),T?_=y[A]&&y[A][T]:_=null,!_){var N=[],M;if(y[A])for(var V in y[A])N.push(w.lexer.mapReverseSymbol(V));throw M=I+"syntax error at line "+E.lineNumber+`:
`+E.showDebugInfo()+`
expect `+N.join(", "),new Error(M)}switch(_[i.TYPE_INDEX]){case i.SHIFT_TYPE:P.push(T),S.push(E.text),P.push(_[i.TO_INDEX]),T=null;break;case i.REDUCE_TYPE:var L=x[_[i.PRODUCTION_INDEX]],j=L.symbol||L[0],oe=L.action||L[2],$=L.rhs||L[1],B=$.length,G=0,Z,ee=S[S.length-B];for(Z=t,w.$$=ee;G<B;G++)w["$"+(B-G)]=S[S.length-1-G];oe&&(Z=oe.call(w)),Z!==t?ee=Z:ee=w.$$,P=P.slice(0,-1*B*2),S=S.slice(0,-1*B),P.push(j),S.push(ee);var fe=g[P[P.length-2]][P[P.length-1]];P.push(fe);break;case i.ACCEPT_TYPE:return ee}}},r}();n.exports=e})(fj);var Dte=fj.exports,Ds=kte,kk=Dte,ZE="_ks_data_selector_id_",TT={},hg,uL=0,By={},Xv=function(n,e){return hg?Ds.getSimpleAttr(n,e):Ds.attr(n,e)},Mte=Ds.hasSingleClass,Nte=Ds.isTag,Lte=/^(([+-]?(?:\d+)?)?n)?([+-]?\d+)?$/,Ote=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,Fte=function(n,e){var t="0x"+e-65536;return isNaN(t)?e:t<0?String.fromCharCode(t+65536):String.fromCharCode(t>>10|55296,t&1023|56320)},lv,$y={"nth-child":function(n,e){var t=eb(e),r=t.a,i=t.b;if(r===0&&i===0)return 0;var s=0,o=n.parentNode;if(o){for(var a=o.childNodes,l=0,c,u,h=a.length;l<h;l++)if(c=a[l],c.nodeType===1&&(s++,u=tb(s,r,i,c===n),u!==void 0))return u}return 0},"nth-last-child":function(n,e){var t=eb(e),r=t.a,i=t.b;if(r===0&&i===0)return 0;var s=0,o=n.parentNode;if(o){for(var a=o.childNodes,l=a.length,c=l-1,u,h;c>=0;c--)if(u=a[c],u.nodeType===1&&(s++,h=tb(s,r,i,u===n),h!==void 0))return h}return 0},"nth-of-type":function(n,e){var t=eb(e),r=t.a,i=t.b;if(r===0&&i===0)return 0;var s=0,o=n.parentNode;if(o){for(var a=o.childNodes,l=n.tagName,c=0,u,h,f=a.length;c<f;c++)if(u=a[c],u.tagName===l&&(s++,h=tb(s,r,i,u===n),h!==void 0))return h}return 0},"nth-last-of-type":function(n,e){var t=eb(e),r=t.a,i=t.b;if(r===0&&i===0)return 0;var s=0,o=n.parentNode;if(o){for(var a=o.childNodes,l=a.length,c=n.tagName,u=l-1,h,f;u>=0;u--)if(h=a[u],h.tagName===c&&(s++,f=tb(s,r,i,h===n),f!==void 0))return f}return 0},lang:function(n,e){var t;e=pj(e.toLowerCase());do if(t=hg?n.getAttribute("xml:lang")||n.getAttribute("lang"):n.lang)return t=t.toLowerCase(),t===e||t.indexOf(e+"-")===0;while((n=n.parentNode)&&n.nodeType===1);return!1},not:function(n,e){return!lv[e.t](n,e.value)}},pp={empty:function(n){for(var e=n.childNodes,t=0,r=e.length-1,i,s;t<r;t++)if(i=e[t],s=i.nodeType,s===1||s===3||s===4||s===5)return 0;return 1},root:function(n){return n.nodeType===9?!0:n.ownerDocument&&n===n.ownerDocument.documentElement},"first-child":function(n){return $y["nth-child"](n,1)},"last-child":function(n){return $y["nth-last-child"](n,1)},"first-of-type":function(n){return $y["nth-of-type"](n,1)},"last-of-type":function(n){return $y["nth-last-of-type"](n,1)},"only-child":function(n){return pp["first-child"](n)&&pp["last-child"](n)},"only-of-type":function(n){return pp["first-of-type"](n)&&pp["last-of-type"](n)},focus:function(n){var e=n.ownerDocument;return e&&n===e.activeElement&&(!e.hasFocus||e.hasFocus())&&!!(n.type||n.href||n.tabIndex>=0)},target:function(n){var e=location.hash;return e&&e.slice(1)===Xv(n,"id")},enabled:function(n){return!n.disabled},disabled:function(n){return n.disabled},checked:function(n){var e=n.nodeName.toLowerCase();return e==="input"&&n.checked||e==="option"&&n.selected}},Vte={"~=":function(n,e){return!e||e.indexOf(" ")>-1?0:(" "+n+" ").indexOf(" "+e+" ")!==-1},"|=":function(n,e){return(" "+n).indexOf(" "+e+"-")!==-1},"^=":function(n,e){return e&&Ds.startsWith(n,e)},"$=":function(n,e){return e&&Ds.endsWith(n,e)},"*=":function(n,e){return e&&n.indexOf(e)!==-1},"=":function(n,e){return n===e}},mp={">":{dir:"parentNode",immediate:1}," ":{dir:"parentNode"},"+":{dir:"previousSibling",immediate:1},"~":{dir:"previousSibling"}};lv={tag:Nte,cls:Mte,id:function(n,e){return Xv(n,"id")===e},attrib:function(n,e){var t=e.ident;hg||(t=t.toLowerCase());var r=Xv(n,t),i=e.match;if(!i&&r!==void 0)return 1;if(i){if(r===void 0)return 0;var s=Vte[i];if(s)return s(r+"",e.value+"")}return 0},pseudo:function(n,e){var t,r,i;if(r=e.fn){if(!(t=$y[r]))throw new SyntaxError("Syntax error: not support pseudo: "+r);return t(n,e.param)}if(i=e.ident){if(!pp[i])throw new SyntaxError("Syntax error: not support pseudo: "+i);return pp[i](n)}return 0}};function pj(n){return n.replace(Ote,Fte)}kk.lexer.yy={trim:Ds.trim,unEscape:pj,unEscapeStr:function(n){return this.unEscape(n.slice(1,-1))}};function Ute(){By={}}function gp(n,e){do n=n[e];while(n&&n.nodeType!==1);return n}function eb(n){var e=0,t,r=0;return typeof n=="number"?r=n:n==="odd"?(e=2,r=1):n==="even"?(e=2,r=0):(t=n.replace(/\s/g,"").match(Lte))&&(t[1]?(e=parseInt(t[2],10),isNaN(e)&&(t[2]==="-"?e=-1:e=1)):e=0,r=parseInt(t[3],10)||0),{a:e,b:r}}function tb(n,e,t,r){if(e===0){if(n===t)return r}else if((n-t)/e>=0&&(n-t)%e===0&&r)return 1}function Bte(n){var e=n&&(n.ownerDocument||n).documentElement;return e?e.nodeName.toLowerCase()!=="html":!1}function $te(n,e){return Pg(n,null,e)}function mj(n,e){if(!e)return!0;if(!n||n.nodeType===9)return!1;var t=1,r=e.suffix,i,s;if(e.t==="tag"&&(t&=lv.tag(n,e.value)),t&&r)for(i=r.length,s=0;t&&s<i;s++){var o=r[s],a=o.t;lv[a]&&(t&=lv[a](n,o.value))}return t}function jte(n,e){var t=1,r=n,i,s=e;do if(t&=mj(n,e),t){if(e=e&&e.prev,!e)return!0;if(i=mp[e.nextCombinator],n=gp(n,i.dir),!i.immediate)return{el:n,match:e}}else return i=mp[e.nextCombinator],i.immediate?{el:gp(r,mp[s.nextCombinator].dir),match:s}:{el:n&&gp(n,i.dir),match:e};while(n);return{el:gp(r,mp[s.nextCombinator].dir),match:s}}function zte(n,e){var t,r=e;do{if(!mj(n,r))return null;if(r=r.prev,!r)return!0;t=mp[r.nextCombinator],n=gp(n,t.dir)}while(n&&t.immediate);return n?{el:n,match:r}:null}function Hte(n){var e;return hg?(e=n.getAttribute(ZE))||n.setAttribute(ZE,e=+new Date+"_"+ ++uL):(e=n[ZE])||(e=n[ZE]=+new Date+"_"+ ++uL),e}function gj(n,e){var t=Hte(n),r;return r=t+"_"+(e.order||0),r in By||(By[r]=Gte(n,e)),By[r]}function Gte(n,e){var t=jte(n,e);if(t===!0)return!0;for(n=t.el,e=t.match;n;){if(gj(n,e))return!0;n=gp(n,mp[e.nextCombinator].dir)}return!1}function Pg(n,e,t){TT[n]||(TT[n]=kk.parse(n));var r=TT[n],i=0,s=r.length,o,a,l=[];for(t&&(e=e||t[0].ownerDocument),o=e&&e.ownerDocument||typeof document<"u"&&document,e&&e.nodeType===9&&!o&&(o=e),e=e||o,hg=Bte(e);i<s;i++){Ute(),a=r[i];var c=a.suffix,u,h,f,v=t,w,E=null;if(!v){if(c&&!hg)for(u=0,h=c.length;u<h;u++){var A=c[u];if(A.t==="id"){E=A.value;break}}if(E){var T=!e.getElementById,_=Ds.contains(o,e),b=T?_?o.getElementById(E):null:e.getElementById(E);if(!b&&T||b&&Xv(b,"id")!==E){for(var g=Ds.getElementsByTagName("*",e),y=g.length,x=0;x<y;x++)if(b=g[x],Xv(b,"id")===E){v=[b];break}x===y&&(v=[])}else _&&b&&e!==o&&(b=Ds.contains(e,b)?b:null),v=b?[b]:[]}else v=Ds.getElementsByTagName(a.value||"*",e)}if(f=0,w=v.length,!!w)for(;f<w;f++){var S=v[f],I=zte(S,a);(I===!0||I&&gj(I.el,I.match))&&l.push(S)}}return s>1&&(l=Ds.unique(l)),l}var Wte=Pg;Pg.parse=function(n){return kk.parse(n)};Pg.matches=$te;Pg.util=Ds;Pg.version="@VERSION@";var qte=Wte,dL=/-+([a-z])/gi;function Kte(n,e,t){return t!==0?e.toUpperCase():e}function Yte(n){var e=n.replace(dL,Kte);return dL.lastIndex=0,e}var yj=Yte;function Qte(n){return typeof n=="string"}var Xte=Qte;function Jte(n){return typeof n>"u"}var Zte=Jte;function ene(n){for(var e=arguments,t,r=1;r<e.length;r++){t=e[r];for(var i in t)n[i]=t[i]}return n}var tne=ene;function nne(n,e){var t={};for(var r in n)n.hasOwnProperty(r)&&(t[r]=e(n[r]));return t}var vj=nne,rne=yj;function ine(n){var e=rne(n);return e.charAt(0).toUpperCase()===n.charAt(0)?n.charAt(0)+e.slice(1):n.charAt(0)==="-"?e.indexOf("ms")===0?e:e.charAt(0).toUpperCase()+e.slice(1):e}var sne=ine,hL=D,one=JA,ane=qte,lne=yj,cne=Xte,fL=Zte,IT=tne,pL=vj,xT=sne;function une(){function n(t,r){this.nodeName=t,this.parentNode=r,this.childNodes=[],this.eventListeners={},this.text="";var i=this,s=this.props={ref:function(o){i.component=o},style:{setProperty:function(o,a){s.style[xT(o)]=a},getProperty:function(o){return s.style[xT(o)]||""},getPropertyValue:function(o){return s.style.getProperty(o)},removeProperty:function(o){delete s.style[xT(o)]}}};this.style=s.style}n.ELEMENT_NODE=1,n.DOCUMENT_POSITION_DISCONNECTED=1,n.DOCUMENT_POSITION_PRECEDING=2,n.DOCUMENT_POSITION_FOLLOWING=4,n.DOCUMENT_POSITION_CONTAINS=8,n.DOCUMENT_POSITION_CONTAINED_BY=16,n.prototype.nodeType=1,n.prototype.eventNameMappings={blur:"onBlur",change:"onChange",click:"onClick",contextmenu:"onContextMenu",copy:"onCopy",cut:"onCut",doubleclick:"onDoubleClick",drag:"onDrag",dragend:"onDragEnd",dragenter:"onDragEnter",dragexit:"onDragExit",dragleave:"onDragLeave",dragover:"onDragOver",dragstart:"onDragStart",drop:"onDrop",error:"onError",focus:"onFocus",input:"onInput",keydown:"onKeyDown",keypress:"onKeyPress",keyup:"onKeyUp",load:"onLoad",mousedown:"onMouseDown",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseover:"onMouseOver",mouseup:"onMouseUp",paste:"onPaste",scroll:"onScroll",submit:"onSubmit",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",wheel:"onWheel"},n.prototype.skipNameTransformationExpressions=[/^data-/,/^aria-/],n.prototype.attributeNameMappings={class:"className"},n.prototype.attributeToPropName=function(t){var r=this.skipNameTransformationExpressions.map(function(i){return i.test(t)});return r.some(Boolean)?t:this.attributeNameMappings[t]||lne(t)},n.prototype.setAttribute=function(t,r){if(t==="style"&&cne(r)){var i=one.parse(r);for(var s in i)this.style.setProperty(s,i[s])}else this.props[this.attributeToPropName(t)]=r},n.prototype.getAttribute=function(t){return this.props[this.attributeToPropName(t)]},n.prototype.getAttributeNode=function(t){var r=this.getAttribute(t);if(!fL(r))return{value:r,specified:!0}},n.prototype.removeAttribute=function(t){delete this.props[this.attributeToPropName(t)]},n.prototype.eventToPropName=function(t){return this.eventNameMappings[t]||t},n.prototype.addEventListener=function(t,r){var i=this.eventToPropName(t);this.eventListeners[i]=this.eventListeners[i]||[],this.eventListeners[i].push(r)},n.prototype.removeEventListener=function(t,r){var i=this.eventListeners[this.eventToPropName(t)];if(i){var s=i.indexOf(r);s!==-1&&i.splice(s,1)}},n.prototype.appendChild=function(t){return t instanceof n&&(t.parentNode=this),this.childNodes.push(t),t},n.prototype.insertBefore=function(t,r){var i=this.childNodes.indexOf(r);return t.parentNode=this,i!==-1?this.childNodes.splice(i,0,t):this.childNodes.push(t),t},n.prototype.removeChild=function(t){var r=this.childNodes.indexOf(t);this.childNodes.splice(r,1)},n.prototype.querySelector=function(){return this.querySelectorAll.apply(this,arguments)[0]||null},n.prototype.querySelectorAll=function(t){if(!t)throw new Error("Not enough arguments");return ane(t,this)},n.prototype.getElementsByTagName=function(t){var r=this.children;if(r.length===0)return[];var i;t!=="*"?i=r.filter(function(o){return o.nodeName===t}):i=r;var s=r.map(function(o){return o.getElementsByTagName(t)});return i.concat.apply(i,s)},n.prototype.getElementById=function(t){var r=this.children;if(r.length===0)return null;var i=r.filter(function(o){return o.getAttribute("id")===t})[0];if(i)return i;var s=r.map(function(o){return o.getElementById(t)});return s.filter(function(o){return o!==null})[0]||null},n.prototype.getBoundingClientRect=function(){if(this.component)return this.component.getBoundingClientRect()},n.prototype.cloneNode=function(t){t===void 0&&(t=!0);var r=new n(this.nodeName,this.parentNode);this.nodeType&&(r.nodeType=this.nodeType);var i;for(i in this.props)this.props.hasOwnProperty(i)&&i!=="ref"&&i!=="style"&&(r.props[i]=this.props[i]);for(i in this.style)this.style.hasOwnProperty(i)&&["setProperty","getProperty","getPropertyValue","removeProperty"].indexOf(i)===-1&&(r.style[i]=this.style[i]);return t&&(r.childNodes=this.childNodes.map(function(s){return s.nodeType?(s=s.cloneNode(!0),s instanceof n&&(s.parentNode=r),s):hL.cloneElement(s)})),r},n.prototype.toReact=function(t){t=t||0;var r=IT({},this.props);r.style=IT({},r.style);var i=this;function s(){return"faux-dom-"+t}return fL(r.key)&&(r.key=s()),delete r.style.setProperty,delete r.style.getProperty,delete r.style.getPropertyValue,delete r.style.removeProperty,IT(r,pL(this.eventListeners,function(o){return function(a){var l;a&&(l=a.nativeEvent,l.syntheticEvent=a),pL(o,function(c){c.call(i,l)})}})),hL.createElement(this.nodeName,r,this.text||this.children.map(function(o,a){return o instanceof n?o.toReact(a):o}))},n.prototype.compareDocumentPosition=function(t){function r(h,f,v){return h.reduce(function(w,E){return w!==!1?w:E===f?f:E===v?v:E.childNodes?r(E.childNodes,f,v):!1},!1)}function i(h,f){for(;f.parentNode;)if(f=f.parentNode,f===h)return!0;return!1}function s(h,f){return i(h,f)?n.DOCUMENT_POSITION_CONTAINED_BY+n.DOCUMENT_POSITION_FOLLOWING:i(f,h)?n.DOCUMENT_POSITION_CONTAINS+n.DOCUMENT_POSITION_PRECEDING:!1}function o(h){for(;h.parentNode;)h=h.parentNode;return h}if(this===t)return 0;var a=o(this),l=o(t);if(a!==l)return n.DOCUMENT_POSITION_DISCONNECTED;var c=s(this,t);if(c)return c;var u=r([a],this,t);return u===this?n.DOCUMENT_POSITION_FOLLOWING:u===t?n.DOCUMENT_POSITION_PRECEDING:n.DOCUMENT_POSITION_DISCONNECTED},Object.defineProperties(n.prototype,{nextSibling:{get:function(){var t=this.parentNode.children,r=t.indexOf(this);return t[r+1]}},previousSibling:{get:function(){var t=this.parentNode.children,r=t.indexOf(this);return t[r-1]}},innerHTML:{get:function(){return this.text},set:function(t){this.text=t}},textContent:{get:function(){return this.text},set:function(t){this.text=t}},children:{get:function(){return this.childNodes.filter(function(t){return t.nodeType?t.nodeType===1:!0})}}});var e=["setAttribute","getAttribute","getAttributeNode","removeAttribute","getElementsByTagName","getElementById"];return e.forEach(function(t){var r=n.prototype[t];n.prototype[t+"NS"]=function(){return r.apply(this,Array.prototype.slice.call(arguments,1))}}),n}var dne=une;function hne(){var n={getComputedStyle:function(e){return{getPropertyValue:e.style.getProperty}}};return n}var fne=hne;/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var mL=Object.getOwnPropertySymbols,pne=Object.prototype.hasOwnProperty,mne=Object.prototype.propertyIsEnumerable;function gne(n){if(n==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function yne(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de",Object.getOwnPropertyNames(n)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var r=Object.getOwnPropertyNames(e).map(function(s){return e[s]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(s){i[s]=s}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var vne=yne()?Object.assign:function(n,e){for(var t,r=gne(n),i,s=1;s<arguments.length;s++){t=Object(arguments[s]);for(var o in t)pne.call(t,o)&&(r[o]=t[o]);if(mL){i=mL(t);for(var a=0;a<i.length;a++)mne.call(t,i[a])&&(r[i[a]]=t[i[a]])}}return r},nb=vne,wne={};function Ao(n,e,t,r,i,s,o,a){if(!n){var l;if(e===void 0)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[t,r,i,s,o,a],u=0;l=new Error(e.replace(/%s/g,function(){return c[u++]})),l.name="Invariant Violation"}throw l.framesToPop=1,l}}var gL="mixins";function Ene(n,e,t){var r=[],i={mixins:"DEFINE_MANY",statics:"DEFINE_MANY",propTypes:"DEFINE_MANY",contextTypes:"DEFINE_MANY",childContextTypes:"DEFINE_MANY",getDefaultProps:"DEFINE_MANY_MERGED",getInitialState:"DEFINE_MANY_MERGED",getChildContext:"DEFINE_MANY_MERGED",render:"DEFINE_ONCE",componentWillMount:"DEFINE_MANY",componentDidMount:"DEFINE_MANY",componentWillReceiveProps:"DEFINE_MANY",shouldComponentUpdate:"DEFINE_ONCE",componentWillUpdate:"DEFINE_MANY",componentDidUpdate:"DEFINE_MANY",componentWillUnmount:"DEFINE_MANY",UNSAFE_componentWillMount:"DEFINE_MANY",UNSAFE_componentWillReceiveProps:"DEFINE_MANY",UNSAFE_componentWillUpdate:"DEFINE_MANY",updateComponent:"OVERRIDE_BASE"},s={getDerivedStateFromProps:"DEFINE_MANY_MERGED"},o={displayName:function(g,y){g.displayName=y},mixins:function(g,y){if(y)for(var x=0;x<y.length;x++)l(g,y[x])},childContextTypes:function(g,y){g.childContextTypes=nb({},g.childContextTypes,y)},contextTypes:function(g,y){g.contextTypes=nb({},g.contextTypes,y)},getDefaultProps:function(g,y){g.getDefaultProps?g.getDefaultProps=h(g.getDefaultProps,y):g.getDefaultProps=y},propTypes:function(g,y){g.propTypes=nb({},g.propTypes,y)},statics:function(g,y){c(g,y)},autobind:function(){}};function a(g,y){var x=i.hasOwnProperty(y)?i[y]:null;T.hasOwnProperty(y)&&Ao(x==="OVERRIDE_BASE","ReactClassInterface: You are attempting to override `%s` from your class specification. Ensure that your method names do not overlap with React methods.",y),g&&Ao(x==="DEFINE_MANY"||x==="DEFINE_MANY_MERGED","ReactClassInterface: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",y)}function l(g,y){if(y){Ao(typeof y!="function","ReactClass: You're attempting to use a component class or function as a mixin. Instead, just use a regular object."),Ao(!e(y),"ReactClass: You're attempting to use a component as a mixin. Instead, just use a regular object.");var x=g.prototype,S=x.__reactAutoBindPairs;y.hasOwnProperty(gL)&&o.mixins(g,y.mixins);for(var I in y)if(y.hasOwnProperty(I)&&I!==gL){var P=y[I],N=x.hasOwnProperty(I);if(a(N,I),o.hasOwnProperty(I))o[I](g,P);else{var M=i.hasOwnProperty(I),V=typeof P=="function",L=V&&!M&&!N&&y.autobind!==!1;if(L)S.push(I,P),x[I]=P;else if(N){var j=i[I];Ao(M&&(j==="DEFINE_MANY_MERGED"||j==="DEFINE_MANY"),"ReactClass: Unexpected spec policy %s for key %s when mixing in component specs.",j,I),j==="DEFINE_MANY_MERGED"?x[I]=h(x[I],P):j==="DEFINE_MANY"&&(x[I]=f(x[I],P))}else x[I]=P}}}}function c(g,y){if(y)for(var x in y){var S=y[x];if(y.hasOwnProperty(x)){var I=x in o;Ao(!I,'ReactClass: You are attempting to define a reserved property, `%s`, that shouldn\'t be on the "statics" key. Define it as an instance property instead; it will still be accessible on the constructor.',x);var P=x in g;if(P){var N=s.hasOwnProperty(x)?s[x]:null;Ao(N==="DEFINE_MANY_MERGED","ReactClass: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",x),g[x]=h(g[x],S);return}g[x]=S}}}function u(g,y){Ao(g&&y&&typeof g=="object"&&typeof y=="object","mergeIntoWithNoDuplicateKeys(): Cannot merge non-objects.");for(var x in y)y.hasOwnProperty(x)&&(Ao(g[x]===void 0,"mergeIntoWithNoDuplicateKeys(): Tried to merge two objects with the same key: `%s`. This conflict may be due to a mixin; in particular, this may be caused by two getInitialState() or getDefaultProps() methods returning objects with clashing keys.",x),g[x]=y[x]);return g}function h(g,y){return function(){var S=g.apply(this,arguments),I=y.apply(this,arguments);if(S==null)return I;if(I==null)return S;var P={};return u(P,S),u(P,I),P}}function f(g,y){return function(){g.apply(this,arguments),y.apply(this,arguments)}}function v(g,y){var x=y.bind(g);return x}function w(g){for(var y=g.__reactAutoBindPairs,x=0;x<y.length;x+=2){var S=y[x],I=y[x+1];g[S]=v(g,I)}}var E={componentDidMount:function(){this.__isMounted=!0}},A={componentWillUnmount:function(){this.__isMounted=!1}},T={replaceState:function(g,y){this.updater.enqueueReplaceState(this,g,y)},isMounted:function(){return!!this.__isMounted}},_=function(){};nb(_.prototype,n.prototype,T);function b(g){var y=function(S,I,P){this.__reactAutoBindPairs.length&&w(this),this.props=S,this.context=I,this.refs=wne,this.updater=P||t,this.state=null;var N=this.getInitialState?this.getInitialState():null;Ao(typeof N=="object"&&!Array.isArray(N),"%s.getInitialState(): must return an object or null",y.displayName||"ReactCompositeComponent"),this.state=N};y.prototype=new _,y.prototype.constructor=y,y.prototype.__reactAutoBindPairs=[],r.forEach(l.bind(null,y)),l(y,E),l(y,g),l(y,A),y.getDefaultProps&&(y.defaultProps=y.getDefaultProps()),Ao(y.prototype.render,"createClass(...): Class specification must implement a `render` method.");for(var x in i)y.prototype[x]||(y.prototype[x]=null);return y}return b}var bne=Ene,xS=D,_ne=bne;if(typeof xS>"u")throw Error("create-react-class could not find the React object. If you are using script tags, make sure that React is being loaded before create-react-class.");var Sne=new xS.Component().updater,Ane=_ne(xS.Component,xS.isValidElement,Sne),wj={exports:{}},on={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Br=typeof Symbol=="function"&&Symbol.for,Dk=Br?Symbol.for("react.element"):60103,Mk=Br?Symbol.for("react.portal"):60106,ZA=Br?Symbol.for("react.fragment"):60107,e1=Br?Symbol.for("react.strict_mode"):60108,t1=Br?Symbol.for("react.profiler"):60114,n1=Br?Symbol.for("react.provider"):60109,r1=Br?Symbol.for("react.context"):60110,Nk=Br?Symbol.for("react.async_mode"):60111,i1=Br?Symbol.for("react.concurrent_mode"):60111,s1=Br?Symbol.for("react.forward_ref"):60112,o1=Br?Symbol.for("react.suspense"):60113,Tne=Br?Symbol.for("react.suspense_list"):60120,a1=Br?Symbol.for("react.memo"):60115,l1=Br?Symbol.for("react.lazy"):60116,Ine=Br?Symbol.for("react.block"):60121,xne=Br?Symbol.for("react.fundamental"):60117,Cne=Br?Symbol.for("react.responder"):60118,Pne=Br?Symbol.for("react.scope"):60119;function Ws(n){if(typeof n=="object"&&n!==null){var e=n.$$typeof;switch(e){case Dk:switch(n=n.type,n){case Nk:case i1:case ZA:case t1:case e1:case o1:return n;default:switch(n=n&&n.$$typeof,n){case r1:case s1:case l1:case a1:case n1:return n;default:return e}}case Mk:return e}}}function Ej(n){return Ws(n)===i1}on.AsyncMode=Nk;on.ConcurrentMode=i1;on.ContextConsumer=r1;on.ContextProvider=n1;on.Element=Dk;on.ForwardRef=s1;on.Fragment=ZA;on.Lazy=l1;on.Memo=a1;on.Portal=Mk;on.Profiler=t1;on.StrictMode=e1;on.Suspense=o1;on.isAsyncMode=function(n){return Ej(n)||Ws(n)===Nk};on.isConcurrentMode=Ej;on.isContextConsumer=function(n){return Ws(n)===r1};on.isContextProvider=function(n){return Ws(n)===n1};on.isElement=function(n){return typeof n=="object"&&n!==null&&n.$$typeof===Dk};on.isForwardRef=function(n){return Ws(n)===s1};on.isFragment=function(n){return Ws(n)===ZA};on.isLazy=function(n){return Ws(n)===l1};on.isMemo=function(n){return Ws(n)===a1};on.isPortal=function(n){return Ws(n)===Mk};on.isProfiler=function(n){return Ws(n)===t1};on.isStrictMode=function(n){return Ws(n)===e1};on.isSuspense=function(n){return Ws(n)===o1};on.isValidElementType=function(n){return typeof n=="string"||typeof n=="function"||n===ZA||n===i1||n===t1||n===e1||n===o1||n===Tne||typeof n=="object"&&n!==null&&(n.$$typeof===l1||n.$$typeof===a1||n.$$typeof===n1||n.$$typeof===r1||n.$$typeof===s1||n.$$typeof===xne||n.$$typeof===Cne||n.$$typeof===Pne||n.$$typeof===Ine)};on.typeOf=Ws;wj.exports=on;var Rne=wj.exports,Lk=Rne,kne={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},Dne={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},Mne={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},bj={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Ok={};Ok[Lk.ForwardRef]=Mne;Ok[Lk.Memo]=bj;function yL(n){return Lk.isMemo(n)?bj:Ok[n.$$typeof]||kne}var Nne=Object.defineProperty,Lne=Object.getOwnPropertyNames,vL=Object.getOwnPropertySymbols,One=Object.getOwnPropertyDescriptor,Fne=Object.getPrototypeOf,wL=Object.prototype;function _j(n,e,t){if(typeof e!="string"){if(wL){var r=Fne(e);r&&r!==wL&&_j(n,r,t)}var i=Lne(e);vL&&(i=i.concat(vL(e)));for(var s=yL(n),o=yL(e),a=0;a<i.length;++a){var l=i[a];if(!Dne[l]&&!(t&&t[l])&&!(o&&o[l])&&!(s&&s[l])){var c=One(e,l);try{Nne(n,l,c)}catch{}}}}return n}var Vne=_j,Une=D,Bne=Ane,$ne=vj,jne=Vne;function zne(n){function e(t){var r=Bne({componentWillMount:function(){this.connectedFauxDOM={},this.animateFauxDOMUntil=0},componentWillUnmount:function(){this.stopAnimatingFauxDOM(),this.stopDrawFauxDOM()},connectFauxDOM:function(i,s,o){return(!this.connectedFauxDOM[s]||o)&&(this.connectedFauxDOM[s]=typeof i!="string"?i:new n(i),this.drawFauxDOMTimeout=setTimeout(this.drawFauxDOM)),this.connectedFauxDOM[s]},drawFauxDOM:function(){var i=$ne(this.connectedFauxDOM,function(s){return s.toReact()});this.setState(i)},animateFauxDOM:function(i){this.animateFauxDOMUntil=Math.max(Date.now()+i,this.animateFauxDOMUntil),this.fauxDOMAnimationInterval||(this.fauxDOMAnimationInterval=setInterval((function(){Date.now()<this.animateFauxDOMUntil?this.drawFauxDOM():this.stopAnimatingFauxDOM()}).bind(this),16))},stopAnimatingFauxDOM:function(){this.fauxDOMAnimationInterval=clearInterval(this.fauxDOMAnimationInterval),this.animateFauxDOMUntil=0},stopDrawFauxDOM:function(){this.drawFauxDOMTimeout=clearTimeout(this.drawFauxDOMTimeout)},isAnimatingFauxDOM:function(){return!!this.fauxDOMAnimationInterval},render:function(){var i=Object.assign({},this.props,this.state,{connectFauxDOM:this.connectFauxDOM,drawFauxDOM:this.drawFauxDOM,animateFauxDOM:this.animateFauxDOM,stopAnimatingFauxDOM:this.stopAnimatingFauxDOM,isAnimatingFauxDOM:this.isAnimatingFauxDOM});return Une.createElement(t,i)}});return r.displayName="WithFauxDOM("+Hne(t)+")",jne(r,t),r}return e}function Hne(n){return n.displayName||n.name||"Component"}var Gne=zne,Wne=dne,qne=fne,Kne=Gne;function Yne(){var n=Wne(),e=qne(),t={Element:n,defaultView:e,withFauxDOM:Kne(n),createElement:function(r){return new n(r)},createElementNS:function(r,i){return this.createElement(i)},compareDocumentPosition:function(){return 8}};return n.prototype.ownerDocument=t,t}var Qne=Yne,Xne=Qne,Jne=Xne();const Zne=_g(Jne);var ere={value:function(){}};function Sj(){for(var n=0,e=arguments.length,t={},r;n<e;++n){if(!(r=arguments[n]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new p_(t)}function p_(n){this._=n}function tre(n,e){return n.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");if(i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}p_.prototype=Sj.prototype={constructor:p_,on:function(n,e){var t=this._,r=tre(n+"",t),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(n=r[s]).type)&&(i=nre(t[i],n.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(i=(n=r[s]).type)t[i]=EL(t[i],n.name,e);else if(e==null)for(i in t)t[i]=EL(t[i],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new p_(n)},call:function(n,e){if((i=arguments.length-2)>0)for(var t=new Array(i),r=0,i,s;r<i;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],r=0,i=s.length;r<i;++r)s[r].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],i=0,s=r.length;i<s;++i)r[i].value.apply(e,t)}};function nre(n,e){for(var t=0,r=n.length,i;t<r;++t)if((i=n[t]).name===e)return i.value}function EL(n,e,t){for(var r=0,i=n.length;r<i;++r)if(n[r].name===e){n[r]=ere,n=n.slice(0,r).concat(n.slice(r+1));break}return t!=null&&n.push({name:e,value:t}),n}const rre=Object.freeze(Object.defineProperty({__proto__:null,dispatch:Sj},Symbol.toStringTag,{value:"Module"})),ire=kK(rre),sre=ire.dispatch,CT=Math.PI/180,ore={archimedean:Aj,rectangular:yre},jy=64,m_=2048;var are=function(){var n=[256,256],e=lre,t=cre,r=ure,i=bL,s=bL,o=dre,a=hre,l=Aj,c=[],u=1/0,h=sre("word","end"),f=null,v=Math.random,w={},E=wre;w.canvas=function(_){return arguments.length?(E=bc(_),w):E},w.start=function(){var _=A(E()),b=vre((n[0]>>5)*n[1]),g=null,y=c.length,x=-1,S=[],I=c.map(function(N,M){return N.text=e.call(this,N,M),N.font=t.call(this,N,M),N.style=i.call(this,N,M),N.weight=s.call(this,N,M),N.rotate=o.call(this,N,M),N.size=~~r.call(this,N,M),N.padding=a.call(this,N,M),N}).sort(function(N,M){return M.size-N.size});return f&&clearInterval(f),f=setInterval(P,0),P(),w;function P(){for(var N=Date.now();Date.now()-N<u&&++x<y&&f;){var M=I[x];M.x=n[0]*(v()+.5)>>1,M.y=n[1]*(v()+.5)>>1,fre(_,M,I,x),M.hasText&&T(b,M,g)&&(S.push(M),h.call("word",w,M),g?mre(g,M):g=[{x:M.x+M.x0,y:M.y+M.y0},{x:M.x+M.x1,y:M.y+M.y1}],M.x-=n[0]>>1,M.y-=n[1]>>1)}x>=y&&(w.stop(),h.call("end",w,S,g))}},w.stop=function(){f&&(clearInterval(f),f=null);for(const _ of c)delete _.sprite;return w};function A(_){const b=_.getContext("2d",{willReadFrequently:!0});_.width=_.height=1;const g=Math.sqrt(b.getImageData(0,0,1,1).data.length>>2);return _.width=(jy<<5)/g,_.height=m_/g,b.fillStyle=b.strokeStyle="red",{context:b,ratio:g}}function T(_,b,g){n[0],n[1];for(var y=b.x,x=b.y,S=Math.sqrt(n[0]*n[0]+n[1]*n[1]),I=l(n),P=v()<.5?1:-1,N=-P,M,V,L;(M=I(N+=P))&&(V=~~M[0],L=~~M[1],!(Math.min(Math.abs(V),Math.abs(L))>=S));)if(b.x=y+V,b.y=x+L,!(b.x+b.x0<0||b.y+b.y0<0||b.x+b.x1>n[0]||b.y+b.y1>n[1])&&(!g||gre(b,g))&&!pre(b,_,n[0])){for(var j=b.sprite,oe=b.width>>5,$=n[0]>>5,B=b.x-(oe<<4),G=B&127,Z=32-G,ee=b.y1-b.y0,fe=(b.y+b.y0)*$+(B>>5),ae,_e=0;_e<ee;_e++){ae=0;for(var Qe=0;Qe<=oe;Qe++)_[fe+Qe]|=ae<<Z|(Qe<oe?(ae=j[_e*oe+Qe])>>>G:0);fe+=$}return!0}return!1}return w.timeInterval=function(_){return arguments.length?(u=_??1/0,w):u},w.words=function(_){return arguments.length?(c=_,w):c},w.size=function(_){return arguments.length?(n=[+_[0],+_[1]],w):n},w.font=function(_){return arguments.length?(t=bc(_),w):t},w.fontStyle=function(_){return arguments.length?(i=bc(_),w):i},w.fontWeight=function(_){return arguments.length?(s=bc(_),w):s},w.rotate=function(_){return arguments.length?(o=bc(_),w):o},w.text=function(_){return arguments.length?(e=bc(_),w):e},w.spiral=function(_){return arguments.length?(l=ore[_]||_,w):l},w.fontSize=function(_){return arguments.length?(r=bc(_),w):r},w.padding=function(_){return arguments.length?(a=bc(_),w):a},w.random=function(_){return arguments.length?(v=_,w):v},w.on=function(){var _=h.on.apply(h,arguments);return _===h?w:_},w};function lre(n){return n.text}function cre(){return"serif"}function bL(){return"normal"}function ure(n){return Math.sqrt(n.value)}function dre(){return(~~(random()*6)-3)*30}function hre(){return 1}function fre(n,e,t,r){if(!e.sprite){var i=n.context,s=n.ratio;i.clearRect(0,0,(jy<<5)/s,m_/s);var o=0,a=0,l=0,c=t.length;for(--r;++r<c;){e=t[r],i.save(),i.font=e.style+" "+e.weight+" "+~~((e.size+1)/s)+"px "+e.font;const M=i.measureText(e.text),V=-Math.floor(M.width/2);let L=(M.width+1)*s,j=e.size<<1;if(e.rotate){var u=Math.sin(e.rotate*CT),h=Math.cos(e.rotate*CT),f=L*h,v=L*u,w=j*h,E=j*u;L=Math.max(Math.abs(f+E),Math.abs(f-E))+31>>5<<5,j=~~Math.max(Math.abs(v+w),Math.abs(v-w))}else L=L+31>>5<<5;if(j>l&&(l=j),o+L>=jy<<5&&(o=0,a+=l,l=0),a+j>=m_)break;i.translate((o+(L>>1))/s,(a+(j>>1))/s),e.rotate&&i.rotate(e.rotate*CT),i.fillText(e.text,V,0),e.padding&&(i.lineWidth=2*e.padding,i.strokeText(e.text,V,0)),i.restore(),e.width=L,e.height=j,e.xoff=o,e.yoff=a,e.x1=L>>1,e.y1=j>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,o+=L}for(var A=i.getImageData(0,0,(jy<<5)/s,m_/s).data,T=[];--r>=0;)if(e=t[r],!!e.hasText){for(var _=e.width,b=_>>5,g=e.y1-e.y0,y=0;y<g*b;y++)T[y]=0;if(o=e.xoff,o==null)return;a=e.yoff;for(var x=0,S=-1,I=0;I<g;I++){for(var y=0;y<_;y++){var P=b*I+(y>>5),N=A[(a+I)*(jy<<5)+(o+y)<<2]?1<<31-y%32:0;T[P]|=N,x|=N}x?S=I:(e.y0++,g--,I--,a++)}e.y1=e.y0+S,e.sprite=T.slice(0,(e.y1-e.y0)*b)}}}function pre(n,e,t){t>>=5;for(var r=n.sprite,i=n.width>>5,s=n.x-(i<<4),o=s&127,a=32-o,l=n.y1-n.y0,c=(n.y+n.y0)*t+(s>>5),u,h=0;h<l;h++){u=0;for(var f=0;f<=i;f++)if((u<<a|(f<i?(u=r[h*i+f])>>>o:0))&e[c+f])return!0;c+=t}return!1}function mre(n,e){var t=n[0],r=n[1];e.x+e.x0<t.x&&(t.x=e.x+e.x0),e.y+e.y0<t.y&&(t.y=e.y+e.y0),e.x+e.x1>r.x&&(r.x=e.x+e.x1),e.y+e.y1>r.y&&(r.y=e.y+e.y1)}function gre(n,e){return n.x+n.x1>e[0].x&&n.x+n.x0<e[1].x&&n.y+n.y1>e[0].y&&n.y+n.y0<e[1].y}function Aj(n){var e=n[0]/n[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function yre(n){var e=4,t=e*n[0]/n[1],r=0,i=0;return function(s){var o=s<0?-1:1;switch(Math.sqrt(1+4*o*s)-o&3){case 0:r+=t;break;case 1:i+=e;break;case 2:r-=t;break;default:i-=e;break}return[r,i]}}function vre(n){for(var e=[],t=-1;++t<n;)e[t]=0;return e}function wre(){return document.createElement("canvas")}function bc(n){return typeof n=="function"?n:function(){return n}}const Ere=_g(are);var bre=typeof Element<"u",_re=typeof Map=="function",Sre=typeof Set=="function",Are=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function g_(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){if(n.constructor!==e.constructor)return!1;var t,r,i;if(Array.isArray(n)){if(t=n.length,t!=e.length)return!1;for(r=t;r--!==0;)if(!g_(n[r],e[r]))return!1;return!0}var s;if(_re&&n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(s=n.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=n.entries();!(r=s.next()).done;)if(!g_(r.value[1],e.get(r.value[0])))return!1;return!0}if(Sre&&n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(s=n.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(Are&&ArrayBuffer.isView(n)&&ArrayBuffer.isView(e)){if(t=n.length,t!=e.length)return!1;for(r=t;r--!==0;)if(n[r]!==e[r])return!1;return!0}if(n.constructor===RegExp)return n.source===e.source&&n.flags===e.flags;if(n.valueOf!==Object.prototype.valueOf&&typeof n.valueOf=="function"&&typeof e.valueOf=="function")return n.valueOf()===e.valueOf();if(n.toString!==Object.prototype.toString&&typeof n.toString=="function"&&typeof e.toString=="function")return n.toString()===e.toString();if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(bre&&n instanceof Element)return!1;for(r=t;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&n.$$typeof)&&!g_(n[i[r]],e[i[r]]))return!1;return!0}return n!==n&&e!==e}var Tre=function(e,t){try{return g_(e,t)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}};const Ire=_g(Tre);var VC="http://www.w3.org/1999/xhtml";const _L={svg:"http://www.w3.org/2000/svg",xhtml:VC,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Tj(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),_L.hasOwnProperty(e)?{space:_L[e],local:n}:n}function xre(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===VC&&e.documentElement.namespaceURI===VC?e.createElement(n):e.createElementNS(t,n)}}function Cre(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function Ij(n){var e=Tj(n);return(e.local?Cre:xre)(e)}function Pre(){}function xj(n){return n==null?Pre:function(){return this.querySelector(n)}}function Rre(n){typeof n!="function"&&(n=xj(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=new Array(o),l,c,u=0;u<o;++u)(l=s[u])&&(c=n.call(l,l.__data__,u,s))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new $s(r,this._parents)}function Cj(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function kre(){return[]}function Dre(n){return n==null?kre:function(){return this.querySelectorAll(n)}}function Mre(n){return function(){var e=n.apply(this,arguments);return e==null?[]:Cj(e)}}function Nre(n){typeof n=="function"?n=Mre(n):n=Dre(n);for(var e=this._groups,t=e.length,r=[],i=[],s=0;s<t;++s)for(var o=e[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(r.push(n.call(l,l.__data__,c,o)),i.push(l));return new $s(r,i)}function Lre(n){return function(){return this.matches(n)}}function Pj(n){return function(e){return e.matches(n)}}var Ore=Array.prototype.find;function Fre(n){return function(){return Ore.call(this.children,n)}}function Vre(){return this.firstElementChild}function Ure(n){return this.select(n==null?Vre:Fre(typeof n=="function"?n:Pj(n)))}var Bre=Array.prototype.filter;function $re(){return this.children}function jre(n){return function(){return Bre.call(this.children,n)}}function zre(n){return this.selectAll(n==null?$re:jre(typeof n=="function"?n:Pj(n)))}function Hre(n){typeof n!="function"&&(n=Lre(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var s=e[i],o=s.length,a=r[i]=[],l,c=0;c<o;++c)(l=s[c])&&n.call(l,l.__data__,c,s)&&a.push(l);return new $s(r,this._parents)}function Rj(n){return new Array(n.length)}function Gre(){return new $s(this._enter||this._groups.map(Rj),this._parents)}function CS(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}CS.prototype={constructor:CS,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function Wre(n){return function(){return n}}function qre(n,e,t,r,i,s){for(var o=0,a,l=e.length,c=s.length;o<c;++o)(a=e[o])?(a.__data__=s[o],r[o]=a):t[o]=new CS(n,s[o]);for(;o<l;++o)(a=e[o])&&(i[o]=a)}function Kre(n,e,t,r,i,s,o){var a,l,c=new Map,u=e.length,h=s.length,f=new Array(u),v;for(a=0;a<u;++a)(l=e[a])&&(f[a]=v=o.call(l,l.__data__,a,e)+"",c.has(v)?i[a]=l:c.set(v,l));for(a=0;a<h;++a)v=o.call(n,s[a],a,s)+"",(l=c.get(v))?(r[a]=l,l.__data__=s[a],c.delete(v)):t[a]=new CS(n,s[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(f[a])===l&&(i[a]=l)}function Yre(n){return n.__data__}function Qre(n,e){if(!arguments.length)return Array.from(this,Yre);var t=e?Kre:qre,r=this._parents,i=this._groups;typeof n!="function"&&(n=Wre(n));for(var s=i.length,o=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var u=r[c],h=i[c],f=h.length,v=Cj(n.call(u,u&&u.__data__,c,r)),w=v.length,E=a[c]=new Array(w),A=o[c]=new Array(w),T=l[c]=new Array(f);t(u,h,E,A,T,v,e);for(var _=0,b=0,g,y;_<w;++_)if(g=E[_]){for(_>=b&&(b=_+1);!(y=A[b])&&++b<w;);g._next=y||null}}return o=new $s(o,r),o._enter=a,o._exit=l,o}function Xre(){return new $s(this._exit||this._groups.map(Rj),this._parents)}function Jre(n,e,t){var r=this.enter(),i=this,s=this.exit();return r=typeof n=="function"?n(r):r.append(n+""),e!=null&&(i=e(i)),t==null?s.remove():t(s),r&&i?r.merge(i).order():i}function Zre(n){if(!(n instanceof $s))throw new Error("invalid merge");for(var e=this._groups,t=n._groups,r=e.length,i=t.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var l=e[a],c=t[a],u=l.length,h=o[a]=new Array(u),f,v=0;v<u;++v)(f=l[v]||c[v])&&(h[v]=f);for(;a<r;++a)o[a]=e[a];return new $s(o,this._parents)}function eie(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function tie(n){n||(n=nie);function e(h,f){return h&&f?n(h.__data__,f.__data__):!h-!f}for(var t=this._groups,r=t.length,i=new Array(r),s=0;s<r;++s){for(var o=t[s],a=o.length,l=i[s]=new Array(a),c,u=0;u<a;++u)(c=o[u])&&(l[u]=c);l.sort(e)}return new $s(i,this._parents).order()}function nie(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function rie(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function iie(){return Array.from(this)}function sie(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function oie(){let n=0;for(const e of this)++n;return n}function aie(){return!this.node()}function lie(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],s=0,o=i.length,a;s<o;++s)(a=i[s])&&n.call(a,a.__data__,s,i);return this}function cie(n){return function(){this.removeAttribute(n)}}function uie(n){return function(){this.removeAttributeNS(n.space,n.local)}}function die(n,e){return function(){this.setAttribute(n,e)}}function hie(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function fie(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function pie(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function mie(n,e){var t=Tj(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?uie:cie:typeof e=="function"?t.local?pie:fie:t.local?hie:die)(t,e))}function kj(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function gie(n){return function(){this.style.removeProperty(n)}}function yie(n,e,t){return function(){this.style.setProperty(n,e,t)}}function vie(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function wie(n,e,t){return arguments.length>1?this.each((e==null?gie:typeof e=="function"?vie:yie)(n,e,t??"")):Eie(this.node(),n)}function Eie(n,e){return n.style.getPropertyValue(e)||kj(n).getComputedStyle(n,null).getPropertyValue(e)}function bie(n){return function(){delete this[n]}}function _ie(n,e){return function(){this[n]=e}}function Sie(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function Aie(n,e){return arguments.length>1?this.each((e==null?bie:typeof e=="function"?Sie:_ie)(n,e)):this.node()[n]}function Dj(n){return n.trim().split(/^|\s+/)}function Fk(n){return n.classList||new Mj(n)}function Mj(n){this._node=n,this._names=Dj(n.getAttribute("class")||"")}Mj.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function Nj(n,e){for(var t=Fk(n),r=-1,i=e.length;++r<i;)t.add(e[r])}function Lj(n,e){for(var t=Fk(n),r=-1,i=e.length;++r<i;)t.remove(e[r])}function Tie(n){return function(){Nj(this,n)}}function Iie(n){return function(){Lj(this,n)}}function xie(n,e){return function(){(e.apply(this,arguments)?Nj:Lj)(this,n)}}function Cie(n,e){var t=Dj(n+"");if(arguments.length<2){for(var r=Fk(this.node()),i=-1,s=t.length;++i<s;)if(!r.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?xie:e?Tie:Iie)(t,e))}function Pie(){this.textContent=""}function Rie(n){return function(){this.textContent=n}}function kie(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function Die(n){return arguments.length?this.each(n==null?Pie:(typeof n=="function"?kie:Rie)(n)):this.node().textContent}function Mie(){this.innerHTML=""}function Nie(n){return function(){this.innerHTML=n}}function Lie(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function Oie(n){return arguments.length?this.each(n==null?Mie:(typeof n=="function"?Lie:Nie)(n)):this.node().innerHTML}function Fie(){this.nextSibling&&this.parentNode.appendChild(this)}function Vie(){return this.each(Fie)}function Uie(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Bie(){return this.each(Uie)}function $ie(n){var e=typeof n=="function"?n:Ij(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function jie(){return null}function zie(n,e){var t=typeof n=="function"?n:Ij(n),r=e==null?jie:typeof e=="function"?e:xj(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function Hie(){var n=this.parentNode;n&&n.removeChild(this)}function Gie(){return this.each(Hie)}function Wie(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function qie(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Kie(n){return this.select(n?qie:Wie)}function Yie(n){return arguments.length?this.property("__data__",n):this.node().__data__}function Qie(n){return function(e){n.call(this,e,this.__data__)}}function Xie(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function Jie(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,i=e.length,s;t<i;++t)s=e[t],(!n.type||s.type===n.type)&&s.name===n.name?this.removeEventListener(s.type,s.listener,s.options):e[++r]=s;++r?e.length=r:delete this.__on}}}function Zie(n,e,t){return function(){var r=this.__on,i,s=Qie(e);if(r){for(var o=0,a=r.length;o<a;++o)if((i=r[o]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=s,i.options=t),i.value=e;return}}this.addEventListener(n.type,s,t),i={type:n.type,name:n.name,value:e,listener:s,options:t},r?r.push(i):this.__on=[i]}}function ese(n,e,t){var r=Xie(n+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(i=0,u=a[l];i<s;++i)if((o=r[i]).type===u.type&&o.name===u.name)return u.value}return}for(a=e?Zie:Jie,i=0;i<s;++i)this.each(a(r[i],e,t));return this}function Oj(n,e,t){var r=kj(n),i=r.CustomEvent;typeof i=="function"?i=new i(e,t):(i=r.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),n.dispatchEvent(i)}function tse(n,e){return function(){return Oj(this,n,e)}}function nse(n,e){return function(){return Oj(this,n,e.apply(this,arguments))}}function rse(n,e){return this.each((typeof e=="function"?nse:tse)(n,e))}function*ise(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,s=r.length,o;i<s;++i)(o=r[i])&&(yield o)}var sse=[null];function $s(n,e){this._groups=n,this._parents=e}function ose(){return this}$s.prototype={constructor:$s,select:Rre,selectAll:Nre,selectChild:Ure,selectChildren:zre,filter:Hre,data:Qre,enter:Gre,exit:Xre,join:Jre,merge:Zre,selection:ose,order:eie,sort:tie,call:rie,nodes:iie,node:sie,size:oie,empty:aie,each:lie,attr:mie,style:wie,property:Aie,classed:Cie,text:Die,html:Oie,raise:Vie,lower:Bie,append:$ie,insert:zie,remove:Gie,clone:Kie,datum:Yie,on:ese,dispatch:rse,[Symbol.iterator]:ise};function SL(n){return typeof n=="string"?new $s([[document.querySelector(n)]],[document.documentElement]):new $s([[n]],sse)}function ase(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}const AL=Symbol("implicit");function Fj(){var n=new Map,e=[],t=[],r=AL;function i(s){var o=s+"",a=n.get(o);if(!a){if(r!==AL)return r;n.set(o,a=e.push(s))}return t[(a-1)%t.length]}return i.domain=function(s){if(!arguments.length)return e.slice();e=[],n=new Map;for(const o of s){const a=o+"";n.has(a)||n.set(a,e.push(o))}return i},i.range=function(s){return arguments.length?(t=Array.from(s),i):t.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return Fj(e,t).unknown(r)},ase.apply(i,arguments),i}function lse(n){for(var e=n.length/6|0,t=new Array(e),r=0;r<e;)t[r]="#"+n.slice(r*6,++r*6);return t}const cse=lse("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function use(n,e){return pse(n)||fse(n,e)||hse(n,e)||dse()}function dse(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hse(n,e){if(n){if(typeof n=="string")return TL(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return TL(n,e)}}function TL(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function fse(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r=[],i=!0,s=!1,o,a;try{for(t=t.call(n);!(i=(o=t.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(l){s=!0,a=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw a}}return r}}function pse(n){if(Array.isArray(n))return n}var mse=Fj(cse);function Vj(n){var e=n.data,t=n.width,r=t===void 0?700:t,i=n.height,s=i===void 0?600:i,o=n.font,a=o===void 0?"serif":o,l=n.fontStyle,c=l===void 0?"normal":l,u=n.fontWeight,h=u===void 0?"normal":u,f=n.fontSize,v=f===void 0?function(j){return Math.sqrt(j.value)}:f,w=n.rotate,E=w===void 0?function(){return(~~(Math.random()*6)-3)*30}:w,A=n.spiral,T=A===void 0?"archimedean":A,_=n.padding,b=_===void 0?1:_,g=n.random,y=g===void 0?Math.random:g,x=n.fill,S=x===void 0?function(j,oe){return mse(oe)}:x,I=n.onWordClick,P=n.onWordMouseOver,N=n.onWordMouseOut,M=D.useRef();M.current||(M.current=Zne.createElement("div"));var V=M.current;SL(V).selectAll("*").remove();var L=Ere().words(e).size([r,s]).font(a).fontStyle(c).fontWeight(h).fontSize(v).rotate(E).spiral(T).padding(b).random(y).on("end",function(j){var oe=L.size(),$=use(oe,2),B=$[0],G=$[1],Z=SL(V).append("svg").attr("viewBox","0 0 ".concat(B," ").concat(G)).attr("preserveAspectRatio","xMinYMin meet").append("g").attr("transform","translate(".concat(B/2,",").concat(G/2,")")).selectAll("text").data(j).enter().append("text").style("font-family",function(ee){return ee.font}).style("font-style",function(ee){return ee.style}).style("font-weight",function(ee){return ee.weight}).style("font-size",function(ee){return"".concat(ee.size,"px")}).style("fill",S).attr("text-anchor","middle").attr("transform",function(ee){return"translate(".concat([ee.x,ee.y],")rotate(").concat(ee.rotate,")")}).text(function(ee){return ee.text});I&&Z.on("click",I),P&&Z.on("mouseover",P),N&&Z.on("mouseout",N)});return L.start(),V.toReact()}Vj.propTypes={data:jt.arrayOf(jt.shape({text:jt.string.isRequired,value:jt.number.isRequired})).isRequired,width:jt.number,height:jt.number,font:jt.oneOfType([jt.string,jt.func]),fontStyle:jt.oneOfType([jt.string,jt.func]),fontWeight:jt.oneOfType([jt.string,jt.number,jt.func]),fontSize:jt.oneOfType([jt.number,jt.func]),rotate:jt.oneOfType([jt.number,jt.func]),spiral:jt.oneOfType([jt.oneOf(["archimedean"]),jt.oneOf(["rectangular"]),jt.func]),padding:jt.oneOfType([jt.number,jt.func]),random:jt.func,onWordClick:jt.func,onWordMouseOver:jt.func,onWordMouseOut:jt.func};const gse=m.memo(Vj,Ire),yse={MatemÃ¡tica:"MAT",Matematica:"MAT","MatemÃ¡tica ":"MAT",FÃ­sica:"FIS",Fisica:"FIS",QuÃ­mica:"QUI",Quimica:"QUI",BiologÃ­a:"BIO",Biologia:"BIO",Historia:"HIS",Lenguaje:"LEN","Lenguaje y ComunicaciÃ³n":"LEN"},vse={"7Â° bÃ¡sico":"7b","7mo bÃ¡sico":"7b","7 bÃ¡sico":"7b","7Â° BÃ¡sico":"7b","8Â° bÃ¡sico":"8b","8mo bÃ¡sico":"8b","8 bÃ¡sico":"8b","8Â° BÃ¡sico":"8b","1Â° medio":"1m","1ro medio":"1m","1 medio":"1m","1Â° Medio":"1m","2Â° medio":"2m","2do medio":"2m","2 medio":"2m","2Â° Medio":"2m","3Â° medio":"3m","3ro medio":"3m","3 medio":"3m","3Â° Medio":"3m","4Â° medio":"4m","4to medio":"4m","4 medio":"4m","4Â° Medio":"4m"};function wse(n,e){const t=yse[n==null?void 0:n.trim()]||n,r=vse[e==null?void 0:e.trim()]||e;return{materiaId:t,gradoId:r}}async function Ese(n,e){const t=tn(X,"curriculo",String(n),"niveles",String(e),"unidades"),i=(await $n(t)).docs.map(s=>({id:s.id,...s.data()}));return i.sort((s,o)=>String(s.codigo||s.id).localeCompare(String(o.codigo||o.id),"es",{numeric:!0})),i}function Rg(n=new Date){const e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);const r=new Date(Date.UTC(e.getUTCFullYear(),0,1)),s=`0${Math.ceil(((e-r)/864e5+1)/7)}`.slice(-2);return`${e.getUTCFullYear()}-${s}`}function Uj(n,e){return`${n}-${e}`}function Bj(n,e){const t=n.toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),""),r=e.toLowerCase().replaceAll(" ","").replace("Âº","o").replace("Â°","o");return`${t}_${r}`}async function bse(n,e){const t=Bj(n,e),r=se(X,"catalogo_curricular",t),i=await Fe(r);return i.exists()?i.data():null}async function IL(n,e,t=new Date){var i;if(!n||!e)throw new Error("Faltan uid u horario");const r=Rg(t);for(let s=0;s<((e==null?void 0:e.length)||0);s++){const o=e[s]||[];for(let a=0;a<((o==null?void 0:o.length)||0);a++){const l=o[a];if(!l)continue;const{asignatura:c,nivel:u,titulo:h}=l;if(!c||!u)continue;const f=await bse(c,u),v=(f==null?void 0:f.fuentes)||[];let w=null,E=null,A=null;try{const{unidades:b,programaUrl:g}=await $j(c,u);let y=null;if(l!=null&&l.unidad){const x=String(l.unidad).toLowerCase();y=(b||[]).find(S=>[S.titulo,S.nombre].filter(Boolean).some(I=>String(I).toLowerCase().includes(x)))}y=y||(b==null?void 0:b[0])||null,y&&(w=y.titulo||y.nombre||null,E=y.objetivo??(Array.isArray(y.objetivos)?((i=y.objetivos[0])==null?void 0:i.texto)??y.objetivos[0]:null)??null,A=Array.isArray(y.habilidades)?y.habilidades.join(", "):y.habilidades??null),!(f!=null&&f.programaUrl)&&g&&(f.programaUrl=g)}catch{}!w&&(l!=null&&l.unidad)&&(w=l.unidad),!E&&(l!=null&&l.objetivo)&&(E=l.objetivo),!A&&(l!=null&&l.habilidades)&&(A=l.habilidades);const T=Uj(s,a),_=se(X,"planificaciones_sugeridas",n,r,T);await xt(_,{uid:n,yearWeek:r,slotId:T,diaIndex:s,horaIndex:a,asignatura:c,nivel:u,titulo:h||`${c} - ${u}`,fuentes:v,programaUrl:(f==null?void 0:f.programaUrl)||null,origen:"catalogo_curricular",version:(f==null?void 0:f.version)||"desconocida",needs_review:v.length===0,unidadTitulo:w||null,objetivo:E||null,habilidades:A||null,createdAt:ut()},{merge:!0})}}return{ok:!0,yearWeek:r}}async function $j(n,e){const t=Bj(n,e),r=se(X,"catalogo_curricular",t),i=await Fe(r),s=i.exists()&&i.data().programaUrl||null,o=tn(X,"catalogo_curricular",t,"unidades"),a=await $n(o),l=[];return a.forEach(c=>l.push({id:c.id,...c.data()})),l.sort((c,u)=>(c.numero||0)-(u.numero||0)),{programaUrl:s,unidades:l}}const jj=(...n)=>Rg(...n);async function zj(n,e=Rg()){const t=tn(X,"planificaciones_sugeridas",n,e);return(await $n(t)).docs.map(i=>({id:i.id,...i.data()}))}async function _se(n,e,t){const r=se(X,"planificaciones",n,e,t.id);await xt(r,{...t,estado:"aprobada"},{merge:!0});const i=se(X,"planificaciones_sugeridas",n,e,t.id);await rR(i)}async function Sse(n,e,t){const r=se(X,"planificaciones_sugeridas",n,e,t);await rR(r)}async function Hj(){var e;return(e=we.currentUser)!=null&&e.uid?we.currentUser.uid:(await mo(we)).user.uid}function Ase(n=new Date){const e=new Date(n);e.setHours(0,0,0,0);const t=e.getDay(),r=(t===0?-6:1)-t;e.setDate(e.getDate()+r);const i=new Date(e),s=new Date(i.getFullYear(),0,1),o=(()=>{const c=s.getDay(),u=(c===0?-6:1)-c,h=new Date(s);return h.setDate(s.getDate()+u),h.setHours(0,0,0,0),h})(),a=Math.floor((i-o)/864e5),l=Math.floor(a/7)+1;return`${i.getFullYear()}-W${String(l).padStart(2,"0")}`}function Gj(n=new Date){return(n.getDay()+6)%7}async function Tse(n){var r;const e=se(X,"usuarios",n),t=await Fe(e);return t.exists()?((r=t.data())==null?void 0:r.horarioConfig)||{}:{}}function Wj(n,e=new Date){const t=Array.isArray(n==null?void 0:n.marcas)?n.marcas:[];if(t.length<2)return null;const r=e.getHours(),i=e.getMinutes(),s=r*60+i;for(let o=0;o<t.length-1;o++){const a=t[o][0]*60+t[o][1],l=t[o+1][0]*60+t[o+1][1];if(s>=a&&s<l)return o}return null}async function Ise(n,e){var i;const t=se(X,"usuarios",n,"planificacion_calendario",e),r=await Fe(t);return r.exists()?((i=r.data())==null?void 0:i.items)||[]:[]}async function xL(n,e,t){const r=`${e}-${t}`,i=se(X,"clases_detalle",n,"slots",r),s=await Fe(i);return s.exists()?s.data():null}function CL(n){const[e,t]=String(n).trim().split(":").map(Number);return(e||0)*60+(t||0)}function xse(n){const e=String(n||""),t=e.split("(")[0].trim(),[r,i]=t.split("-").map(o=>o.trim()),s=/\((recreo|almuerzo)\)/i.test(e);return{ini:CL(r),fin:CL(i),esPausa:s}}function qj(n,e=new Date){const t=Array.isArray(n==null?void 0:n.bloquesGenerados)?n.bloquesGenerados:[];if(!t.length)return{index:null,esPausa:!1};const r=e.getHours()*60+e.getMinutes();for(let i=0;i<t.length;i++){const{ini:s,fin:o,esPausa:a}=xse(t[i]);if(r>=s&&r<o)return{index:i,esPausa:a}}return{index:null,esPausa:!1}}async function Cse(n,e=new Date){const t=se(X,"usuarios",n),r=await Fe(t);if(!r.exists())return null;const i=r.data()||{},s=i.horarioConfig||{};let o=Wj(s,e),a=!1;if(o==null){const w=qj(s,e);o=w.index,a=w.esPausa}const l=Gj(e);if(l<0||l>6||o==null||a)return null;const u=(Array.isArray(s==null?void 0:s.bloquesGenerados)?s.bloquesGenerados:[]).length||10,h=Array.isArray(i.horario)?i.horario:[],f=h.find(w=>(w==null?void 0:w.dia)===l&&(w==null?void 0:w.bloque)===o)??h[l*u+o];if(!f)return{col:l,fila:o,cursoId:null,slot:null};const v=f.cursoId||f.curso_id||null;return{col:l,fila:o,cursoId:v,slot:f,bloquesAncho:u}}async function Pse(n,e,t=new Date){if(!n)return null;const r=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),o=`${r}-${i}-${s}`,a=se(X,"planificaciones",n,"fechas",o,`b${e}`),l=await Fe(a);if(l.exists()){const y=l.data();return{unidad:y.unidad||"",objetivo:y.objetivo||"",habilidades:Array.isArray(y.habilidades)?y.habilidades:y.habilidades?[y.habilidades]:[],fuente:"override"}}const c=se(X,"cursos",n),u=await Fe(c);if(!u.exists())return null;const h=u.data()||{},f=h.progreso||{unidad_idx:0,objetivo_idx:0},[v,w]=String(h.plan_ref||"").split("/"),E=se(X,v||"catalogo_curricular",w),A=await Fe(E);if(!A.exists())return null;const T=A.data()||{},b=(Array.isArray(T.unidades)?T.unidades:[])[f.unidad_idx]||{},g=(b.objetivos||[])[f.objetivo_idx]||{};return{unidad:b.nombre||b.titulo||"",objetivo:g.descripcion||g.texto||g||"",habilidades:Array.isArray(g.habilidades)?g.habilidades:g.habilidades?[g.habilidades]:[],fuente:"progreso",_curso:h}}async function Rse(n,e=new Date){var a;const t=await Cse(n,e);if(!t)return null;if(t.slot&&(t.slot.unidad||t.slot.objetivo))return{curso:t.slot.curso||t.slot.cursoNombre||"",asignatura:t.slot.asignatura||"",unidad:t.slot.unidad||"",objetivo:t.slot.objetivo||"",habilidades:Array.isArray(t.slot.habilidades)?t.slot.habilidades:t.slot.habilidades?[t.slot.habilidades]:[],profesor:((a=t.slot.profesor)==null?void 0:a.nombre)||"",_debug:{fuente:"usuarios.horario",cursoId:t.cursoId,bloque:t.fila,dia:t.col}};const r=await Pse(t.cursoId,t.fila,e);if(!r)return null;const i=se(X,"cursos",t.cursoId),s=await Fe(i),o=s.exists()?s.data():{};return{curso:o.nombre||"",asignatura:o.asignatura||"",unidad:r.unidad||"(sin unidad)",objetivo:r.objetivo||"(sin objetivo)",habilidades:r.habilidades||[],profesor:o.profesor||"",_debug:{fuente:r.fuente||"progreso",cursoId:t.cursoId,bloque:t.fila,dia:t.col}}}async function c1(n=new Date){const e=await Hj(),t=await Tse(e);let r=Wj(t,n),i=!1;if(r==null){const h=qj(t,n);r=h.index,i=h.esPausa}const s=Gj(n);if(r==null||s<0||s>6)return{fuente:"ninguna",fila:null,col:null};if(i)return{fuente:"pausa",fila:r,col:s};const o=Ase(n),l=(await Ise(e,o)).find(h=>h.fila===r&&h.col===s);if(l){const h=await xL(e,r,s);return{fuente:"calendario",fila:r,col:s,unidad:l.unidadNombre,evaluacion:!!l.evaluacion,objetivo:(h==null?void 0:h.objetivo)||"",habilidades:(h==null?void 0:h.habilidades)||"",asignatura:(h==null?void 0:h.asignatura)||"",nivel:(h==null?void 0:h.nivel)||""}}const c=await xL(e,r,s);if(c)return{fuente:"slots",fila:r,col:s,unidad:c.unidad||"",evaluacion:!1,objetivo:c.objetivo||"",habilidades:c.habilidades||"",asignatura:c.asignatura||"",nivel:c.nivel||""};const u=await Rse(e,n);return u?{fuente:"cursos",fila:r,col:s,unidad:u.unidad||"",evaluacion:!1,objetivo:u.objetivo||"",habilidades:Array.isArray(u.habilidades)?u.habilidades.join(", "):u.habilidades||"",asignatura:u.asignatura||"",nivel:""}:{fuente:"ninguna",fila:r,col:s}}async function kse(n,e){let t="",r="";typeof n=="object"&&n?(t=n.materia||n.asignatura||"",r=n.grado||n.nivel||""):(t=n||"",r=e||"");try{const{materiaId:i,gradoId:s}=wse(t,r),o=await Ese(i,s);if(Array.isArray(o)&&o.length)return{programaUrl:null,unidades:o.map(l=>({id:l.id||l.codigo,codigo:l.codigo||l.id,nombre:l.nombre||l.titulo||`Unidad ${l.codigo||l.id}`,objetivos:l.objetivos??l.oa??l.oas??[],habilidades:Array.isArray(l.habilidades)?l.habilidades:l.habilidades?[l.habilidades]:[],...l})).sort((l,c)=>String(l.codigo||l.id).localeCompare(String(c.codigo||c.id),"es",{numeric:!0}))}}catch(i){console.warn("[Compat] curriculo/* no disponible:",(i==null?void 0:i.message)||i)}return await $j(t,r)}const mi={FREE:{maxStudentsPerClass:10,exports:{pdf:!0,xlsx:!1},tools:{aiBasic:!0}},BASICO:{maxStudentsPerClass:25,exports:{pdf:!0,xlsx:!1},tools:{aiBasic:!0}},PRO:{maxStudentsPerClass:40,exports:{pdf:!0,xlsx:!0},tools:{aiBasic:!0}},PREMIUM:{maxStudentsPerClass:9999,exports:{pdf:!0,xlsx:!0},tools:{aiBasic:!0}}},Dse={user:null,plan:"FREE",caps:mi.FREE,loading:!1},Af=D.createContext(null);function Mse({children:n}){const[e,t]=D.useState(null),[r,i]=D.useState("FREE"),[s,o]=D.useState(mi.FREE),[a,l]=D.useState(!0);return D.useEffect(()=>{const c=ls(we,async u=>{if(t(u||null),!u){i("FREE"),o(mi.FREE),l(!1);return}const h=se(X,"users",u.uid),f=await Fe(h);if(!f.exists())await xt(h,{plan:"FREE",planUntil:null,limits:mi.FREE,createdAt:ut()}),i("FREE"),o(mi.FREE);else{const v=f.data(),w=v.plan||"FREE";i(w),o(v.limits||mi[w]||mi.FREE)}l(!1)});return()=>c()},[]),m.createElement(Af.Provider,{value:{user:e,plan:r,caps:s,loading:a}},n)}function Nse(){return D.useContext(Af)||Dse}async function Lse(n){var e,t,r;try{const i=se(X,"horarios",n),s=await Fe(i);if(s.exists()&&Array.isArray((e=s.data())==null?void 0:e.horario))return s.data().horario}catch{}try{const i=se(X,"usuarios",n),s=await Fe(i);if(!s.exists())return null;const o=s.data();if(o.horarioMatriz)return Object.keys(o.horarioMatriz).sort((l,c)=>Number(l.replace("f",""))-Number(c.replace("f",""))).map(l=>o.horarioMatriz[l]);if(Array.isArray(o.horarioSlots)){const a=((r=(t=o.horarioConfig)==null?void 0:t.bloquesGenerados)==null?void 0:r.length)||16,l=5,c=Array.from({length:a},()=>Array.from({length:l},()=>({asignatura:"",nivel:"",seccion:"",unidad:"",objetivo:"",habilidades:"",codUnidad:""})));return o.horarioSlots.forEach(u=>{(u==null?void 0:u.fila)!=null&&(u==null?void 0:u.col)!=null&&(c[u.fila][u.col]={asignatura:u.asignatura||"",nivel:u.nivel||"",seccion:u.seccion||"",unidad:u.unidad||"",objetivo:u.objetivo||"",habilidades:Array.isArray(u.habilidades)?u.habilidades.join(", "):u.habilidades||"",codUnidad:u.codUnidad||""})}),c}}catch{}return null}async function Ose(n,{overwrite:e=!1}={}){const t=await Lse(n);if(!t)return{ok:!1,reason:"no-matrix"};for(let r=0;r<t.length;r++){const i=t[r]||[];for(let s=0;s<i.length;s++){const o=i[s]||{};if(!(o.asignatura&&o.asignatura.trim()||o.nivel&&o.nivel.trim()||o.seccion&&o.seccion.trim()||o.unidad&&o.unidad.trim()||o.objetivo&&o.objetivo.trim()||o.habilidades&&String(o.habilidades).trim()))continue;const l=`${r}-${s}`,c=se(X,"clases_detalle",n,"slots",l),u=await Fe(c),h=u.exists()?u.data()||{}:{},f=e?{asignatura:o.asignatura||"",nivel:o.nivel||"",seccion:o.seccion||"",unidad:o.unidad||"",objetivo:o.objetivo||"",habilidades:Array.isArray(o.habilidades)?o.habilidades.join(", "):o.habilidades||"",codUnidad:o.codUnidad||"",updatedAt:ut()}:{asignatura:h.asignatura||o.asignatura||"",nivel:h.nivel||o.nivel||"",seccion:h.seccion||o.seccion||"",unidad:h.unidad||o.unidad||"",objetivo:h.objetivo||o.objetivo||"",habilidades:h.habilidades||(Array.isArray(o.habilidades)?o.habilidades.join(", "):o.habilidades||""),codUnidad:h.codUnidad||o.codUnidad||"",updatedAt:ut()};await xt(c,f,{merge:!0})}}return{ok:!0}}const Kj={"7B":"7Â° bÃ¡sico","8B":"8Â° bÃ¡sico","1M":"1Â° medio","2M":"2Â° medio","3M":"3Â° medio","4M":"4Â° medio"};Object.fromEntries(Object.entries(Kj).map(([n,e])=>[e,n]));function Fse(n=""){const e=String(n).trim().toUpperCase().replace(/\s+/g,"").replace(/[ÂºÂ°]/g,"Â°"),t=e.match(/^([78])B/);if(t)return`${t[1]}B`;const r=e.match(/^([1-4])M/);if(r)return`${r[1]}M`;const i=e.replace(/[^\wÂ°]/g,"");if(/(7|7Â°).*BASI/.test(i))return"7B";if(/(8|8Â°).*BASI/.test(i))return"8B";if(/^1(Â°)?MEDIO/.test(i))return"1M";if(/^2(Â°)?MEDIO/.test(i))return"2M";if(/^3(Â°)?MEDIO/.test(i))return"3M";if(/^4(Â°)?MEDIO/.test(i))return"4M";const s=i.match(/^([1-4])(Â°)?M/);return s?`${s[1]}M`:null}function Vse(n){const e=Fse(n);return e?Kj[e]:null}async function Use(n,e,t){const r=Bo(tn(X,"curriculo_items"),fi("asignaturaId","==",n),fi("nivel","==",e),fi("codUnidad","==",t),z_("oaCodigo"),Fq(1)),s=(await $n(r)).docs[0];return s?s.data().objetivo:null}function rb(n="0-0"){var r;const e=((r=we.currentUser)==null?void 0:r.uid)||localStorage.getItem("uid")||"anon",t=Rg();return`ic_countdown_end:${e}:${t}:${n}`}const sy={user:null,plan:"FREE",caps:mi.FREE,loading:!1},Vn={brandA:"#2193b0",brandB:"#6dd5ed",white:"#ffffff",textDark:"#1f2937",textMuted:"#475569",border:"#e5e7eb",btnText:"#2193b0"},PL={minHeight:"100vh",background:`linear-gradient(to right, ${Vn.brandA}, ${Vn.brandB})`,padding:"2rem",fontFamily:"Segoe UI, sans-serif",color:Vn.white,boxSizing:"border-box"},Bse=(n="1rem")=>({display:"grid",gridTemplateColumns:"1fr 2fr 1fr",gap:n,alignItems:"stretch"}),Zs={background:Vn.white,color:Vn.textDark,borderRadius:12,padding:"1rem",boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)",border:`1px solid ${Vn.border}`,maxWidth:"100%",overflow:"hidden"},zy={background:Vn.white,color:Vn.btnText,border:"none",borderRadius:10,padding:".6rem .9rem",fontWeight:700,cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,.15)"},RL={...zy,padding:".35rem .6rem",fontWeight:600,boxShadow:"none",border:`1px solid ${Vn.border}`},oy="inicioClase_countdown_end",kL=n=>{const e=Math.max(0,n-Date.now()),t=Math.floor(e/6e4),r=Math.floor(e%6e4/1e3);return{m:t,s:r,finished:e===0}},$se=(n,e)=>`${String(n).padStart(2,"0")}:${String(e).padStart(2,"0")}`;function Yj(){const e=new URLSearchParams(window.location.search).get("at");if(!e)return new Date;const[t,r]=e.split(":").map(Number),i=new Date;return i.setHours(t),i.setMinutes(r),i.setSeconds(0),i.setMilliseconds(0),i}function Qj(){const n=new URLSearchParams(window.location.search),e=Number(n.get("dow"));return e>=1&&e<=5?e:null}function PT(){try{const e=new URLSearchParams(window.location.search||"").get("slot");if(!e)return null;const[t,r]=e.split("-").map(i=>Number(i));if(Number.isInteger(t)&&Number.isInteger(r))return`${t}-${r}`}catch{}return null}async function jse(n){var e,t,r;try{const i=se(X,"horarios",n),s=await Fe(i);if(s.exists()&&Array.isArray((e=s.data())==null?void 0:e.horario))return s.data().horario}catch(i){console.debug("[horarios] fallback -> usuarios",i==null?void 0:i.code)}try{const i=se(X,"usuarios",n),s=await Fe(i);if(!s.exists())return null;const o=s.data();if(o.horarioMatriz)return Object.keys(o.horarioMatriz).sort((l,c)=>Number(l.replace("f",""))-Number(c.replace("f",""))).map(l=>o.horarioMatriz[l]);if(Array.isArray(o.horarioSlots)){const a=((r=(t=o.horarioConfig)==null?void 0:t.bloquesGenerados)==null?void 0:r.length)??16,l=5,c=Array.from({length:a},()=>Array.from({length:l},()=>({asignatura:"",nivel:"",seccion:"",unidad:"",objetivo:"",habilidades:""})));return o.horarioSlots.forEach(u=>{(u==null?void 0:u.fila)!=null&&(u==null?void 0:u.col)!=null&&(c[u.fila][u.col]={asignatura:u.asignatura??"",nivel:u.nivel??"",seccion:u.seccion??"",unidad:u.unidad??"",objetivo:u.objetivo??"",habilidades:Array.isArray(u.habilidades)?u.habilidades.join(", "):u.habilidades??""})}),c}}catch(i){console.debug("[usuarios] read error:",i==null?void 0:i.code)}return null}const zse=()=>{const n=Qj(),e=n??new Date().getDay();return e>=1&&e<=5?e-1:0},Hse=(n=[])=>{const e=Yj(),t=e.getHours()*60+e.getMinutes();for(let r=0;r<n.length-1;r++){const i=n[r][0]*60+n[r][1],s=n[r+1][0]*60+n[r+1][1];if(t>=i&&t<s)return r}return 0};function DL(n={}){if(Array.isArray(n.marcas)&&Array.isArray(n.marcas[0]))return n.marcas;if(Array.isArray(n.marcas)&&n.marcas.length&&typeof n.marcas[0]=="object")return n.marcas.map(e=>[Number(e.h)||0,Number(e.m)||0]);if(Array.isArray(n.marcasStr))return n.marcasStr.map(e=>{const[t,r]=String(e).split(":").map(i=>Number(i)||0);return[t,r]});if(Array.isArray(n.bloquesGenerados)&&n.bloquesGenerados.length){const e=n.bloquesGenerados.map(r=>String(r).split(" - ")[0]),t=String(n.bloquesGenerados.at(-1)).split(" - ")[1];return[...e,t].map(r=>{const[i,s]=r.split(":").map(o=>Number(o)||0);return[i,s]})}return[]}const ML=()=>String(Math.floor(1e4+Math.random()*9e4));function NL(){try{const n="http://www.w3.org/2000/svg",e=document.createElementNS(n,"svg");e.setAttribute("width","0"),e.setAttribute("height","0");const t=document.createElementNS(n,"text");t.textContent="m",e.appendChild(t),document.body.appendChild(e);const r=t.getBBox();return document.body.removeChild(e),Number.isFinite(r==null?void 0:r.width)&&r.width>0}catch{return!1}}const LL=()=>/OPR|Opera Mini|Opera/i.test(navigator.userAgent);class Gse extends m.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){try{localStorage.setItem("cloudMode","html")}catch{}return{hasError:!0}}componentDidCatch(e){console.error("[WordCloud SVG] error:",e)}render(){return this.state.hasError?this.props.fallback:this.props.children}}class Wse extends m.Component{constructor(e){super(e),this.state={hasError:!1,err:null}}static getDerivedStateFromError(e){return{hasError:!0,err:e}}componentDidCatch(e,t){console.error("[InicioClase] render error:",e,t)}render(){var e;return this.state.hasError?m.createElement("div",{style:{minHeight:"100vh",display:"grid",placeItems:"center",background:"#f8fafc",fontFamily:"Segoe UI, sans-serif"}},m.createElement("div",{style:{maxWidth:720,background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,boxShadow:"0 10px 30px rgba(0,0,0,.05)",padding:"20px"}},m.createElement("h3",{style:{margin:"0 0 8px"}},"Se produjo un error al dibujar la pantalla"),m.createElement("div",{style:{color:"#475569",marginBottom:12}},"Prueba con los modos de diagnÃ³stico:"),m.createElement("code",{style:{display:"block",background:"#0f172a",color:"#e2e8f0",padding:"10px",borderRadius:8,overflowX:"auto"}},window.location.origin,"/inicio?safe=1&bypass=1",`
`,window.location.origin,"/inicio?nocloud=1&bypass=1"),m.createElement("div",{style:{marginTop:12,color:"#475569"}},"Detalle:"," ",String(((e=this.state.err)==null?void 0:e.message)||this.state.err)||"(sin mensaje)"))):this.props.children}}function OL({data:n,palette:e,width:t,height:r,fontSize:i}){var a;const s=D.useRef(null),o=!!((a=we.currentUser)!=null&&a.uid||localStorage.getItem("uid"));return D.useEffect(()=>{var c;if(!o)return;const l=((c=we.currentUser)==null?void 0:c.uid)||localStorage.getItem("uid");l&&window.__slotsSyncedForUid!==l&&(async()=>{try{await Ose(l,{overwrite:!1}),window.__slotsSyncedForUid=l,console.log("âœ“ slots sincronizados desde el horario")}catch(u){console.warn("syncSlotsFromHorario error:",u)}})()},[o]),D.useEffect(()=>{const l=s.current;if(!l)return;const c=window.devicePixelRatio||1;l.width=Math.floor(t*c),l.height=Math.floor(r*c),l.style.width=`${t}px`,l.style.height=`${r}px`;const u=l.getContext("2d");if(!u)return;u.setTransform(c,0,0,c,0,0),u.clearRect(0,0,t,r);const h=[...n].sort((g,y)=>i(y)-i(g)),f=t/2,v=r/2,w=[],E=4,A=0,T=6,_=.35,b=(g,y)=>!(y.x>g.x+g.w||y.x+y.w<g.x||y.y>g.y+g.h||y.y+y.h<g.y);h.forEach((g,y)=>{const x=Math.max(12,Math.floor(i(g))),S=String(g.text||""),I=e[y%e.length];let P=0,N=!1,M=f,V=v,L;for(let j=0;j<2e3;j++){const oe=A+T*P;M=f+oe*Math.cos(P),V=v+oe*Math.sin(P);const $=u;$.font=`bold ${x}px Segoe UI, sans-serif`,$.textBaseline="middle",$.textAlign="center";const G=$.measureText(S).width,Z=x*.9;if(L={x:M-G/2-E,y:V-Z/2-E,w:G+2*E,h:Z+2*E},w.every(ee=>!b(ee,L))){N=!0;break}P+=_}u.fillStyle=I,u.globalAlpha=.95,u.fillText(S,M,V),u.globalAlpha=1,N&&w.push(L)})},[n,e,t,r,i]),m.createElement("canvas",{ref:s,style:{display:"block",width:t,height:r}})}function FL({show:n,data:e}){if(!n)return null;const t=(r,i)=>m.createElement("div",{key:r,style:{display:"flex",justifyContent:"space-between",gap:8}},m.createElement("span",{style:{opacity:.75}},r),m.createElement("b",null,String(i)));return m.createElement("div",{style:{position:"fixed",left:12,bottom:12,zIndex:9999,background:"#052e16",color:"#d1fae5",padding:"10px 12px",borderRadius:10,boxShadow:"0 8px 24px rgba(0,0,0,.35)",width:260,fontFamily:"Segoe UI, system-ui, sans-serif",fontSize:12}},m.createElement("div",{style:{fontWeight:800,marginBottom:6}},"InicioClase Â· debug"),m.createElement("div",{style:{display:"grid",gap:4}},Object.entries(e).map(([r,i])=>t(r,i))))}function qse(){var Se,Be,kt,Bt;const n=ji(),e=Hs(),t=new URLSearchParams(window.location.search||""),r=t.get("safe")==="1",i=t.get("nocloud")==="1",s=t.get("debug")==="1";try{console.log("[InicioClase] flags",{SAFE_MODE:r,DISABLE_CLOUD:i})}catch{}const{user:o=sy.user,plan:a=sy.plan,caps:l=sy.caps,loading:c=sy.loading}=D.useContext(Af)||sy,[u,h]=D.useState("0-0"),[f,v]=D.useState(!1),[w,E]=D.useState("Profesor"),[A,T]=D.useState(""),[_,b]=D.useState(""),[g,y]=D.useState(null),[x,S]=D.useState(null),[I,P]=D.useState("Â¿CuÃ¡l palabra representa mejor la Ãºltima clase?"),[N,M]=D.useState([]),[V,L]=D.useState(null),[j,oe]=D.useState(localStorage.getItem("salaCode")||""),[$,B]=D.useState(""),[G,Z]=D.useState([]),[ee,fe]=D.useState("auto"),[ae,_e]=D.useState(null),[Qe,Ye]=D.useState(!0);D.useEffect(()=>{const W=PT()||localStorage.getItem("__lastSlotId");W&&h(W)},[]),D.useEffect(()=>{const W=ls(we,async z=>{if(z)v(!0),localStorage.getItem("uid")!==z.uid&&localStorage.setItem("uid",z.uid);else{try{await mo(we)}catch(le){console.error("Anon sign-in:",le)}return}});return()=>W()},[]),D.useEffect(()=>{const W=(e==null?void 0:e.state)||null;if(W)try{const z=W.profesor||{};z!=null&&z.nombre&&E(z.nombre);const le=W.clase||null;le&&y(te=>({...te||{},unidad:le.unidad??(te==null?void 0:te.unidad)??"(sin unidad)",objetivo:le.objetivo??(te==null?void 0:te.objetivo)??"(sin objetivo)",habilidades:le.habilidades??(te==null?void 0:te.habilidades)??"(sin habilidades)",asignatura:le.asignatura??(te==null?void 0:te.asignatura)??A??"(sin asignatura)"}))}catch{}},[]),D.useEffect(()=>{(async()=>{try{const W=await c1(new Date);L(W),W&&(W.unidad||W.objetivo||W.habilidades)&&y(z=>({...z||{},unidad:W.unidad??(z==null?void 0:z.unidad)??"(sin unidad)",objetivo:W.objetivo??(z==null?void 0:z.objetivo)??"(sin objetivo)",habilidades:W.habilidades??(z==null?void 0:z.habilidades)??"(sin habilidades)",asignatura:W.asignatura??(z==null?void 0:z.asignatura)??A??"(sin asignatura)"}))}catch(W){console.error("[Inicio] getClaseVigente:",W)}})()},[A]),D.useEffect(()=>{let W=!1;async function z(){try{Ye(!0),_e(null);const le=(V==null?void 0:V.codUnidad)||null;if(!le){Ye(!1);return}const te=se(X,"curriculo",le),Ee=await Fe(te);W||(Ee.exists()&&_e(Ee.data()),Ye(!1))}catch(le){console.warn("[curriculo] read:",(le==null?void 0:le.code)||(le==null?void 0:le.message)),W||Ye(!1)}}return z(),()=>{W=!0}},[V]),D.useEffect(()=>{b(new Date().toLocaleTimeString());const W=setInterval(()=>b(new Date().toLocaleTimeString()),1e3);return()=>clearInterval(W)},[]);const[gt,ie]=D.useState({m:10,s:0});D.useEffect(()=>{if(!u)return;const W=rb(u);let z=localStorage.getItem(W)||localStorage.getItem(oy);if(!z){const Et=Date.now()+6e5;localStorage.setItem(W,String(Et)),localStorage.setItem(oy,String(Et)),z=String(Et)}const le=Number(z),te=()=>ie(kL(le));te();const Ee=setInterval(te,1e3);return()=>clearInterval(Ee)},[u]);const ot=()=>{const W=Date.now()+6e5,z=rb(u||"0-0");localStorage.setItem(z,String(W)),localStorage.setItem(oy,String(W)),ie(kL(W))},et=()=>{const W=Array.isArray(g==null?void 0:g.habilidades)?g.habilidades.join("; "):(g==null?void 0:g.habilidades)??"";return{asignatura:(g==null?void 0:g.asignatura)??A??"(sin asignatura)",unidad:(g==null?void 0:g.unidad)??"(sin unidad)",objetivo:(g==null?void 0:g.objetivo)??"(sin objetivo)",habilidades:W??"(sin habilidades)",nivel:(g==null?void 0:g.nivel)??"",seccion:(g==null?void 0:g.seccion)??"",bloque:(g==null?void 0:g.bloque)??"",dia:(g==null?void 0:g.dia)??"",codUnidad:(V==null?void 0:V.codUnidad)??(x==null?void 0:x.codUnidad)??"",programaUrl:(x==null?void 0:x.programaUrl)??"",fuentes:Array.isArray(x==null?void 0:x.fuentes)?x.fuentes:[],planId:(x==null?void 0:x.planId)??"",updatedAt:Date.now()}};D.useEffect(()=>{if(gt.m===0&&gt.s===0){const W=rb(u||"0-0"),z=localStorage.getItem(W)||localStorage.getItem(oy)||String(Date.now()),le=Number(z);try{localStorage.setItem("__lastSlotId",u||"0-0")}catch{}const te=et();n("/desarrollo",{state:{slotId:u||"0-0",endMs:le,clase:g||null,ficha:te}})}},[gt,n,u,g]),D.useEffect(()=>{(async()=>{let W=j;W||(W=ML(),localStorage.setItem("salaCode",W),oe(W));try{await xt(se(X,"salas",W),{activa:!0,createdAt:ut()},{merge:!0})}catch(te){console.warn("[sala] setDoc:",(te==null?void 0:te.code)||(te==null?void 0:te.message))}const z=localStorage.getItem("hostOverride"),le=z&&/^https?:\/\/.*/.test(z)?z:window.location.origin;B(`${le}/participa?code=${W}`)})()},[]),D.useEffect(()=>{f&&(window.__salaInitDone||(async()=>{try{let W=j||localStorage.getItem("salaCode");W||(W=ML(),localStorage.setItem("salaCode",W),oe(W)),await xt(se(X,"salas",W),{activa:!0,createdAt:ut()},{merge:!0});const z=localStorage.getItem("hostOverride"),le=z&&/^https?:\/\/.*/.test(z)?z:window.location.origin;B(`${le}/participa?code=${W}`),window.__salaInitDone=!0}catch(W){console.warn("[sala][authed] setDoc:",(W==null?void 0:W.code)||(W==null?void 0:W.message))}})())},[f,j]),D.useEffect(()=>{f&&(async()=>{var z,le;const W=((z=we.currentUser)==null?void 0:z.uid)||localStorage.getItem("uid");if(W)try{const te=se(X,"usuarios",W),Ee=await Fe(te);if(Ee.exists()){const Et=Ee.data();Et!=null&&Et.nombre&&E(Et.nombre),Et!=null&&Et.asignatura&&T(Et.asignatura)}}catch(te){console.warn("[usuarios] read nombre:",te==null?void 0:te.code)}try{const te=se(X,"preguntaClase","actual"),Ee=await Fe(te);Ee.exists()&&((le=Ee.data())!=null&&le.texto)&&P(Ee.data().texto)}catch(te){console.warn("[preguntaClase] read:",te==null?void 0:te.code)}})()},[f]),D.useEffect(()=>{if(!f)return;const W=(...le)=>{for(const te of le){const Ee=(te??"").toString().trim();if(Ee&&!/^\(sin/i.test(Ee))return Ee}return le.find(Boolean)||""},z=le=>Array.isArray(le)?le.join(", "):le??"";(async()=>{var le;try{const te=((le=we.currentUser)==null?void 0:le.uid)||localStorage.getItem("uid");if(!te)return;try{const Ee=se(X,"profesores",te),Et=await Fe(Ee);if(Et.exists()){const We=Et.data()||{};y(de=>({...de||{},unidad:W(de==null?void 0:de.unidad,We.unidad,We.unidadInicial,"(sin unidad)"),objetivo:W(de==null?void 0:de.objetivo,We.objetivo,We.objetivoInicial,"(sin objetivo)"),habilidades:W(de==null?void 0:de.habilidades,z(We.habilidades),"(sin habilidades)"),asignatura:W(de==null?void 0:de.asignatura,A,We.asignatura,"(sin asignatura)"),curso:W(de==null?void 0:de.curso,We.curso,"(sin curso)")}))}}catch(Ee){console.warn("[Inicio] profesores read:",(Ee==null?void 0:Ee.code)||Ee)}try{const Ee=se(X,"usuarios",te),Et=await Fe(Ee);if(Et.exists()){const We=Et.data()||{};y(de=>({...de||{},unidad:de!=null&&de.unidad&&!/^\(sin/i.test(de==null?void 0:de.unidad)?de==null?void 0:de.unidad:We.unidadInicial??We.unidad??"(sin unidad)",objetivo:de!=null&&de.objetivo&&!/^\(sin/i.test(de==null?void 0:de.objetivo)?de==null?void 0:de.objetivo:We.objetivo??"(sin objetivo)",habilidades:de!=null&&de.habilidades&&!/^\(sin/i.test(de==null?void 0:de.habilidades)?de==null?void 0:de.habilidades:z(We.habilidades)||"(sin habilidades)",asignatura:W(de==null?void 0:de.asignatura,A,We.asignatura,"(sin asignatura)"),curso:W(de==null?void 0:de.curso,We.curso,"(sin curso)")}))}}catch(Ee){console.warn("[Inicio] usuarios fallback:",(Ee==null?void 0:Ee.code)||Ee)}}catch{}})()},[f,A]),D.useEffect(()=>{f&&(async()=>{var W;try{const z=((W=we.currentUser)==null?void 0:W.uid)||localStorage.getItem("uid");if(!z)return;const le=PT();if(le){h(le);try{localStorage.setItem("__lastSlotId",le)}catch{}const de=se(X,"clases_detalle",z,"slots",le),nt=await Fe(de);if(nt.exists()){const At=nt.data();y(it=>({...it||{},unidad:At.unidad??(it==null?void 0:it.unidad)??"(sin unidad)",objetivo:At.objetivo??(it==null?void 0:it.objetivo)??"(sin objetivo)",habilidades:At.habilidades??(it==null?void 0:it.habilidades)??"(sin habilidades)",asignatura:At.asignatura??(it==null?void 0:it.asignatura)??A??"(sin asignatura)"}))}else try{const At=await Fe(se(X,"horarios",z,"celdas",le));if(At.exists()){const it=At.data()||{},Nt={asignatura:it.asignatura??"",nivel:it.nivel??"",seccion:it.seccion??"",unidad:it.unidad??"",objetivo:it.objetivo??"",habilidades:Array.isArray(it.habilidades)?it.habilidades.join(", "):it.habilidades??"",updatedAt:ut()};(Nt.unidad||Nt.objetivo||Nt.habilidades)&&(await xt(de,Nt,{merge:!0}),y(at=>({...at||{},...Nt})))}}catch{}return}const te=se(X,"usuarios",z),Ee=await Fe(te),Et=Ee.exists()?Ee.data().horarioConfig||{}:{},We=DL(Et);if(We.length>1){const de=Hse(We),nt=zse(),At=`${de}-${nt}`;h(At);try{localStorage.setItem("__lastSlotId",At)}catch{}const it=se(X,"clases_detalle",z,"slots",At),Nt=await Fe(it);if(Nt.exists()){const at=Nt.data();y(bt=>({...bt||{},unidad:at.unidad??(bt==null?void 0:bt.unidad)??"(sin unidad)",objetivo:at.objetivo??(bt==null?void 0:bt.objetivo)??"(sin objetivo)",habilidades:at.habilidades??(bt==null?void 0:bt.habilidades)??"(sin habilidades)",asignatura:at.asignatura??(bt==null?void 0:bt.asignatura)??A??"(sin asignatura)"}))}else try{const at=await Fe(se(X,"horarios",z,"celdas",At));if(at.exists()){const bt=at.data()||{};y(lt=>({...lt||{},asignatura:bt.asignatura??(lt==null?void 0:lt.asignatura)??A??"(sin asignatura)",unidad:bt.unidad??(lt==null?void 0:lt.unidad)??"(sin unidad)",objetivo:bt.objetivo??(lt==null?void 0:lt.objetivo)??"(sin objetivo)",habilidades:(Array.isArray(bt.habilidades)?bt.habilidades.join(", "):bt.habilidades??"")||(lt==null?void 0:lt.habilidades)||"(sin habilidades)"}))}}catch{}}}catch(z){console.warn("[horarioConfig.marcas â†’ clases_detalle]",(z==null?void 0:z.code)||(z==null?void 0:z.message))}})()},[f,A]),D.useEffect(()=>{f&&(async()=>{var nt,At;const W=((nt=we.currentUser)==null?void 0:nt.uid)||localStorage.getItem("uid");if(!W)return;const z=await jse(W);if(!z)return;const le=["08:00 - 08:45","08:45 - 09:30","09:30 - 09:50 (Recreo)","09:50 - 10:35","10:35 - 11:20","11:20 - 11:30 (Recreo)","11:30 - 12:15","12:15 - 13:00","13:00 - 13:45 (Almuerzo)","13:45 - 14:30","14:30 - 15:15","15:15 - 15:30 (Recreo)","15:30 - 16:15","16:15 - 17:00","17:00 - 17:45","17:45 - 18:30"],te=["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes"];let Ee=[[8,0],[8,45],[9,30],[9,50],[10,35],[11,20],[11,30],[12,15],[13,45],[14,30],[15,15],[15,30],[16,15],[17,0],[17,45],[18,30]];try{const it=se(X,"usuarios",W),Nt=await Fe(it),at=Nt.exists()?Nt.data().horarioConfig||{}:{},bt=DL(at);bt.length>1&&(Ee=bt)}catch{}const Et=PT();let We=null,de=null;if(Et){const[it,Nt]=Et.split("-").map(at=>Number(at));We=Number.isInteger(it)?it:0,de=Number.isInteger(Nt)?Nt:0}else{const it=Yj(),Nt=Qj()??it.getDay(),at=it.getHours(),bt=it.getMinutes();let lt=Ee.findIndex(([ft,bi])=>at<ft||at===ft&&bt<bi);lt===-1?lt=Ee.length-1:lt=Math.max(0,lt-1),Nt>=1&&Nt<=5?(We=lt,de=Nt-1):(We=0,de=0)}if(We!=null&&de!=null&&We>=0&&We<z.length&&de>=0&&de<(((At=z[0])==null?void 0:At.length)||5)){let it=null,Nt=We;if(Et)it=z[We][de],Nt=We;else for(let lt=We;lt<z.length;lt++){const ft=z[lt][de];if(ft&&(ft.asignatura||ft.nivel||ft.seccion)){it=ft,Nt=lt;break}}const at=it,bt=Uj(Nt,de);h(bt);try{localStorage.setItem("__lastSlotId",bt)}catch{}if(at!=null&&at.asignatura){const lt=Array.isArray(at.habilidades)?at.habilidades.join(", "):at.habilidades??"";y({...at,unidad:at.unidad??"(sin unidad)",objetivo:at.objetivo??"(sin objetivo)",habilidades:lt??"(sin habilidades)",bloque:le[Nt],dia:te[de],asignatura:at.asignatura??A??"(sin asignatura)"});try{const ft=Rg(),bi=se(X,"planificaciones_sugeridas",W,ft,bt),Kt=await Fe(bi);S(Kt.exists()?Kt.data():null)}catch(ft){console.warn("[planificaciones_sugeridas] read:",ft==null?void 0:ft.code)}try{const ft=se(X,"clases_detalle",W,"slots",bt),bi=await Fe(ft);if(bi.exists()){const Kt=bi.data();y(gn=>({...gn||{},unidad:Kt.unidad??(gn==null?void 0:gn.unidad)??"(sin unidad)",objetivo:Kt.objetivo??(gn==null?void 0:gn.objetivo)??"(sin objetivo)",habilidades:Kt.habilidades??(gn==null?void 0:gn.habilidades)??"(sin habilidades)",asignatura:Kt.asignatura??(gn==null?void 0:gn.asignatura)??A??"(sin asignatura)"}))}else try{const Kt={asignatura:at.asignatura??"",nivel:at.nivel??"",seccion:at.seccion??"",unidad:at.unidad??"",objetivo:at.objetivo??"",habilidades:lt??"",updatedAt:ut()};if(Kt.unidad||Kt.objetivo||Kt.habilidades)await xt(ft,Kt,{merge:!0});else try{const Y=await Fe(se(X,"horarios",W,"celdas",bt));if(Y.exists()){const re=Y.data()||{},pe={asignatura:re.asignatura??"",nivel:re.nivel??"",seccion:re.seccion??"",unidad:re.unidad??"",objetivo:re.objetivo??"",habilidades:Array.isArray(re.habilidades)?re.habilidades.join(", "):re.habilidades??"",updatedAt:ut()};(pe.unidad||pe.objetivo||pe.habilidades)&&(await xt(ft,pe,{merge:!0}),y(Te=>({...Te||{},...pe})))}}catch{}}catch(Kt){console.warn("[auto seed clases_detalle desde horario]",(Kt==null?void 0:Kt.code)||(Kt==null?void 0:Kt.message))}}catch(ft){console.warn("[clases_detalle] read:",ft==null?void 0:ft.code)}}}})()},[f,A]);const[ze,tt]=D.useState([]);D.useEffect(()=>{if(!j)return;const W=tn(X,"salas",j,"palabras");let z=W;try{z=Bo(W,z_("timestamp"))}catch{}const le=fa(z,te=>{const Ee=te.docs.map(nt=>nt.data()).filter(nt=>(nt.texto||"").trim().length>0),Et=te.docs.map(nt=>{var At,it,Nt;return{id:nt.id,...nt.data(),ts:((Nt=(it=(At=nt.data())==null?void 0:At.timestamp)==null?void 0:it.toMillis)==null?void 0:Nt.call(it))||0}}).sort((nt,At)=>At.ts-nt.ts).slice(0,5);M(Et);const We=new Map;Ee.forEach(nt=>{const At=String(nt.texto||"").trim().toLowerCase();At&&We.set(At,(We.get(At)||0)+1)});const de=Array.from(We.entries()).map(([nt,At])=>({text:nt,value:At}));tt(de);try{window.__lastCloud=de,setTimeout(()=>{tt((Array.isArray(de)?de:[]).map(nt=>({...nt,value:Number.isFinite(+nt.value)?+nt.value:1})))},0)}catch{}},te=>console.warn("[salas/palabras] onSnapshot:",(te==null?void 0:te.code)||(te==null?void 0:te.message)));return()=>le()},[j]),D.useRef(null);const Xe=["#2563eb","#16a34a","#f59e0b","#ef4444","#a855f7","#0ea5e9","#10b981","#f43f5e","#f97316","#84cc16"],Je=W=>Math.min(80,18+(W.value-1)*10),dt=()=>0,Ct=D.useMemo(()=>ze,[ze]),Ut=D.useMemo(()=>{const W=new Map;for(const z of G||[]){const le=(z.text||"").trim().toLowerCase();if(!le)continue;const te=Number(z.value||1);W.set(le,(W.get(le)||0)+(isFinite(te)?te:1))}return Array.from(W.entries()).map(([z,le])=>({text:z,value:le}))},[G]);D.useMemo(()=>Ut.reduce((W,z)=>Math.max(W,Number(z.value||0)),1),[Ut]);const Ir=D.useMemo(()=>(Ct||[]).map((W,z)=>({text:String(W.text||"").trim(),value:Number.isFinite(+W.value)&&+W.value>0?+W.value:1,key:`${String(W.text||"").trim()}_${z}`})),[Ct]),ue=D.useRef(null),[ye,De]=D.useState({w:800,h:420});if(D.useEffect(()=>{const W=ue.current;if(!W||typeof ResizeObserver>"u")return;const z=new ResizeObserver(le=>{const te=Math.max(320,Math.floor(le[0].contentRect.width-24)),Ee=Math.max(220,Math.floor(te*.52));De({w:te,h:Ee})});return z.observe(W),()=>z.disconnect()},[]),D.useEffect(()=>{try{const W=localStorage.getItem("cloudMode");if(!W||W==="auto"){const le=NL()&&!LL()?"svg":"html";localStorage.setItem("cloudMode",le),fe(le)}else fe(W)}catch{fe(NL()&&!LL()?"svg":"html")}},[]),D.useEffect(()=>{window.seedPruebaLunes=async()=>{var W;try{const z=((W=we.currentUser)==null?void 0:W.uid)||localStorage.getItem("uid");if(!z)return alert("Sin uid");await xt(se(X,"clases_detalle",z,"slots","0-0"),{unidad:"NÃºmeros y operaciones",objetivo:"Reconocer y aplicar propiedades de los nÃºmeros enteros.",habilidades:"Razonamiento y resoluciÃ³n de problemas; comunicaciÃ³n matemÃ¡tica.",updatedAt:ut()},{merge:!0}),alert("âœ… Seed de detalle creado en clases_detalle/{uid}/slots/0-0")}catch(z){console.error(z),alert("âŒ No se pudo crear el seed de prueba")}}},[]),D.useEffect(()=>{!f||!u||(async()=>{var W;try{const z=((W=we.currentUser)==null?void 0:W.uid)||localStorage.getItem("uid");if(!z)return;const le=se(X,"clases_detalle",z,"slots",u),te=await Fe(le),Ee=te.exists()?te.data():{};if(!(!(Ee!=null&&Ee.unidad&&String(Ee.unidad).trim())||!(Ee!=null&&Ee.objetivo&&String(Ee.objetivo).trim())||!(Ee!=null&&Ee.habilidades&&String(Ee.habilidades).trim())))return;const We=(Ee==null?void 0:Ee.codUnidad)||(V==null?void 0:V.codUnidad)||(x==null?void 0:x.codUnidad)||null;if(!We)return;const de=await Fe(se(X,"curriculo",We));if(!de.exists())return;const nt=de.data(),At={codUnidad:We,unidad:Ee.unidad??nt.titulo??"Unidad",objetivo:Ee.objetivo??(Array.isArray(nt.objetivos)?nt.objetivos[0]:"")??"",habilidades:Ee.habilidades??(Array.isArray(nt.habilidades)?nt.habilidades.join("; "):"")??"",updatedAt:ut()};await xt(le,At,{merge:!0}),y(it=>({...it||{},...At}))}catch(z){console.warn("[autofill curriculo â†’ clases_detalle]",(z==null?void 0:z.code)||(z==null?void 0:z.message))}})()},[f,u,V,x]),D.useEffect(()=>{if(!f)return;const W=String((g==null?void 0:g.objetivo)||"").trim();(!W||/^\(sin/i.test(W))&&(async()=>{var le;try{const te=(g==null?void 0:g.asignatura)||A||"",Ee=(g==null?void 0:g.curso)||(V==null?void 0:V.curso)||"",Et=(g==null?void 0:g.nivel)||Vse(Ee)||(V==null?void 0:V.nivel)||"",We=(g==null?void 0:g.unidad)||(V==null?void 0:V.unidad)||"";if(!te||!Et||!We)return;const de=await Use(te,Et,(V==null?void 0:V.codUnidad)||null,We);if(!de)return;y(At=>({...At||{},objetivo:de}));const nt=((le=we.currentUser)==null?void 0:le.uid)||localStorage.getItem("uid");nt&&u&&await xt(se(X,"clases_detalle",nt,"slots",u),{objetivo:de,updatedAt:ut()},{merge:!0})}catch(te){console.warn("[getPrimerOA autofill]",(te==null?void 0:te.code)||(te==null?void 0:te.message))}})()},[f,u,A,V==null?void 0:V.codUnidad,V==null?void 0:V.unidad,V==null?void 0:V.nivel,g==null?void 0:g.objetivo,g==null?void 0:g.curso,g==null?void 0:g.nivel,g==null?void 0:g.unidad,g==null?void 0:g.asignatura]),r)return m.createElement("div",{style:PL},m.createElement(FL,{show:s,data:{SAFE_MODE:r,DISABLE_CLOUD:i,mounted:!0}}),m.createElement("div",{style:{...Zs,maxWidth:960,margin:"20px auto"}},"âœ… ",m.createElement("b",null,"InicioClase")," montÃ³ en ",m.createElement("b",null,"modo seguro"),".",m.createElement("br",null),"Quita ",m.createElement("code",null,"?safe=1")," o usa ",m.createElement("code",null,"?nocloud=1")," para aislar la nube si fuese necesario."));const Tt=D.useMemo(()=>{const W=(g==null?void 0:g.habilidades)??null??(ae==null?void 0:ae.habilidades)??null;return W?Array.isArray(W)?W.map(z=>typeof z=="string"?z.trim():z!=null&&z.codigo?z.descripcion?`${z.codigo}: ${z.descripcion}`:z.codigo:(z==null?void 0:z.descripcion)||"").filter(Boolean):typeof W=="string"?W.split(/[,;â€¢\n]+/).map(z=>z.trim()).filter(Boolean):[]:[]},[g,ae]);return m.createElement(Wse,null,m.createElement(FL,{show:s,data:{SAFE_MODE:r,DISABLE_CLOUD:i,authed:f,salaCode:j||"(none)",cloudMode:ee,palabras:Array.isArray(Ct)&&Ct.length||0}}),m.createElement("div",{style:PL},V&&m.createElement("div",{style:{...Zs,marginBottom:"1rem",background:V.fuente==="calendario"?"rgba(124,58,237,.06)":"rgba(2,132,199,.06)"}},m.createElement("div",{style:{fontWeight:800}},V.fuente==="calendario"?"Plan semanal (vigente)":V.fuente==="slots"?"Horario (fallback)":"Sin clase planificada"),V.fila!=null&&V.col!=null&&m.createElement("div",{style:{fontSize:13,color:"#475569"}},"Bloque #",V.fila," Â· DÃ­a #",V.col," (L=0)"),V.unidad&&m.createElement("div",{style:{marginTop:6}},m.createElement("b",null,"Unidad:")," ",V.unidad,V.evaluacion?" Â· (EvaluaciÃ³n)":""),(V.objetivo||V.habilidades)&&m.createElement("div",{style:{fontSize:13,color:"#475569",marginTop:4}},V.objetivo&&m.createElement("span",null,m.createElement("b",null,"Objetivo:")," ",V.objetivo," Â·"," "),V.habilidades&&m.createElement("span",null,m.createElement("b",null,"Habilidades:")," ",V.habilidades))),m.createElement("div",{style:{...Bse("1rem"),marginBottom:"1rem"}},m.createElement("div",{style:{...Zs}},m.createElement("div",{style:{fontWeight:800,fontSize:"1.1rem",marginBottom:6}},"Inicio"),m.createElement("div",{style:{color:Vn.textMuted,marginBottom:8}},"ðŸ•’ ",_),m.createElement("div",{style:{display:"flex",alignItems:"center",gap:".5rem"}},m.createElement("div",{style:{fontSize:"1.6rem",fontWeight:800}},$se(gt.m,gt.s)),m.createElement("button",{onClick:ot,style:RL,title:"Reiniciar a 10:00"},"ðŸ”"))),m.createElement("div",{style:{...Zs}},m.createElement("div",{style:{fontWeight:800,fontSize:"1.2rem",marginBottom:6}},"Desarrollo de la clase"),m.createElement("div",{style:{marginBottom:6}},m.createElement("strong",null,"Unidad:")," ",(g==null?void 0:g.unidad)??"(sin unidad)"),m.createElement("div",{style:{marginBottom:6}},m.createElement("strong",null,"Objetivo:")," ",(g==null?void 0:g.objetivo)??"(sin objetivo)"),m.createElement("div",null,m.createElement("strong",null,"Habilidades:")," ",(g==null?void 0:g.habilidades)??"(sin habilidades)"),Tt.length>0&&m.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginTop:6}},Tt.map((W,z)=>m.createElement("span",{key:`${W}_${z}`,style:{border:"1px solid #cbd5e1",background:"#f8fafc",borderRadius:999,padding:"4px 10px",fontSize:12}},W))),x&&m.createElement("div",{style:{marginTop:10}},m.createElement("div",null,m.createElement("strong",null,"Sugerencias del catÃ¡logo:")),(((Se=x.fuentes)==null?void 0:Se.length)||0)===0&&m.createElement("div",{style:{color:Vn.textMuted}},"No hay sugerencias registradas."),((Be=x.fuentes)==null?void 0:Be.length)>0&&m.createElement("ul",{style:{marginTop:6}},x.fuentes.map((W,z)=>m.createElement("li",{key:z},W.tipo?m.createElement("strong",null,W.tipo,":"):null," ",W.url?m.createElement("a",{href:W.url,target:"_blank",rel:"noreferrer"},W.url):null))),x.programaUrl&&m.createElement("div",{style:{marginTop:6}},m.createElement("a",{href:x.programaUrl,target:"_blank",rel:"noreferrer"},"Ver Programa de Estudio")))),m.createElement("div",{style:{...Zs,display:"flex",flexDirection:"column",gap:".6rem"}},m.createElement("div",{style:{display:"flex",gap:".5rem"}},m.createElement("button",{style:zy},"âœ‹"),m.createElement("button",{style:zy},"ðŸ‘")),m.createElement("div",{style:{textAlign:"right"}},m.createElement("div",{style:{fontWeight:800}},w),m.createElement("div",{style:{color:Vn.textMuted}},(g==null?void 0:g.asignatura)??A??"(sin asignatura)")))),Qe?m.createElement("div",{style:{...Zs,marginBottom:"1rem",color:Vn.textMuted}},"Cargando currÃ­culo MINEDUCâ€¦"):ae?m.createElement("div",{style:{...Zs,marginBottom:"1rem"}},m.createElement("div",{style:{fontWeight:800,marginBottom:6}},"Objetivos de Aprendizaje"),(kt=ae.objetivos)!=null&&kt.length?m.createElement("ul",{style:{marginTop:6}},ae.objetivos.map((W,z)=>m.createElement("li",{key:z},W))):m.createElement("div",{style:{color:Vn.textMuted}},"(Sin objetivos cargados)"),m.createElement("div",{style:{fontWeight:800,marginTop:12,marginBottom:6}},"Habilidades"),(Bt=ae.habilidades)!=null&&Bt.length?m.createElement("ul",{style:{marginTop:6}},ae.habilidades.map((W,z)=>m.createElement("li",{key:z},W))):m.createElement("div",{style:{color:Vn.textMuted}},"(Sin habilidades cargadas)")):m.createElement("div",{style:{...Zs,marginBottom:"1rem",color:Vn.textMuted}},"No se encontrÃ³ informaciÃ³n curricular para esta unidad."),m.createElement("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:"1rem"}},m.createElement("div",{style:Zs,ref:ue},m.createElement("h3",{style:{marginTop:0,marginBottom:8}},"â˜ï¸ Nube de palabras"),i?m.createElement("div",{style:{color:Vn.textMuted,padding:"1rem 0"}},"(Nube desactivada con ",m.createElement("code",null,"?nocloud=1")," para pruebas)"):m.createElement(m.Fragment,null,Ct.length===0?m.createElement("div",{style:{color:Vn.textMuted,padding:"1rem 0"}},"AÃºn no hay palabras. Pide a tus estudiantes que escaneen el QR y envÃ­en una palabra."):m.createElement("div",{style:{width:"100%",overflow:"hidden"}},ee==="html"?m.createElement(OL,{data:Ir,palette:Xe,width:ye.w,height:ye.h,fontSize:Je}):m.createElement(Gse,{fallback:m.createElement(OL,{data:Ir,palette:Xe,width:ye.w,height:ye.h,fontSize:Je})},m.createElement(gse,{data:Ir,font:"Segoe UI, sans-serif",fontSizeMapper:Je,rotate:dt,padding:2,width:ye.w,height:ye.h,fill:(W,z)=>Xe[z%Xe.length],spiral:"archimedean"}))))),m.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"}},m.createElement("div",{style:{...Zs,display:"flex",flexDirection:"column",alignItems:"center"}},m.createElement("h4",{style:{marginTop:0}},"ðŸ“² Escanea para participar"),m.createElement("div",{style:{background:Vn.white,padding:12,borderRadius:8,border:`1px solid ${Vn.border}`}},m.createElement(lj,{value:$||window.location.origin,size:200})),m.createElement("code",{style:{fontSize:12,marginTop:8,color:Vn.textMuted}},$),j&&m.createElement("div",{style:{marginTop:8,fontWeight:800}},"CÃ³digo: ",m.createElement("span",null,j),m.createElement("button",{style:{...RL,marginLeft:8},onClick:()=>{navigator.clipboard.writeText($)}},"ðŸ“‹ Copiar"))),m.createElement("div",{style:Zs},m.createElement("h4",{style:{marginTop:0}},"ðŸ•‘ Ãšltimos envÃ­os"),m.createElement("ul",{style:{margin:0,paddingLeft:"1rem"}},N.length===0&&m.createElement("li",{style:{color:Vn.textMuted}},"AÃºn no hay respuestas"),N.map(W=>m.createElement("li",{key:W.id},"#",W.numeroLista||"?"," â€” ",W.texto)))))),m.createElement("div",{style:{...Zs,marginTop:"1rem",textAlign:"center"}},m.createElement("em",{style:{color:Vn.textMuted}},"Espacio reservado para funciones futuras")),m.createElement("div",{style:{marginTop:"1.25rem",textAlign:"center",display:"flex",gap:"0.75rem",justifyContent:"center"}},m.createElement("button",{onClick:()=>{const W=rb(u||"0-0"),z=localStorage.getItem(W)||localStorage.getItem(oy),le=z?Number(z):0;try{localStorage.setItem("__lastSlotId",u||"0-0")}catch{}const te=et();n("/desarrollo",{state:{slotId:u||"0-0",endMs:le,clase:g||null,ficha:te}})},style:zy},"â­ï¸ Ir a Desarrollo"),m.createElement("button",{onClick:()=>n("/"),style:zy},"â¬…ï¸ Volver al Inicio"))))}function Kse({height:n=72,color:e="var(--pragma-brand, #2193b0)",bg:t="rgba(255,255,255,0.95)",onClick:r,style:i}){const s=n;return m.createElement("div",{onClick:r,style:{width:s,height:s,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:12,background:t,boxShadow:"0 2px 10px rgba(0,0,0,.12)",cursor:r?"pointer":"default",...i},"aria-label":"PragmaProfe",title:"PragmaProfe"},m.createElement("svg",{viewBox:"0 0 128 128",width:Math.round(s*.78),height:Math.round(s*.78),role:"img","aria-hidden":"true"},m.createElement("circle",{cx:"64",cy:"64",r:"60",fill:e}),m.createElement("path",{d:"M48 96V32h24c16 0 26 8 26 20s-10 20-26 20H66v24H48zm18-38h6c7.5 0 12-3.7 12-6.9S79.5 44 72 44h-6v14z",fill:"#fff"})))}const en={a:"#2193b0",b:"#6dd5ed",white:"#ffffff",text:"#0f172a",muted:"#475569",border:"#e5e7eb"},Yse={minHeight:"100vh",background:`linear-gradient(to right, ${en.a}, ${en.b})`,fontFamily:"Segoe UI, sans-serif",color:en.white},Qse={maxWidth:1180,margin:"0 auto",padding:"24px 20px 64px"},Xse={display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:20},ay={background:"transparent",color:en.white,border:"none",fontWeight:700,padding:"10px 12px",cursor:"pointer"},VL={padding:"12px 18px",backgroundColor:en.white,color:en.a,border:"none",borderRadius:10,fontSize:"1rem",fontWeight:800,cursor:"pointer",boxShadow:"0 6px 18px rgba(16,24,40,.18)"},Jse={padding:"12px 18px",backgroundColor:"transparent",color:en.white,border:`2px solid ${en.white}`,borderRadius:10,fontSize:"1rem",fontWeight:800,cursor:"pointer"},Za={background:en.white,color:en.text,borderRadius:14,border:`1px solid ${en.border}`,boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)"};function Zse({mensaje:n}){const e=ji(),[t,r]=D.useState(""),[i,s]=D.useState(!1),[o,a]=D.useState(null),[l,c]=D.useState(null),[u,h]=D.useState([]),[f,v]=D.useState(!0);D.useEffect(()=>{const b=ls(we,async g=>{try{if(g)localStorage.setItem("uid",g.uid),s(!0);else{const y=await mo(we);localStorage.setItem("uid",y.user.uid),s(!0)}}catch(y){console.error("Anon sign-in error:",y),s(!1)}});return()=>b()},[]),D.useEffect(()=>{let b=!0;return(async()=>{try{const g=await fetch("/pragmaprofe_web_slideshow/index.html",{method:"HEAD"});if(!b)return;a(g.ok)}catch{if(!b)return;a(!1)}})(),()=>{b=!1}},[]),D.useEffect(()=>{window.seedPruebaLunes=async()=>{var b;try{const g=localStorage.getItem("uid")||((b=we.currentUser)==null?void 0:b.uid);if(!g){alert("No hay uid aÃºn. Abre Home y espera 1-2s.");return}const y={unidad:"NÃºmeros y operaciones",objetivo:"Reconocer y aplicar propiedades de las operaciones bÃ¡sicas en problemas cotidianos.",habilidades:["Razonamiento lÃ³gico","CÃ¡lculo mental","ComunicaciÃ³n matemÃ¡tica"],curso:"1Â° Medio",seccion:"A",asignatura:"MatemÃ¡tica",creadoEn:new Date,fuente:"seedPruebaLunes"};await xt(se(X,"clases_detalle",g,"slots","0-0"),y,{merge:!0}),alert("âœ… seedPruebaLunes: creado clases_detalle/{uid}/slots/0-0"),console.log("[seedPruebaLunes] OK",y)}catch(g){console.error("[seedPruebaLunes] error",g),alert("âŒ seedPruebaLunes fallÃ³: "+(g.code||g.message))}}},[]),D.useEffect(()=>{window.seedCatalogoMatematica1Medio=async()=>{try{we.currentUser||await mo(we);const b=[{id:"u1",numero:1,nombre:"NÃºmeros y proporcionalidad",priorizado:!0},{id:"u2",numero:2,nombre:"Ãlgebra y funciones",priorizado:!0},{id:"u3",numero:3,nombre:"GeometrÃ­a",priorizado:!1},{id:"u4",numero:4,nombre:"Probabilidad y estadÃ­stica",priorizado:!0}];for(const g of b)await xt(se(X,"catalogo_curricular","matematica","niveles","1medio","unidades",g.id),{asignatura:"MatemÃ¡tica",nivel:"1Â° Medio",...g,updatedAt:ut()},{merge:!0});alert("âœ… CatÃ¡logo MatemÃ¡tica 1Â° Medio cargado en Firestore.")}catch(b){console.error(b),alert("âŒ No se pudo cargar el catÃ¡logo: "+(b.code||b.message))}},window.listarUnidadesMat1Medio=async()=>{const b=await $n(tn(X,"catalogo_curricular","matematica","niveles","1medio","unidades"));console.table(b.docs.map(g=>({id:g.id,...g.data()}))),alert("Mira la consola (console.table) para ver las unidades.")}},[]),D.useEffect(()=>{if(!i)return;(async()=>{var g;try{const y=localStorage.getItem("uid"),x=localStorage.getItem("desdeRutaInicial");if(!y||x!=="true")return;localStorage.removeItem("desdeRutaInicial");const I=["Domingo","Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado"][new Date().getDay()],P=new Date;if(!X)return;const N=tn(X,"horarios",y,"clases"),L=(await $n(N)).docs.map(B=>B.data()||{}).find(B=>{if(!(B!=null&&B.dia)||!(B!=null&&B.hora)||B.dia!==I)return!1;const[G,Z]=String(B.hora).split(":").map(Number);if(Number.isNaN(G)||Number.isNaN(Z))return!1;const ee=new Date;return ee.setHours(G,Z,0,0),Math.abs((P-ee)/6e4)<=10}),j=se(X,"usuarios",y),oe=await Fe(j),$=oe.exists()&&((g=oe.data())==null?void 0:g.nombre)||"Profesor";if(r($),L)e("/inicio");else{const B=new SpeechSynthesisUtterance(`${$}, no tienes clases activas, revisa tu horario para prepararte`);B.lang="es-ES",window!=null&&window.speechSynthesis&&window.speechSynthesis.speak(B),e("/proxima-clase")}}catch(y){console.error("checkClaseActiva error:",y)}})()},[e,i]),D.useEffect(()=>{i&&(async()=>{const b=localStorage.getItem("uid");if(!b)return;const g=[],y=(S,I,P="")=>g.push(`${S?"âœ”":"âœ˜"} ${I} ${P}`);try{await Fe(se(X,"usuarios",b)),y(!0,"usuarios/{uid}: read")}catch(S){y(!1,"usuarios/{uid}: read",`-> ${S.code||S.message}`)}try{await $n(tn(X,"horarios",b,"clases")),y(!0,"horarios/{uid}/clases: query")}catch(S){y(!1,"horarios/{uid}/clases: query",`-> ${S.code||S.message}`)}try{await Fe(se(X,"preguntaClase","actual")),y(!0,"preguntaClase/actual: read")}catch(S){y(!1,"preguntaClase/actual: read",`-> ${S.code||S.message}`)}try{await xt(se(X,"palabras","permiso-test"),{texto:"ping",timestamp:new Date},{merge:!0}),y(!0,"palabras/permiso-test: write ok")}catch(S){y(!1,"palabras/permiso-test: write",`-> ${S.code||S.message}`)}try{await Fe(se(X,"catalogo_curricular","matematica_1medio")),y(!0,"catalogo_curricular/matematica_1medio: read")}catch(S){y(!1,"catalogo_curricular/...: read",`-> ${S.code||S.message}`)}console.log("%c[DIAG FIRESTORE]","font-weight:bold;color:#0a0",`
`+g.join(`
`));const x=g.filter(S=>S.startsWith("âœ˜"));x.length&&!window.__diagShown&&(window.__diagShown=!0,alert(`DIAG Permisos:
`+x.join(`
`)))})()},[i]),D.useEffect(()=>{let b=!0;return(async()=>{try{if(v(!0),!await Hj()){v(!1);return}const y=await c1(new Date);if(!b||!y||!y.asignatura){v(!1);return}c(y);const x=await kse(y.asignatura,y.nivel||"");if(!b)return;const S=(x==null?void 0:x.unidades)||[];h(S);const I=S.find(P=>{const N=(P.titulo||P.nombre||"").toLowerCase();return(y==null?void 0:y.unidad)&&N.includes(String(y.unidad).toLowerCase())})||S[0];I&&(!y.objetivo||!y.habilidades)&&c(P=>{var N,M,V,L;return{...P,unidad:(P==null?void 0:P.unidad)||I.nombre||I.titulo||I.id||I.codigo,objetivo:(P==null?void 0:P.objetivo)||((M=(N=I.objetivos)==null?void 0:N[0])==null?void 0:M.descripcion)||((L=(V=I.objetivos)==null?void 0:V[0])==null?void 0:L.texto)||I.objetivo||"",habilidades:(P==null?void 0:P.habilidades)||I.habilidades||[]}})}catch(g){console.warn("[Home] currÃ­culo no disponible:",(g==null?void 0:g.message)||g)}finally{b&&v(!1)}})(),()=>{b=!1}},[]);const w=b=>{var g;return(g=document.getElementById(b))==null?void 0:g.scrollIntoView({behavior:"smooth"})},E=()=>e("/oferta-profesor"),A=()=>e("/oferta-estudiante"),T=()=>e("/registro?plan=trial"),_=()=>e("/registro?plan=paid");return m.createElement("div",{style:Yse},m.createElement("div",{style:Qse},m.createElement("div",{style:Xse},m.createElement("div",{style:{fontWeight:900,letterSpacing:.4,fontSize:"1.1rem",display:"flex",alignItems:"center",gap:8}},m.createElement(Kse,{height:38,onClick:()=>e("/")}),m.createElement("span",{style:{display:"none"}}," PragmaProfe",m.createElement("span",{style:{opacity:.85,fontWeight:600}}," Â· Docentes"))),m.createElement("div",{style:{display:"flex",gap:12,alignItems:"center"}},m.createElement("button",{style:ay,onClick:()=>w("producto")},"Producto"),m.createElement("button",{style:ay,onClick:()=>w("como-funciona")},"CÃ³mo funciona"),m.createElement("button",{style:ay,onClick:()=>w("para-quien")},"Para docentes"),m.createElement("button",{style:ay,onClick:()=>w("faq")},"FAQ"),m.createElement("button",{style:ay,onClick:()=>w("contacto")},"Soporte"),m.createElement("button",{style:VL,onClick:()=>e("/login")},"Iniciar sesiÃ³n")," ")),m.createElement("section",{id:"hero",style:{display:"grid",gridTemplateColumns:"1.2fr 1fr",gap:20,alignItems:"center",marginBottom:28}},m.createElement("div",{style:{...Za,padding:10}},m.createElement("div",{style:{position:"relative",paddingTop:"56.25%",borderRadius:12,overflow:"hidden",background:"#f3f4f6"}},o===!0&&m.createElement("iframe",{width:"512",height:"384",src:"https://www.youtube.com/embed/Rqd3PmGwSBc",title:"CÃ³mo Funciona",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,style:{position:"absolute",inset:0,width:"100%",height:"100%",border:0}}),o===!1&&m.createElement("img",{src:"/frame_pragmaprofe.png",alt:"PragmaProfe - vista previa",style:{position:"absolute",inset:0,width:"100%",height:"100%",objectFit:"cover"}}),o===null&&m.createElement("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",fontWeight:700}},"Cargando recursoâ€¦")),m.createElement("div",{style:{padding:"10px 12px",color:en.muted,fontSize:12}},"âœ¦ Video explicativo (1:08) â€” quÃ© es PragmaProfe y cÃ³mo acelera tu clase.")),m.createElement("div",null,m.createElement("h1",{style:{margin:0,fontSize:"2.1rem",lineHeight:1.2}},"Planifica, dinamiza y evalÃºa tu clase en minutos."),m.createElement("p",{style:{marginTop:10,color:"rgba(255,255,255,.95)"}},"PragmaProfe alinea objetivos al currÃ­culo, activa a tus estudiantes con QR, nubes de palabras y juegos, y cierra con evidenciasâ€¦ sin complicarte."),t&&m.createElement("div",{style:{marginTop:6,opacity:.95}},"Bienvenido, ",m.createElement("b",null,t)," ðŸ‘¨â€ðŸ«"),n&&m.createElement("div",{style:{marginTop:6,color:"#fffb90"}},n),m.createElement("div",{style:{display:"flex",gap:12,marginTop:12}},m.createElement("button",{style:VL,onClick:T},"ðŸŽ Probar gratis 7 dÃ­as"),m.createElement("button",{style:Jse,onClick:_},"ðŸ’³ Suscribirse")),m.createElement("div",{style:{marginTop:14,fontSize:12,opacity:.9}},"âœ”ï¸Ž Prueba Gratis por 7 dÃ­as Â· âœ”ï¸Ž Login con Google Â· âœ”ï¸Ž Sin instalaciones"))),m.createElement("section",{style:{marginTop:8}},m.createElement("div",{style:{...Za,padding:12}},m.createElement("div",{style:{fontWeight:800,color:en.text,marginBottom:6}},"ðŸ“š CurrÃ­culo de la clase actual"),f?m.createElement("div",{style:{color:en.muted}},"Cargando currÃ­culoâ€¦"):l?m.createElement(m.Fragment,null,m.createElement("div",{style:{marginBottom:6}},m.createElement("span",{style:{fontWeight:700}},l.asignatura||"(asignatura desconocida)"),l.nivel?m.createElement("span",null," Â· ",l.nivel):null),l.unidad?m.createElement("div",null,m.createElement("b",null,"Unidad:")," ",l.unidad):null,l.objetivo?m.createElement("div",null,m.createElement("b",null,"Objetivo:")," ",l.objetivo):null,Array.isArray(l.habilidades)?m.createElement("div",null,m.createElement("b",null,"Habilidades:")," ",l.habilidades.join(", ")):l.habilidades?m.createElement("div",null,m.createElement("b",null,"Habilidades:")," ",String(l.habilidades)):null,u!=null&&u.length?m.createElement("details",{style:{marginTop:8}},m.createElement("summary",{style:{cursor:"pointer"}},"Ver unidades disponibles (",u.length,")"),m.createElement("ul",{style:{marginTop:6}},u.map(b=>m.createElement("li",{key:b.id||b.codigo},m.createElement("b",null,b.codigo||b.id)," â€” ",b.nombre||b.titulo)))):null):m.createElement("div",{style:{color:en.muted}},"No se detectÃ³ clase vigente ahora."))),m.createElement("section",{id:"producto",style:{marginTop:12}},m.createElement("h2",{style:{margin:"10px 0 14px"}},"Lo que obtienes"),m.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12}},[{t:"Planificador inteligente",d:"Importa tu horario y recibe sugerencias de unidad, objetivo y recursos alineados."},{t:"ParticipaciÃ³n en vivo",d:"Comparte un QR y recoge respuestas al instante con nubes de palabras y carreras."},{t:"Evidencias en un clic",d:"Guarda resultados por clase y registra la participaciÃ³n del curso."},{t:"Privado y simple",d:"Login con Google. Datos en Firebase. Sin instalaciones."}].map(b=>m.createElement("div",{key:b.t,style:{...Za,padding:16}},m.createElement("div",{style:{fontWeight:800,marginBottom:6}},b.t),m.createElement("div",{style:{color:en.muted}},b.d))))),m.createElement("section",{id:"como-funciona",style:{marginTop:28}},m.createElement("h2",{style:{margin:"0 0 14px"}},"CÃ³mo funciona"),m.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12}},[{n:"1",t:"Planifica",d:"Define unidad, objetivo y habilidades para el bloque."},{n:"2",t:"Comparte",d:"Muestra el QR; cada estudiante responde desde su mÃ³vil."},{n:"3",t:"Observa",d:"La nube y el progreso aparecen en tiempo real."},{n:"4",t:"Cierra",d:"Guarda evidencias y resume la clase."}].map(b=>m.createElement("div",{key:b.n,style:{...Za,padding:16}},m.createElement("div",{style:{fontWeight:900,color:en.a,marginBottom:6}},"Paso ",b.n),m.createElement("div",{style:{fontWeight:800,marginBottom:4}},b.t),m.createElement("div",{style:{color:en.muted}},b.d))))),m.createElement("section",{id:"para-quien",style:{marginTop:28}},m.createElement("h2",{style:{margin:"0 0 14px"}},"Pensado para tu contexto"),m.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:12}},[{t:"EducaciÃ³n BÃ¡sica",d:"Actividades rÃ¡pidas para iniciar y cerrar con participaciÃ³n."},{t:"EducaciÃ³n Media",d:"EvaluaciÃ³n formativa en tiempo real y evidencias."},{t:"Preuniversitario",d:"PrÃ¡ctica Ã¡gil y mÃ©tricas de avance."}].map(b=>m.createElement("div",{key:b.t,style:{...Za,padding:16,cursor:"pointer"},onClick:E,title:"Ver mÃ¡s"},m.createElement("div",{style:{fontWeight:800,marginBottom:6}},b.t),m.createElement("div",{style:{color:en.muted}},b.d)))),m.createElement("div",{style:{marginTop:8,fontSize:12,opacity:.95}},"Â¿Eres estudiante?"," ",m.createElement("a",{href:"#",onClick:b=>{b.preventDefault(),A()},style:{color:en.white,fontWeight:700,textDecoration:"underline"}},"Mira cÃ³mo participar â†’"))),m.createElement("section",{id:"mision-vision",style:{marginTop:28}},m.createElement("h2",{style:{margin:"0 0 14px"}},"Nuestro porquÃ©"),m.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}},m.createElement("div",{style:{...Za,padding:16}},m.createElement("div",{style:{fontWeight:900,marginBottom:6}},"MisiÃ³n"),m.createElement("div",{style:{color:en.muted}},"Facilitar clases activas y alineadas al currÃ­culo, ahorrando tiempo al docente y elevando la participaciÃ³n.")),m.createElement("div",{style:{...Za,padding:16}},m.createElement("div",{style:{fontWeight:900,marginBottom:6}},"VisiÃ³n"),m.createElement("div",{style:{color:en.muted}},"Convertir cada clase en una experiencia participativa basada en datos, accesible para cualquier escuela.")))),m.createElement("section",{id:"faq",style:{marginTop:28}},m.createElement("h2",{style:{margin:"0 0 14px"}},"Preguntas frecuentes"),m.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12}},[{q:"Â¿Mis estudiantes necesitan cuenta?",a:"No. Responden desde un enlace/QR sin registrarse."},{q:"Â¿Funciona sin internet?",a:"Necesitas conexiÃ³n para ver respuestas en tiempo real."},{q:"Â¿QuÃ© datos guardan?",a:"Solo lo necesario para la clase y tu planificaciÃ³n; puedes borrar cuando quieras."},{q:"Â¿Tiene costo?",a:"Prueba Gratis por 7 dÃ­as y luego te suscribes. Planes para equipos prÃ³ximamente."}].map(b=>m.createElement("div",{key:b.q,style:{...Za,padding:16}},m.createElement("div",{style:{fontWeight:800,marginBottom:6}},b.q),m.createElement("div",{style:{color:en.muted}},b.a))))),m.createElement("section",{id:"contacto",style:{marginTop:28}},m.createElement("h2",{style:{margin:"0 0 14px"}},"Contacto"),m.createElement("div",{style:{...Za,padding:16}},m.createElement("div",{style:{color:en.muted}},"Â¿Tienes dudas o quieres implementar PragmaProfe en tu escuela?"),m.createElement("div",{style:{marginTop:8,display:"flex",gap:12,flexWrap:"wrap",alignItems:"center",fontWeight:800}},"âœ‰ï¸"," ",m.createElement("a",{href:"mailto:contactocolegios@pragmaprofe.com",style:{color:en.a}},"contactocolegios@pragmaprofe.com"),m.createElement("span",{style:{opacity:.6}},"Â·"),m.createElement("a",{href:"mailto:administracion@pragmaprofe.com",style:{color:en.a}},"administracion@pragmaprofe.com"))),!1),m.createElement("footer",{style:{marginTop:28,opacity:.9,display:"flex",gap:12,flexWrap:"wrap"}},m.createElement("span",null,"Â© ",new Date().getFullYear()," PragmaProfe"),m.createElement("span",null,"Â·"),m.createElement("a",{href:"#",style:{color:en.white}},"TÃ©rminos"),m.createElement("span",null,"Â·"),m.createElement("a",{href:"#",style:{color:en.white}},"Privacidad"),m.createElement("span",null,"Â·"),m.createElement("a",{href:"#",style:{color:en.white}},"Estado del servicio"))))}async function eoe(n="BASICO",e=1){var t;try{const r=(t=we==null?void 0:we.currentUser)==null?void 0:t.uid;if(!r)throw new Error("Usuario no autenticado");const i=H0(tc,"southamerica-east1");return await QU(i,"setPlanV2")({uid:r,plan:n,months:e}),console.log("[Pago] setPlan (Callable) OK"),!0}catch(r){console.warn("[Pago] setPlan (Callable) no disponible. Fallback local:",(r==null?void 0:r.message)||r);try{return await toe(n,e),!1}catch(i){return console.error("[Pago] Fallback local tambiÃ©n fallÃ³:",i),!1}}}async function toe(n="BASICO",e=1){var s;const t=(s=we==null?void 0:we.currentUser)==null?void 0:s.uid;if(!t)throw new Error("Usuario no autenticado");const r=mi==null?void 0:mi[n];if(!r)throw new Error("Plan invÃ¡lido");const i=xn.fromDate(new Date(Date.now()+e*30*24*60*60*1e3));await xt(se(X,"users",t,"meta","limits"),{plan:n,...r,period:{start:ut(),end:i},updatedAt:ut()},{merge:!0}),console.log("[Pago] ActivaciÃ³n de plan (fallback local) escrita en Firestore")}function noe(n="BASICO",e=1){localStorage.setItem("pendingPlan",n),localStorage.setItem("pendingMonths",String(e)),localStorage.setItem("pendingTS",String(Date.now()))}async function PS(){const n=localStorage.getItem("pendingPlan"),e=Number(localStorage.getItem("pendingMonths")||1);return n?(await eoe(n,e),localStorage.removeItem("pendingPlan"),localStorage.removeItem("pendingMonths"),localStorage.removeItem("pendingTS"),!0):!1}const roe=()=>{let n=null;try{n=window.open("","_blank"),n&&n.document&&(n.document.write(`
        <!doctype html>
        <html><head><meta charset="utf-8"><title>Abriendo Flowâ€¦</title>
        <style>
          html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto}
          .box{height:100%;display:flex;align-items:center;justify-content:center;gap:.75rem;flex-direction:column}
          .spinner{width:28px;height:28px;border:3px solid #e5e7eb;border-top-color:#22c55e;border-radius:50%;animation:spin 1s linear infinite}
          @keyframes spin{to{transform:rotate(360deg)}}
          .txt{color:#334155}
        </style></head>
        <body><div class="box">
          <div class="spinner"></div>
          <div class="txt">Redirigiendo a Flowâ€¦</div>
        </div></body></html>`),n.document.close())}catch{}return n},ioe="https://southamerica-east1-pragma-2c5d1.cloudfunctions.net/crearPagoFlowHttp";async function soe(n,e,t){const i=await(await fetch(ioe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan:n,precio:e,email:t})})).json();let s=i==null?void 0:i.token;if(!s&&(i!=null&&i.url))try{s=new URL(i.url).searchParams.get("token")}catch{}if(!s)throw new Error("No se recibiÃ³ token desde crearPagoFlowHttp");return/sandbox/i.test(i==null?void 0:i.url),`https://sandbox.flow.cl/app/web/pay.php?token=${encodeURIComponent(s)}`}async function ooe(n,e){const t=we==null?void 0:we.currentUser;if(!t||t.isAnonymous){alert("Para suscribirte debes iniciar sesiÃ³n."),window.location.href="/login?next=/pago&checkout=1";return}noe(String(n||"").toUpperCase(),1);const r=t.email||localStorage.getItem("email")||"",i=roe();let s=!!i;try{const o=await soe(n,e,r);if(s&&i){try{i.document&&(i.document.body.innerHTML=`
            <div class="box" style="height:100%;display:flex;align-items:center;justify-content:center;gap:.75rem;flex-direction:column;font-family:system-ui,-apple-system,Segoe UI,Roboto">
              <div class="spinner" style="width:28px;height:28px;border:3px solid #e5e7eb;border-top-color:#22c55e;border-radius:50%;animation:spin 1s linear infinite"></div>
              <div style="color:#334155">Redirigiendo a Flowâ€¦</div>
              <a href="${o}" style="color:#16a34a;text-decoration:none;font-weight:600">Si no continÃºa automÃ¡ticamente, haz clic aquÃ­</a>
              <meta http-equiv="refresh" content="0;url=${o}">
              <script>setTimeout(function(){ try{ location.href=${JSON.stringify(o)} }catch(e){} }, 60);<\/script>
            </div>`)}catch{}i.location.href=o}else s=!!window.open(o,"_blank");setTimeout(()=>{s||(window.location.href=o)},300),setTimeout(()=>{s&&(window.location.href="/registro")},600)}catch(o){try{i&&!i.closed&&i.close()}catch{}console.error("[Pago][HTTP] Error creando pago:",o),alert(`No se pudo iniciar el pago con Flow (HTTP).
Detalle: ${(o==null?void 0:o.message)||o}`)}}function aoe(){const n=ji();D.useEffect(()=>{PS().then(a=>{a&&(console.log("[Pago] Plan activado automÃ¡ticamente al volver."),n("/login?paid=1&next=/inicio",{replace:!0}))}).catch(a=>console.warn("[Pago] No se pudo activar automÃ¡ticamente:",(a==null?void 0:a.message)||a))},[n]);const[e,t]=D.useState(!1),[r,i]=D.useState(null);D.useEffect(()=>{const a=ls(we,l=>{i(l||null),t(!0);try{l!=null&&l.uid&&localStorage.setItem("uid",l.uid),l!=null&&l.email&&localStorage.setItem("email",l.email)}catch{}});return()=>a()},[]);const s={minHeight:"100vh",background:"linear-gradient(to right, #2193b0, #6dd5ed)",padding:"2rem",fontFamily:"Segoe UI, sans-serif",color:"#ffffff"},o={display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"2rem",marginBottom:"2rem",maxWidth:1200,marginInline:"auto"};return e&&(!r||r.isAnonymous)?m.createElement("div",{style:s},m.createElement("h2",{style:{textAlign:"center",marginBottom:"1rem"}},"ðŸ’³ Elige tu Plan"),m.createElement("div",{style:{maxWidth:760,margin:"0 auto",background:"rgba(255,255,255,.9)",color:"#0f172a",padding:"1.25rem",borderRadius:12,boxShadow:"0 6px 18px rgba(16,24,40,.12)"}},m.createElement("b",null,"Necesitas iniciar sesiÃ³n para continuar con el pago."),m.createElement("div",{style:{marginTop:8}},"Inicia sesiÃ³n con tu cuenta (o regÃ­strate primero) y volveremos a esta pantalla."),m.createElement("div",{style:{marginTop:12,display:"flex",gap:8}},m.createElement("button",{onClick:()=>n("/login?next=/pago&checkout=1"),style:{padding:"0.8rem 1.2rem",background:"#ffffff",color:"#2193b0",border:"none",borderRadius:8,fontWeight:800,cursor:"pointer"}},"ðŸ” Iniciar sesiÃ³n y pagar"),m.createElement("button",{onClick:()=>n("/registro?plan=trial"),style:{padding:"0.8rem 1.2rem",background:"transparent",border:"2px solid #ffffff",color:"#ffffff",borderRadius:8,fontWeight:800,cursor:"pointer"}},"ðŸŽ Probar 7 dÃ­as gratis")))):m.createElement("div",{style:s},m.createElement("h2",{style:{textAlign:"center",marginBottom:"2rem",color:"#ffffff"}},"ðŸ’³ Elige tu Plan"),m.createElement("div",{style:o},m.createElement(RT,{color:"#0288d1",fondo:"#e3f2fd",titulo:"ðŸ¥‰ BÃ¡sico",precioCLP:9990,descripcion:["âœ” Horario editable","âœ” PlanificaciÃ³n diaria con IA bÃ¡sica","âœ” Nube de palabras (25 alumnos)","âœ” Videos YouTube","âœ” ExportaciÃ³n PDF","âœ” RedirecciÃ³n automÃ¡tica","âœ” Prueba 7 dÃ­as gratis","âœ” Soporte por correo"],flowPlan:"BASICO",flowPrecio:9990}),m.createElement(RT,{color:"#7e57c2",fondo:"#ede7f6",titulo:"ðŸ¥ˆ Pro",precioCLP:19990,descripcion:["âœ” TODO del BÃ¡sico +","âœ” IA personalizada","âœ” ExportaciÃ³n a Excel","âœ” 40 estudiantes por clase","âœ” Herramientas interactivas (Kahoot, WordCloud)","âœ” EstadÃ­sticas semanales","âœ” Alertas y sugerencias","âœ” Biblioteca de planificaciones","âœ” Google Drive y Canva"],flowPlan:"PRO",flowPrecio:19990}),m.createElement(RT,{color:"#f9a825",fondo:"#fff8e1",titulo:"ðŸ¥‡ Premium",precioCLP:29990,descripcion:["âœ” TODO del Pro +","âœ” Juegos en Unity","âœ” GrabaciÃ³n de clases (30 dÃ­as)","âœ” Estudiantes ilimitados","âœ” Control de ruido","âœ” Carga masiva de contenidos","âœ” PlanificaciÃ³n automÃ¡tica","âœ” Informes institucionales","âœ” PersonalizaciÃ³n completa"],flowPlan:"PREMIUM",flowPrecio:29990})),m.createElement("div",{style:{textAlign:"center"}},m.createElement("button",{onClick:()=>n("/"),style:{padding:"0.8rem 1.5rem",backgroundColor:"#ffffff",color:"#2193b0",border:"none",borderRadius:"8px",fontSize:"1rem",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,0.2)"}},"â¬… Volver al Inicio")))}function RT({color:n,fondo:e,titulo:t,precioCLP:r,descripcion:i,flowPlan:s,flowPrecio:o}){const a={background:"#ffffff",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)",border:"1px solid #e5e7eb",textAlign:"center"},l=u=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(u),c={padding:"0.6rem 1rem",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"bold",background:"#43a047"};return m.createElement("div",{style:a},m.createElement("div",{style:{background:e,borderRadius:10,padding:"0.75rem 1rem",marginBottom:"0.75rem"}},m.createElement("h3",{style:{color:n,margin:0}},t)),m.createElement("p",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"1.15rem"}},m.createElement("strong",null,l(r)," / mes")),i.map((u,h)=>m.createElement("p",{key:h,style:{margin:"0.25rem 0",color:"#334155"}},u)),m.createElement("div",{style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.5rem"}},m.createElement("button",{style:c,onClick:()=>ooe(s,o),"aria-label":`Pagar plan ${t} con Flow.cl`},"Pagar con Flow.cl Â· ",l(o),m.createElement("div",{style:{fontSize:"0.75rem",color:"#e6ffe6",marginTop:"0.2rem"}},"ðŸ’¡ Cuenta RUT o dÃ©bito (Chile)"))))}function loe(){const n=ji(),e=Hs(),[t,r]=D.useState(""),[i,s]=D.useState({nombre:"",correo:"",clave:"",confirmar:"",tipo:"",region:"",ciudad:"",colegio:"",colegioOtro:"",asignatura:"",unidadInicial:""}),l=(new URLSearchParams(e.search).get("plan")||"trial").toLowerCase()==="paid",c=l?"paid":"trial";D.useEffect(()=>{(async()=>{try{await PS()&&(r("âœ… SuscripciÃ³n activada correctamente."),setTimeout(()=>n("/planificaciones?upgraded=1"),1e3))}catch(_){console.warn("[Registro] activarSiPendiente:",_)}})()},[n]),D.useEffect(()=>{l&&r("Este formulario activa la PRUEBA GRATIS. Para suscribirte, inicia sesiÃ³n y te llevamos al pago.")},[l]),D.useEffect(()=>{const _=ls(we,b=>{l&&b&&!b.isAnonymous&&n("/pago",{replace:!0})});return()=>_()},[l,n]);const u=_=>{s({...i,[_.target.name]:_.target.value})};D.useEffect(()=>{s(_=>({..._,ciudad:"",colegio:"",colegioOtro:""}))},[i.region]),D.useEffect(()=>{s(_=>({..._,colegio:"",colegioOtro:""}))},[i.ciudad]);const h=async _=>{if(_.preventDefault(),r(""),l){r("Para suscribirte, inicia sesiÃ³n con tu cuenta y completa el pago."),n("/login?next=/pago&checkout=1",{replace:!0});return}if(i.clave!==i.confirmar){r("âš ï¸ Las contraseÃ±as no coinciden.");return}const b=i.colegio==="OTRO"||!i.colegio?(i.colegioOtro||"").trim():i.colegio;if(!b){r("âš ï¸ Indica el nombre de tu Colegio/Liceo.");return}try{const g=(i.correo||"").trim().toLowerCase(),y=await c8(we,g,i.clave),x=y.user.uid;try{await f8(y.user)}catch{}try{await m8(y.user,{displayName:i.nombre||"Profesor"})}catch{}const S=[],I=16,P=5,N=Object.fromEntries(Array.from({length:I},(L,j)=>[`f${j}`,Array.from({length:P},()=>({asignatura:"",nivel:"",seccion:"",unidad:"",objetivo:"",habilidades:""}))])),M=xn.fromDate(new Date(Date.now()+7*24*60*60*1e3)),V={startedAt:ut(),endsAt:M,status:"active",everUsed:!0};await xt(se(X,"usuarios",x),{uid:x,nombre:i.nombre,correo:g,tipo:i.tipo,region:i.region,ciudad:i.ciudad||"",colegio:b,asignatura:i.asignatura,unidadInicial:i.unidadInicial,plan:c,billingStatus:"unpaid",trial:V,fechaInicioPrueba:ut(),pagoRealizado:!1,horario:S,horarioMatriz:N,horarioSlots:[],horarioConfig:{cantidad:I},createdAt:ut(),updatedAt:ut()},{merge:!0});try{localStorage.setItem("uid",x),localStorage.setItem("plan",c)}catch{}r("âœ… Registro exitoso (Prueba 7 dÃ­as). Redirigiendo a Planificacionesâ€¦"),setTimeout(()=>n("/planificaciones?onboard=1"),1200)}catch(g){r({"auth/email-already-in-use":"â— Ese correo ya estÃ¡ registrado. Inicia sesiÃ³n o usa otro.","auth/invalid-email":"â— Correo invÃ¡lido.","auth/weak-password":"â— La contraseÃ±a debe tener al menos 6 caracteres.","permission-denied":"â— Permiso denegado al escribir en Firestore. Revisa reglas."}[g.code]||"âŒ Error en el registro: "+g.message),console.error(g)}},f=["Argentina","Bolivia","Chile","Colombia","Costa Rica","Cuba","RepÃºblica Dominicana","Ecuador","El Salvador","Guatemala","Honduras","MÃ©xico","Nicaragua","PanamÃ¡","Paraguay","PerÃº","Puerto Rico","Uruguay","Venezuela","EspaÃ±a","Brasil","Portugal","Estados Unidos","CanadÃ¡","Reino Unido","Irlanda","Belice","Jamaica","Trinidad y Tobago"],v={Argentina:["Buenos Aires","CÃ³rdoba","Rosario","Mendoza","La Plata"],Bolivia:["La Paz","Santa Cruz","Cochabamba","Sucre"],Chile:["Santiago","ValparaÃ­so","ConcepciÃ³n","La Serena","Antofagasta","Temuco"],Colombia:["BogotÃ¡","MedellÃ­n","Cali","Barranquilla","Cartagena"],"Costa Rica":["San JosÃ©","Alajuela","Cartago","Heredia"],Cuba:["La Habana","Santiago de Cuba","CamagÃ¼ey"],"RepÃºblica Dominicana":["Santo Domingo","Santiago","La Romana"],Ecuador:["Quito","Guayaquil","Cuenca","Ambato"],"El Salvador":["San Salvador","Santa Ana","San Miguel"],Guatemala:["Ciudad de Guatemala","Quetzaltenango","Escuintla"],Honduras:["Tegucigalpa","San Pedro Sula","La Ceiba"],MÃ©xico:["Ciudad de MÃ©xico","Guadalajara","Monterrey","Puebla","Tijuana"],Nicaragua:["Managua","LeÃ³n","Masaya"],PanamÃ¡:["Ciudad de PanamÃ¡","ColÃ³n","David"],Paraguay:["AsunciÃ³n","Ciudad del Este","EncarnaciÃ³n"],PerÃº:["Lima","Arequipa","Trujillo","Chiclayo","Cusco"],"Puerto Rico":["San Juan","Ponce","MayagÃ¼ez"],Uruguay:["Montevideo","Salto","PaysandÃº"],Venezuela:["Caracas","Maracaibo","Valencia","Barquisimeto"],EspaÃ±a:["Madrid","Barcelona","Valencia","Sevilla","Bilbao","Zaragoza"],Brasil:["SÃ£o Paulo","Rio de Janeiro","Belo Horizonte","BrasÃ­lia"],Portugal:["Lisboa","Porto","CoÃ­mbra","Braga"],"Estados Unidos":["New York","Los Angeles","Miami","Houston","Chicago"],CanadÃ¡:["Toronto","Vancouver","Montreal","Calgary","Ottawa"],"Reino Unido":["Londres","Manchester","Birmingham","Liverpool"],Irlanda:["DublÃ­n","Cork","Galway","Limerick"],Belice:["BelmopÃ¡n","Ciudad de Belice","San Ignacio"],Jamaica:["Kingston","Montego Bay","Spanish Town"],"Trinidad y Tobago":["Puerto EspaÃ±a","San Fernando","Chaguanas"]},w={Chile:{Santiago:["Liceo Nacional Santiago","Colegio RepÃºblica de Chile","Colegio San MartÃ­n","Colegio Los HÃ©roes"],ValparaÃ­so:["Liceo MarÃ­timo","Colegio Puerto Real"],ConcepciÃ³n:["Colegio BioBÃ­o","Liceo ConcepciÃ³n"],Temuco:["Colegio AraucanÃ­a","Liceo Temuco"]},MÃ©xico:{"Ciudad de MÃ©xico":["Colegio Insurgentes","Liceo Reforma","Colegio del Centro"],Guadalajara:["Colegio TapatÃ­o","Liceo Jalisco"],Monterrey:["Colegio Regio","Instituto Monterrey"]},PerÃº:{Lima:["Colegio Los PrÃ³ceres","Colegio Miraflores","Liceo Lima"],Arequipa:["Colegio Misti","Liceo Arequipa"]},EspaÃ±a:{Madrid:["Colegio Retiro","IES Castilla","Colegio Gran VÃ­a"],Barcelona:["Colegio Eixample","IES GaudÃ­"]}},E=v[i.region]||["Otra / No listado"],A=w[i.region]&&w[i.region][i.ciudad]||[],T=i.colegio==="OTRO"||A.length===0;return m.createElement("div",{style:coe},m.createElement("h2",{style:uoe},"ðŸ“ Registro de Profesor"),m.createElement("div",{style:{textAlign:"center",marginBottom:"0.5rem",color:"#2e7d32",fontWeight:800}},"Plan: ",l?"SuscripciÃ³n (inicia sesiÃ³n para pagar)":"Prueba Gratis por 7 dÃ­as"),t&&m.createElement("div",{style:foe},t),l&&m.createElement("div",{style:{display:"flex",gap:8,justifyContent:"center",marginBottom:12}},m.createElement("button",{onClick:()=>n("/login?next=/pago&checkout=1"),style:{...ib,backgroundColor:"#2563eb"}},"ðŸ”’ Iniciar sesiÃ³n y pagar")),m.createElement("form",{onSubmit:h,style:doe},m.createElement("input",{type:"text",name:"nombre",placeholder:"Nombre completo",onChange:u,required:!0,style:_c}),m.createElement("input",{type:"email",name:"correo",placeholder:"Correo electrÃ³nico",onChange:u,required:!0,style:_c}),m.createElement("input",{type:"password",name:"clave",placeholder:"ContraseÃ±a",onChange:u,required:!0,style:_c}),m.createElement("input",{type:"password",name:"confirmar",placeholder:"Confirmar contraseÃ±a",onChange:u,required:!0,style:_c}),m.createElement("select",{name:"region",value:i.region,onChange:u,required:!0,style:_c},m.createElement("option",{value:""},"PaÃ­s"),f.map(_=>m.createElement("option",{key:_,value:_},_))),m.createElement("select",{name:"ciudad",value:i.ciudad,onChange:u,required:!0,style:_c,disabled:!i.region},m.createElement("option",{value:""},i.region?"Ciudad":"Selecciona un paÃ­s primero"),E.map(_=>m.createElement("option",{key:_,value:_},_))),m.createElement("select",{name:"colegio",value:A.length===0?"OTRO":i.colegio||"",onChange:u,required:!0,style:_c,disabled:!i.ciudad},m.createElement("option",{value:""},i.ciudad?"Colegio/Liceo":"Selecciona una ciudad primero"),A.map(_=>m.createElement("option",{key:_,value:_},_)),m.createElement("option",{value:"OTRO"},"Otro / No listado")),T&&m.createElement("input",{type:"text",name:"colegioOtro",placeholder:"Indica el Nombre de tu Colegio/Liceo",value:i.colegioOtro,onChange:u,required:!0,style:_c}),m.createElement("button",{type:"submit",style:hoe,disabled:l},l?"Bloqueado para pago (usa Iniciar sesiÃ³n)":"âœ… Registrarme")),m.createElement("button",{onClick:()=>n("/"),style:ib},"â¬…ï¸ Volver al Inicio"),m.createElement("div",{style:{display:"flex",gap:8,marginTop:12,justifyContent:"center"}},m.createElement("button",{onClick:()=>n("/planificaciones?onboard=1"),style:{...ib,backgroundColor:"#2563eb"}},"ðŸ“š Ir a Planificaciones"),m.createElement("button",{onClick:()=>n("/horario",{state:{forzar:!0}}),style:{...ib}},"ðŸ—“ï¸ Configurar Horario ahora")))}const coe={padding:"2rem",maxWidth:"600px",margin:"auto",fontFamily:"Segoe UI, sans-serif",backgroundColor:"#f5f5f5",borderRadius:"12px",boxShadow:"0 4px 10px rgba(0,0,0,0.1)"},uoe={textAlign:"center",color:"#2e7d32",marginBottom:"1rem"},doe={display:"flex",flexDirection:"column",gap:"1rem"},_c={padding:"0.75rem",fontSize:"1rem",border:"1px solid #ccc",borderRadius:"8px"},hoe={padding:"0.8rem",fontSize:"1rem",backgroundColor:"#2e7d32",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},ib={marginTop:"1rem",padding:"0.7rem",backgroundColor:"#607d8b",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},foe={backgroundColor:"#fff3cd",color:"#856404",padding:"0.8rem",borderRadius:"6px",marginBottom:"1rem",border:"1px solid #ffeeba"},poe="modulepreload",moe=function(n){return"/"+n},UL={},goe=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(l=>{if(l=moe(l),l in UL)return;UL[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":poe,c||(h.as="script"),h.crossOrigin="",h.href=l,a&&h.setAttribute("nonce",a),document.head.appendChild(h),c)return new Promise((f,v)=>{h.addEventListener("load",f),h.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};function yoe(){const[n,e]=D.useState(""),[t,r]=D.useState(""),[i,s]=D.useState(""),o=ji(),a=Hs(),l=D.useRef(null);D.useEffect(()=>{const f=setTimeout(()=>{var v;return(v=l.current)==null?void 0:v.focus()},100);return()=>clearTimeout(f)},[]);const c=()=>{const f=new Date().toISOString().slice(0,10);try{sessionStorage.setItem("teacher.session.ok","1"),localStorage.setItem("lastTeacherLoginDay",f)}catch{}},u=async(f,v)=>{let w="âš ï¸ Ha ocurrido un error. Intenta nuevamente.";switch(f==null?void 0:f.code){case"auth/invalid-email":w="âš ï¸ Correo no vÃ¡lido.";break;case"auth/user-not-found":w="âš ï¸ No encontramos una cuenta con ese correo. RegÃ­strate primero.";break;case"auth/wrong-password":w="âš ï¸ ContraseÃ±a incorrecta.";break;case"auth/invalid-credential":{try{const E=await h8(we,v);!E||E.length===0?w="âš ï¸ No encontramos una cuenta con ese correo. RegÃ­strate primero.":w="âš ï¸ ContraseÃ±a incorrecta."}catch{w="âš ï¸ Verifica tu correo y contraseÃ±a."}break}case"auth/network-request-failed":w="âš ï¸ Problema de red. Revisa tu conexiÃ³n e intÃ©ntalo de nuevo.";break;case"auth/too-many-requests":w="âš ï¸ Demasiados intentos fallidos. IntÃ©ntalo mÃ¡s tarde o restablece tu contraseÃ±a.";break;case"auth/user-disabled":w="âš ï¸ La cuenta estÃ¡ deshabilitada. Contacta a soporte.";break;default:console.warn("[Login] error no mapeado:",f==null?void 0:f.code,f==null?void 0:f.message),w="âš ï¸ Verifica tu correo y contraseÃ±a.";break}return w},h=async f=>{f.preventDefault(),s("â³ Verificando tus credenciales...");const v=(n||"").trim().toLowerCase();try{const E=(await u8(we,v,t)).user.uid;try{localStorage.setItem("uid",E)}catch{}try{const _=await goe(()=>import("./postLogin-ljzuMEpr.js"),[]);if(_!=null&&_.postLogin){s("âœ… Â¡Inicio de sesiÃ³n exitoso! Preparando tu claseâ€¦"),await _.postLogin(o,a);return}}catch(_){console.warn("[Login] postLogin no disponible aÃºn, uso fallback:",(_==null?void 0:_.message)||_)}const A=se(X,"usuarios",E),T=await Fe(A);c(),s("âœ… Â¡Inicio de sesiÃ³n exitoso! Redirigiendo..."),setTimeout(()=>{const b=new URLSearchParams(a.search||"").get("next");b?o(b,{replace:!0}):T.exists()?o("/"):o("/horario")},700)}catch(w){console.error(w.code);const E=await u(w,v);s(E)}};return m.createElement("div",{style:voe},m.createElement("div",{style:woe},m.createElement("h1",{style:Eoe},"ðŸ” Iniciar SesiÃ³n en PRAGMAPROFE"),m.createElement("p",{style:boe},"Accede con tu correo y contraseÃ±a"),i&&m.createElement("div",{style:_oe},i),m.createElement("form",{onSubmit:h,style:Soe},m.createElement("label",{style:BL},"Correo ElectrÃ³nico"),m.createElement("input",{type:"email",value:n,onChange:f=>e(f.target.value),placeholder:"ejemplo@correo.com",style:$L,required:!0,name:"username",autoComplete:"username",inputMode:"email"}),m.createElement("label",{style:BL},"ContraseÃ±a"),m.createElement("input",{ref:l,type:"password",value:t,onChange:f=>r(f.target.value),placeholder:"Tu clave secreta",style:$L,required:!0,name:"password",autoComplete:"current-password"}),m.createElement("button",{type:"submit",style:Aoe},"Ingresar")),m.createElement("button",{onClick:()=>o("/"),style:Toe},"â¬…ï¸ Volver al inicio")))}const voe={minHeight:"100vh",background:"linear-gradient(to right, #2193b0, #6dd5ed)",display:"flex",justifyContent:"center",alignItems:"center",fontFamily:"'Segoe UI', sans-serif"},woe={background:"#ffffff",padding:"2.5rem",borderRadius:"15px",boxShadow:"0 4px 20px rgba(0,0,0,0.1)",width:"100%",maxWidth:"400px",textAlign:"center"},Eoe={fontSize:"1.8rem",marginBottom:"0.5rem",color:"#2193b0"},boe={fontSize:"1rem",marginBottom:"1.5rem",color:"#555"},_oe={background:"#fff8e1",color:"#795548",padding:"0.9rem",marginBottom:"1.2rem",borderRadius:"6px",fontSize:"0.95rem",fontWeight:"500"},Soe={display:"flex",flexDirection:"column",gap:"1rem"},BL={textAlign:"left",fontWeight:"bold",color:"#333"},$L={padding:"0.8rem",border:"1px solid #ccc",borderRadius:"6px",fontSize:"1rem"},Aoe={padding:"0.9rem",backgroundColor:"#2193b0",color:"white",fontWeight:"bold",border:"none",borderRadius:"6px",fontSize:"1rem",cursor:"pointer",transition:"background-color 0.3s"},Toe={marginTop:"1rem",padding:"0.7rem 1rem",backgroundColor:"#eeeeee",color:"#333",border:"1px solid #ccc",borderRadius:"6px",fontSize:"0.95rem",cursor:"pointer"},Ioe={minHeight:"100vh",display:"grid",placeItems:"center",background:"linear-gradient(to right, #2193b0, #6dd5ed)",fontFamily:"Segoe UI, sans-serif",color:"#fff",padding:"2rem"},xoe={background:"#ffffff",color:"#1f2937",borderRadius:12,padding:"1rem 1.25rem",width:"min(520px, 95vw)",boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)",border:"1px solid #e5e7eb"},sb={width:"100%",padding:"0.7rem 0.9rem",borderRadius:10,border:"1px solid #e5e7eb",outline:"none",marginBottom:10,fontSize:"1rem"},kT={background:"#2193b0",color:"#fff",border:"none",borderRadius:10,padding:".6rem .9rem",fontWeight:700,cursor:"pointer"},Coe=["ðŸ±","ðŸ¶","ðŸ¦Š","ðŸ¯","ðŸ¼","ðŸ¸","ðŸµ","ðŸ¦„","ðŸ¢","ðŸ™","ðŸ¥","ðŸ¨","ðŸ°","ðŸ®","ðŸº","ðŸ¦","ðŸ·","ðŸ¹","ðŸ”","ðŸ»"];function Poe(){const[n,e]=D.useState(""),[t,r]=D.useState(localStorage.getItem("nlista")||""),[i,s]=D.useState(""),[o,a]=D.useState(!1),[l,c]=D.useState(""),[u,h]=D.useState(!1),[f,v]=D.useState(localStorage.getItem("pid")||""),[w,E]=D.useState(localStorage.getItem("pname")||""),[A,T]=D.useState(localStorage.getItem("pava")||"ðŸ±"),[_,b]=D.useState(null),[g,y]=D.useState(""),[x,S]=D.useState(null),[I,P]=D.useState(!1);D.useEffect(()=>{const L=ls(we,async j=>{if(!j)try{await mo(we)}catch(oe){console.error("anon auth",oe)}});return()=>L()},[]),D.useEffect(()=>{const L=new URLSearchParams(window.location.search),j=L.get("session")||"";c(j);const oe=L.get("code")||"";e(oe)},[]),D.useEffect(()=>{const L=se(X,"carrera","actual","meta","pregunta"),j=fa(L,oe=>{var $;if(oe.exists()){const B=oe.data();b(B),y("");const G=($=B==null?void 0:B.startAt)!=null&&$.toMillis?B.startAt.toMillis():Date.now();S(G)}else b(null)});return()=>j()},[]);const N=async()=>{const L=(i||"").trim();if(!n){alert("Falta el cÃ³digo de la sala (escanea el QR otra vez).");return}if(!L){alert("Escribe una palabra.");return}a(!0);try{await V1(tn(X,"salas",n,"palabras"),{texto:L,numeroLista:t||null,timestamp:ut()}),localStorage.setItem("nlista",t||""),s(""),alert("Â¡Enviado!")}catch(j){console.error(j),alert("No se pudo enviar. Intenta de nuevo")}finally{a(!1)}},M=async()=>{if(!w.trim()){alert("Escribe tu nombre");return}h(!0);try{let L=f;L?await xt(se(X,"carrera","actual","participantes",L),{nombre:w.trim(),avatar:A,joinedAt:ut(),session:l||null},{merge:!0}):L=(await V1(tn(X,"carrera","actual","participantes"),{nombre:w.trim(),avatar:A,progreso:0,puntos:0,joinedAt:ut(),session:l||null})).id,v(L),localStorage.setItem("pid",L),localStorage.setItem("pname",w.trim()),localStorage.setItem("pava",A),alert("Â¡Listo! EstÃ¡s dentro de la carrera.")}catch(L){console.error(L),alert("No se pudo registrar.")}finally{h(!1)}},V=async()=>{if(!f){alert("Primero Ãºnete a la carrera.");return}if(!(_!=null&&_.activa)){alert("No hay una ronda activa ahora.");return}const L=g||"";if(Array.isArray(_.opciones)&&_.opciones.length>0&&!L){alert("Selecciona una opciÃ³n.");return}P(!0);try{const j=Date.now(),oe=Math.max(0,j-(x||j));await V1(tn(X,"carrera","actual","respuestas"),{pid:f,nombre:w||"Jugador",answer:L,createdAt:ut(),latencyMs:oe,session:l||null}),alert("Â¡Respuesta enviada!")}catch(j){console.error(j),alert("No se pudo enviar la respuesta.")}finally{P(!1)}};return m.createElement("div",{style:Ioe},m.createElement("div",{style:xoe},m.createElement("h2",{style:{marginTop:0,textAlign:"center"}},"ðŸ“² Participa"),m.createElement("div",{style:{color:"#475569",fontSize:13,textAlign:"center",marginBottom:12}},"CÃ³digo de sala: ",m.createElement("strong",null,n||"â€”")),m.createElement("label",{style:{fontWeight:700}},"NÂ° lista (opcional)"),m.createElement("input",{style:sb,value:t,onChange:L=>r(L.target.value),placeholder:"Ej: 5"}),m.createElement("label",{style:{fontWeight:700}},"Tu palabra"),m.createElement("input",{style:sb,value:i,onChange:L=>s(L.target.value),placeholder:"Escribe una palabraâ€¦"}),m.createElement("button",{style:{...kT,width:"100%"},onClick:N,disabled:o},o?"Enviandoâ€¦":"Enviar a la nube"),m.createElement("hr",{style:{margin:"16px 0",border:"none",borderTop:"1px solid #e5e7eb"}}),m.createElement("div",{style:{color:"#475569",fontSize:13,textAlign:"center",marginBottom:12}},"SesiÃ³n (carrera): ",m.createElement("strong",null,l||"â€”")),m.createElement("label",{style:{fontWeight:700}},"Nombre"),m.createElement("input",{style:sb,value:w,onChange:L=>E(L.target.value),placeholder:"Tu nombre"}),m.createElement("label",{style:{fontWeight:700}},"Avatar"),m.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(10, 1fr)",gap:6,marginBottom:10}},Coe.map(L=>m.createElement("button",{key:L,type:"button",onClick:()=>T(L),style:{border:L===A?"2px solid #2193b0":"1px solid #e5e7eb",borderRadius:10,padding:"6px 4px",cursor:"pointer",background:"#fff",fontSize:20},title:L},L))),m.createElement("button",{style:kT,onClick:M,disabled:u},u?"Uniendo...":"Unirme"),m.createElement("hr",{style:{margin:"16px 0",border:"none",borderTop:"1px solid #e5e7eb"}}),m.createElement("h3",{style:{marginTop:0}},"ðŸ§  Pregunta"),!(_!=null&&_.activa)&&m.createElement("div",{style:{color:"#64748b"}},"Esperando una ronda activaâ€¦"),(_==null?void 0:_.activa)&&m.createElement(m.Fragment,null,m.createElement("div",{style:{marginBottom:8,fontWeight:700}},_.texto||"(sin texto)"),Array.isArray(_.opciones)&&_.opciones.length>0?m.createElement("div",{style:{display:"grid",gap:8,marginBottom:10}},_.opciones.map(L=>m.createElement("label",{key:L,style:{display:"flex",alignItems:"center",gap:8}},m.createElement("input",{type:"radio",name:"op",value:L,checked:g===L,onChange:()=>y(L)}),m.createElement("span",null,L)))):m.createElement("input",{style:sb,value:g,onChange:L=>y(L.target.value),placeholder:"Escribe tu respuestaâ€¦"}),m.createElement("button",{style:kT,onClick:V,disabled:I},I?"Enviandoâ€¦":"Responder"))))}const jL=n=>/Recreo|Almuerzo/i.test(n||""),zL=n=>{const e=String(n||"").match(/(\d{2}):(\d{2})\s*-\s*(\d{2}):(\d{2})/);return e?[[+e[1],+e[2]],[+e[3],+e[4]]]:null};function Roe(){const n=ji(),[e,t]=D.useState(null),[r,i]=D.useState(null),[s,o]=D.useState(!0);D.useEffect(()=>{const u=ls(we,async h=>{if(h)t(h.uid);else{const f=await mo(we);t(f.user.uid)}});return()=>u()},[]),D.useEffect(()=>{e&&(async()=>{o(!0);const u=await Fe(se(X,"usuarios",e));i(u.exists()?u.data():null),o(!1)})()},[e]);const a=()=>{if(!(r!=null&&r.horarioMatriz)||!(r!=null&&r.horarioConfig))return{enCurso:null,proxima:null};const{horarioMatriz:u,horarioConfig:h}=r,f=Array.isArray(h.bloquesGenerados)?h.bloquesGenerados:[],v=Array.isArray(h.marcas)?h.marcas:[],w=new Date,E=w.getDay()-1;if(E<0||E>4)return{enCurso:null,proxima:null};const A=w.getHours()*60+w.getMinutes(),T=Math.max(f.length,Object.keys(u||{}).length);let _=null;for(let g=0;g<T;g++){const y=f[g]||"";if(jL(y))continue;let x=v[g],S=v[g+1];if(!x||!S){const N=zL(y);N&&(x=N[0],S=N[1])}if(!x||!S)continue;const I=x[0]*60+x[1],P=S[0]*60+S[1];if(A>=I&&A<P){const M=(u[`f${g}`]||[])[E]||{};_={fila:g,col:E,cell:M,label:y};break}}let b=null;if(!_)for(let g=0;g<T;g++){const y=f[g]||"";if(jL(y))continue;let x=v[g],S=v[g+1];if(!x||!S){const P=zL(y);P&&(x=P[0],S=P[1])}if(!x||!S)continue;const I=x[0]*60+x[1];if(A<I){const N=(u[`f${g}`]||[])[E]||{};if(N!=null&&N.asignatura){b={fila:g,col:E,cell:N,label:y};break}}}return{enCurso:_,proxima:b}};if(s)return m.createElement("div",{style:{padding:"2rem"}},"Cargandoâ€¦");if(!r)return m.createElement("div",{style:{padding:"2rem"}},"No hay datos de horario."," ",m.createElement("button",{onClick:()=>n("/horario"),style:{padding:8,borderRadius:8,border:"1px solid #e5e7eb"}},"Crear/Editar horario"));const{enCurso:l,proxima:c}=a();return m.createElement("div",{style:{padding:"2rem",fontFamily:"Segoe UI, sans-serif"}},m.createElement("h2",null,"ðŸŽ“ Inicio de Clase"),l?m.createElement("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:16,marginBottom:16,background:"#f8fafc"}},m.createElement("div",{style:{fontWeight:800,marginBottom:6}},"Clase en curso"),m.createElement("div",null,m.createElement("b",null,l.cell.asignatura)," â€” ",l.cell.nivel," ",l.cell.seccion),m.createElement("div",null,l.label),l.cell.unidad&&m.createElement("div",null,"Unidad: ",l.cell.unidad),l.cell.objetivo&&m.createElement("div",null,"Objetivo: ",l.cell.objetivo)):m.createElement("div",{style:{marginBottom:16}},"Ahora mismo no hay clase."),c&&m.createElement("div",{style:{border:"1px solid #e5e7eb",borderRadius:12,padding:16,marginBottom:16}},m.createElement("div",{style:{fontWeight:800,marginBottom:6}},"PrÃ³xima clase"),m.createElement("div",null,m.createElement("b",null,c.cell.asignatura)," â€” ",c.cell.nivel," ",c.cell.seccion),m.createElement("div",null,c.label),c.cell.unidad&&m.createElement("div",null,"Unidad: ",c.cell.unidad)),m.createElement("div",{style:{display:"flex",gap:10}},m.createElement("button",{onClick:()=>n("/horario"),style:{padding:"8px 12px",borderRadius:10,border:"1px solid #e5e7eb"}},"ðŸ—“ï¸ Editar horario"),m.createElement("button",{onClick:()=>n("/planificaciones"),style:{padding:"8px 12px",borderRadius:10,border:"1px solid #e5e7eb"}},"ðŸ“š Ir a Planificaciones")))}function koe(){const n=ji(),[e,t]=D.useState(null),[r,i]=D.useState([]),[s,o]=D.useState(!0),a=jj();return D.useEffect(()=>{const l=ls(we,async c=>{if(c)t(c.uid);else{const u=await mo(we);t(u.user.uid)}});return()=>l()},[]),D.useEffect(()=>{e&&(async()=>{o(!0);try{const l=await zj(e,a);i(l)}finally{o(!1)}})()},[e,a]),s?m.createElement("div",{style:{padding:"2rem"}},"Cargandoâ€¦"):m.createElement("div",{style:{padding:"2rem",fontFamily:"Segoe UI, sans-serif"}},m.createElement("h2",null,"ðŸ“š Planificaciones sugeridas â€” ",a),!r.length&&m.createElement("div",{style:{marginBottom:16}},"No hay sugerencias. Guarda tu horario con al menos una clase de MatemÃ¡tica y vuelve acÃ¡.",m.createElement("div",{style:{marginTop:8}},m.createElement("button",{onClick:()=>n("/horario"),style:{padding:"8px 12px",borderRadius:10,border:"1px solid #e5e7eb"}},"ðŸ—“ï¸ Ir al horario"))),m.createElement("div",{style:{display:"grid",gap:12}},r.map(l=>m.createElement("div",{key:l.id,style:{border:"1px solid #e5e7eb",borderRadius:12,padding:12}},m.createElement("div",null,m.createElement("b",null,l.asignatura||"Asignatura")," â€” ",l.nivel||"Nivel"),m.createElement("div",null,l.dia," Â· ",l.bloqueLabel||`Bloque ${l.bloqueIdx??""}`),l.unidad&&m.createElement("div",null,"Unidad: ",l.unidad),l.objetivoClase&&m.createElement("div",null,"Objetivo: ",l.objetivoClase),m.createElement("div",{style:{display:"flex",gap:8,marginTop:8}},m.createElement("button",{onClick:async()=>{await _se(e,a,l),i(c=>c.filter(u=>u.id!==l.id))},style:{padding:"6px 10px"}},"Aprobar"),m.createElement("button",{onClick:async()=>{await Sse(e,a,l.id),i(c=>c.filter(u=>u.id!==l.id))},style:{padding:"6px 10px"}},"Rechazar"))))))}function Xj(n,e){return function(){return n.apply(e,arguments)}}const{toString:Doe}=Object.prototype,{getPrototypeOf:Vk}=Object,{iterator:u1,toStringTag:Jj}=Symbol,d1=(n=>e=>{const t=Doe.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Zo=n=>(n=n.toLowerCase(),e=>d1(e)===n),h1=n=>e=>typeof e===n,{isArray:kg}=Array,fg=h1("undefined");function sE(n){return n!==null&&!fg(n)&&n.constructor!==null&&!fg(n.constructor)&&os(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Zj=Zo("ArrayBuffer");function Moe(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Zj(n.buffer),e}const Noe=h1("string"),os=h1("function"),e6=h1("number"),oE=n=>n!==null&&typeof n=="object",Loe=n=>n===!0||n===!1,y_=n=>{if(d1(n)!=="object")return!1;const e=Vk(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Jj in n)&&!(u1 in n)},Ooe=n=>{if(!oE(n)||sE(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},Foe=Zo("Date"),Voe=Zo("File"),Uoe=Zo("Blob"),Boe=Zo("FileList"),$oe=n=>oE(n)&&os(n.pipe),joe=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||os(n.append)&&((e=d1(n))==="formdata"||e==="object"&&os(n.toString)&&n.toString()==="[object FormData]"))},zoe=Zo("URLSearchParams"),[Hoe,Goe,Woe,qoe]=["ReadableStream","Request","Response","Headers"].map(Zo),Koe=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function aE(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let r,i;if(typeof n!="object"&&(n=[n]),kg(n))for(r=0,i=n.length;r<i;r++)e.call(null,n[r],r,n);else{if(sE(n))return;const s=t?Object.getOwnPropertyNames(n):Object.keys(n),o=s.length;let a;for(r=0;r<o;r++)a=s[r],e.call(null,n[a],a,n)}}function t6(n,e){if(sE(n))return null;e=e.toLowerCase();const t=Object.keys(n);let r=t.length,i;for(;r-- >0;)if(i=t[r],e===i.toLowerCase())return i;return null}const Od=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,n6=n=>!fg(n)&&n!==Od;function UC(){const{caseless:n,skipUndefined:e}=n6(this)&&this||{},t={},r=(i,s)=>{const o=n&&t6(t,s)||s;y_(t[o])&&y_(i)?t[o]=UC(t[o],i):y_(i)?t[o]=UC({},i):kg(i)?t[o]=i.slice():(!e||!fg(i))&&(t[o]=i)};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&aE(arguments[i],r);return t}const Yoe=(n,e,t,{allOwnKeys:r}={})=>(aE(e,(i,s)=>{t&&os(i)?n[s]=Xj(i,t):n[s]=i},{allOwnKeys:r}),n),Qoe=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),Xoe=(n,e,t,r)=>{n.prototype=Object.create(e.prototype,r),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Joe=(n,e,t,r)=>{let i,s,o;const a={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),s=i.length;s-- >0;)o=i[s],(!r||r(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&Vk(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},Zoe=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const r=n.indexOf(e,t);return r!==-1&&r===t},eae=n=>{if(!n)return null;if(kg(n))return n;let e=n.length;if(!e6(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},tae=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Vk(Uint8Array)),nae=(n,e)=>{const r=(n&&n[u1]).call(n);let i;for(;(i=r.next())&&!i.done;){const s=i.value;e.call(n,s[0],s[1])}},rae=(n,e)=>{let t;const r=[];for(;(t=n.exec(e))!==null;)r.push(t);return r},iae=Zo("HTMLFormElement"),sae=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,i){return r.toUpperCase()+i}),HL=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),oae=Zo("RegExp"),r6=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),r={};aE(t,(i,s)=>{let o;(o=e(i,s,n))!==!1&&(r[s]=o||i)}),Object.defineProperties(n,r)},aae=n=>{r6(n,(e,t)=>{if(os(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const r=n[t];if(os(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},lae=(n,e)=>{const t={},r=i=>{i.forEach(s=>{t[s]=!0})};return kg(n)?r(n):r(String(n).split(e)),t},cae=()=>{},uae=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function dae(n){return!!(n&&os(n.append)&&n[Jj]==="FormData"&&n[u1])}const hae=n=>{const e=new Array(10),t=(r,i)=>{if(oE(r)){if(e.indexOf(r)>=0)return;if(sE(r))return r;if(!("toJSON"in r)){e[i]=r;const s=kg(r)?[]:{};return aE(r,(o,a)=>{const l=t(o,i+1);!fg(l)&&(s[a]=l)}),e[i]=void 0,s}}return r};return t(n,0)},fae=Zo("AsyncFunction"),pae=n=>n&&(oE(n)||os(n))&&os(n.then)&&os(n.catch),i6=((n,e)=>n?setImmediate:e?((t,r)=>(Od.addEventListener("message",({source:i,data:s})=>{i===Od&&s===t&&r.length&&r.shift()()},!1),i=>{r.push(i),Od.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",os(Od.postMessage)),mae=typeof queueMicrotask<"u"?queueMicrotask.bind(Od):typeof process<"u"&&process.nextTick||i6,gae=n=>n!=null&&os(n[u1]),Q={isArray:kg,isArrayBuffer:Zj,isBuffer:sE,isFormData:joe,isArrayBufferView:Moe,isString:Noe,isNumber:e6,isBoolean:Loe,isObject:oE,isPlainObject:y_,isEmptyObject:Ooe,isReadableStream:Hoe,isRequest:Goe,isResponse:Woe,isHeaders:qoe,isUndefined:fg,isDate:Foe,isFile:Voe,isBlob:Uoe,isRegExp:oae,isFunction:os,isStream:$oe,isURLSearchParams:zoe,isTypedArray:tae,isFileList:Boe,forEach:aE,merge:UC,extend:Yoe,trim:Koe,stripBOM:Qoe,inherits:Xoe,toFlatObject:Joe,kindOf:d1,kindOfTest:Zo,endsWith:Zoe,toArray:eae,forEachEntry:nae,matchAll:rae,isHTMLForm:iae,hasOwnProperty:HL,hasOwnProp:HL,reduceDescriptors:r6,freezeMethods:aae,toObjectSet:lae,toCamelCase:sae,noop:cae,toFiniteNumber:uae,findKey:t6,global:Od,isContextDefined:n6,isSpecCompliantForm:dae,toJSONObject:hae,isAsyncFn:fae,isThenable:pae,setImmediate:i6,asap:mae,isIterable:gae};function _t(n,e,t,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}Q.inherits(_t,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Q.toJSONObject(this.config),code:this.code,status:this.status}}});const s6=_t.prototype,o6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{o6[n]={value:n}});Object.defineProperties(_t,o6);Object.defineProperty(s6,"isAxiosError",{value:!0});_t.from=(n,e,t,r,i,s)=>{const o=Object.create(s6);Q.toFlatObject(n,o,function(u){return u!==Error.prototype},c=>c!=="isAxiosError");const a=n&&n.message?n.message:"Error",l=e==null&&n?n.code:e;return _t.call(o,a,l,t,r,i),n&&o.cause==null&&Object.defineProperty(o,"cause",{value:n,configurable:!0}),o.name=n&&n.name||"Error",s&&Object.assign(o,s),o};const yae=null;function BC(n){return Q.isPlainObject(n)||Q.isArray(n)}function a6(n){return Q.endsWith(n,"[]")?n.slice(0,-2):n}function GL(n,e,t){return n?n.concat(e).map(function(i,s){return i=a6(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function vae(n){return Q.isArray(n)&&!n.some(BC)}const wae=Q.toFlatObject(Q,{},null,function(e){return/^is[A-Z]/.test(e)});function f1(n,e,t){if(!Q.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=Q.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,A){return!Q.isUndefined(A[E])});const r=t.metaTokens,i=t.visitor||u,s=t.dots,o=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&Q.isSpecCompliantForm(e);if(!Q.isFunction(i))throw new TypeError("visitor must be a function");function c(w){if(w===null)return"";if(Q.isDate(w))return w.toISOString();if(Q.isBoolean(w))return w.toString();if(!l&&Q.isBlob(w))throw new _t("Blob is not supported. Use a Buffer instead.");return Q.isArrayBuffer(w)||Q.isTypedArray(w)?l&&typeof Blob=="function"?new Blob([w]):Buffer.from(w):w}function u(w,E,A){let T=w;if(w&&!A&&typeof w=="object"){if(Q.endsWith(E,"{}"))E=r?E:E.slice(0,-2),w=JSON.stringify(w);else if(Q.isArray(w)&&vae(w)||(Q.isFileList(w)||Q.endsWith(E,"[]"))&&(T=Q.toArray(w)))return E=a6(E),T.forEach(function(b,g){!(Q.isUndefined(b)||b===null)&&e.append(o===!0?GL([E],g,s):o===null?E:E+"[]",c(b))}),!1}return BC(w)?!0:(e.append(GL(A,E,s),c(w)),!1)}const h=[],f=Object.assign(wae,{defaultVisitor:u,convertValue:c,isVisitable:BC});function v(w,E){if(!Q.isUndefined(w)){if(h.indexOf(w)!==-1)throw Error("Circular reference detected in "+E.join("."));h.push(w),Q.forEach(w,function(T,_){(!(Q.isUndefined(T)||T===null)&&i.call(e,T,Q.isString(_)?_.trim():_,E,f))===!0&&v(T,E?E.concat(_):[_])}),h.pop()}}if(!Q.isObject(n))throw new TypeError("data must be an object");return v(n),e}function WL(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function Uk(n,e){this._pairs=[],n&&f1(n,this,e)}const l6=Uk.prototype;l6.append=function(e,t){this._pairs.push([e,t])};l6.toString=function(e){const t=e?function(r){return e.call(this,r,WL)}:WL;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Eae(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function c6(n,e,t){if(!e)return n;const r=t&&t.encode||Eae;Q.isFunction(t)&&(t={serialize:t});const i=t&&t.serialize;let s;if(i?s=i(e,t):s=Q.isURLSearchParams(e)?e.toString():new Uk(e,t).toString(r),s){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+s}return n}class qL{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Q.forEach(this.handlers,function(r){r!==null&&e(r)})}}const u6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},bae=typeof URLSearchParams<"u"?URLSearchParams:Uk,_ae=typeof FormData<"u"?FormData:null,Sae=typeof Blob<"u"?Blob:null,Aae={isBrowser:!0,classes:{URLSearchParams:bae,FormData:_ae,Blob:Sae},protocols:["http","https","file","blob","url","data"]},Bk=typeof window<"u"&&typeof document<"u",$C=typeof navigator=="object"&&navigator||void 0,Tae=Bk&&(!$C||["ReactNative","NativeScript","NS"].indexOf($C.product)<0),Iae=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",xae=Bk&&window.location.href||"http://localhost",Cae=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Bk,hasStandardBrowserEnv:Tae,hasStandardBrowserWebWorkerEnv:Iae,navigator:$C,origin:xae},Symbol.toStringTag,{value:"Module"})),vi={...Cae,...Aae};function Pae(n,e){return f1(n,new vi.classes.URLSearchParams,{visitor:function(t,r,i,s){return vi.isNode&&Q.isBuffer(t)?(this.append(r,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)},...e})}function Rae(n){return Q.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function kae(n){const e={},t=Object.keys(n);let r;const i=t.length;let s;for(r=0;r<i;r++)s=t[r],e[s]=n[s];return e}function d6(n){function e(t,r,i,s){let o=t[s++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=s>=t.length;return o=!o&&Q.isArray(i)?i.length:o,l?(Q.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!a):((!i[o]||!Q.isObject(i[o]))&&(i[o]=[]),e(t,r,i[o],s)&&Q.isArray(i[o])&&(i[o]=kae(i[o])),!a)}if(Q.isFormData(n)&&Q.isFunction(n.entries)){const t={};return Q.forEachEntry(n,(r,i)=>{e(Rae(r),i,t,0)}),t}return null}function Dae(n,e,t){if(Q.isString(n))try{return(e||JSON.parse)(n),Q.trim(n)}catch(r){if(r.name!=="SyntaxError")throw r}return(t||JSON.stringify)(n)}const lE={transitional:u6,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",i=r.indexOf("application/json")>-1,s=Q.isObject(e);if(s&&Q.isHTMLForm(e)&&(e=new FormData(e)),Q.isFormData(e))return i?JSON.stringify(d6(e)):e;if(Q.isArrayBuffer(e)||Q.isBuffer(e)||Q.isStream(e)||Q.isFile(e)||Q.isBlob(e)||Q.isReadableStream(e))return e;if(Q.isArrayBufferView(e))return e.buffer;if(Q.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Pae(e,this.formSerializer).toString();if((a=Q.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return f1(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),Dae(e)):e}],transformResponse:[function(e){const t=this.transitional||lE.transitional,r=t&&t.forcedJSONParsing,i=this.responseType==="json";if(Q.isResponse(e)||Q.isReadableStream(e))return e;if(e&&Q.isString(e)&&(r&&!this.responseType||i)){const o=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(a){if(o)throw a.name==="SyntaxError"?_t.from(a,_t.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:vi.classes.FormData,Blob:vi.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Q.forEach(["delete","get","head","post","put","patch"],n=>{lE.headers[n]={}});const Mae=Q.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Nae=n=>{const e={};let t,r,i;return n&&n.split(`
`).forEach(function(o){i=o.indexOf(":"),t=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!t||e[t]&&Mae[t])&&(t==="set-cookie"?e[t]?e[t].push(r):e[t]=[r]:e[t]=e[t]?e[t]+", "+r:r)}),e},KL=Symbol("internals");function ly(n){return n&&String(n).trim().toLowerCase()}function v_(n){return n===!1||n==null?n:Q.isArray(n)?n.map(v_):String(n)}function Lae(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=t.exec(n);)e[r[1]]=r[2];return e}const Oae=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function DT(n,e,t,r,i){if(Q.isFunction(r))return r.call(this,e,t);if(i&&(e=t),!!Q.isString(e)){if(Q.isString(r))return e.indexOf(r)!==-1;if(Q.isRegExp(r))return r.test(e)}}function Fae(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}function Vae(n,e){const t=Q.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(n,r+t,{value:function(i,s,o){return this[r].call(this,e,i,s,o)},configurable:!0})})}let as=class{constructor(e){e&&this.set(e)}set(e,t,r){const i=this;function s(a,l,c){const u=ly(l);if(!u)throw new Error("header name must be a non-empty string");const h=Q.findKey(i,u);(!h||i[h]===void 0||c===!0||c===void 0&&i[h]!==!1)&&(i[h||l]=v_(a))}const o=(a,l)=>Q.forEach(a,(c,u)=>s(c,u,l));if(Q.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(Q.isString(e)&&(e=e.trim())&&!Oae(e))o(Nae(e),t);else if(Q.isObject(e)&&Q.isIterable(e)){let a={},l,c;for(const u of e){if(!Q.isArray(u))throw TypeError("Object iterator must return a key-value pair");a[c=u[0]]=(l=a[c])?Q.isArray(l)?[...l,u[1]]:[l,u[1]]:u[1]}o(a,t)}else e!=null&&s(t,e,r);return this}get(e,t){if(e=ly(e),e){const r=Q.findKey(this,e);if(r){const i=this[r];if(!t)return i;if(t===!0)return Lae(i);if(Q.isFunction(t))return t.call(this,i,r);if(Q.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ly(e),e){const r=Q.findKey(this,e);return!!(r&&this[r]!==void 0&&(!t||DT(this,this[r],r,t)))}return!1}delete(e,t){const r=this;let i=!1;function s(o){if(o=ly(o),o){const a=Q.findKey(r,o);a&&(!t||DT(r,r[a],a,t))&&(delete r[a],i=!0)}}return Q.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let r=t.length,i=!1;for(;r--;){const s=t[r];(!e||DT(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,r={};return Q.forEach(this,(i,s)=>{const o=Q.findKey(r,s);if(o){t[o]=v_(i),delete t[s];return}const a=e?Fae(s):String(s).trim();a!==s&&delete t[s],t[a]=v_(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Q.forEach(this,(r,i)=>{r!=null&&r!==!1&&(t[i]=e&&Q.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const r=new this(e);return t.forEach(i=>r.set(i)),r}static accessor(e){const r=(this[KL]=this[KL]={accessors:{}}).accessors,i=this.prototype;function s(o){const a=ly(o);r[a]||(Vae(i,o),r[a]=!0)}return Q.isArray(e)?e.forEach(s):s(e),this}};as.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Q.reduceDescriptors(as.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[t]=r}}});Q.freezeMethods(as);function MT(n,e){const t=this||lE,r=e||t,i=as.from(r.headers);let s=r.data;return Q.forEach(n,function(a){s=a.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function h6(n){return!!(n&&n.__CANCEL__)}function Dg(n,e,t){_t.call(this,n??"canceled",_t.ERR_CANCELED,e,t),this.name="CanceledError"}Q.inherits(Dg,_t,{__CANCEL__:!0});function f6(n,e,t){const r=t.config.validateStatus;!t.status||!r||r(t.status)?n(t):e(new _t("Request failed with status code "+t.status,[_t.ERR_BAD_REQUEST,_t.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Uae(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Bae(n,e){n=n||10;const t=new Array(n),r=new Array(n);let i=0,s=0,o;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=r[s];o||(o=c),t[i]=l,r[i]=c;let h=s,f=0;for(;h!==i;)f+=t[h++],h=h%n;if(i=(i+1)%n,i===s&&(s=(s+1)%n),c-o<e)return;const v=u&&c-u;return v?Math.round(f*1e3/v):void 0}}function $ae(n,e){let t=0,r=1e3/e,i,s;const o=(c,u=Date.now())=>{t=u,i=null,s&&(clearTimeout(s),s=null),n(...c)};return[(...c)=>{const u=Date.now(),h=u-t;h>=r?o(c,u):(i=c,s||(s=setTimeout(()=>{s=null,o(i)},r-h)))},()=>i&&o(i)]}const RS=(n,e,t=3)=>{let r=0;const i=Bae(50,250);return $ae(s=>{const o=s.loaded,a=s.lengthComputable?s.total:void 0,l=o-r,c=i(l),u=o<=a;r=o;const h={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:c||void 0,estimated:c&&a&&u?(a-o)/c:void 0,event:s,lengthComputable:a!=null,[e?"download":"upload"]:!0};n(h)},t)},YL=(n,e)=>{const t=n!=null;return[r=>e[0]({lengthComputable:t,total:n,loaded:r}),e[1]]},QL=n=>(...e)=>Q.asap(()=>n(...e)),jae=vi.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,vi.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(vi.origin),vi.navigator&&/(msie|trident)/i.test(vi.navigator.userAgent)):()=>!0,zae=vi.hasStandardBrowserEnv?{write(n,e,t,r,i,s){const o=[n+"="+encodeURIComponent(e)];Q.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),Q.isString(r)&&o.push("path="+r),Q.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Hae(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Gae(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function p6(n,e,t){let r=!Hae(e);return n&&(r||t==!1)?Gae(n,e):e}const XL=n=>n instanceof as?{...n}:n;function mf(n,e){e=e||{};const t={};function r(c,u,h,f){return Q.isPlainObject(c)&&Q.isPlainObject(u)?Q.merge.call({caseless:f},c,u):Q.isPlainObject(u)?Q.merge({},u):Q.isArray(u)?u.slice():u}function i(c,u,h,f){if(Q.isUndefined(u)){if(!Q.isUndefined(c))return r(void 0,c,h,f)}else return r(c,u,h,f)}function s(c,u){if(!Q.isUndefined(u))return r(void 0,u)}function o(c,u){if(Q.isUndefined(u)){if(!Q.isUndefined(c))return r(void 0,c)}else return r(void 0,u)}function a(c,u,h){if(h in e)return r(c,u);if(h in n)return r(void 0,c)}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,u,h)=>i(XL(c),XL(u),h,!0)};return Q.forEach(Object.keys({...n,...e}),function(u){const h=l[u]||i,f=h(n[u],e[u],u);Q.isUndefined(f)&&h!==a||(t[u]=f)}),t}const m6=n=>{const e=mf({},n);let{data:t,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:s,headers:o,auth:a}=e;if(e.headers=o=as.from(o),e.url=c6(p6(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),Q.isFormData(t)){if(vi.hasStandardBrowserEnv||vi.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(Q.isFunction(t.getHeaders)){const l=t.getHeaders(),c=["content-type","content-length"];Object.entries(l).forEach(([u,h])=>{c.includes(u.toLowerCase())&&o.set(u,h)})}}if(vi.hasStandardBrowserEnv&&(r&&Q.isFunction(r)&&(r=r(e)),r||r!==!1&&jae(e.url))){const l=i&&s&&zae.read(s);l&&o.set(i,l)}return e},Wae=typeof XMLHttpRequest<"u",qae=Wae&&function(n){return new Promise(function(t,r){const i=m6(n);let s=i.data;const o=as.from(i.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:c}=i,u,h,f,v,w;function E(){v&&v(),w&&w(),i.cancelToken&&i.cancelToken.unsubscribe(u),i.signal&&i.signal.removeEventListener("abort",u)}let A=new XMLHttpRequest;A.open(i.method.toUpperCase(),i.url,!0),A.timeout=i.timeout;function T(){if(!A)return;const b=as.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders()),y={data:!a||a==="text"||a==="json"?A.responseText:A.response,status:A.status,statusText:A.statusText,headers:b,config:n,request:A};f6(function(S){t(S),E()},function(S){r(S),E()},y),A=null}"onloadend"in A?A.onloadend=T:A.onreadystatechange=function(){!A||A.readyState!==4||A.status===0&&!(A.responseURL&&A.responseURL.indexOf("file:")===0)||setTimeout(T)},A.onabort=function(){A&&(r(new _t("Request aborted",_t.ECONNABORTED,n,A)),A=null)},A.onerror=function(g){const y=g&&g.message?g.message:"Network Error",x=new _t(y,_t.ERR_NETWORK,n,A);x.event=g||null,r(x),A=null},A.ontimeout=function(){let g=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const y=i.transitional||u6;i.timeoutErrorMessage&&(g=i.timeoutErrorMessage),r(new _t(g,y.clarifyTimeoutError?_t.ETIMEDOUT:_t.ECONNABORTED,n,A)),A=null},s===void 0&&o.setContentType(null),"setRequestHeader"in A&&Q.forEach(o.toJSON(),function(g,y){A.setRequestHeader(y,g)}),Q.isUndefined(i.withCredentials)||(A.withCredentials=!!i.withCredentials),a&&a!=="json"&&(A.responseType=i.responseType),c&&([f,w]=RS(c,!0),A.addEventListener("progress",f)),l&&A.upload&&([h,v]=RS(l),A.upload.addEventListener("progress",h),A.upload.addEventListener("loadend",v)),(i.cancelToken||i.signal)&&(u=b=>{A&&(r(!b||b.type?new Dg(null,n,A):b),A.abort(),A=null)},i.cancelToken&&i.cancelToken.subscribe(u),i.signal&&(i.signal.aborted?u():i.signal.addEventListener("abort",u)));const _=Uae(i.url);if(_&&vi.protocols.indexOf(_)===-1){r(new _t("Unsupported protocol "+_+":",_t.ERR_BAD_REQUEST,n));return}A.send(s||null)})},Kae=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let r=new AbortController,i;const s=function(c){if(!i){i=!0,a();const u=c instanceof Error?c:this.reason;r.abort(u instanceof _t?u:new Dg(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,s(new _t(`timeout ${e} of ms exceeded`,_t.ETIMEDOUT))},e);const a=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(c=>{c.unsubscribe?c.unsubscribe(s):c.removeEventListener("abort",s)}),n=null)};n.forEach(c=>c.addEventListener("abort",s));const{signal:l}=r;return l.unsubscribe=()=>Q.asap(a),l}},Yae=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let r=0,i;for(;r<t;)i=r+e,yield n.slice(r,i),r=i},Qae=async function*(n,e){for await(const t of Xae(n))yield*Yae(t,e)},Xae=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)break;yield r}}finally{await e.cancel()}},JL=(n,e,t,r)=>{const i=Qae(n,e);let s=0,o,a=l=>{o||(o=!0,r&&r(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await i.next();if(c){a(),l.close();return}let h=u.byteLength;if(t){let f=s+=h;t(f)}l.enqueue(new Uint8Array(u))}catch(c){throw a(c),c}},cancel(l){return a(l),i.return()}},{highWaterMark:2})},ZL=64*1024,{isFunction:ob}=Q,Jae=(({Request:n,Response:e})=>({Request:n,Response:e}))(Q.global),{ReadableStream:eO,TextEncoder:tO}=Q.global,nO=(n,...e)=>{try{return!!n(...e)}catch{return!1}},Zae=n=>{n=Q.merge.call({skipUndefined:!0},Jae,n);const{fetch:e,Request:t,Response:r}=n,i=e?ob(e):typeof fetch=="function",s=ob(t),o=ob(r);if(!i)return!1;const a=i&&ob(eO),l=i&&(typeof tO=="function"?(w=>E=>w.encode(E))(new tO):async w=>new Uint8Array(await new t(w).arrayBuffer())),c=s&&a&&nO(()=>{let w=!1;const E=new t(vi.origin,{body:new eO,method:"POST",get duplex(){return w=!0,"half"}}).headers.has("Content-Type");return w&&!E}),u=o&&a&&nO(()=>Q.isReadableStream(new r("").body)),h={stream:u&&(w=>w.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(w=>{!h[w]&&(h[w]=(E,A)=>{let T=E&&E[w];if(T)return T.call(E);throw new _t(`Response type '${w}' is not supported`,_t.ERR_NOT_SUPPORT,A)})});const f=async w=>{if(w==null)return 0;if(Q.isBlob(w))return w.size;if(Q.isSpecCompliantForm(w))return(await new t(vi.origin,{method:"POST",body:w}).arrayBuffer()).byteLength;if(Q.isArrayBufferView(w)||Q.isArrayBuffer(w))return w.byteLength;if(Q.isURLSearchParams(w)&&(w=w+""),Q.isString(w))return(await l(w)).byteLength},v=async(w,E)=>{const A=Q.toFiniteNumber(w.getContentLength());return A??f(E)};return async w=>{let{url:E,method:A,data:T,signal:_,cancelToken:b,timeout:g,onDownloadProgress:y,onUploadProgress:x,responseType:S,headers:I,withCredentials:P="same-origin",fetchOptions:N}=m6(w),M=e||fetch;S=S?(S+"").toLowerCase():"text";let V=Kae([_,b&&b.toAbortSignal()],g),L=null;const j=V&&V.unsubscribe&&(()=>{V.unsubscribe()});let oe;try{if(x&&c&&A!=="get"&&A!=="head"&&(oe=await v(I,T))!==0){let fe=new t(E,{method:"POST",body:T,duplex:"half"}),ae;if(Q.isFormData(T)&&(ae=fe.headers.get("content-type"))&&I.setContentType(ae),fe.body){const[_e,Qe]=YL(oe,RS(QL(x)));T=JL(fe.body,ZL,_e,Qe)}}Q.isString(P)||(P=P?"include":"omit");const $=s&&"credentials"in t.prototype,B={...N,signal:V,method:A.toUpperCase(),headers:I.normalize().toJSON(),body:T,duplex:"half",credentials:$?P:void 0};L=s&&new t(E,B);let G=await(s?M(L,N):M(E,B));const Z=u&&(S==="stream"||S==="response");if(u&&(y||Z&&j)){const fe={};["status","statusText","headers"].forEach(Ye=>{fe[Ye]=G[Ye]});const ae=Q.toFiniteNumber(G.headers.get("content-length")),[_e,Qe]=y&&YL(ae,RS(QL(y),!0))||[];G=new r(JL(G.body,ZL,_e,()=>{Qe&&Qe(),j&&j()}),fe)}S=S||"text";let ee=await h[Q.findKey(h,S)||"text"](G,w);return!Z&&j&&j(),await new Promise((fe,ae)=>{f6(fe,ae,{data:ee,headers:as.from(G.headers),status:G.status,statusText:G.statusText,config:w,request:L})})}catch($){throw j&&j(),$&&$.name==="TypeError"&&/Load failed|fetch/i.test($.message)?Object.assign(new _t("Network Error",_t.ERR_NETWORK,w,L),{cause:$.cause||$}):_t.from($,$&&$.code,w,L)}}},ele=new Map,g6=n=>{let e=n?n.env:{};const{fetch:t,Request:r,Response:i}=e,s=[r,i,t];let o=s.length,a=o,l,c,u=ele;for(;a--;)l=s[a],c=u.get(l),c===void 0&&u.set(l,c=a?new Map:Zae(e)),u=c;return c};g6();const jC={http:yae,xhr:qae,fetch:{get:g6}};Q.forEach(jC,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const rO=n=>`- ${n}`,tle=n=>Q.isFunction(n)||n===null||n===!1,y6={getAdapter:(n,e)=>{n=Q.isArray(n)?n:[n];const{length:t}=n;let r,i;const s={};for(let o=0;o<t;o++){r=n[o];let a;if(i=r,!tle(r)&&(i=jC[(a=String(r)).toLowerCase()],i===void 0))throw new _t(`Unknown adapter '${a}'`);if(i&&(Q.isFunction(i)||(i=i.get(e))))break;s[a||"#"+o]=i}if(!i){const o=Object.entries(s).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let a=t?o.length>1?`since :
`+o.map(rO).join(`
`):" "+rO(o[0]):"as no adapter specified";throw new _t("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return i},adapters:jC};function NT(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Dg(null,n)}function iO(n){return NT(n),n.headers=as.from(n.headers),n.data=MT.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),y6.getAdapter(n.adapter||lE.adapter,n)(n).then(function(r){return NT(n),r.data=MT.call(n,n.transformResponse,r),r.headers=as.from(r.headers),r},function(r){return h6(r)||(NT(n),r&&r.response&&(r.response.data=MT.call(n,n.transformResponse,r.response),r.response.headers=as.from(r.response.headers))),Promise.reject(r)})}const v6="1.12.2",p1={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{p1[n]=function(r){return typeof r===n||"a"+(e<1?"n ":" ")+n}});const sO={};p1.transitional=function(e,t,r){function i(s,o){return"[Axios v"+v6+"] Transitional option '"+s+"'"+o+(r?". "+r:"")}return(s,o,a)=>{if(e===!1)throw new _t(i(o," has been removed"+(t?" in "+t:"")),_t.ERR_DEPRECATED);return t&&!sO[o]&&(sO[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};p1.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};function nle(n,e,t){if(typeof n!="object")throw new _t("options must be an object",_t.ERR_BAD_OPTION_VALUE);const r=Object.keys(n);let i=r.length;for(;i-- >0;){const s=r[i],o=e[s];if(o){const a=n[s],l=a===void 0||o(a,s,n);if(l!==!0)throw new _t("option "+s+" must be "+l,_t.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new _t("Unknown option "+s,_t.ERR_BAD_OPTION)}}const w_={assertOptions:nle,validators:p1},la=w_.validators;let Yh=class{constructor(e){this.defaults=e||{},this.interceptors={request:new qL,response:new qL}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{r.stack?s&&!String(r.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+s):r.stack=s}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=mf(this.defaults,t);const{transitional:r,paramsSerializer:i,headers:s}=t;r!==void 0&&w_.assertOptions(r,{silentJSONParsing:la.transitional(la.boolean),forcedJSONParsing:la.transitional(la.boolean),clarifyTimeoutError:la.transitional(la.boolean)},!1),i!=null&&(Q.isFunction(i)?t.paramsSerializer={serialize:i}:w_.assertOptions(i,{encode:la.function,serialize:la.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),w_.assertOptions(t,{baseUrl:la.spelling("baseURL"),withXsrfToken:la.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&Q.merge(s.common,s[t.method]);s&&Q.forEach(["delete","get","head","post","put","patch","common"],w=>{delete s[w]}),t.headers=as.concat(o,s);const a=[];let l=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(t)===!1||(l=l&&E.synchronous,a.unshift(E.fulfilled,E.rejected))});const c=[];this.interceptors.response.forEach(function(E){c.push(E.fulfilled,E.rejected)});let u,h=0,f;if(!l){const w=[iO.bind(this),void 0];for(w.unshift(...a),w.push(...c),f=w.length,u=Promise.resolve(t);h<f;)u=u.then(w[h++],w[h++]);return u}f=a.length;let v=t;for(;h<f;){const w=a[h++],E=a[h++];try{v=w(v)}catch(A){E.call(this,A);break}}try{u=iO.call(this,v)}catch(w){return Promise.reject(w)}for(h=0,f=c.length;h<f;)u=u.then(c[h++],c[h++]);return u}getUri(e){e=mf(this.defaults,e);const t=p6(e.baseURL,e.url,e.allowAbsoluteUrls);return c6(t,e.params,e.paramsSerializer)}};Q.forEach(["delete","get","head","options"],function(e){Yh.prototype[e]=function(t,r){return this.request(mf(r||{},{method:e,url:t,data:(r||{}).data}))}});Q.forEach(["post","put","patch"],function(e){function t(r){return function(s,o,a){return this.request(mf(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Yh.prototype[e]=t(),Yh.prototype[e+"Form"]=t(!0)});let rle=class w6{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new Promise(a=>{r.subscribe(a),s=a}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},e(function(s,o,a){r.reason||(r.reason=new Dg(s,o,a),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=r=>{e.abort(r)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new w6(function(i){e=i}),cancel:e}}};function ile(n){return function(t){return n.apply(null,t)}}function sle(n){return Q.isObject(n)&&n.isAxiosError===!0}const zC={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(zC).forEach(([n,e])=>{zC[e]=n});function E6(n){const e=new Yh(n),t=Xj(Yh.prototype.request,e);return Q.extend(t,Yh.prototype,e,{allOwnKeys:!0}),Q.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return E6(mf(n,i))},t}const pn=E6(lE);pn.Axios=Yh;pn.CanceledError=Dg;pn.CancelToken=rle;pn.isCancel=h6;pn.VERSION=v6;pn.toFormData=f1;pn.AxiosError=_t;pn.Cancel=pn.CanceledError;pn.all=function(e){return Promise.all(e)};pn.spread=ile;pn.isAxiosError=sle;pn.mergeConfig=mf;pn.AxiosHeaders=as;pn.formToJSON=n=>d6(Q.isHTMLForm(n)?new FormData(n):n);pn.getAdapter=y6.getAdapter;pn.HttpStatusCode=zC;pn.default=pn;const{Axios:Pce,AxiosError:Rce,CanceledError:kce,isCancel:Dce,CancelToken:Mce,VERSION:Nce,all:Lce,Cancel:Oce,isAxiosError:Fce,spread:Vce,toFormData:Uce,AxiosHeaders:Bce,HttpStatusCode:$ce,formToJSON:jce,getAdapter:zce,mergeConfig:Hce}=pn;function b6({duracion:n=10,onEnd:e=null,storageKey:t=null}){const r=m.useMemo(()=>{try{const w=window.location&&window.location.pathname||"";return w.includes("/desarrollo")?"cnt:desarrollo":w.includes("/cierre")?"cnt:cierre":"cnt:inicio"}catch{return"cnt:inicio"}},[]),i=t||r,s=m.useRef(0),[o,a]=m.useState(0),l=m.useRef(!1),c=w=>{const E=Math.max(0,Math.floor(w/1e3)),A=Math.floor(E/60),T=E%60;return`${String(A).padStart(2,"0")}:${String(T).padStart(2,"0")}`},u=m.useCallback(()=>{try{const w=localStorage.getItem(i),E=w?Number(w):0;return Number.isFinite(E)?E:0}catch{return 0}},[i]),h=m.useCallback(w=>{try{localStorage.setItem(i,String(w))}catch{}},[i]),f=m.useCallback(()=>{let w=u();const E=Date.now();(!w||w<=E)&&(w=E+n*60*1e3,h(w),l.current=!1),s.current=w,a(w-E)},[n,u,h]);m.useEffect(()=>{f();const w=setInterval(()=>{const A=Date.now(),_=(s.current||0)-A;if(_<=0){if(a(0),!l.current&&(l.current=!0,typeof e=="function"))try{e()}catch{}}else a(_)},250),E=()=>f();return document.addEventListener("visibilitychange",E),()=>{clearInterval(w),document.removeEventListener("visibilitychange",E)}},[f,e]);const v=()=>{const w=Date.now()+n*60*1e3;h(w),s.current=w,l.current=!1,a(w-Date.now())};return m.createElement("div",{style:{display:"inline-flex",alignItems:"center",gap:8,fontWeight:800,fontSize:18,fontFamily:"system-ui, Segoe UI, sans-serif"}},m.createElement("span",{"aria-live":"polite"},c(o)),m.createElement("button",{type:"button",onClick:v,title:"Reiniciar cronÃ³metro de esta etapa",style:{border:"1px solid #e5e7eb",background:"#fff",color:"#111",padding:"2px 8px",borderRadius:8,cursor:"pointer"}},"â†»"))}function ole(){const{plan:n,caps:e,loading:t}=Nse();return{plan:n,caps:e,has:s=>t?!1:!!(e!=null&&e.tools&&e.tools[s]),limit:s=>{var o;return t?0:(e==null?void 0:e[s])??((o=e==null?void 0:e.exports)==null?void 0:o[s])??0},loading:t}}function ale({modo:n}){const{has:e,limit:t,loading:r,plan:i}=ole(),s=["aprendizaje","colaboraciÃ³n","participaciÃ³n","respeto","logro"],o=m.createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"10px"}},s.map((l,c)=>m.createElement("span",{key:c,style:{background:"#6dd5ed",color:"#fff",padding:"5px 10px",borderRadius:"20px",fontSize:"1.2rem",fontWeight:"bold"}},l)));if(r)return m.createElement("div",{style:{textAlign:"center"}},"Cargandoâ€¦");if(n==="demo")return m.createElement("div",null,o,m.createElement("div",{style:{marginTop:10,textAlign:"center",opacity:.7,fontSize:12}},"(Vista de ejemplo Â· plan actual: ",i,")"));if(!e("wordCloud"))return m.createElement("div",{style:{border:"1px solid #e0e0e0",borderRadius:12,padding:20,maxWidth:560,margin:"20px auto",textAlign:"center",background:"#fff"}},m.createElement("h3",{style:{margin:"0 0 8px"}},"Nube de palabras"),m.createElement("p",{style:{margin:"0 0 14px",color:"#555"}},"Activa participaciÃ³n en vivo con QR y visualizaciÃ³n instantÃ¡nea. Disponible desde el plan ",m.createElement("b",null,"PRO"),"."),m.createElement(iJ,{to:"/pago?plan=PRO",className:"btn",style:{display:"inline-block",background:"#7e57c2",color:"#fff",padding:"10px 16px",borderRadius:8,textDecoration:"none",fontWeight:600}},"Subir a PRO"));const a=t("maxStudentsPerClass");return m.createElement("div",null,o,m.createElement("div",{style:{marginTop:10,textAlign:"center",opacity:.7,fontSize:12}},"LÃ­mite de participantes segÃºn tu plan: ",m.createElement("b",null,a)))}const lle={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PROXY_BASE:"/api"};var LT={};const cle=typeof import.meta<"u"&&lle&&"/api"||typeof process<"u"&&LT&&(LT.REACT_APP_PROXY_URL||LT.VITE_PROXY_BASE)||(typeof window<"u"?`${window.location.origin}/api`:"http://localhost:8080"),_6=(n="")=>n.toString().toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim(),ule={matematica:"matematica",matematicas:"matematica",lenguaje:"lenguaje","lenguaje y comunicacion":"lenguaje","lengua y literatura":"lenguaje",fisica:"fisica",quimica:"quimica",historia:"historia","historia y ciencias sociales":"historia",ingles:"ingles",biologia:"biologia",ciencias:"ciencias",tecnologia:"tecnologia"};function oO(n=""){const e=_6(n);return ule[e]||"matematica"}function aO(n="",e=""){const t=_6(n||e);return/basico|b[aÃ¡]sico|b[aÃ¡]sica|basica/i.test(t)?"basica":"media"}function S6(){return new Date}function dle(){const n=S6().getDay();return n>=1&&n<=5?n-1:0}function hle(n=[]){const e=S6(),t=e.getHours()*60+e.getMinutes();for(let r=0;r<n.length-1;r++){const i=n[r][0]*60+n[r][1],s=n[r+1][0]*60+n[r+1][1];if(t>=i&&t<s)return r}return 0}function fle(n={}){if(Array.isArray(n.marcas)&&Array.isArray(n.marcas[0]))return n.marcas;if(Array.isArray(n.marcas)&&n.marcas.length&&typeof n.marcas[0]=="object")return n.marcas.map(e=>[Number(e.h)||0,Number(e.m)||0]);if(Array.isArray(n.marcasStr))return n.marcasStr.map(e=>{const[t,r]=String(e).split(":").map(i=>Number(i)||0);return[t,r]});if(Array.isArray(n.bloquesGenerados)&&n.bloquesGenerados.length){const e=n.bloquesGenerados.map(r=>String(r).split(" - ")[0]),t=String(n.bloquesGenerados.at(-1)).split(" - ")[1];return[...e,t].map(r=>{const[i,s]=r.split(":").map(o=>Number(o)||0);return[i,s]})}return[]}const Dn={brandA:"#2193b0",brandB:"#6dd5ed",white:"#ffffff",textDark:"#1f2937",textMuted:"#475569",border:"#e5e7eb",btnText:"#2193b0"},ple={minHeight:"100vh",background:`linear-gradient(to right, ${Dn.brandA}, ${Dn.brandB})`,padding:"2rem",fontFamily:"Segoe UI, sans-serif",color:Dn.white,boxSizing:"border-box"},mle=(n="1rem")=>({display:"grid",gridTemplateColumns:"minmax(0,1fr) minmax(0,2fr) minmax(0,1fr)",gap:n,alignItems:"stretch"}),ol={background:Dn.white,color:Dn.textDark,borderRadius:12,padding:"1rem",boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)",border:`1px solid ${Dn.border}`,maxWidth:"100%",overflow:"hidden",contain:"content",minWidth:0},Iu={willChange:"transform",transform:"translateZ(0)",backfaceVisibility:"hidden",WebkitFontSmoothing:"antialiased",textRendering:"optimizeLegibility"},Cc={background:Dn.white,color:Dn.btnText,border:"none",borderRadius:10,padding:".6rem .9rem",fontWeight:700,cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,.15)"},lO={width:"100%",padding:"0.65rem 0.8rem",borderRadius:10,border:`1px solid ${Dn.border}`,fontSize:"0.95rem",outline:"none"},OT={color:Dn.textMuted,fontSize:12},gle=[{key:"pragma",name:"Carrera PRAGMA (en esta pÃ¡gina)",desc:"Juego nativo de la plataforma. Publica rondas y muestra ranking.",type:"internal"},{key:"blooket",name:"Blooket",desc:"Lanza sets y comparte PIN con tu clase. Requiere tu cuenta.",type:"external",url:"https://dashboard.blooket.com/discover",premium:!0},{key:"decktoys",name:"Deck.Toys",desc:"Rutas y tableros interactivos. Requiere tu cuenta.",type:"external",url:"https://deck.toys/teacher",premium:!0},{key:"classcraft",name:"Classcraft",desc:"GamificaciÃ³n del curso a largo plazo. Requiere tu cuenta.",type:"external",url:"https://game.classcraft.com",premium:!0}],yle="crono:cierre:v2";function vle(){try{const n=[];for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);t&&(t==="inicioClase_countdown_end"||t.startsWith("ic_countdown_end:")||t.startsWith("crono:"))&&n.push(t)}n.forEach(e=>localStorage.removeItem(e))}catch{}}const Vf=n=>/^\(sin/i.test(String(n||"")),wle=m.memo(function(){const[e,t]=D.useState(new Date().toLocaleTimeString());return D.useEffect(()=>{const r=setInterval(()=>t(new Date().toLocaleTimeString()),1e3);return()=>clearInterval(r)},[]),m.createElement("span",{className:"tnum clock-w"},e)}),Ele=m.memo(function({unidad:e,objetivo:t,curso:r,asignatura:i}){return m.createElement("div",{style:{...ol,textAlign:"center",...Iu}},m.createElement("div",{style:{fontWeight:800,fontSize:"1.2rem",marginBottom:6}},"Unidad"),m.createElement("div",{style:{marginBottom:6,...Iu}},m.createElement("strong",null,e||"(sin unidad)")),m.createElement("div",{style:{marginTop:4,color:Dn.textDark,...Iu}},m.createElement("strong",null,"Objetivo:")," ",t),m.createElement("div",{style:{marginTop:10,color:Dn.textMuted,...Iu}},m.createElement("strong",null,"Curso:")," ",r," Â |Â  ",m.createElement("strong",null,"Asignatura:")," ",i))},(n,e)=>n.unidad===e.unidad&&n.objetivo===e.objetivo&&n.curso===e.curso&&n.asignatura===e.asignatura),ble=m.memo(function({nombreProfesor:e,asignatura:t}){return m.createElement("div",{style:{...ol,display:"flex",flexDirection:"column",gap:".6rem",...Iu}},m.createElement("div",{style:{display:"flex",gap:".5rem"}},m.createElement("button",{style:Cc},"âœ‹"),m.createElement("button",{style:Cc},"ðŸ‘")),m.createElement("div",{style:{textAlign:"right"}},m.createElement("div",{style:{fontWeight:800,...Iu}},e),m.createElement("div",{style:{color:Dn.textMuted,...Iu}},t)))},(n,e)=>n.nombreProfesor===e.nombreProfesor&&n.asignatura===e.asignatura);function _le({duracion:n=10}){const e=ji(),t=D.useContext(Af)||{},{user:r=null,plan:i="FREE",caps:s=mi.FREE,loading:o=!1}=t,[a,l]=D.useState(""),[c,u]=D.useState("Profesor"),[h,f]=D.useState("(sin asignatura)"),[v,w]=D.useState("(sin curso)"),[E,A]=D.useState(""),[T,_]=D.useState(null),[b,g]=D.useState("(sin objetivo)");D.useEffect(()=>{},[]);const[y,x]=D.useState(null);D.useEffect(()=>{(async()=>{try{const ue=await c1(new Date);x(ue),ue!=null&&ue.unidad&&!E&&A(ue.unidad),ue!=null&&ue.asignatura&&h==="(sin asignatura)"&&f(ue.asignatura),ue!=null&&ue.objetivo&&b==="(sin objetivo)"&&g(ue.objetivo)}catch(ue){console.error("[Cierre] getClaseVigente:",ue)}})()},[]);const S=D.useRef(null);D.useEffect(()=>{h&&!Vf(h)&&(S.current=h)},[h]);const I=S.current||h,[P,N]=D.useState(!1);D.useEffect(()=>{const ue=ls(we,async ye=>{try{if(ye)localStorage.setItem("uid",ye.uid),N(!0);else{const De=await mo(we);localStorage.setItem("uid",De.user.uid),N(!0)}}catch(De){console.error("[Cierre] auth error:",De),localStorage.getItem("uid")&&N(!0)}});return()=>ue()},[]);const[M,V]=D.useState(""),L=D.useMemo(()=>{const ue=window.location.origin.replace(/\/$/,"");return M?`${ue}/participa?session=${encodeURIComponent(M)}`:`${ue}/participa`},[M]),[j,oe]=D.useState(null),[$,B]=D.useState([]),[G,Z]=D.useState(""),[ee,fe]=D.useState(["","","",""]),[ae,_e]=D.useState(0),[Qe,Ye]=D.useState(!1),[gt,ie]=D.useState(!1),[ot,et]=D.useState(0);D.useEffect(()=>{if(!P)return;(async()=>{var ye,De,Tt;try{const Se=localStorage.getItem("uid")||((ye=we.currentUser)==null?void 0:ye.uid);if(!Se)return;const Be=se(X,"usuarios",Se),kt=await Fe(Be);kt.exists()&&u(((De=kt.data())==null?void 0:De.nombre)||"Profesor");const Bt=se(X,"profesores",Se),W=await Fe(Bt);if(W.exists()){const z=W.data()||{},le=z.unidadInicial||"";if(A(te=>te||le),z.asignatura&&!Vf(z.asignatura)&&f(te=>Vf(te)?z.asignatura:te),w(te=>te==="(sin curso)"?z.curso||"(sin curso)":te),z.objetivo?g(z.objetivo):z.objetivoInicial&&g(z.objetivoInicial),le&&!T)try{const te=oO(z.asignatura||h||"MatemÃ¡tica"),Ee=aO(z.curso||v,(y==null?void 0:y.nivel)||""),Et=`${cle}/mineduc?asignatura=${encodeURIComponent(te)}&nivel=${encodeURIComponent(Ee)}&unidad=${encodeURIComponent(le)}`,We=await pn.get(Et),de=Array.isArray(We.data)?We.data[0]:null;if(de)_(de);else throw new Error("Proxy sin resultados, intento directo")}catch{try{const Ee=oO(z.asignatura||h||"MatemÃ¡tica"),Et=aO(z.curso||v,(y==null?void 0:y.nivel)||""),We=`https://curriculumnacional.mineduc.cl/api/v1/oa/buscar?asignatura=${encodeURIComponent(Ee)}&nivel=${encodeURIComponent(Et)}&unidad=${encodeURIComponent(le)}`,de=await pn.get(We);_(Array.isArray(de.data)?de.data[0]:null)}catch{}}}try{if(kt.exists()){const z=((Tt=kt.data())==null?void 0:Tt.horarioConfig)||{},le=fle(z);if(Array.isArray(le)&&le.length>1){const te=hle(le),Ee=dle(),Et=`${te}-${Ee}`,We=se(X,"clases_detalle",Se,"slots",Et),de=await Fe(We);if(de.exists()){const nt=de.data()||{};nt.unidad&&!E&&A(nt.unidad),nt.objetivo&&b==="(sin objetivo)"&&g(nt.objetivo),nt.asignatura&&h==="(sin asignatura)"&&f(nt.asignatura),nt.curso&&v==="(sin curso)"&&w(nt.curso)}}}}catch(z){console.warn("[Cierre] horarioConfig â†’ clases_detalle:",(z==null?void 0:z.code)||(z==null?void 0:z.message))}try{const z=se(X,"clases_detalle",Se,"slots","0-0"),le=await Fe(z);if(le.exists()){const te=le.data()||{};!E&&te.unidad&&A(te.unidad),b==="(sin objetivo)"&&te.objetivo&&g(te.objetivo),h==="(sin asignatura)"&&te.asignatura&&f(te.asignatura),v==="(sin curso)"&&te.curso&&w(te.curso)}}catch{}}catch(Se){console.error("Error cargando datos de Cierre:",Se)}})()},[P]),D.useEffect(()=>{P&&(async()=>{var ue;try{const ye=localStorage.getItem("uid")||((ue=we.currentUser)==null?void 0:ue.uid);if(!ye)return;const De=se(X,"usuarios",ye),Tt=await Fe(De);if(Tt.exists()){const Se=Tt.data()||{};(!E||/^\(sin/i.test(E))&&A(Se.unidadInicial||Se.unidad||""),h==="(sin asignatura)"&&Se.asignatura&&f(Se.asignatura),v==="(sin curso)"&&Se.curso&&w(Se.curso),b==="(sin objetivo)"&&Se.objetivo&&g(Se.objetivo)}}catch(ye){console.warn("[Cierre] usuarios fallback:",(ye==null?void 0:ye.code)||(ye==null?void 0:ye.message))}})()},[P]),D.useEffect(()=>{var Tt;if(!P)return;const ue=localStorage.getItem("uid")||((Tt=we.currentUser)==null?void 0:Tt.uid);if(!ue)return;const ye=Se=>{Se&&(Se.nombre&&u(Be=>Se.nombre&&Se.nombre!==Be?Se.nombre:Be),A(Be=>Se.unidad&&Se.unidad!==Be?Se.unidad:Be),f(Be=>Se.asignatura&&!Vf(Se.asignatura)&&Se.asignatura!==Be?Se.asignatura:Be),w(Be=>Se.curso&&!Vf(Se.curso)&&Se.curso!==Be?Se.curso:Be),g(Be=>Se.objetivo&&!Vf(Se.objetivo)&&Se.objetivo!==Be?Se.objetivo:Be))},De=[];try{const Se=se(X,"clases_detalle",ue,"meta","actual");De.push(fa(Se,Be=>Be.exists()&&ye(Be.data())))}catch{}try{const Se=se(X,"clases_detalle",ue,"actual","info");De.push(fa(Se,Be=>Be.exists()&&ye(Be.data())))}catch{}try{const Se=se(X,"clases_detalle",ue,"slots","0-0");De.push(fa(Se,Be=>Be.exists()&&ye(Be.data())))}catch{}try{const Se=se(X,"profesores",ue);De.push(fa(Se,Be=>{var kt,Bt,W,z,le,te,Ee;Be.exists()&&ye({nombre:(kt=Be.data())==null?void 0:kt.nombre,unidad:((Bt=Be.data())==null?void 0:Bt.unidad)||((W=Be.data())==null?void 0:W.unidadInicial),objetivo:((z=Be.data())==null?void 0:z.objetivo)||((le=Be.data())==null?void 0:le.objetivoInicial),asignatura:(te=Be.data())==null?void 0:te.asignatura,curso:(Ee=Be.data())==null?void 0:Ee.curso})}))}catch{}return()=>De.forEach(Se=>typeof Se=="function"&&Se())},[P]),D.useEffect(()=>{if(!P)return;(async()=>{var ye;try{const De=se(X,"carrera","actual","meta","session"),Tt=await Fe(De);if(Tt.exists()&&((ye=Tt.data())!=null&&ye.id))V(String(Tt.data().id));else{const Se=Math.random().toString(36).slice(2,8).toUpperCase();await xt(De,{id:Se,createdAt:ut()},{merge:!0}),V(Se)}}catch(De){console.error("No se pudo crear/leer la sesiÃ³n:",De)}})()},[P]),D.useEffect(()=>{if(!P)return;const ue=se(X,"carrera","actual","meta","pregunta"),ye=fa(ue,De=>{De.exists()?oe(De.data()):oe(null)});return()=>ye()},[P]),D.useEffect(()=>{if(!P)return;let ue;M?ue=Bo(tn(X,"carrera","actual","participantes"),fi("session","==",M),z_("progreso","desc")):ue=Bo(tn(X,"carrera","actual","participantes"),z_("progreso","desc"));const ye=fa(ue,De=>{const Tt=De.docs.map(Se=>({id:Se.id,...Se.data()}));B(Tt)});return()=>ye()},[M,P]),D.useEffect(()=>{if(!P||!(j!=null&&j.activa))return;let ue;M?ue=Bo(tn(X,"carrera","actual","respuestas"),fi("scored","!=",!0),fi("session","==",M)):ue=Bo(tn(X,"carrera","actual","respuestas"),fi("scored","!=",!0));const ye=fa(ue,async De=>{var Be;if(gt)return;ie(!0);const Tt=[],Se=(Be=j==null?void 0:j.startAt)!=null&&Be.toMillis?j.startAt.toMillis():null;De.docChanges().forEach(kt=>{var Bt;if(kt.type==="added"||kt.type==="modified"){const W=kt.doc.data();if(Se&&((Bt=W.createdAt)!=null&&Bt.toMillis)&&W.createdAt.toMillis()<Se||W.scored===!0)return;Tt.push({id:kt.doc.id,data:W})}});for(const kt of Tt)try{await Xe(kt.id,kt.data)}catch(Bt){console.error("Error scoring:",Bt)}ie(!1)});return()=>ye()},[j==null?void 0:j.activa,j==null?void 0:j.startAt,ot,M,P]);const ze=async()=>{if(!G.trim())return;const ue=ee.map(ye=>ye.trim()).filter(ye=>ye.length>0);if(ue.length>0&&(ae<0||ae>=ue.length)){alert("Selecciona el Ã­ndice de la respuesta correcta vÃ¡lido.");return}Ye(!0);try{await xt(se(X,"carrera","actual","meta","pregunta"),{texto:G.trim(),opciones:ue.length>0?ue:[],correcta:ue.length>0?ae:null,startAt:ut(),activa:!0,session:M||null},{merge:!0}),et(ye=>ye+1)}catch(ye){console.error(ye),alert("No se pudo publicar la pregunta.")}finally{Ye(!1)}},tt=async()=>{try{await gy(se(X,"carrera","actual","meta","pregunta"),{activa:!1})}catch{}};async function Xe(ue,ye){const{pid:De,answer:Tt,latencyMs:Se}=ye;if(!De){await gy(se(X,"carrera","actual","respuestas",ue),{scored:!0,points:0});return}let Be=0;if(Array.isArray(j==null?void 0:j.opciones)&&j.opciones.length>0&&typeof(j==null?void 0:j.correcta)=="number"){const kt=j.opciones[j.correcta];if(String(Tt).trim()===String(kt).trim()){const W=typeof Se=="number"?Se/1e3:8;Be=5+Math.max(0,8-Math.floor(W))}else Be=0}else{const kt=typeof Se=="number"?Se/1e3:8;Be=2+Math.max(0,5-Math.floor(kt))}try{await gy(se(X,"carrera","actual","participantes",De),{puntos:ZD(Be),progreso:ZD(Be)})}catch{await xt(se(X,"carrera","actual","participantes",De),{nombre:ye.nombre||"Jugador",avatar:"ðŸ",progreso:Be,puntos:Be,joinedAt:ut(),session:M||null},{merge:!0})}await gy(se(X,"carrera","actual","respuestas",ue),{scored:!0,points:Be})}const Je=D.useMemo(()=>[...$].sort((ue,ye)=>(ye.progreso||0)-(ue.progreso||0)),[$]),dt=async()=>{if(window.confirm("Â¿Resetear carrera? Se borrarÃ¡n participantes y respuestas, y se reiniciarÃ¡ la pregunta."))try{let ye=tn(X,"carrera","actual","participantes"),De=M?await $n(Bo(ye,fi("session","==",M))):await $n(ye);const Tt=eM(X);De.forEach(Bt=>Tt.delete(Bt.ref)),await Tt.commit();let Se=tn(X,"carrera","actual","respuestas"),Be=M?await $n(Bo(Se,fi("session","==",M))):await $n(Se);const kt=eM(X);Be.forEach(Bt=>kt.delete(Bt.ref)),await kt.commit(),await xt(se(X,"carrera","actual","meta","pregunta"),{texto:"",opciones:[],correcta:null,activa:!1,startAt:ut(),session:M||null},{merge:!0}),Z(""),fe(["","","",""]),_e(0),et(Bt=>Bt+1),alert("Carrera reseteada âœ…")}catch{alert("No se pudo resetear la carrera.")}},Ct=ue=>{try{const ye=new URL(ue);ye.searchParams.set("utm_source","pragma"),ye.searchParams.set("utm_medium","launcher"),ye.searchParams.set("utm_campaign","cierre");const De=localStorage.getItem("salaCode")||"";De&&ye.searchParams.set("code",De),window.open(ye.toString(),"_blank","noopener,noreferrer")}catch{window.open(ue,"_blank","noopener,noreferrer")}},Ut=()=>{try{const ue=document.getElementById("carreraPanel");ue!=null&&ue.scrollIntoView&&ue.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},Ir={duracion:n,storageKey:yle,instanceId:"cierre"};return m.createElement("div",{style:ple,className:"no-scroll-jump"},y&&m.createElement("div",{style:{...ol,marginBottom:"1rem",background:y.fuente==="calendario"?"rgba(124,58,237,.06)":"rgba(2,132,199,.06)"}},m.createElement("div",{style:{fontWeight:800}},y.fuente==="calendario"?"Plan semanal (vigente)":y.fuente==="slots"?"Horario (fallback)":"Sin clase planificada"),y.unidad&&m.createElement("div",null,m.createElement("b",null,"Unidad:")," ",y.unidad,y.evaluacion?" Â· (EvaluaciÃ³n)":""),(y==null?void 0:y.objetivo)&&m.createElement("div",null,m.createElement("b",null,"Objetivo:")," ",y.objetivo)),m.createElement("div",{style:{...mle("1rem"),marginBottom:"1rem"}},m.createElement("div",{style:{...ol,...Iu},className:"no-scroll-jump layer-accel"},m.createElement("div",{style:{fontWeight:800,fontSize:"1.1rem",marginBottom:6}},"Cierre"),m.createElement("div",{style:{color:Dn.textMuted,marginBottom:8}},"ðŸ•’ ",m.createElement(wle,null)),m.createElement("div",{className:"tnum clock-w layer-accel",style:{fontVariantNumeric:"tabular-nums lining-nums",fontFeatureSettings:"'tnum' 1, 'lnum' 1",transform:"translateZ(0)",willChange:"transform",backfaceVisibility:"hidden"}},m.createElement(b6,{...Ir}))),m.createElement(Ele,{unidad:E,objetivo:b,curso:v,asignatura:I}),m.createElement(ble,{nombreProfesor:c,asignatura:I})),m.createElement("div",{style:{...ol,textAlign:"center",marginBottom:"1rem"}},m.createElement("h3",{style:{marginTop:0}},"â˜ï¸ Nube de palabras final"),m.createElement(ale,{modo:"cierre"})),m.createElement("div",{style:{...ol,textAlign:"center",marginBottom:"1rem"}},m.createElement("h3",{style:{marginTop:0}},"ðŸ“² Ãšnete a la carrera"),m.createElement("div",{style:{display:"flex",gap:16,justifyContent:"center",alignItems:"center",flexWrap:"wrap"}},m.createElement("div",{style:{background:"#fff",padding:12,borderRadius:8,border:`1px solid ${Dn.border}`}},m.createElement(lj,{value:L,size:160})),m.createElement("div",null,m.createElement("div",{style:{fontWeight:800,fontSize:18}},"SesiÃ³n: ",M||"â€”"),m.createElement("div",{style:{color:Dn.textMuted,fontSize:14,marginTop:6}},"Abre ",m.createElement("code",null,"/participa")," o escanea el QR. Link directo:"),m.createElement("code",{style:{fontSize:12,color:Dn.textMuted}},L)))),m.createElement("div",{style:{...ol,marginBottom:"1rem"}},m.createElement("h3",{style:{marginTop:0,marginBottom:8}},"ðŸŽ® Centro de Juegos"),m.createElement("div",{style:{color:Dn.textMuted,fontSize:13,marginBottom:8}},"Los juegos externos se abren en pestaÃ±a nueva y requieren tu propia cuenta."),m.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))",gap:10}},gle.map(ue=>m.createElement("div",{key:ue.key,style:{border:`1px solid ${Dn.border}`,borderRadius:10,padding:12}},m.createElement("div",{style:{fontWeight:800}},ue.name," ",ue.premium?m.createElement("span",{style:{fontSize:12,color:"#9333ea"}},"Â· Premium"):null),m.createElement("div",{style:{color:Dn.textMuted,fontSize:14,marginTop:4}},ue.desc),m.createElement("div",{style:{display:"flex",gap:8,marginTop:10,flexWrap:"wrap"}},ue.type==="internal"?m.createElement("button",{style:Cc,onClick:Ut},"ðŸ Ir a Carrera"):m.createElement(m.Fragment,null,m.createElement("button",{style:Cc,onClick:()=>Ct(ue.url)},"ðŸŒ Abrir"))))))),m.createElement("div",{id:"carreraPanel",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"}},m.createElement("div",{style:ol},m.createElement("h3",{style:{marginTop:0}},"ðŸŽ® Mini panel del profesor"),m.createElement("div",{style:{...OT,marginBottom:8}},"Publica una pregunta (texto + 0â€“4 opciones). Si agregas opciones, selecciona cuÃ¡l es la correcta."),m.createElement("label",{style:{fontWeight:700}},"Pregunta"),m.createElement("input",{style:{...lO,marginBottom:8},value:G,onChange:ue=>Z(ue.target.value),placeholder:"Escribe la preguntaâ€¦"}),m.createElement("label",{style:{fontWeight:700}},"Opciones (opcional)"),ee.map((ue,ye)=>m.createElement("div",{key:ye,style:{display:"grid",gridTemplateColumns:"auto 1fr",gap:8,alignItems:"center",marginBottom:6}},m.createElement("input",{type:"radio",name:"correcta",checked:ae===ye,onChange:()=>_e(ye),title:"Marcar correcta"}),m.createElement("input",{style:lO,value:ue,onChange:De=>{const Tt=[...ee];Tt[ye]=De.target.value,fe(Tt)},placeholder:`OpciÃ³n ${ye+1}`}))),m.createElement("div",{style:{display:"flex",gap:8,marginTop:8}},m.createElement("button",{style:Cc,onClick:ze,disabled:Qe,title:"Publicar pregunta"},"ðŸš€ Publicar ronda"),m.createElement("button",{style:Cc,onClick:tt,title:"Cerrar ronda"},"â›” Cerrar ronda")),m.createElement("div",{style:{...OT,marginTop:8}},j!=null&&j.activa?"Ronda ACTIVA":"Ronda INACTIVA"," ",j!=null&&j.texto?`â€¢ "${j.texto}"`:"")),m.createElement("div",{style:ol},m.createElement("h3",{style:{marginTop:0}},"ðŸ Carrera en vivo"),m.createElement("div",{style:{...OT,marginBottom:8}},"Avance = acierto (5 pts) + bonus por rapidez (hasta +8). ParticipaciÃ³n abierta: pequeÃ±o avance."),m.createElement("div",{style:{display:"grid",gap:10}},Je.length===0&&m.createElement("div",{style:{color:Dn.textMuted}},"AÃºn no hay participantes. Pide a tus estudiantes abrir ",m.createElement("code",null,"/participa"),"."),Je.map(ue=>{const ye=Math.min(100,Math.round(ue.progreso||0));return m.createElement("div",{key:ue.id,style:{display:"grid",gridTemplateColumns:"40px 1fr 60px",gap:8,alignItems:"center"}},m.createElement("div",{style:{textAlign:"center",fontSize:20}},ue.avatar||"ðŸ"),m.createElement("div",{style:{background:"#eef2f7",borderRadius:999,overflow:"hidden",border:`1px solid ${Dn.border}`}},m.createElement("div",{style:{width:`${ye}%`,background:`linear-gradient(90deg, ${Dn.brandA}, ${Dn.brandB})`,color:"#fff",padding:"6px 10px",whiteSpace:"nowrap",textOverflow:"ellipsis"},title:`${ue.nombre} (${ye} pts)`},m.createElement("strong",{style:{fontSize:12}},ue.nombre||"Jugador"))),m.createElement("div",{style:{textAlign:"right",fontWeight:800}},ue.progreso||0))})))),m.createElement("div",{style:{textAlign:"center",display:"flex",gap:8,justifyContent:"center"}},m.createElement("button",{onClick:dt,style:Cc,title:"Borrar participantes, respuestas y reiniciar pregunta"},"ðŸ§¹ Reset carrera"),m.createElement("button",{onClick:()=>{vle(),e("/inicio",{replace:!0,state:{resetTimers:!0,from:"cierre"}})},style:Cc},"â¬…ï¸ Volver al Inicio")))}const Sle="/assets/pdf.worker.min-r-TJsTTt.mjs",Ale={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PROXY_BASE:"/api"};var FT={};Di.workerSrc=Sle;const VT=typeof import.meta<"u"&&Ale&&"/api"||typeof process<"u"&&FT&&(FT.REACT_APP_PROXY_URL||FT.VITE_PROXY_BASE)||(typeof window<"u"?`${window.location.origin}/api`:"http://localhost:8080");function A6(){const e=new URLSearchParams(window.location.search).get("at");if(e){const[t,r]=e.split(":").map(Number),i=new Date,s=Number.isFinite(t)?t:0,o=Number.isFinite(r)?r:0;return i.setHours(s),i.setMinutes(o),i.setSeconds(0),i.setMilliseconds(0),i}return new Date}function cO(){const n=new URLSearchParams(window.location.search),e=Number(n.get("dow")),t=e>=1&&e<=5?e:A6().getDay();return t>=1&&t<=5?t-1:0}function uO(n=[]){const e=A6(),t=e.getHours()*60+e.getMinutes();for(let r=0;r<n.length-1;r++){const[i,s]=n[r],[o,a]=n[r+1],l=i*60+s,c=o*60+a;if(t>=l&&t<c)return r}return 0}function dO(n={}){if(Array.isArray(n.marcas)&&Array.isArray(n.marcas[0]))return n.marcas;if(Array.isArray(n.marcas)&&n.marcas.length&&typeof n.marcas[0]=="object")return n.marcas.map(e=>[Number(e.h)||0,Number(e.m)||0]);if(Array.isArray(n.marcasStr))return n.marcasStr.map(e=>{const[t,r]=String(e).split(":").map(i=>Number(i)||0);return[t,r]});if(Array.isArray(n.bloquesGenerados)&&n.bloquesGenerados.length){const e=n.bloquesGenerados.map(r=>String(r).split(" - ")[0]),t=String(n.bloquesGenerados.at(-1)).split(" - ")[1];return[...e,t].map(r=>{const[i,s]=r.split(":").map(o=>Number(o)||0);return[i,s]})}return[]}const un={brandA:"#2193b0",brandB:"#6dd5ed",white:"#ffffff",textDark:"#1f2937",textMuted:"#475569",border:"#e5e7eb",btnText:"#2193b0"},Tle={minHeight:"100vh",background:`linear-gradient(to right, ${un.brandA}, ${un.brandB})`,padding:"2rem",fontFamily:"Segoe UI, sans-serif",color:un.white,boxSizing:"border-box"},Ile=(n="1rem")=>({display:"grid",gridTemplateColumns:"1fr 2fr 1fr",gap:n,alignItems:"stretch"}),el={background:un.white,color:un.textDark,borderRadius:12,padding:"1rem",boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)",border:`1px solid ${un.border}`,maxWidth:"100%",overflow:"hidden"},cv={background:un.white,color:un.btnText,border:"none",borderRadius:10,padding:".6rem .9rem",fontWeight:700,cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,.15)"},xle={marginTop:12,paddingTop:10,borderTop:`1px dashed ${un.border}`},Uf={display:"flex",flexWrap:"wrap",gap:8,justifyContent:"center",alignItems:"center"},Tc={padding:"8px 10px",border:`1px solid ${un.border}`,borderRadius:8,minWidth:220,outline:"none"},hO={...Tc,minWidth:160},ur={...cv,padding:".45rem .7rem",fontWeight:800},Cle={display:"flex",flexWrap:"wrap",gap:10,justifyContent:"center",alignItems:"center",marginTop:10},Ai={...cv,padding:6,borderRadius:12,display:"inline-flex",alignItems:"center",justifyContent:"center",width:56,height:56},tl={width:28,height:28},ca=n=>`https://www.google.com/s2/favicons?sz=64&domain=${encodeURIComponent(n)}`;function Bf({size:n=24}){return m.createElement("svg",{width:n,height:n,viewBox:"0 0 24 24","aria-hidden":"true"},m.createElement("path",{fill:"currentColor",d:"M3 5c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5v2h3a1 1 0 1 1 0 2H7a1 1 0 1 1 0-2h3v-2H5a2 2 0 0 1-2-2V5zm2 0v10h14V5H5zm7.7 2.3 3.6 3.6a1 1 0 0 1-1.4 1.4l-1.9-1.9V14a1 1 0 1 1-2 0V10.4l-1.9 1.9a1 1 0 0 1-1.4-1.4l3.6-3.6a1 1 0 0 1 1.4 0z"}))}const Ple="https://huggingface.co/spaces/hysts/Shap-E",Rle="https://huggingface.co/spaces/Intel/TripoSR",kle="https://aframe.io/examples/showcase/helloworld/",fO="inicioClase_countdown_end";function pO(n="0-0"){var r;const e=((r=we.currentUser)==null?void 0:r.uid)||localStorage.getItem("uid")||"anon",t=Rg();return`ic_countdown_end:${e}:${t}:${n}`}const yp=(n="")=>n.toString().toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim(),Dle={matematica:"matematica",matematicas:"matematica",lenguaje:"lenguaje","lenguaje y comunicacion":"lenguaje","lengua y literatura":"lenguaje",fisica:"fisica",quimica:"quimica",historia:"historia","historia y ciencias sociales":"historia",ingles:"ingles",biologia:"biologia",ciencias:"ciencias",tecnologia:"tecnologia"};function Mle(n=""){const e=yp(n);return Dle[e]||"matematica"}function Nle(n="",e=""){const t=yp(n||e);return/basico|basica|basico/i.test(t)?"basica":"media"}function yd(n="",e=""){return[(n||"").replace(/Âº/g,"Â°"),e].filter(Boolean).join(" ").trim()}function UT(){try{const e=new URLSearchParams(window.location.search).get("slot");if(!e)return null;const[t,r]=e.split("-").map(i=>Number(i));if(Number.isInteger(t)&&Number.isInteger(r))return`${t}-${r}`}catch{}return null}const mO={Generales:[{id:"youtube",name:"YouTube",url:"https://youtube.com",icon:"â–¶",embed:!0},{id:"google",name:"Google",url:"https://google.com",icon:"G",embed:!0},{id:"wikipedia",name:"Wikipedia",url:"https://wikipedia.org",icon:"W",embed:!0},{id:"drive",name:"Drive",url:"https://drive.google.com",icon:"ðŸ“",embed:!1},{id:"flipbook",name:"Flipbook",url:"https://heyzine.com",icon:"ðŸ“–",embed:!0},{id:"timer",name:"Timer",url:"https://timer.onlineclock.net",icon:"â±ï¸",embed:!0},{id:"qr",name:"QR Generator",url:"https://qrcode-monkey.com",icon:"ðŸ”³",embed:!0}],MatemÃ¡tica:[{id:"geogebra-graph",name:"GeoGebra Â· Graficadora",url:"https://www.geogebra.org/graphing",icon:"ðŸ“ˆ",embed:!0},{id:"geogebra-geom",name:"GeoGebra Â· GeometrÃ­a",url:"https://www.geogebra.org/geometry",icon:"ðŸ“",embed:!0},{id:"desmos",name:"Desmos",url:"https://www.desmos.com/calculator",icon:"ðŸ§®",embed:!0},{id:"phet-math",name:"PhET MatemÃ¡ticas",url:"https://phet.colorado.edu/es/simulations/filter?subjects=math",icon:"ðŸ§ª",embed:!1}],Lenguaje:[{id:"wordreference",name:"WordReference",url:"https://www.wordreference.com",icon:"ðŸ“š",embed:!0},{id:"linguee",name:"Linguee",url:"https://www.linguee.es",icon:"ðŸ…»",embed:!0},{id:"docs",name:"Google Docs",url:"https://docs.google.com",icon:"ðŸ“„",embed:!1},{id:"padlet",name:"Padlet",url:"https://padlet.com",icon:"ðŸ§±",embed:!1}],Ciencias:[{id:"phet-physics",name:"PhET FÃ­sica",url:"https://phet.colorado.edu/es/simulations/filter?subjects=physics",icon:"âš›ï¸",embed:!1},{id:"phet-chem",name:"PhET QuÃ­mica",url:"https://phet.colorado.edu/es/simulations/filter?subjects=chemistry",icon:"ðŸ§«",embed:!1},{id:"phet-bio",name:"PhET BiologÃ­a",url:"https://phet.colorado.edu/es/simulations/filter?subjects=biology",icon:"ðŸ§¬",embed:!1}],Historia:[{id:"google-arts",name:"Google Arts & Culture",url:"https://artsandculture.google.com",icon:"ðŸ›ï¸",embed:!0},{id:"timeline",name:"KnightLab Timeline",url:"https://timeline.knightlab.com",icon:"ðŸ—“ï¸",embed:!1}],InglÃ©s:[{id:"cambridge",name:"Cambridge Dictionary",url:"https://dictionary.cambridge.org",icon:"ðŸ‡¬ðŸ‡§",embed:!0},{id:"reverso",name:"Reverso Context",url:"https://context.reverso.net",icon:"ðŸ”„",embed:!0}],Artes:[{id:"sketchpad",name:"Sketchpad",url:"https://sketch.io/sketchpad",icon:"ðŸŽ¨",embed:!0},{id:"autodraw",name:"AutoDraw",url:"https://www.autodraw.com",icon:"âœï¸",embed:!0}],TecnologÃ­a:[{id:"scratch",name:"Scratch",url:"https://scratch.mit.edu",icon:"ðŸ±",embed:!1},{id:"w3schools",name:"W3Schools",url:"https://www.w3schools.com/tryit",icon:"ðŸ’»",embed:!0}]},Lle={marginTop:10,paddingTop:10,borderTop:`1px dashed ${un.border}`},Ole={display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:10,marginTop:8},Fle={background:"#ffffff",border:`1px solid ${un.border}`,borderRadius:12,padding:"10px",textAlign:"left",cursor:"pointer",display:"flex",gap:10,alignItems:"center",boxShadow:"0 3px 8px rgba(16,24,40,.06)"},Vle={width:28,height:28,flex:"0 0 28px",borderRadius:6},Ule={fontWeight:800,fontSize:14,lineHeight:1.15,color:un.textDark},Ble={fontSize:11,color:un.textMuted};function $le({duracion:n=30,onIrACierre:e}){var hE,fE;const t=ji(),r=Hs(),i=D.useContext(Af)||{},{user:s=null,plan:o="FREE",caps:a=mi.FREE,loading:l=!1}=i,[c,u]=D.useState(""),[h,f]=D.useState("Profesor"),[v,w]=D.useState("(sin asignatura)"),[E,A]=D.useState("(sin curso)"),[T,_]=D.useState(""),[b,g]=D.useState(null),[y,x]=D.useState(null),[S,I]=D.useState(!1),[P,N]=D.useState(""),[M,V]=D.useState(""),[L,j]=D.useState(""),[oe,$]=D.useState("calculator"),[B,G]=D.useState(""),[Z,ee]=D.useState("https://www.youtube-nocookie.com/embed/Ibrj8pRX8Zg"),[fe,ae]=D.useState(""),[_e,Qe]=D.useState("iframe"),[Ye,gt]=D.useState(null),ie=D.useRef(null),ot=D.useRef(null),et=D.useRef(null),[ze,tt]=D.useState(!1),[Xe,Je]=D.useState(null);D.useEffect(()=>{(async()=>{try{const H=await c1(new Date);Je(H),H&&(H.unidad&&!T&&_(H.unidad),H.objetivo&&!P&&N(H.objetivo),H.habilidades&&!M&&V(H.habilidades),H.asignatura&&v==="(sin asignatura)"&&w(H.asignatura),(H.nivel||H.seccion)&&E==="(sin curso)"&&A(yd(H.nivel,H.seccion)))}catch(H){console.error("[Desarrollo] getClaseVigente:",H)}})()},[]);const dt=H=>/^https?:\/\//i.test(H)?H:`https://${H}`,Ct=H=>window.open(H,"_blank","noopener,noreferrer"),Ut=H=>{try{const me=dt(H),ke=new URL(me);return`https://r.jina.ai/${ke.protocol.replace(":","")}://${ke.host}${ke.pathname}${ke.search}`}catch{return H}},Ir=H=>{try{if(/youtu\.?be/.test(H)){const me=new URL(H);if(me.hostname.includes("youtu.be"))return me.pathname.replace("/","");const ke=me.searchParams.get("v");if(ke)return ke}}catch{}return/^[\w-]{10,12}$/.test(H)?H.trim():null},ue=H=>{const me=Ir(H);return me?`https://www.youtube-nocookie.com/embed/${me}`:`https://www.youtube-nocookie.com/embed?listType=search&list=${encodeURIComponent(H||"matemÃ¡tica 1 medio")}`},ye=(H,me)=>{if(me==="youtube"){const Pe=(H||"").trim()||(T?`matemÃ¡tica ${T}`:"matemÃ¡tica 1 medio");return ue(Pe)}if(me==="geogebra"){let Pe="/calculator";return oe==="geometry"&&(Pe="/geometry"),oe==="3d"&&(Pe="/3d"),`https://www.geogebra.org${Pe}?embed`}if(me==="desmos")return"https://www.desmos.com/calculator?embed&lang=es";let ke=dt((H||"").trim());try{const Pe=new URL(ke);if(Pe.hostname.includes("youtube")||Pe.hostname.includes("youtu.be"))return ue(ke);if(Pe.hostname.endsWith("docs.google.com")){if(Pe.pathname.includes("/document/"))return ke.replace(/\/edit.*$/i,"/preview");if(Pe.pathname.includes("/spreadsheets/"))return ke.replace(/\/edit.*$/i,"/preview");if(Pe.pathname.includes("/presentation/"))return ke.replace(/\/edit.*$/i,"/embed")}if(Pe.hostname.endsWith("onedrive.live.com")||Pe.hostname.endsWith("sharepoint.com"))return`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(ke)}`;if(Pe.hostname.includes("wikipedia.org"))return Ut(ke)}catch{return ue(H)}return ke},De=H=>{ae(""),ee(H),Qe("iframe"),/(^https?:\/\/)?(docs\.google\.com|drive\.google\.com|office\.com|onedrive\.live\.com|sharepoint\.com)/i.test(H)&&ae("Este sitio puede requerir inicio de sesiÃ³n o bloquear funciones dentro del panel. Si no ves contenido, pega un enlace pÃºblico/â€œembedâ€.")},Tt=()=>{var H;return(H=ie.current)==null?void 0:H.click()},Se=H=>{var Pe;const me=(Pe=H.target.files)==null?void 0:Pe[0];if(!me)return;const ke=URL.createObjectURL(me);if(me.type==="application/pdf"){if(Ye)try{URL.revokeObjectURL(Ye)}catch{}gt(ke),Qe("iframe"),De(ke)}else if(me.type.startsWith("image/")){if(Ye)try{URL.revokeObjectURL(Ye)}catch{}gt(ke),Qe("image"),ae("")}else URL.revokeObjectURL(ke),alert("Para Word/Excel/PowerPoint, usa Â«Compartir pantallaÂ». (El panel renderiza nativamente PDF e imÃ¡genes).");try{H.target.value=""}catch{}},Be=async()=>{try{const H=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1});ot.current&&(ot.current.srcObject=H),et.current=H,Qe("screen"),tt(!0);const[me]=H.getVideoTracks();me.addEventListener("ended",()=>kt())}catch(H){console.warn("DisplayMedia cancelado/no disponible:",H)}},kt=()=>{try{const H=et.current;H&&H.getTracks().forEach(me=>me.stop())}catch{}et.current=null,tt(!1),Qe("iframe")},Bt=()=>{window.confirm(`Â¿Compartir pantalla ahora?
Aceptar: Compartir pantalla
Cancelar: Presentar archivo (PDF o imagen) en el panel`)?Be():Tt()};D.useEffect(()=>()=>{if(Ye)try{URL.revokeObjectURL(Ye)}catch{}if(et.current)try{et.current.getTracks().forEach(H=>H.stop())}catch{}},[]);const W=()=>De(ye(L,"youtube")),z=()=>De(ye("","geogebra")),le=()=>De(ye("","desmos")),te=()=>{De("https://phet.colorado.edu/es/simulations/filter?subjects=math&type=html,prototype"),ae("Para ver una simulaciÃ³n dentro del panel, entra a la simulaciÃ³n â†’ 'Compartir/Insertar' y pega ese enlace en 'Abrir en panel'.")},Ee=()=>De(Ut("https://drive.google.com")),Et=()=>{const H=B.trim();H&&De(ye(H,"custom"))},We=()=>{De(Ut(y||"https://es.wikipedia.org"))};D.useEffect(()=>{u(new Date().toLocaleTimeString());const H=setInterval(()=>u(new Date().toLocaleTimeString()),1e3);return()=>clearInterval(H)},[]),D.useEffect(()=>{const H=ls(we,async me=>{try{if(me)localStorage.setItem("uid",me.uid),I(!0);else{const ke=await mo(we);localStorage.setItem("uid",ke.user.uid),I(!0)}}catch(ke){console.error("[Desarrollo] auth error:",ke),I(!1)}});return()=>H()},[]),D.useEffect(()=>{const H=(r==null?void 0:r.state)||null;if(H)try{if(H.clase&&(_(me=>me||H.clase.unidad||""),N(me=>me||H.clase.objetivo||""),V(me=>me||H.clase.habilidades||""),H.clase.asignatura&&w(H.clase.asignatura),H.clase.curso&&A(H.clase.curso),!H.clase.curso&&(H.clase.nivel||H.clase.seccion)&&A(yd(H.clase.nivel,H.clase.seccion))),H.slotId)try{localStorage.setItem("__lastSlotId",H.slotId)}catch{}if(Number.isFinite(+H.endMs)&&+H.endMs>0){const me=pO(H.slotId||"0-0");try{localStorage.setItem(me,String(H.endMs)),localStorage.setItem(fO,String(H.endMs))}catch{}}}catch{}},[r]),D.useLayoutEffect(()=>{var H;try{const me=localStorage.getItem("uid")||"anon",ke=((H=r==null?void 0:r.state)==null?void 0:H.slotId)||UT()||localStorage.getItem("__lastSlotId")||"0-0",Pe=pO(ke),ln=fO,lr=Date.now();let cs=localStorage.getItem(Pe)||localStorage.getItem(ln);if(!cs||+cs<=lr){const ta=lr+n*60*1e3;localStorage.setItem(Pe,String(ta)),localStorage.setItem(ln,String(ta))}}catch{}},[]),D.useEffect(()=>{if(!S)return;(async()=>{var me,ke,Pe,ln,lr,cs,ta,Wt,Eo,us,Xn,Ys,pc,_i;try{const xr=localStorage.getItem("uid")||((me=we.currentUser)==null?void 0:me.uid);if(!xr)return;try{const ht=se(X,"usuarios",xr),ti=await Fe(ht);ti.exists()&&f(((ke=ti.data())==null?void 0:ke.nombre)||"Profesor")}catch(ht){(ht==null?void 0:ht.code)!=="permission-denied"&&console.warn("[Desarrollo] usuarios read:",(ht==null?void 0:ht.code)||ht)}let mc="";try{const ht=se(X,"profesores",xr),ti=await Fe(ht);if(ti.exists()){const Qt=ti.data()||{};mc=(Qt.unidadInicial||"").trim(),_(pt=>pt||mc),w(pt=>pt==="(sin asignatura)"?Qt.asignatura||"(sin asignatura)":pt),A(pt=>pt==="(sin curso)"?Qt.curso||yd(Qt.nivel,Qt.seccion)||"(sin curso)":pt)}}catch(ht){(ht==null?void 0:ht.code)!=="permission-denied"&&console.warn("[Desarrollo] profesores read:",(ht==null?void 0:ht.code)||ht)}if(!mc)try{const ht=se(X,"usuarios",xr),ti=await Fe(ht);if(ti.exists()){const Qt=ti.data()||{};mc=(Qt.unidadInicial||Qt.unidad||"").trim(),_(pt=>pt||mc),Qt.asignatura&&v==="(sin asignatura)"&&w(Qt.asignatura),Qt.curso&&E==="(sin curso)"&&A(Qt.curso)}}catch(ht){(ht==null?void 0:ht.code)!=="permission-denied"&&console.warn("[Desarrollo] usuarios fallback:",(ht==null?void 0:ht.code)||ht)}try{const ht=((Pe=r==null?void 0:r.state)==null?void 0:Pe.slotId)||UT()||localStorage.getItem("__lastSlotId")||"0-0",ti=se(X,"clases_detalle",xr,"slots",ht),Qt=await Fe(ti);if(Qt.exists()){const pt=Qt.data()||{};if(_(mr=>mr||pt.unidad||""),N(mr=>mr||pt.objetivo||""),V(mr=>mr||(Array.isArray(pt.habilidades)?pt.habilidades.join(", "):pt.habilidades||"")),pt.asignatura&&v==="(sin asignatura)"&&w(pt.asignatura),E==="(sin curso)")if(pt.curso||pt.nivel||pt.seccion)A(pt.curso||yd(pt.nivel,pt.seccion)||"(sin curso)");else try{const mr=await Fe(se(X,"horarios",xr,"celdas",ht));if(mr.exists()){const ra=mr.data()||{};ra.curso&&A(ra.curso),ra.asignatura&&v==="(sin asignatura)"&&w(ra.asignatura)}}catch{}}else{const pt=se(X,"usuarios",xr),mr=await Fe(pt),ra=mr.exists()?((ln=mr.data())==null?void 0:ln.horarioConfig)||{}:{},Fg=dO(ra);if(Array.isArray(Fg)&&Fg.length>1){const ia=uO(Fg),y1=cO(),v1=`${ia}-${y1}`,Rf=se(X,"clases_detalle",xr,"slots",v1),hd=await Fe(Rf);if(hd.exists()){const ds=hd.data()||{};_(bo=>bo||ds.unidad||""),N(bo=>bo||ds.objetivo||""),V(bo=>bo||(Array.isArray(ds.habilidades)?ds.habilidades.join(", "):ds.habilidades||"")),ds.asignatura&&v==="(sin asignatura)"&&w(ds.asignatura),E==="(sin curso)"&&A(ds.curso||yd(ds.nivel,ds.seccion)||"(sin curso)")}}}}catch(ht){(ht==null?void 0:ht.code)!=="permission-denied"&&console.warn("[Desarrollo] clases_detalle fallback:",(ht==null?void 0:ht.code)||ht)}const Pf=((cs=(lr=r==null?void 0:r.state)==null?void 0:lr.clase)==null?void 0:cs.unidad)||mc||T||"",dd=((Wt=(ta=r==null?void 0:r.state)==null?void 0:ta.clase)==null?void 0:Wt.asignatura)||v||"MatemÃ¡tica",na=((us=(Eo=r==null?void 0:r.state)==null?void 0:Eo.clase)==null?void 0:us.curso)||E||"";if(Pf){const ht=Mle(dd),ti=Nle(na,(Xe==null?void 0:Xe.nivel)||"");try{const Qt=`${VT}/mineduc?asignatura=${encodeURIComponent(ht)}&nivel=${encodeURIComponent(ti)}&unidad=${encodeURIComponent(Pf)}`,pt=await pn.get(Qt),mr=Array.isArray(pt.data)?pt.data[0]:null;if(mr)g(mr);else throw new Error("Proxy sin resultados, intento directo")}catch{try{const pt=`https://curriculumnacional.mineduc.cl/api/v1/oa/buscar?asignatura=${encodeURIComponent(ht)}&nivel=${encodeURIComponent(ti)}&unidad=${encodeURIComponent(Pf)}`,mr=await pn.get(pt),ra=Array.isArray(mr.data)?mr.data[0]:null;g(ra||null)}catch(pt){console.warn("[Desarrollo] OA ministerio no disponible (CORS/local):",(pt==null?void 0:pt.message)||pt)}}try{const Qt=await pn.get(`https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(Pf)}&format=json&origin=*`),pt=(_i=(pc=(Ys=(Xn=Qt==null?void 0:Qt.data)==null?void 0:Xn.query)==null?void 0:Ys.search)==null?void 0:pc[0])==null?void 0:_i.title;pt&&x(`https://es.wikipedia.org/wiki/${encodeURIComponent(pt)}`)}catch(Qt){console.warn("[Desarrollo] Wikipedia no disponible:",(Qt==null?void 0:Qt.message)||Qt)}}}catch(xr){console.error("Error cargando datos de Desarrollo:",xr)}})()},[S]),D.useEffect(()=>{S&&(async()=>{var H,me,ke;try{const Pe=localStorage.getItem("uid")||((H=we.currentUser)==null?void 0:H.uid);if(!Pe)return;const ln=((me=r==null?void 0:r.state)==null?void 0:me.slotId)||UT()||null;if(ln){const Eo=se(X,"clases_detalle",Pe,"slots",ln),us=await Fe(Eo);if(us.exists()){const Xn=us.data()||{};_(Ys=>Ys||Xn.unidad||""),N(Ys=>Ys||Xn.objetivo||""),V(Ys=>Ys||(Array.isArray(Xn.habilidades)?Xn.habilidades.join(", "):Xn.habilidades||"")),Xn.asignatura&&v==="(sin asignatura)"&&w(Xn.asignatura),E==="(sin curso)"&&A(Xn.curso||yd(Xn.nivel,Xn.seccion)||"(sin curso)");return}}const lr=se(X,"usuarios",Pe),cs=await Fe(lr),ta=cs.exists()?((ke=cs.data())==null?void 0:ke.horarioConfig)||{}:{},Wt=dO(ta);if(Array.isArray(Wt)&&Wt.length>1){const Eo=uO(Wt),us=cO(),Xn=`${Eo}-${us}`,Ys=se(X,"clases_detalle",Pe,"slots",Xn),pc=await Fe(Ys);if(pc.exists()){const _i=pc.data()||{};_(xr=>xr||_i.unidad||""),N(xr=>xr||_i.objetivo||""),V(xr=>xr||(Array.isArray(_i.habilidades)?_i.habilidades.join(", "):_i.habilidades||"")),_i.asignatura&&v==="(sin asignatura)"&&w(_i.asignatura),E==="(sin curso)"&&A(_i.curso||yd(_i.nivel,_i.seccion)||"(sin curso)")}}}catch(Pe){console.warn("[Desarrollo] marcasâ†’clases_detalle:",(Pe==null?void 0:Pe.code)||(Pe==null?void 0:Pe.message))}})()},[S]);const de=()=>{e?e():t("/cierre")},[nt,At]=D.useState(""),[it,Nt]=D.useState(""),[at,bt]=D.useState(null),lt=D.useRef(null),ft=D.useRef(null);D.useEffect(()=>{var H,me;if(!window.customElements||!((me=(H=window.customElements).get)!=null&&me.call(H,"model-viewer"))){const ke=document.createElement("script");ke.type="module",ke.src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js",ke.crossOrigin="anonymous",document.head.appendChild(ke)}},[]);const bi=()=>{De(Ple+(nt?`?prompt=${encodeURIComponent(nt)}`:"")),ae("Usa la Space para generar y descargar el GLB; luego pÃ©galo abajo en â€˜URL GLBâ€™ o sÃºbelo.")},Kt=()=>{De(Rle),ae("Primero genera una imagen (p. ej., en Stable Diffusion) y sÃºbala en la Space para obtener el GLB.")},gn=()=>{var me;const H=it.trim();if(!H)return alert("Pega una URL .glb/.gltf primero o sube un archivo.");bt(H),(me=ft.current)==null||me.scrollIntoView({behavior:"smooth",block:"center"})},Y=()=>{var H;return(H=lt.current)==null?void 0:H.click()},re=H=>{var Pe,ln;const me=(Pe=H.target.files)==null?void 0:Pe[0];if(!me)return;if(!/(\.glb|\.gltf)$/i.test(me.name)){alert("Sube un archivo .glb o .gltf.");return}const ke=URL.createObjectURL(me);bt(ke),(ln=ft.current)==null||ln.scrollIntoView({behavior:"smooth",block:"center"});try{H.target.value=""}catch{}},[pe,Te]=D.useState(!1),[yt,xe]=D.useState(""),Ze=async()=>{var me;const H=(nt||"").trim();if(!H)return alert("Escribe un prompt 3D primero.");Te(!0),xe("Generando modeloâ€¦");try{const ke=await fetch(`${VT}/shape/generate`,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({prompt:H,steps:32,size:1.2})});if(!ke.ok)throw new Error(`HTTP ${ke.status}`);const Pe=await ke.json();if(Pe!=null&&Pe.url)bt(Pe.url),Nt(Pe.url);else if(Pe!=null&&Pe.blobBase64)bt(Pe.blobBase64),Nt(Pe.blobBase64);else throw new Error("Respuesta sin URL ni blobBase64");xe("Listo âœ…"),(me=ft.current)==null||me.scrollIntoView({behavior:"smooth",block:"center"})}catch(ke){console.warn(ke),xe("No se pudo generar desde el servidor local. Abre Shap-E (botÃ³n) o verifica tu proxy en "+VT),alert("Fallo la generaciÃ³n local. Revisa el proxy o usa el botÃ³n de Shap-E.")}finally{Te(!1),setTimeout(()=>xe(""),3500)}},[$e,Ce]=D.useState(""),Ve=()=>{De(kle),ae("Demo A-Frame. Para una sala propia, pega la URL de tu mundo (FrameVR/Spatial/etc.) y Ã¡brela.")},He=()=>{$e.trim()&&De(dt($e.trim()))},[ve,an]=D.useState(()=>{var ke,Pe;const H=((Pe=(ke=r==null?void 0:r.state)==null?void 0:ke.ficha)==null?void 0:Pe.programaUrl)||"",me=localStorage.getItem("programaPdfUrl")||"";return H||me||""}),[Vt,yn]=D.useState(0),[ar,Hn]=D.useState(1),vn=D.useRef(null),[qs,Ks]=D.useState(900),[Ya,Tf]=D.useState("flip"),[ld,cd]=D.useState(""),fc=(()=>{var Pe,ln;const H=((ln=(Pe=r==null?void 0:r.state)==null?void 0:Pe.ficha)==null?void 0:ln.nivel)||"",me=(Xe==null?void 0:Xe.nivel)||"";if(H)return H;if(me)return me;const ke=String(E||"").match(/(\d+)\s*[Â°Âº]?\s*(b[aÃ¡]sico|medio)/i);return ke?`${ke[1]}Â° ${ke[2].toLowerCase().replace("basico","bÃ¡sico")}`:""})();D.useEffect(()=>{let H=!1;return(async()=>{try{if(ve){cd("");return}if(!fc){cd("");return}const me=Bo(tn(X,"mineduc_pdfs"),fi("nivel","==",fc)),Pe=(await $n(me)).docs.map(lr=>({id:lr.id,...lr.data()})),ln=Pe.find(lr=>lr.asignatura===v&&lr.unidad===T)||Pe.find(lr=>lr.asignatura===v)||Pe[0];H||cd((ln==null?void 0:ln.url)||"")}catch(me){H||cd(""),console.warn("[ProgramaPDF] mineduc_pdfs lookup:",(me==null?void 0:me.message)||me)}})(),()=>{H=!0}},[ve,fc,v,T]),D.useEffect(()=>{const H=vn.current;if(!H||typeof ResizeObserver>"u")return;const me=new ResizeObserver(ke=>{const Pe=Math.max(320,Math.floor(ke[0].contentRect.width-24));Ks(Math.min(980,Pe))});return me.observe(H),()=>me.disconnect()},[]),D.useEffect(()=>{var H,me;if((me=(H=r==null?void 0:r.state)==null?void 0:H.ficha)!=null&&me.programaUrl)try{localStorage.setItem("programaPdfUrl",r.state.ficha.programaUrl)}catch{}},[(fE=(hE=r==null?void 0:r.state)==null?void 0:hE.ficha)==null?void 0:fE.programaUrl]);const m1=({numPages:H})=>{yn(H||0),Hn(1)},If=()=>Hn(H=>Math.max(1,H-1)),cE=()=>Hn(H=>Math.min(Vt||1,H+1)),Mg=()=>{const H=(ve||"").trim();if(H)try{localStorage.setItem("programaPdfUrl",H)}catch{}},Qa=ve||ld,ea=D.useMemo(()=>Object.entries(mO).flatMap(([H,me])=>(me||[]).map(ke=>({...ke,group:H}))),[]),[xf,g1]=D.useState(!0),[ud,uE]=D.useState("Todas"),[Cf,Ng]=D.useState(""),Lg=D.useMemo(()=>["Todas",...Object.keys(mO)],[]),Og=D.useMemo(()=>{const H=yp(Cf);return ea.filter(me=>{const ke=ud==="Todas"||me.group===ud,Pe=!H||yp(me.name).includes(H)||yp(me.id).includes(H)||yp(me.group).includes(H);return ke&&Pe})},[ea,ud,Cf]),dE=H=>{const me=String(H.id||""),ke=dt(H.url||"");if(H.embed){if(me.startsWith("geogebra"))return De(ye(ke,"geogebra"));if(me.includes("desmos"))return De(ye(ke,"desmos"));if(me.includes("youtube"))return De(ye(ke,"youtube"));const Pe=/wikipedia|drive\.google|docs\.google|office|sharepoint|onedrive/.test(ke)?ye(ke,"custom"):dt(ke);return De(Pe)}Ct(ke)};return m.createElement("div",{style:Tle},Xe&&m.createElement("div",{style:{...el,marginBottom:"1rem",background:Xe.fuente==="calendario"?"rgba(124,58,237,.06)":"rgba(2,132,199,.06)"}},m.createElement("div",{style:{fontWeight:800}},Xe.fuente==="calendario"?"Plan semanal (vigente)":Xe.fuente==="slots"?"Horario (fallback)":"Sin clase planificada"),Xe.unidad&&m.createElement("div",null,m.createElement("b",null,"Unidad:")," ",Xe.unidad,Xe.evaluacion?" Â· (EvaluaciÃ³n)":"")),m.createElement("div",{style:{...Ile("1rem"),marginBottom:"1rem"}},m.createElement("div",{style:el},m.createElement("div",{style:{fontWeight:800,fontSize:"1.1rem",marginBottom:6}},"Desarrollo"),m.createElement("div",{style:{color:un.textMuted,marginBottom:8}},"ðŸ•’ ",c),m.createElement("div",{style:{display:"flex",alignItems:"center",gap:".5rem"}},m.createElement(b6,{duracion:n,onEnd:de}))),m.createElement("div",{style:{...el,textAlign:"center"}},m.createElement("div",{style:{fontWeight:800,fontSize:"1.2rem",marginBottom:6}},"Unidad"),m.createElement("div",{style:{marginBottom:6}},m.createElement("strong",null,T||"(sin unidad)"," ")),m.createElement("div",{style:{marginBottom:6}},m.createElement("strong",null,"Objetivo:")," ",P||"(sin objetivo)"),m.createElement("div",null,m.createElement("strong",null,"Habilidades:")," ",M||"(sin habilidades)"),b&&m.createElement("div",{style:{marginTop:8,color:un.textDark}},m.createElement("strong",null,"OA:")," ",b.descripcion),m.createElement("div",{style:{marginTop:10,color:un.textMuted}},m.createElement("strong",null,"Curso:")," ",E," Â |Â  ",m.createElement("strong",null,"Asignatura:")," ",v)),m.createElement("div",{style:{...el,display:"flex",flexDirection:"column",gap:".6rem"}},m.createElement("div",{style:{display:"flex",gap:".5rem"}},m.createElement("button",{style:cv},"âœ‹"),m.createElement("button",{style:cv},"ðŸ‘")),m.createElement("div",{style:{textAlign:"right"}},m.createElement("div",{style:{fontWeight:800}},h),m.createElement("div",{style:{color:un.textMuted}},v)))),m.createElement("div",{style:{...el,textAlign:"center",marginBottom:"1rem"}},m.createElement("h3",{style:{marginTop:0}},"ðŸŽ¬ Recurso de apoyo"),_e==="screen"?m.createElement("video",{ref:ot,autoPlay:!0,playsInline:!0,style:{width:"80%",height:420,borderRadius:8,border:`1px solid ${un.border}`,background:"#000",objectFit:"contain"}}):_e==="image"&&Ye?m.createElement("img",{src:Ye,alt:"Imagen presentada",style:{width:"80%",height:420,borderRadius:8,border:`1px solid ${un.border}`,background:"#000",objectFit:"contain"}}):m.createElement("iframe",{key:Z,width:"80%",height:"420",src:Z,title:"Panel principal",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{borderRadius:8,border:`1px solid ${un.border}`,background:"#000"}}),fe&&m.createElement("div",{style:{marginTop:8,color:"#b45309"}},"âš ï¸ ",fe),m.createElement("div",{style:xle},m.createElement("h4",{style:{margin:"0 0 8px"}},"ðŸ”§ Herramientas rÃ¡pidas"),m.createElement("div",{style:Uf},m.createElement("input",{style:Tc,value:L,onChange:H=>j(H.target.value),placeholder:"Buscar o pegar enlace de YouTubeâ€¦ (ej: proporcionalidad o https://youtu.be/ID)"}),m.createElement("button",{style:ur,onClick:W},"â–¶ï¸ Ver en panel"),m.createElement("select",{style:hO,value:oe,onChange:H=>$(H.target.value),title:"Tipo de app GeoGebra"},m.createElement("option",{value:"calculator"},"GeoGebra Â· Graficadora"),m.createElement("option",{value:"geometry"},"GeoGebra Â· GeometrÃ­a"),m.createElement("option",{value:"3d"},"GeoGebra Â· 3D")),m.createElement("button",{style:ur,onClick:z},"ðŸ“ En panel"),m.createElement("button",{style:ur,onClick:le},"ðŸ“ˆ Desmos en panel"),m.createElement("button",{style:ur,onClick:te},"ðŸ§ª PhET (portal)"),m.createElement("button",{style:ur,onClick:Ee},"ðŸ—‚ï¸ Drive"),m.createElement("input",{style:{...Tc,minWidth:280},value:B,onChange:H=>G(H.target.value),placeholder:"Pega cualquier enlace (intentaremos mostrarlo aquÃ­)"}),m.createElement("button",{style:ur,onClick:Et},"ðŸ”— Abrir en panel")),m.createElement("div",{style:Cle},m.createElement("button",{style:Ai,onClick:W,title:"YouTube"},m.createElement("img",{src:ca("youtube.com"),alt:"YouTube",style:tl})),m.createElement("button",{style:Ai,onClick:z,title:"GeoGebra"},m.createElement("img",{src:ca("geogebra.org"),alt:"GeoGebra",style:tl})),m.createElement("button",{style:Ai,onClick:le,title:"Desmos"},m.createElement("img",{src:ca("desmos.com"),alt:"Desmos",style:tl})),m.createElement("button",{style:Ai,onClick:te,title:"PhET (portal)"},m.createElement("img",{src:ca("phet.colorado.edu"),alt:"PhET",style:tl})),m.createElement("button",{style:Ai,onClick:Ee,title:"Google Drive (portal)"},m.createElement("img",{src:ca("drive.google.com"),alt:"Drive",style:tl})),m.createElement("button",{style:Ai,onClick:We,title:"Wikipedia en panel"},m.createElement("img",{src:ca("wikipedia.org"),alt:"Wikipedia",style:tl})),m.createElement("button",{style:Ai,onClick:Bt,title:ze?"Compartiendoâ€¦ (elige otra opciÃ³n)":"Presentar (pantalla o archivo)"},m.createElement(Bf,null)),m.createElement("button",{style:{...Ai,display:"none"},onClick:Bt},m.createElement(Bf,null)),m.createElement("button",{style:{...Ai,display:"none"},onClick:Bt},m.createElement(Bf,null)),m.createElement("button",{style:{...Ai,display:"none"},onClick:Bt},m.createElement(Bf,null)),m.createElement("button",{style:{...Ai,display:"none"},onClick:Bt},m.createElement(Bf,null)),m.createElement("button",{style:{...Ai,display:"none"},onClick:Bt},m.createElement(Bf,null)),m.createElement("button",{style:Ai,onClick:bi,title:"Shap-E (textoâ†’3D)"},m.createElement("img",{src:ca("huggingface.co"),alt:"Shap-E",style:tl})),m.createElement("button",{style:Ai,onClick:Kt,title:"TripoSR (imagenâ†’3D)"},m.createElement("img",{src:ca("huggingface.co"),alt:"TripoSR",style:tl})),m.createElement("button",{style:Ai,onClick:Ve,title:"Escape Room (demo A-Frame)"},m.createElement("img",{src:ca("aframe.io"),alt:"A-Frame",style:tl}))),m.createElement("div",{style:Lle},m.createElement("div",{style:{...Uf,justifyContent:"space-between"}},m.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}},m.createElement("h4",{style:{margin:0}},"ðŸ§° Apps rÃ¡pidas"),m.createElement("button",{style:{...ur,padding:".3rem .6rem"},onClick:()=>g1(H=>!H),title:"Mostrar/Ocultar catÃ¡logo"},xf?"Ocultar":"Mostrar")),m.createElement("div",{style:{display:"flex",gap:8,flexWrap:"wrap"}},m.createElement("select",{style:hO,value:ud,onChange:H=>uE(H.target.value),title:"Filtrar por categorÃ­a"},Lg.map(H=>m.createElement("option",{key:H,value:H},H))),m.createElement("input",{style:{...Tc,minWidth:240},value:Cf,onChange:H=>Ng(H.target.value),placeholder:"Buscar app por nombre/categorÃ­aâ€¦"}))),xf&&m.createElement("div",{style:Ole},Og.map(H=>{let me="example.com";try{me=new URL(dt(H.url)).host}catch{}return m.createElement("div",{key:`${H.group}:${H.id}`,style:Fle,onClick:()=>dE(H),title:H.embed?"Abrir dentro del panel":"Abrir en pestaÃ±a nueva"},m.createElement("img",{src:ca(me),alt:H.name,style:Vle}),m.createElement("div",{style:{display:"flex",flexDirection:"column"}},m.createElement("span",{style:Ule},H.name," ",H.embed?"":"â†—"),m.createElement("span",{style:Ble},H.group)))}),Og.length===0&&m.createElement("div",{style:{gridColumn:"1/-1",color:un.textMuted,fontStyle:"italic",padding:6}},"Sin resultados para ese filtro/bÃºsqueda."))),m.createElement("input",{ref:ie,type:"file",accept:"application/pdf,image/*",onChange:Se,style:{display:"none"}}))),m.createElement("div",{style:{...el,marginBottom:"1rem"}},m.createElement("h3",{style:{marginTop:0,textAlign:"center"}},"ðŸ“„ Programa de Estudio (PDF)"),m.createElement("div",{style:{...Uf,marginBottom:8}},m.createElement("input",{style:{...Tc,minWidth:420},value:ve,onChange:H=>an(H.target.value),placeholder:"Pega aquÃ­ la URL del PDF del programa (nivel + asignatura)"}),m.createElement("button",{style:ur,onClick:Mg},"ðŸ’¾ Guardar enlace"),m.createElement("div",{style:{display:"flex",gap:6}},m.createElement("button",{style:{...ur,opacity:Ya==="flip"?1:.6},onClick:()=>Tf("flip"),title:"Ver como Flipbook"},"ðŸ“– Flipbook"),m.createElement("button",{style:{...ur,opacity:Ya==="scroll"?1:.6},onClick:()=>Tf("scroll"),title:"Ver en modo paginado/scroll"},"ðŸ“„ Scroll"),ld&&!ve&&m.createElement("button",{style:ur,onClick:()=>an(ld),title:"Usar URL encontrada en mineduc_pdfs"},"ðŸ“¥ Usar MINEDUC"))),Qa?Ya==="scroll"?m.createElement("div",{ref:vn,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8}},m.createElement("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6}},m.createElement("button",{style:ur,onClick:If,disabled:ar<=1},"â¬…ï¸ Anterior"),m.createElement("div",{style:{fontWeight:700}},"PÃ¡gina ",ar," / ",Vt||"â€¦"),m.createElement("button",{style:ur,onClick:cE,disabled:!Vt||ar>=Vt},"Siguiente âž¡ï¸")),m.createElement("div",{style:{border:`1px solid ${un.border}`,borderRadius:8,overflow:"hidden",background:"#f8fafc"}},m.createElement(OC,{file:{url:Qa},onLoadSuccess:m1,loading:m.createElement("div",{style:{padding:12}},"Cargando PDFâ€¦")},m.createElement(FC,{pageNumber:ar,width:qs,renderAnnotationLayer:!0,renderTextLayer:!0})))):m.createElement("div",{style:{display:"flex",justifyContent:"center"}},m.createElement(OC,{file:{url:Qa},onLoadError:H=>console.error("PDF error:",H),onLoadSuccess:({numPages:H})=>yn(H),loading:m.createElement("div",{style:{padding:12}},"Cargando PDFâ€¦")},Vt?m.createElement(b3,{width:800,height:1e3,className:"shadow-lg"},Array.from({length:Vt}).map((H,me)=>m.createElement("div",{key:`pg-${me}`,className:"bg-white p-2"},m.createElement(FC,{pageNumber:me+1,renderTextLayer:!1,renderAnnotationLayer:!1,width:800})))):null)):m.createElement("div",{style:{color:un.textMuted,textAlign:"center"}},"Pega la URL del PDF arriba. Si vienes desde ",m.createElement("em",null,"Inicio")," con ficha, uso automÃ¡ticamente"," ",m.createElement("code",null,"ficha.programaUrl"),". Si estÃ¡ vacÃ­o, intentamos buscarlo en ",m.createElement("code",null,"mineduc_pdfs")," por tu"," ",fc?`nivel Â«${fc}Â»`:"nivel"," y asignatura.")),m.createElement("div",{style:{...el,marginBottom:"1rem"}},m.createElement("h3",{style:{marginTop:0,textAlign:"center"}},"ðŸ§ª Laboratorio 3D"),m.createElement("div",{style:{...Uf,marginBottom:6}},m.createElement("input",{style:{...Tc,minWidth:360},value:nt,onChange:H=>At(H.target.value),placeholder:"Prompt 3D (ej.: 'un prisma triangular low-poly de color azul')",onKeyDown:H=>{H.key==="Enter"&&Ze()}}),m.createElement("button",{style:ur,onClick:bi},"ðŸš€ Abrir Shap-E (textoâ†’3D)"),m.createElement("button",{style:ur,onClick:Kt},"ðŸ–¼ï¸ Abrir TripoSR (imagenâ†’3D)"),m.createElement("button",{style:{...ur,opacity:pe?.7:1},onClick:Ze,disabled:pe,title:"Requiere proxy local en PROXY_BASE/shape/generate"},"âš™ï¸ Generar (servidor)")),yt&&m.createElement("div",{style:{textAlign:"center",color:"#b45309",marginBottom:6}},yt),m.createElement("div",{style:{...Uf,marginBottom:10}},m.createElement("input",{style:{...Tc,minWidth:360},value:it,onChange:H=>Nt(H.target.value),placeholder:"URL .glb/.gltf (pÃ©galo aquÃ­ para previsualizar)"}),m.createElement("button",{style:ur,onClick:gn},"ðŸ‘ï¸ Ver 3D"),m.createElement("button",{style:ur,onClick:Y},"ðŸ“‚ Subir GLB"),m.createElement("input",{ref:lt,type:"file",accept:".glb,.gltf,model/gltf-binary,model/gltf+json",onChange:re,style:{display:"none"}})),m.createElement("div",{ref:ft,style:{display:"flex",justifyContent:"center"}},at?m.createElement("model-viewer",{src:at,alt:"Modelo 3D","camera-controls":!0,"auto-rotate":!0,exposure:"1.1",style:{width:"100%",maxWidth:720,height:420,borderRadius:12,border:`1px solid ${un.border}`},ar:!0}):m.createElement("div",{style:{color:un.textMuted,fontStyle:"italic"}},"Pega una URL .glb/.gltf o sube un GLB para previsualizarlo aquÃ­."))),m.createElement("div",{style:{...el}},m.createElement("h3",{style:{marginTop:0,textAlign:"center"}},"ðŸ—ï¸ Escape Room / Recorrido 3D"),m.createElement("div",{style:{...Uf}},m.createElement("button",{style:ur,onClick:Ve},"ðŸŽ® Abrir demo A-Frame"),m.createElement("input",{style:{...Tc,minWidth:360},value:$e,onChange:H=>Ce(H.target.value),placeholder:"URL de tu sala (ej.: https://framevr.io/mi-sala)"}),m.createElement("button",{style:ur,onClick:He},"ðŸƒâ€â™€ï¸ Abrir sala en panel")),m.createElement("div",{style:{marginTop:6,color:un.textMuted,textAlign:"center",fontSize:12}},"Sugerencia: crea una sala en FrameVR o Spatial, agrega paneles con contenidos (imÃ¡genes/GLB/links) y pega la URL pÃºblica aquÃ­.")),y&&m.createElement("div",{style:{...el}},m.createElement("h3",{style:{marginTop:0,textAlign:"center"}},"ðŸ“š InformaciÃ³n complementaria"),m.createElement("iframe",{src:Ut(y),width:"100%",height:"420",title:"Contenido Wikipedia",style:{border:`1px solid ${un.border}`,borderRadius:"8px"}})),m.createElement("div",{style:{textAlign:"center",marginTop:"1rem"}},m.createElement("button",{onClick:()=>t("/cierre"),style:cv,title:"Ir al Cierre"},"â­ï¸ Ir al Cierre")))}const vd=["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes"],gO=["08:00 - 08:45","08:45 - 09:30","09:30 - 09:50 (Recreo)","9:50 - 10:35".replace("9:50","09:50"),"10:35 - 11:20","11:20 - 11:30 (Recreo)","11:30 - 12:15","12:15 - 13:00","13:00 - 13:45 (Almuerzo)","13:45 - 14:30","14:30 - 15:15","15:15 - 15:30 (Recreo)","15:30 - 16:15","16:15 - 17:00","17:00 - 17:45","17:45 - 18:30"],jle=["MatemÃ¡tica","Lenguaje","FÃ­sica","QuÃ­mica","BiologÃ­a","Historia","Ciencias","InglÃ©s","TecnologÃ­a","ReuniÃ³n con apoderados","ReuniÃ³n con Profe PIE","PlanificaciÃ³n","Hora libre","Otro","OrientaciÃ³n","Dimensiones Formativas","LÃ­mites","EstadÃ­stica","ReuniÃ³n Dpto"],zle=["1Âº Medio","2Âº Medio","3Âº Medio","4Âº Medio"],Hle=["A","B","C","D"],yO=["ReuniÃ³n con apoderados","ReuniÃ³n con Profe PIE","PlanificaciÃ³n","Hora libre","Otro","ReuniÃ³n Dpto"],ua=n=>{const[e,t]=n.split(":").map(Number);return e*60+t},Sc=n=>{const e=Math.floor(n/60)%24,t=n%60;return`${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}`},al=n=>(n||"").replace(/Âº/g,"Â°").replace(/\s+/g," ").trim(),Pc=n=>(n||"").trim(),Rc=n=>(n||"").trim(),E_=async()=>{var e;return(e=we.currentUser)!=null&&e.uid?we.currentUser.uid:(await mo(we)).user.uid},ab=[[8,0],[8,45],[9,30],[9,50],[10,35],[11,20],[11,30],[12,15],[13,45],[14,30],[15,15],[15,30],[16,15],[17,0],[17,45],[18,30]],vO=n=>(n||[]).map(([e,t])=>({h:e,m:t})),Gle=n=>Array.isArray(n)?n.map(e=>Array.isArray(e)?e:[Number(e==null?void 0:e.h)||0,Number(e==null?void 0:e.m)||0]).filter(e=>Number.isFinite(e[0])&&Number.isFinite(e[1])):[],Wle=n=>/Recreo|Almuerzo/i.test(n||""),qle=n=>{const e=String(n||"").match(/(\d{2}):(\d{2})\s*-\s*(\d{2}):(\d{2})/);return e?[[+e[1],+e[2]],[+e[3],+e[4]]]:null},Kle=(n="")=>{const e=n.toLowerCase();return e.includes("matem")?"matematica":e.includes("lengua")?"lenguaje":e.includes("fÃ­s")||e.includes("fis")?"fisica":e.includes("quÃ­m")||e.includes("quim")?"quimica":e.includes("hist")?"historia":e.includes("ingl")?"ingles":e.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").replace(/\s+/g,"")};function Yle(n,{seleccion:e,unidadesUsuario:t,horario:r}){return m.useCallback(()=>{var s;let i=(e==null?void 0:e.asignaturaId)||((s=t==null?void 0:t[0])==null?void 0:s.asignaturaId)||(()=>{var o,a;for(let l=0;l<((r==null?void 0:r.length)||0);l++)for(let c=0;c<(((o=r[l])==null?void 0:o.length)||0);c++){const u=(a=r[l][c])==null?void 0:a.asignatura;if(u)return Kle(u)}return null})()||localStorage.getItem("selAsignatura")||"";i?(localStorage.setItem("selAsignatura",i),n(`/planificaciones?asig=${encodeURIComponent(i)}`)):n("/planificaciones")},[n,e,t,r])}async function Qle(n){var e,t,r;try{const i=se(X,"horarios",n),s=await Fe(i);if(s.exists()&&Array.isArray((e=s.data())==null?void 0:e.horario))return s.data().horario}catch{}try{const i=se(X,"usuarios",n),s=await Fe(i);if(!s.exists())return null;const o=s.data()||{};if(o.horarioMatriz&&typeof o.horarioMatriz=="object")return Object.keys(o.horarioMatriz).sort((l,c)=>Number(l.replace("f",""))-Number(c.replace("f",""))).map(l=>o.horarioMatriz[l]);if(Array.isArray(o.horarioSlots)){const a=((r=(t=o.horarioConfig)==null?void 0:t.bloquesGenerados)==null?void 0:r.length)||16,l=5,c=Array.from({length:a},()=>Array.from({length:l},()=>({asignatura:"",nivel:"",seccion:"",unidad:"",objetivo:"",habilidades:""})));return o.horarioSlots.forEach(u=>{(u==null?void 0:u.fila)!=null&&(u==null?void 0:u.col)!=null&&(c[u.fila][u.col]={asignatura:u.asignatura||"",nivel:u.nivel||"",seccion:u.seccion||"",unidad:u.unidad||"",objetivo:u.objetivo||"",habilidades:Array.isArray(u.habilidades)?u.habilidades.join(", "):u.habilidades||""})}),c}}catch{}return null}async function lb(n,{overwrite:e=!1}={}){const t=await Qle(n);if(!t)return{ok:!1,reason:"no-matrix"};for(let r=0;r<t.length;r++){const i=t[r]||[];for(let s=0;s<i.length;s++){const o=i[s]||{};if(!(o.asignatura&&o.asignatura.trim()||o.nivel&&o.nivel.trim()||o.seccion&&o.seccion.trim()||o.unidad&&o.unidad.trim()||o.objetivo&&o.objetivo.trim()||o.habilidades&&String(o.habilidades).trim()))continue;const l=`${r}-${s}`,c=se(X,"clases_detalle",n,"slots",l),u=await Fe(c),h=u.exists()?u.data()||{}:{},f=e?{asignatura:o.asignatura||"",nivel:o.nivel||"",seccion:o.seccion||"",unidad:o.unidad||"",objetivo:o.objetivo||"",habilidades:Array.isArray(o.habilidades)?o.habilidades.join(", "):o.habilidades||"",updatedAt:ut()}:{asignatura:h.asignatura||o.asignatura||"",nivel:h.nivel||o.nivel||"",seccion:h.seccion||o.seccion||"",unidad:h.unidad||o.unidad||"",objetivo:h.objetivo||o.objetivo||"",habilidades:h.habilidades||(Array.isArray(o.habilidades)?o.habilidades.join(", "):o.habilidades||""),updatedAt:ut()};await xt(c,f,{merge:!0})}}return{ok:!0}}function Xle({fila:n,columna:e,asignatura:t="",nivel:r="",seccion:i="",unidadesUsuario:s=[],onSaved:o=()=>{},actualizarCelda:a}){var g;const[l,c]=D.useState(((g=we.currentUser)==null?void 0:g.uid)||localStorage.getItem("uid")||""),[u,h]=D.useState(""),[f,v]=D.useState("");D.useEffect(()=>{(async()=>{if(!l){const y=await E_();c(y)}})()},[l]);const w=`${n}-${e}`,E=[al(r),Rc(i)].filter(Boolean).join(" ").trim(),A=(y="")=>y.toString().toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim(),T=A(t),_=D.useMemo(()=>{var I,P;let y=s;if(T&&(y=y.filter(N=>A(N.asignaturaNombre||N.asignaturaId||"").includes(T))),u.trim()){const N=A(u);y=y.filter(M=>{var V;return A(((V=M.unidad)==null?void 0:V.nombre)||"").includes(N)})}const x=new Set,S=[];for(const N of y){const M=`${N.asignaturaId||N.asignaturaNombre}__${N.nivelId}__${(I=N.unidad)==null?void 0:I.id}__${(P=N.unidad)==null?void 0:P.nombre}`;x.has(M)||(x.add(M),S.push(N))}return S.slice(0,40)},[s,T,u]),b=async y=>{var S,I,P,N,M,V,L,j;if(!l)return v("Sin UID.");if(!t)return v("Primero elige la asignatura.");if(!E)return v("Completa nivel y secciÃ³n para el curso.");const x=String(((S=y==null?void 0:y.unidad)==null?void 0:S.id)||"").trim();if(!x)return v("Unidad sin id/cÃ³digo.");try{v("Guardandoâ€¦"),await xt(se(X,"horarios",l,"celdas",w),{asignatura:Pc(t),curso:E,codUnidad:x,updatedAt:ut()},{merge:!0}),await xt(se(X,"clases_detalle",l,"slots",w),{asignatura:Pc(t),nivel:al(r),seccion:Rc(i),unidad:((I=y==null?void 0:y.unidad)==null?void 0:I.nombre)||"",unidadId:((P=y==null?void 0:y.unidad)==null?void 0:P.id)||"",objetivo:Array.isArray((N=y==null?void 0:y.unidad)==null?void 0:N.objetivos)?y.unidad.objetivos.join(" Â· "):"",habilidades:Array.isArray((M=y==null?void 0:y.unidad)==null?void 0:M.habilidades)?y.unidad.habilidades.join(" Â· "):"",updatedAt:ut()},{merge:!0}),typeof a=="function"&&(a(n,e,"unidad",((V=y==null?void 0:y.unidad)==null?void 0:V.nombre)||""),a(n,e,"objetivo",Array.isArray((L=y==null?void 0:y.unidad)==null?void 0:L.objetivos)?y.unidad.objetivos.join(" Â· "):""),a(n,e,"habilidades",Array.isArray((j=y==null?void 0:y.unidad)==null?void 0:j.habilidades)?y.unidad.habilidades.join(" Â· "):"")),v("âœ” PlanificaciÃ³n guardada y materializada en clases_detalle."),o({asignatura:t,curso:E,codUnidad:x}),setTimeout(()=>v(""),2500)}catch(oe){v(`Error: ${(oe==null?void 0:oe.message)||oe}`)}};return m.createElement("div",{style:{marginTop:8,borderTop:"1px dashed #e5e7eb",paddingTop:8}},m.createElement("div",{style:{fontSize:12,color:"#475569",marginBottom:4}},m.createElement("b",null,"PlanificaciÃ³n (combo + chips)")," â€” escribe en ",m.createElement("code",null,"horarios/",l||"â€¦","/celdas/",w)),m.createElement("input",{placeholder:"Buscar unidad por nombreâ€¦",value:u,onChange:y=>h(y.target.value),style:{width:"100%",padding:"6px 8px",borderRadius:8,border:"1px solid #d1d5db",marginBottom:6}}),m.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:6}},_.length===0&&m.createElement("span",{style:{fontSize:12,color:"#64748b"}},t?"No hay resultados para esa asignatura/bÃºsqueda.":"Selecciona una asignatura arriba para ver planificaciones."),_.map(y=>{var x,S,I,P;return m.createElement("button",{key:`${y.asignaturaId}-${y.nivelId}-${(x=y.unidad)==null?void 0:x.id}`,type:"button",onClick:()=>b(y),title:`Guardar ${(S=y.unidad)==null?void 0:S.nombre}`,style:{border:"1px solid #cbd5e1",background:"#f8fafc",borderRadius:999,padding:"6px 10px",cursor:"pointer",fontSize:13}},((I=y.unidad)==null?void 0:I.nombre)||((P=y.unidad)==null?void 0:P.id))})),f&&m.createElement("div",{style:{marginTop:6,fontSize:12,color:"#334155"}},f))}const Jle=()=>{const n=ji(),[e,t]=D.useState(null);D.useEffect(()=>{const Y=ls(we,re=>t(re));return we.currentUser||mo(we).catch(re=>console.error("Anon sign-in error:",re)),()=>Y()},[]),D.useEffect(()=>{e!=null&&e.uid&&localStorage.getItem("uid")!==e.uid&&(localStorage.setItem("uid",e.uid),console.log("[sync] localStorage uid =>",e.uid))},[e]),D.useEffect(()=>{(async()=>{var pe;const re=((pe=we.currentUser)==null?void 0:pe.uid)||localStorage.getItem("uid");if(re&&window.__slotsSyncedForUid!==re)try{await lb(re,{overwrite:!1}),window.__slotsSyncedForUid=re,console.log("âœ“ slots sincronizados (on mount)")}catch(Te){console.warn("syncSlotsFromHorario (mount) error:",Te)}})()},[e]),D.useEffect(()=>{window.syncSlotsNow=async(Y=!1)=>{var Te;const re=((Te=we.currentUser)==null?void 0:Te.uid)||localStorage.getItem("uid");if(!re)return alert("Sin uid");const pe=await lb(re,{overwrite:Y});alert("syncSlotsFromHorario: "+JSON.stringify(pe))}},[]);const[r,i]=D.useState(gO),[s,o]=D.useState(ab),[a,l]=D.useState(Array(gO.length).fill(null).map(()=>Array(vd.length).fill(null).map(()=>({asignatura:"",nivel:"",seccion:""})))),[c,u]=D.useState(!0),[h,f]=D.useState(""),[v,w]=D.useState([]),[E,A]=D.useState(null),[T,_]=D.useState(null),[b,g]=D.useState("08:00"),[y,x]=D.useState(45),[S,I]=D.useState(16),[P,N]=D.useState({habilitado:!0,hora:"09:30",minutos:20}),[M,V]=D.useState({habilitado:!0,hora:"15:15",minutos:15}),[L,j]=D.useState({habilitado:!0,hora:"13:00",minutos:45}),[oe,$]=D.useState([]),[B,G]=D.useState(null),[Z,ee]=D.useState(!1),fe=()=>new Date().toISOString().slice(0,10),ae=()=>{const Y=new Date;return Y.setMonth(Y.getMonth()+4),Y.toISOString().slice(0,10)},[_e,Qe]=D.useState(fe()),[Ye,gt]=D.useState(ae()),[ie,ot]=D.useState("semestre"),[et,ze]=D.useState(8),[tt,Xe]=D.useState(1),[Je,dt]=D.useState(1),[Ct,Ut]=D.useState(0),[Ir,ue]=D.useState({}),ye=Y=>{const[re,pe,Te]=Y.split("-").map(Number);return new Date(re,pe-1,Te)},De=Y=>{const re=new Date(Y),pe=re.getDay(),Te=(pe===0?-6:1)-pe;return re.setDate(re.getDate()+Te),re.setHours(0,0,0,0),re},Tt=(Y,re)=>{const pe=new Date(Y);return pe.setDate(pe.getDate()+re),pe},Se=Y=>{const re=De(Y),pe=new Date(re.getFullYear(),0,1),Te=Math.floor((re-De(pe))/864e5),yt=Math.floor(Te/7)+1;return`${re.getFullYear()}-W${String(yt).padStart(2,"0")}`},Be=(Y,re)=>{const pe=De(ye(Y)),Te=De(ye(re)),yt=[];let xe=new Date(pe);for(;xe<=Te;)yt.push(new Date(xe)),xe=Tt(xe,7);return yt};D.useEffect(()=>{(async()=>{var pe,Te;const re=((pe=we.currentUser)==null?void 0:pe.uid)||localStorage.getItem("uid");if(re){ee(!0);try{const xe=(await $n(tn(X,"usuarios",re,"planificacion_usuario"))).docs.map($e=>({id:$e.id,...$e.data()||{}})),Ze=[];for(const $e of xe){const[Ce,Ve]=($e.id||"").split("_");if(!Ce||!Ve)continue;let He=Ce;try{const Vt=await Fe(se(X,"catalogo_curricular",Ce));Vt.exists()&&((Te=Vt.data())!=null&&Te.nombre)&&(He=Vt.data().nombre)}catch{}let ve=[];try{const Vt=tn(X,"catalogo_curricular",Ce,"niveles",Ve,"unidades");ve=[...(await $n(Vt)).docs.map(Hn=>({id:Hn.id,...Hn.data()||{}}))]}catch{}try{const Vt=`${Ce}_${Ve}`,yn=tn(X,"catalogo_curricular",Vt,"unidades"),Hn=(await $n(yn)).docs.map(vn=>({id:vn.id,...vn.data()||{}}));if(Hn.length>0){const vn=new Map,qs=Ks=>String(Ks.nombre||Ks.titulo||Ks.id||"").trim().toLowerCase();[...ve,...Hn].forEach(Ks=>{const Ya=(Ks.id||"")+"@"+qs(Ks);vn.has(Ya)||vn.set(Ya,Ks)}),ve=Array.from(vn.values())}}catch{}const an=$e.unidades||{};for(const Vt of ve){const yn=Vt.nombre||Vt.titulo||Vt.id,ar=String(yn||"").toLowerCase().trim(),Hn=an[Vt.id]||an[yn]||an[ar]||"";Hn!=="hecha"&&Ze.push({asignaturaId:Ce,asignaturaNombre:He,nivelId:Ve,unidad:{id:Vt.id,nombre:yn,objetivos:Array.isArray(Vt.objetivos)?Vt.objetivos:Array.isArray(Vt.OA)?Vt.OA:[],habilidades:Array.isArray(Vt.habilidades)?Vt.habilidades:[],horasSugeridas:Vt.horasSugeridas},estado:Hn})}}Ze.sort(($e,Ce)=>{const Ve=ve=>ve==="priorizada"?0:ve==="seleccionada"?1:2,He=Ve($e.estado)-Ve(Ce.estado);return He!==0?He:($e.unidad.nombre||"").localeCompare(Ce.unidad.nombre||"")}),$(Ze)}finally{ee(!1)}}})()},[e]);const kt=D.useMemo(()=>{const Y=new Map;for(const re of oe){const pe=`${re.asignaturaNombre} â€” ${re.nivelId}`;Y.has(pe)||Y.set(pe,[]),Y.get(pe).push(re)}return Array.from(Y.entries())},[oe]),Bt=()=>{let Y=ua(b),re=0;const pe=[],Te=[],yt=()=>{if(P.habilitado&&Y===ua(P.hora)){const Ze=Y+P.minutos;pe.push(`${Sc(Y)} - ${Sc(Ze)} (Recreo)`),Te.push([Math.floor(Y/60),Y%60]),Y=Ze}if(L.habilitado&&Y===ua(L.hora)){const Ze=Y+L.minutos;pe.push(`${Sc(Y)} - ${Sc(Ze)} (Almuerzo)`),Te.push([Math.floor(Y/60),Y%60]),Y=Ze}if(M.habilitado&&Y===ua(M.hora)){const Ze=Y+M.minutos;pe.push(`${Sc(Y)} - ${Sc(Ze)} (Recreo)`),Te.push([Math.floor(Y/60),Y%60]),Y=Ze}};for(;re<Number(S);){yt();const Ze=Y+Number(y);pe.push(`${Sc(Y)} - ${Sc(Ze)}`),Te.push([Math.floor(Y/60),Y%60]),Y=Ze,re++,yt()}Te.push([Math.floor(Y/60),Y%60]),i(pe),o(Te);const xe=Array(pe.length).fill(null).map(()=>Array(vd.length).fill(null).map(()=>({asignatura:"",nivel:"",seccion:""})));l(xe)};D.useEffect(()=>{(async()=>{var pe;const re=(e==null?void 0:e.uid)||localStorage.getItem("uid");if(re){const Te=se(X,"usuarios",re),yt=await Fe(Te);if(yt.exists()){const xe=yt.data()||{},Ze=xe.unidadInicial||"";if(f(Ze),!yO.includes(Ze))try{const $e=await pn.get(`https://curriculumnacional.mineduc.cl/api/v1/oa/buscar?asignatura=matematica&nivel=media&unidad=${Ze}`);A($e.data[0]);const Ve=(pe=(await pn.get(`https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${Ze}&format=json&origin=*`)).data.query.search[0])==null?void 0:pe.title;Ve&&_(`https://es.wikipedia.org/wiki/${encodeURIComponent(Ve)}`)}catch($e){console.error("Error buscando OA o Wikipedia:",$e)}try{const $e=xe.horarioConfig||{};if($e.inicio&&g($e.inicio),Number.isFinite(+$e.duracionMin)&&x(Number($e.duracionMin)),Number.isFinite(+$e.cantidad)&&I(Number($e.cantidad)),Array.isArray($e.bloquesGenerados)&&$e.bloquesGenerados.length>0&&i($e.bloquesGenerados),Array.isArray($e.marcas)&&$e.marcas.length>0){const Ce=Gle($e.marcas);Ce.length>1&&o(Ce)}if(Array.isArray($e.breaks)){const Ce=$e.breaks.find(ve=>/Recreo/i.test(ve==null?void 0:ve.label)&&(ve==null?void 0:ve.hhmm)&&ua(ve.hhmm)<ua("12:00")),Ve=$e.breaks.find(ve=>/Almuerzo/i.test(ve==null?void 0:ve.label)),He=$e.breaks.filter(ve=>/Recreo/i.test(ve==null?void 0:ve.label)).sort((ve,an)=>ua(ve.hhmm)-ua(an.hhmm)).find(ve=>ua(ve.hhmm)>=ua("12:00"));Ce&&N({habilitado:!0,hora:Ce.hhmm,minutos:Number(Ce.durMin||15)}),Ve&&j({habilitado:!0,hora:Ve.hhmm,minutos:Number(Ve.durMin||45)}),He&&V({habilitado:!0,hora:He.hhmm,minutos:Number(He.durMin||15)})}if(xe.horarioMatriz&&typeof xe.horarioMatriz=="object"){const Ve=(Array.isArray($e.bloquesGenerados)&&$e.bloquesGenerados.length?$e.bloquesGenerados:r).length,He=vd.length,ve=Array(Ve).fill(null).map((an,Vt)=>{const yn=xe.horarioMatriz[`f${Vt}`]||[];return Array(He).fill(null).map((ar,Hn)=>{const vn=yn[Hn]||{};return{asignatura:vn.asignatura||"",nivel:vn.nivel||"",seccion:vn.seccion||"",unidad:vn.unidad||"",objetivo:vn.objetivo||"",habilidades:vn.habilidades||""}})});l(ve)}}catch($e){console.warn("[Horario] No se pudo pre-cargar horarioConfig/horarioMatriz:",($e==null?void 0:$e.message)||$e)}}}})()},[e]),D.useEffect(()=>{(async()=>{try{const re=new Date().getFullYear(),pe=await pn.get(`https://date.nager.at/api/v3/PublicHolidays/${re}/CL`);w(pe.data.slice(0,5))}catch(re){console.error("Error cargando feriados:",re)}})()},[]);const W=(Y,re,pe,Te)=>{const yt=[...a];yt[Y][re][pe]=Te,l(yt)},z=(Y,re)=>{if(!B){alert("Elige primero una unidad en el panel de la izquierda.");return}const pe=[...a],Te={...pe[Y][re]||{}};Te.asignatura=B.asignaturaNombre||B.asignaturaId||Te.asignatura||"",Te.nivel=al(B.nivelId||Te.nivel||""),Te.unidad=B.unidad.nombre||"",Te.objetivo=Array.isArray(B.unidad.objetivos)?B.unidad.objetivos.join(" Â· "):"",Te.habilidades=Array.isArray(B.unidad.habilidades)?B.unidad.habilidades.join(" Â· "):"",Te.asignaturaId=B.asignaturaId||"",Te.unidadId=B.unidad.id||"",pe[Y][re]=Te,l(pe)},le=()=>{var re;const Y=[];for(let pe=0;pe<r.length;pe++){const Te=r[pe]||"";if(!/Recreo|Almuerzo/i.test(Te))for(let xe=0;xe<vd.length;xe++)((((re=a[pe])==null?void 0:re[xe])||{}).asignatura||"").toLowerCase().includes("matem")&&Y.push({fila:pe,col:xe})}return Y},te=Y=>Math.max(1,Math.ceil(Y*60/Number(y||45))),Ee=async()=>{try{const Y=Be(_e,Ye);if(!Y.length){alert("Rango de fechas invÃ¡lido.");return}Ut(Y.length);const re=le();if(!re.length){alert("No hay bloques de MatemÃ¡tica en el horario semanal. Asigna primero â€˜MatemÃ¡ticaâ€™.");return}const pe=[...oe],Te=ve=>ve.estado==="priorizada"?0:ve.estado==="seleccionada"?1:2;if(pe.sort((ve,an)=>Te(ve)-Te(an)),!pe.length){alert("No tienes unidades seleccionadas. Ve a Planificaciones â†’ CatÃ¡logo.");return}const yt=te(Number(tt||1)),xe={};let Ze=0;const $e=Y.length*re.length,Ce=ve=>{if(Ze>=$e)return null;const an=Math.floor(Ze/re.length),Vt=Ze%re.length,yn=Se(Y[an]),ar=re[Vt];return Ze++,xe[yn]||(xe[yn]=[]),{wk:yn,slot:ar}};for(const ve of pe){const an=Number(ve.unidad.horasSugeridas||et),Vt=te(an);for(let yn=0;yn<Vt;yn++){const ar=Ce();if(!ar)break;const{wk:Hn,slot:vn}=ar;xe[Hn].push({fila:vn.fila,col:vn.col,unidadId:ve.unidad.id,unidadNombre:ve.unidad.nombre,evaluacion:!1})}for(let yn=0;yn<yt;yn++){const ar=Ce();if(!ar)break;const{wk:Hn,slot:vn}=ar;xe[Hn].push({fila:vn.fila,col:vn.col,unidadId:`eval-${ve.unidad.id}-${yn}`,unidadNombre:`EvaluaciÃ³n â€” ${ve.unidad.nombre}`,evaluacion:!0})}}const Ve=await E_();for(const[ve,an]of Object.entries(xe))await xt(se(X,"usuarios",Ve,"planificacion_calendario",ve),{items:an,meta:{fechaInicio:_e,fechaFin:Ye,periodicidad:ie,duracionBloque:y,updatedAt:ut()}},{merge:!0});ue(xe),dt(1);const He=Se(Y[0]);Et(He,xe),alert("âœ… AutoplanificaciÃ³n generada y guardada por semanas.")}catch(Y){console.error("autoPlanificar error:",Y),alert("âŒ No se pudo autoplanificar. Revisa la consola.")}},Et=(Y,re)=>{var yt;const pe=re[Y]||[],Te=a.map(xe=>xe.map(Ze=>({...Ze})));for(const xe of pe){const Ze=(yt=Te[xe.fila])==null?void 0:yt[xe.col];Ze&&(Ze.unidad=xe.unidadNombre,Ze.objetivo=Ze.objetivo||"",Ze.habilidades=Ze.habilidades||"")}l(Te)},We=Y=>{const re=Be(_e,Ye);if(!re.length)return;const pe=Math.min(Math.max(1,Y),re.length);dt(pe);const Te=Se(re[pe-1]);Et(Te,Ir)},de=()=>{var xe;const Y=new Date,pe=Y.getDay()-1;if(pe<0||pe>=vd.length)return null;const Te=Y.getHours()*60+Y.getMinutes(),yt=Array.isArray(s)&&s.length>1?s:ab;for(let Ze=0;Ze<r.length;Ze++){const $e=r[Ze]||"";if(Wle($e))continue;let Ce=yt[Ze],Ve=yt[Ze+1];if(!Ce||!Ve){const an=qle($e);an&&(Ce=an[0],Ve=an[1])}if(!Ce||!Ve)continue;const He=Ce[0]*60+Ce[1],ve=Ve[0]*60+Ve[1];if(Te>=He&&Te<ve){const an=((xe=a[Ze])==null?void 0:xe[pe])||{};if(an.asignatura)return{fila:Ze,col:pe,cell:an,label:$e}}}return null},nt=async()=>{var Y;try{let re=((Y=we.currentUser)==null?void 0:Y.uid)||(e==null?void 0:e.uid)||localStorage.getItem("uid")||null;re||(re=await E_()),localStorage.getItem("uid")!==re&&localStorage.setItem("uid",re);const pe={};a.forEach((Ve,He)=>{pe[`f${He}`]=Ve.map(ve=>({asignatura:Pc(ve.asignatura),nivel:al(ve.nivel),seccion:Rc(ve.seccion),unidad:ve.unidad||"",objetivo:ve.objetivo||"",habilidades:ve.habilidades||""}))});const Te=[];for(let Ve=0;Ve<a.length;Ve++)for(let He=0;He<a[Ve].length;He++){const ve=a[Ve][He];Te.push({fila:Ve,col:He,asignatura:Pc(ve.asignatura),nivel:al(ve.nivel),seccion:Rc(ve.seccion)})}const yt=[];P.habilitado&&yt.push({hhmm:P.hora,durMin:P.minutos,label:"Recreo"}),L.habilitado&&yt.push({hhmm:L.hora,durMin:L.minutos,label:"Almuerzo"}),M.habilitado&&yt.push({hhmm:M.hora,durMin:M.minutos,label:"Recreo"});const xe=Array.isArray(s)&&s.length>1?s:ab,Ze=se(X,"usuarios",re);await xt(Ze,{horarioMatriz:pe,horarioSlots:Te,horarioConfig:{inicio:b,duracionMin:Number(y),cantidad:Number(S),bloquesGenerados:r,marcas:vO(xe),breaks:yt,calendario:{fechaInicio:_e,fechaFin:Ye,periodicidad:ie},updatedAt:ut()},horario:[],updatedAt:ut()},{merge:!0});const $e=[];for(let Ve=0;Ve<a.length;Ve++)for(let He=0;He<a[Ve].length;He++){const ve=a[Ve][He]||{};if(ve.asignatura||ve.unidad||ve.objetivo||ve.habilidades){const an=`${Ve}-${He}`;$e.push(xt(se(X,"clases_detalle",re,"slots",an),{unidad:ve.unidad||"",objetivo:ve.objetivo||"",habilidades:ve.habilidades||"",asignatura:ve.asignatura||"",nivel:ve.nivel||"",updatedAt:ut()},{merge:!0}))}}await Promise.all($e);try{await lb(re,{overwrite:!1})}catch(Ve){console.warn("syncSlotsFromHorario (post-save) error:",Ve)}u(!1),alert("âœ… Horario guardado correctamente en Firestore (incluye clases_detalle).");try{const Ve=a.map(He=>He.map(ve=>({...ve,asignatura:Pc(ve.asignatura),nivel:al(ve.nivel),seccion:Rc(ve.seccion)})));await IL(re,Ve)}catch(Ve){console.error("Error generando planificaciones sugeridas:",Ve)}const Ce=de();n(Ce?"/inicio":"/planificaciones")}catch(re){console.error("Error al guardar horario:",re),alert(`âŒ Error al guardar el horario:
code: ${re.code||"sin-code"}
message: ${re.message||"sin-message"}`)}},At=()=>{n("/inicio")},it=async()=>{var Y;try{let re=((Y=we.currentUser)==null?void 0:Y.uid)||(e==null?void 0:e.uid)||localStorage.getItem("uid")||null;re||(re=await E_()),localStorage.getItem("uid")!==re&&localStorage.setItem("uid",re);const pe={};a.forEach((Ce,Ve)=>{pe[`f${Ve}`]=Ce.map(He=>({asignatura:Pc(He.asignatura),nivel:al(He.nivel),seccion:Rc(He.seccion),unidad:He.unidad||"",objetivo:He.objetivo||"",habilidades:He.habilidades||""}))});const Te=[];for(let Ce=0;Ce<a.length;Ce++)for(let Ve=0;Ve<a[Ce].length;Ve++){const He=a[Ce][Ve];Te.push({fila:Ce,col:Ve,asignatura:Pc(He.asignatura),nivel:al(He.nivel),seccion:Rc(He.seccion)})}const yt=[];P.habilitado&&yt.push({hhmm:P.hora,durMin:P.minutos,label:"Recreo"}),L.habilitado&&yt.push({hhmm:L.hora,durMin:L.minutos,label:"Almuerzo"}),M.habilitado&&yt.push({hhmm:M.hora,durMin:M.minutos,label:"Recreo"});const xe=Array.isArray(s)&&s.length>1?s:ab,Ze=se(X,"usuarios",re);await xt(Ze,{horarioMatriz:pe,horarioSlots:Te,horarioConfig:{inicio:b,duracionMin:Number(y),cantidad:Number(S),bloquesGenerados:r,marcas:vO(xe),breaks:yt,calendario:{fechaInicio:_e,fechaFin:Ye,periodicidad:ie},updatedAt:ut()},horario:[],updatedAt:ut()},{merge:!0});const $e=[];for(let Ce=0;Ce<a.length;Ce++)for(let Ve=0;Ve<a[Ce].length;Ve++){const He=a[Ce][Ve]||{};if(He.asignatura||He.unidad||He.objetivo||He.habilidades){const ve=`${Ce}-${Ve}`;$e.push(xt(se(X,"clases_detalle",re,"slots",ve),{unidad:He.unidad||"",objetivo:He.objetivo||"",habilidades:He.habilidades||"",asignatura:He.asignatura||"",nivel:He.nivel||"",updatedAt:ut()},{merge:!0}))}}await Promise.all($e);try{await lb(re,{overwrite:!1})}catch(Ce){console.warn("syncSlotsFromHorario (post-save test) error:",Ce)}try{const Ce=a.map(Ve=>Ve.map(He=>({...He,asignatura:Pc(He.asignatura),nivel:al(He.nivel),seccion:Rc(He.seccion)})));IL(re,Ce).catch(console.error)}catch(Ce){console.error("Error generando planificaciones:",Ce)}n("/inicio")}catch(re){console.error("Error al guardar horario (Y PROBAR):",re),alert(`âŒ Error al guardar el horario:
code: ${re.code||"sin-code"}
message: ${re.message||"sin-message"}`)}},Nt={background:"#ffffff",border:"1px solid #e5e7eb",borderRadius:12,padding:"1rem",boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)",marginBottom:"1rem"},at={fontWeight:600,fontSize:".95rem"},bt={display:"flex",gap:"1rem",flexWrap:"wrap",alignItems:"center"},lt={padding:".5rem .75rem",borderRadius:8,border:"1px solid #d1d5db"},ft=Y=>({padding:".5rem .9rem",border:"none",borderRadius:8,color:"#fff",background:Y,cursor:"pointer"}),bi=()=>B?m.createElement("span",{style:{fontSize:12,fontWeight:800,color:"#2193b0",border:"1px solid #2193b0",borderRadius:999,padding:"2px 8px"}},"Seleccionada: ",B.unidad.nombre):m.createElement("span",{style:{fontSize:12,color:"#64748b"}},"Elige una unidad para pegarla en el horario"),Kt=de(),gn=Yle(n,{seleccion:B,unidadesUsuario:oe,horario:a});return m.createElement("div",{style:{padding:"2rem"}},m.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:10}},m.createElement("h2",null,"ðŸ—“ï¸ Horario Semanal"),Kt?m.createElement("button",{onClick:()=>n("/inicio"),style:ft("#ef4444")},"â–¶ï¸ Ir a Inicio de Clase (en curso)"):m.createElement("button",{onClick:gn,style:ft("#2563eb")},"ðŸ“š Ir a Planificaciones")),m.createElement("p",null,m.createElement("strong",null,"Unidad inicial registrada:")," ",h||"No registrada"),m.createElement("div",{style:Nt},m.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},m.createElement("h3",{style:{margin:0}},"ðŸ“š Unidades disponibles"),m.createElement(bi,null)),Z&&m.createElement("div",{style:{color:"#64748b"}},"Cargando unidadesâ€¦"),!Z&&kt.length===0&&m.createElement("div",{style:{color:"#64748b"}},"No hay unidades aÃºn. Ve a ",m.createElement("b",null,"Planificaciones"),", selecciona asignatura y marca unidades como ",m.createElement("i",null,"priorizadas")," o ",m.createElement("i",null,"seleccionadas"),".",m.createElement("div",{style:{marginTop:8}},m.createElement("button",{type:"button",onClick:gn,style:ft("#2563eb")},"ðŸ“š Ir a Planificaciones"))),m.createElement("div",{style:{display:"grid",gap:10}},kt.map(([Y,re])=>m.createElement("div",{key:Y,style:{borderTop:"1px dashed #e5e7eb",paddingTop:8}},m.createElement("div",{style:{fontWeight:800,marginBottom:6}},Y),m.createElement("div",{style:{display:"grid",gap:6,gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))"}},re.map(pe=>{var Te,yt;return m.createElement("button",{key:pe.unidad.id,type:"button",onClick:()=>G(pe),title:"Seleccionar unidad",style:{textAlign:"left",border:((Te=B==null?void 0:B.unidad)==null?void 0:Te.id)===pe.unidad.id&&(B==null?void 0:B.asignaturaId)===pe.asignaturaId?"2px solid #2193b0":"1px solid #e5e7eb",borderRadius:10,padding:"10px 12px",background:"#fff",cursor:"pointer"}},m.createElement("div",{style:{fontWeight:800}},pe.unidad.nombre),pe.estado&&m.createElement("div",{style:{fontSize:12,color:"#64748b"}},"Estado: ",pe.estado),((yt=pe.unidad.objetivos)==null?void 0:yt.length)>0&&m.createElement("div",{style:{fontSize:12,color:"#64748b",marginTop:4}},m.createElement("b",null,"Obj:")," ",pe.unidad.objetivos.join(" Â· ")))})))))),m.createElement("div",{style:Nt},m.createElement("h3",{style:{marginTop:0,marginBottom:".5rem"}},"ðŸ—ºï¸ Calendario & AutoplanificaciÃ³n"),m.createElement("div",{style:bt},m.createElement("div",null,m.createElement("div",{style:at},"Fecha de inicio"),m.createElement("input",{type:"date",value:_e,onChange:Y=>Qe(Y.target.value),style:lt})),m.createElement("div",null,m.createElement("div",{style:at},"Fecha de tÃ©rmino"),m.createElement("input",{type:"date",value:Ye,onChange:Y=>gt(Y.target.value),style:lt})),m.createElement("div",null,m.createElement("div",{style:at},"Periodicidad"),m.createElement("select",{value:ie,onChange:Y=>ot(Y.target.value),style:lt},m.createElement("option",{value:"anio"},"AÃ±o"),m.createElement("option",{value:"semestre"},"Semestre"),m.createElement("option",{value:"trimestre"},"Trimestre"),m.createElement("option",{value:"bimestre"},"Bimestre"),m.createElement("option",{value:"mensual"},"Mensual"),m.createElement("option",{value:"personalizado"},"Personalizado"))),m.createElement("div",null,m.createElement("div",{style:at},"Horas fallback por unidad"),m.createElement("input",{type:"number",min:1,value:et,onChange:Y=>ze(Number(Y.target.value)),style:{...lt,width:100}})),m.createElement("div",null,m.createElement("div",{style:at},"Horas evaluaciÃ³n por unidad"),m.createElement("input",{type:"number",min:0,value:tt,onChange:Y=>Xe(Number(Y.target.value)),style:{...lt,width:100}}))),m.createElement("div",{style:{marginTop:".75rem",display:"flex",gap:10,alignItems:"center"}},m.createElement("button",{type:"button",onClick:Ee,style:ft("#7c3aed")},"ðŸ§  Autoplanificar unidades"),Ct>0&&m.createElement(m.Fragment,null,m.createElement("span",{style:{color:"#475569"}},"Semanas generadas: ",m.createElement("b",null,Ct)),m.createElement("span",{style:{color:"#475569"}},"Â· Semana en vista:"),m.createElement("input",{type:"number",min:1,max:Math.max(1,Ct),value:Je,onChange:Y=>We(Number(Y.target.value)),style:{...lt,width:80}}),m.createElement("button",{type:"button",onClick:()=>We(Je-1),style:ft("#0ea5e9")},"â†"),m.createElement("button",{type:"button",onClick:()=>We(Je+1),style:ft("#0ea5e9")},"â†’"))),m.createElement("div",{style:{marginTop:8,color:"#64748b",fontSize:13}},"La tabla de abajo muestra una ",m.createElement("b",null,"previsualizaciÃ³n")," de la semana en vista. Puedes ajustar manualmente celdas especÃ­ficas con â€œðŸ“Œ Poner Unidad Seleccionadaâ€.")),m.createElement("div",{style:Nt},m.createElement("h3",{style:{marginTop:0,marginBottom:".5rem"}},"âš™ï¸ Asistente de configuraciÃ³n"),m.createElement("div",{style:bt},m.createElement("div",null,m.createElement("div",{style:at},"Inicio de jornada"),m.createElement("input",{type:"time",value:b,onChange:Y=>g(Y.target.value),style:lt})),m.createElement("div",null,m.createElement("div",{style:at},"DuraciÃ³n del bloque (min)"),m.createElement("div",{style:{display:"flex",gap:".5rem",alignItems:"center"}},m.createElement("input",{type:"number",min:30,max:120,value:y,onChange:Y=>x(Number(Y.target.value)),style:{...lt,width:90}}),m.createElement("button",{type:"button",onClick:()=>x(45),style:ft("#2563eb")},"45'"),m.createElement("button",{type:"button",onClick:()=>x(50),style:ft("#2563eb")},"50'"),m.createElement("button",{type:"button",onClick:()=>x(55),style:ft("#2563eb")},"55'"),m.createElement("button",{type:"button",onClick:()=>x(90),style:ft("#2563eb")},"90'"))),m.createElement("div",null,m.createElement("div",{style:at},"Bloques de clase (cantidad)"),m.createElement("input",{type:"number",min:1,max:30,value:S,onChange:Y=>I(Number(Y.target.value)),style:{...lt,width:90}}))),m.createElement("hr",{style:{margin:"1rem 0"}}),m.createElement("div",{style:bt},m.createElement("div",null,m.createElement("label",{style:{display:"flex",alignItems:"center",gap:".5rem"}},m.createElement("input",{type:"checkbox",checked:P.habilitado,onChange:Y=>N({...P,habilitado:Y.target.checked})}),"Recreo (maÃ±ana)"),m.createElement("div",{style:{display:"flex",gap:".5rem",marginTop:".25rem"}},m.createElement("input",{type:"time",value:P.hora,onChange:Y=>N({...P,hora:Y.target.value}),style:lt}),m.createElement("input",{type:"number",min:5,max:60,value:P.minutos,onChange:Y=>N({...P,minutos:Number(Y.target.value)}),style:{...lt,width:90}}),m.createElement("span",{style:{alignSelf:"center"}},"min"))),m.createElement("div",null,m.createElement("label",{style:{display:"flex",alignItems:"center",gap:".5rem"}},m.createElement("input",{type:"checkbox",checked:L.habilitado,onChange:Y=>j({...L,habilitado:Y.target.checked})}),"Almuerzo"),m.createElement("div",{style:{display:"flex",gap:".5rem",marginTop:".25rem"}},m.createElement("input",{type:"time",value:L.hora,onChange:Y=>j({...L,hora:Y.target.value}),style:lt}),m.createElement("input",{type:"number",min:15,max:120,value:L.minutos,onChange:Y=>j({...L,minutos:Number(Y.target.value)}),style:{...lt,width:90}}),m.createElement("span",{style:{alignSelf:"center"}},"min"))),m.createElement("div",null,m.createElement("label",{style:{display:"flex",alignItems:"center",gap:".5rem"}},m.createElement("input",{type:"checkbox",checked:M.habilitado,onChange:Y=>V({...M,habilitado:Y.target.checked})}),"Recreo (tarde)"),m.createElement("div",{style:{display:"flex",gap:".5rem",marginTop:".25rem"}},m.createElement("input",{type:"time",value:M.hora,onChange:Y=>V({...M,hora:Y.target.value}),style:lt}),m.createElement("input",{type:"number",min:5,max:60,value:M.minutos,onChange:Y=>V({...M,minutos:Number(Y.target.value)}),style:{...lt,width:90}}),m.createElement("span",{style:{alignSelf:"center"}},"min")))),m.createElement("div",{style:{marginTop:".75rem"}},m.createElement("button",{type:"button",onClick:Bt,style:ft("#059669")},"Aplicar estructura"))),E&&m.createElement("div",{style:{background:"#f0f0f0",padding:"1rem",margin:"1rem 0"}},m.createElement("h4",null,"ðŸ“˜ OA del Ministerio:"),m.createElement("p",null,m.createElement("strong",null,E.codigo),": ",E.descripcion)),T&&m.createElement("div",{style:{marginBottom:"1rem"}},m.createElement("h4",null,"ðŸ“š Contenido Wikipedia:"),m.createElement("iframe",{src:T,width:"100%",height:"400",title:"Contenido Wikipedia",style:{border:"1px solid #ccc",borderRadius:"8px"}})),m.createElement("h4",null,"ðŸ“… PrÃ³ximos Feriados Oficiales en Chile:"),m.createElement("ul",null,v.map((Y,re)=>m.createElement("li",{key:re},Y.date,": ",Y.localName))),m.createElement("table",{border:"1",cellPadding:"5",style:{width:"100%",borderCollapse:"collapse"}},m.createElement("thead",null,m.createElement("tr",null,m.createElement("th",null,"Bloque"),vd.map((Y,re)=>m.createElement("th",{key:re},Y)))),m.createElement("tbody",null,r.map((Y,re)=>m.createElement("tr",{key:re},m.createElement("td",null,Y),vd.map((pe,Te)=>{var $e;const yt=Y.includes("Recreo")||Y.includes("Almuerzo"),xe=(($e=a[re])==null?void 0:$e[Te])||{},Ze=!!(Kt&&Kt.fila===re&&Kt.col===Te);return m.createElement("td",{key:Te,style:Ze?{outline:"2px solid #16a34a",outlineOffset:2,borderRadius:6}:void 0},yt?m.createElement("strong",null,Y):c?m.createElement("div",null,m.createElement("select",{value:xe.asignatura||"",onChange:Ce=>W(re,Te,"asignatura",Ce.target.value)},m.createElement("option",{value:""},"Asignatura"),jle.map(Ce=>m.createElement("option",{key:Ce,value:Ce},Ce))),m.createElement("select",{value:xe.nivel||"",onChange:Ce=>W(re,Te,"nivel",Ce.target.value)},m.createElement("option",{value:""},"Nivel"),zle.map(Ce=>m.createElement("option",{key:Ce,value:Ce},Ce))),m.createElement("select",{value:xe.seccion||"",onChange:Ce=>W(re,Te,"seccion",Ce.target.value)},m.createElement("option",{value:""},"SecciÃ³n"),Hle.map(Ce=>m.createElement("option",{key:Ce,value:Ce},Ce))),m.createElement("div",{style:{marginTop:6}},m.createElement("button",{type:"button",onClick:()=>z(re,Te),disabled:!B,style:{padding:".25rem .5rem",borderRadius:6,border:"1px solid #e5e7eb",background:"#fff",cursor:B?"pointer":"not-allowed"},title:B?"Colocar la unidad seleccionada en esta celda":"Elige primero una unidad en el panel superior"},"ðŸ“Œ Poner Unidad Seleccionada"),xe.unidad&&m.createElement("div",{style:{fontSize:12,color:"#64748b",marginTop:4}},m.createElement("b",null,"Unidad:")," ",xe.unidad)),m.createElement(Xle,{fila:re,columna:Te,asignatura:xe.asignatura,nivel:xe.nivel,seccion:xe.seccion,unidadesUsuario:oe,actualizarCelda:W,onSaved:()=>{}})):m.createElement("div",{style:{backgroundColor:yO.includes(xe.asignatura)?"#fff3cd":"transparent",padding:"0.5rem",borderRadius:"5px"}},m.createElement("div",null,m.createElement("strong",null,xe.asignatura)),m.createElement("div",null,xe.nivel," ",xe.seccion),xe.unidad&&m.createElement("div",{style:{fontSize:12,color:"#64748b"}},m.createElement("b",null,"Unidad:")," ",xe.unidad)))}))))),c&&m.createElement("div",{style:{marginTop:"1rem"}},m.createElement("button",{onClick:nt,disabled:!we.currentUser,style:{padding:"0.5rem 1rem",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"5px",marginRight:"1rem",opacity:we.currentUser?1:.6}},we.currentUser?"Guardar Horario":"Conectando..."),m.createElement("button",{onClick:At,style:{padding:"0.5rem 1rem",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"5px"}},"ðŸ” Probar InicioClase"),m.createElement("button",{onClick:it,style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"5px",marginLeft:"1rem"}},"ðŸ’¾ Guardar y Probar InicioClase")))},wO=["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes"],Cn={page:{padding:"2rem",fontFamily:"Segoe UI, sans-serif"},tabs:{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"},tab:n=>({borderRadius:10,padding:"8px 12px",cursor:"pointer",border:`1px solid ${n?"#2193b0":"#e5e7eb"}`,color:n?"#2193b0":"#475569",background:n?"rgba(33,147,176,.08)":"#fff",fontWeight:800}),row2:{display:"grid",gridTemplateColumns:"1fr 1fr auto auto",gap:10,alignItems:"end",margin:"14px 0"},card:{background:"#fff",color:"#0f172a",border:"1px solid #e5e7eb",borderRadius:12,boxShadow:"0 6px 18px rgba(16,24,40,.06)",padding:12},btnPrimary:{background:"#2193b0",color:"#fff",border:"none",borderRadius:10,padding:"10px 16px",fontWeight:800,cursor:"pointer"},btnGhost:{background:"transparent",color:"#2193b0",border:"2px solid #2193b0",borderRadius:10,padding:"10px 16px",fontWeight:800,cursor:"pointer"},chip:n=>({borderRadius:999,padding:"6px 10px",fontSize:12,fontWeight:700,cursor:"pointer",border:`1px solid ${n?"#2193b0":"#e5e7eb"}`,color:n?"#2193b0":"#475569",background:n?"rgba(33,147,176,.08)":"#fff"}),pills:{display:"flex",flexWrap:"wrap",gap:8,marginTop:6},pill:{border:"1px solid #e5e7eb",borderRadius:999,padding:"4px 10px",fontSize:12,background:"#f8fafc",color:"#0f172a"}};function Zle(){const{plan:n="FREE",caps:e=mi.FREE,loading:t=!1}=D.useContext(Af)||{},[r,i]=D.useState(null),[s,o]=D.useState("catalogo"),[a,l]=D.useState([]),[c,u]=D.useState(!0),h=jj(),[f,v]=D.useState([]),[w,E]=D.useState([]),[A,T]=D.useState(""),[_,b]=D.useState(""),[g,y]=D.useState([]),[x,S]=D.useState({}),[I,P]=D.useState(null),[N,M]=D.useState(!1),[V]=ck();D.useEffect(()=>{if(A)return;const ie=V.get("asig"),ot=localStorage.getItem("selAsignatura"),et=(ie||ot||"").trim();et&&T(et)},[V,A]),D.useEffect(()=>{A&&localStorage.setItem("selAsignatura",A)},[A]),D.useEffect(()=>{const ie=ls(we,ot=>i(ot));return we.currentUser||mo(we).catch(console.error),()=>ie()},[]),D.useEffect(()=>{r!=null&&r.uid&&(async()=>{u(!0);try{const ie=await zj(r.uid,h),ot=["08:00 - 08:45","08:45 - 09:30","09:30 - 09:50 (Recreo)","09:50 - 10:35","10:35 - 11:20","11:20 - 11:30 (Recreo)","11:30 - 12:15","12:15 - 13:00","13:00 - 13:45 (Almuerzo)","13:45 - 14:30","14:30 - 15:15","15:15 - 15:30 (Recreo)","15:30 - 16:15","16:15 - 17:00","17:00 - 17:45","17:45 - 18:30"],et=["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes"],ze=ie.map(tt=>{const Xe=tt.bloqueIdx??tt.horaIndex??0,Je=tt.diaIndex??et.indexOf(tt.dia??""),dt=Je>=0&&Je<et.length?et[Je]:tt.dia||"",Ct=ot[Xe]||tt.bloqueLabel||`Bloque ${Xe}`;return{...tt,bloqueIdx:Xe,dia:dt,bloqueLabel:Ct}});ze.sort((tt,Xe)=>{const Je=wO.indexOf(tt.dia||""),dt=wO.indexOf(Xe.dia||"");return Je!==dt?Je-dt:(tt.bloqueIdx??0)-(Xe.bloqueIdx??0)}),l(ze)}catch(ie){console.error("getPlanificacionesSugeridas error:",ie),alert(`âŒ No se pudieron cargar las planificaciones:
code: ${ie.code||"sin-code"}
message: ${ie.message||"sin-message"}`)}finally{u(!1)}})()},[r,h]),D.useEffect(()=>{(async()=>{try{const ot=(await $n(tn(X,"catalogo_curricular"))).docs.map(et=>({id:et.id,...et.data()||{}}));v(ot.sort((et,ze)=>(et.nombre||et.id).localeCompare(ze.nombre||ze.id)))}catch{}})()},[]),D.useEffect(()=>{if(!A){E([]),b(""),y([]),S({}),P(null);return}(async()=>{var ze;const ie=tn(X,"catalogo_curricular",A,"niveles"),et=(await $n(ie)).docs.map(tt=>({id:tt.id}));E(et.sort((tt,Xe)=>tt.id.localeCompare(Xe.id))),et.find(tt=>tt.id===_)||b(((ze=et[0])==null?void 0:ze.id)||"")})()},[A]),D.useEffect(()=>{if(!A||!_){y([]),S({}),P(null);return}(async()=>{var ie;try{const ot=tn(X,"catalogo_curricular",A,"niveles",_,"unidades"),ze=(await $n(ot)).docs.map(tt=>({id:tt.id,...tt.data()||{}})).sort((tt,Xe)=>(tt.orden||0)-(Xe.orden||0));if(y(ze),r!=null&&r.uid){const tt=se(X,"usuarios",r.uid,"planificacion_usuario",`${A}_${_}`),Xe=await Fe(tt);S(Xe.exists()?((ie=Xe.data())==null?void 0:ie.unidades)||{}:{})}}catch{}})()},[A,_,r]),D.useEffect(()=>{!A||!_||(async()=>{M(!0);try{const ie=se(X,"catalogo_curricular",A,"niveles",_,"metadatos","habilidades_actitudes"),ot=await Fe(ie);P(ot.exists()&&ot.data()||null)}catch{P(null)}finally{M(!1)}})()},[A,_]);const L=async()=>{if(!(r!=null&&r.uid)||!A||!_){alert("Falta usuario/asignatura/nivel.");return}const ie=se(X,"usuarios",r.uid,"planificacion_usuario",`${A}_${_}`);await xt(ie,{asignaturaId:A,nivelId:_,unidades:x,updatedAt:ut()},{merge:!0}),alert("âœ… PlanificaciÃ³n guardada")};if(D.useEffect(()=>{if(s!=="explorar")return;new URLSearchParams(window.location.search).get("autoSeed")==="2"&&seedMat2().catch(()=>{})},[s]),s==="sugeridas"&&c)return m.createElement("div",{style:{padding:"2rem"}},"Cargando planificacionesâ€¦");if(s==="sugeridas"&&!a.length)return m.createElement("div",{style:Cn.page},m.createElement("div",{style:Cn.tabs},m.createElement("button",{style:Cn.tab(s==="catalogo"),onClick:()=>o("catalogo")},"CatÃ¡logo"),m.createElement("button",{style:Cn.tab(s==="sugeridas"),onClick:()=>o("sugeridas")},"Sugeridas")),m.createElement("h2",null,"Planificaciones sugeridas"),m.createElement("p",null,"No hay sugerencias para ",h,"."),m.createElement("div",{style:{marginTop:8}},m.createElement("a",{href:"/horario",style:{textDecoration:"none"}},m.createElement("button",{style:Cn.btnPrimary},"ðŸ—“ï¸ Ir a configurar Horario"))));const j=async(ie,ot,et,ze)=>{const tt=se(X,"catalogo_curricular",ie,"niveles",ot,"unidades",ze.id);await xt(tt,{nombre:ze.nombre,objetivos:ze.objetivos,habilidades:ze.habilidades||[],horasSugeridas:ze.horasSugeridas||8,orden:et+1,updatedAt:ut()},{merge:!0})},oe=async(ie,ot)=>{const et=se(X,"catalogo_curricular",ie,"niveles",ot,"metadatos","habilidades_actitudes");await xt(et,{habilidades:["Pensamiento crÃ­tico","ComunicaciÃ³n","ColaboraciÃ³n"],actitudes:["Respeto","Responsabilidad","AutonomÃ­a"],updatedAt:ut()},{merge:!0})},$=async(ie,ot)=>{await xt(se(X,"catalogo_curricular",ie),{nombre:ot,updatedAt:ut()},{merge:!0})},B=async(ie,ot,et)=>{await xt(se(X,"catalogo_curricular",ie,"niveles",ot),{nombre:et,updatedAt:ut()},{merge:!0})},G=async(ie,ot,et)=>{await $(ie,ot);for(const[ze,{unidades:tt}]of Object.entries(et)){await B(ie,ze,ze==="1M"?"1Â° Medio":"2Â° Medio"),await oe(ie,ze);for(let Xe=0;Xe<tt.length;Xe++)await j(ie,ze,Xe,tt[Xe])}},Z={matematica:{nombre:"MatemÃ¡tica",niveles:{"1M":{unidades:[{id:"U1",nombre:"NÃºmeros racionales y porcentajes",objetivos:["Resuelve problemas con fracciones, decimales y porcentajes","Aplica proporcionalidad en contextos cotidianos"],habilidades:["Razonamiento","ModelaciÃ³n","ResoluciÃ³n de problemas"],horasSugeridas:10},{id:"U2",nombre:"Ãlgebra bÃ¡sica y ecuaciones lineales",objetivos:["Simplifica expresiones algebraicas","Resuelve ecuaciones lineales de una variable"],habilidades:["RepresentaciÃ³n","ComunicaciÃ³n matemÃ¡tica"],horasSugeridas:10}]},"2M":{unidades:[{id:"U1",nombre:"Funciones lineales y afines",objetivos:["Modela situaciones con funciones lineales","Interpreta pendiente y ordenada al origen"],habilidades:["AnÃ¡lisis","ModelaciÃ³n"],horasSugeridas:10},{id:"U2",nombre:"GeometrÃ­a: semejanza y trigonometrÃ­a bÃ¡sica",objetivos:["Aplica razones trigonomÃ©tricas en triÃ¡ngulos rectÃ¡ngulos","Resuelve problemas de longitudes y Ã¡ngulos"],habilidades:["Razonamiento espacial"],horasSugeridas:10}]}}},lenguaje:{nombre:"Lenguaje",niveles:{"1M":{unidades:[{id:"U1",nombre:"ComprensiÃ³n lectora y estrategias",objetivos:["Analiza textos narrativos identificando tema e ideas principales","Utiliza estrategias de inferencia y predicciÃ³n"],habilidades:["ComprensiÃ³n lectora","AnÃ¡lisis textual"],horasSugeridas:8},{id:"U2",nombre:"ProducciÃ³n de textos argumentativos",objetivos:["Escribe textos argumentativos breves con tesis y evidencias","Usa conectores para la coherencia"],habilidades:["Escritura","Coherencia y cohesiÃ³n"],horasSugeridas:8}]},"2M":{unidades:[{id:"U1",nombre:"Literatura: gÃ©neros y movimiento",objetivos:["Reconoce rasgos de gÃ©neros literarios","Relaciona obras con su contexto"],habilidades:["InterpretaciÃ³n","Pensamiento crÃ­tico"],horasSugeridas:8},{id:"U2",nombre:"ComunicaciÃ³n oral: debates",objetivos:["Participa en debates con respeto a turnos y evidencias","EvalÃºa argumentos de sus pares"],habilidades:["ComunicaciÃ³n oral","ColaboraciÃ³n"],horasSugeridas:8}]}}},fisica:{nombre:"FÃ­sica",niveles:{"1M":{unidades:[{id:"U1",nombre:"CinemÃ¡tica: MRU y MRUA",objetivos:["Describe el movimiento con grÃ¡ficas xâ€“t y vâ€“t","Resuelve problemas de MRU y MRUA"],habilidades:["ModelaciÃ³n","AnÃ¡lisis de datos"],horasSugeridas:10},{id:"U2",nombre:"Fuerzas y leyes de Newton",objetivos:["Aplica la segunda ley de Newton en sistemas simples","Analiza diagramas de cuerpo libre"],habilidades:["Razonamiento cientÃ­fico"],horasSugeridas:10}]},"2M":{unidades:[{id:"U1",nombre:"Trabajo, energÃ­a y potencia",objetivos:["Relaciona trabajo y cambio de energÃ­a","Calcula potencia en situaciones cotidianas"],habilidades:["InterpretaciÃ³n fÃ­sica","CÃ¡lculo"],horasSugeridas:10},{id:"U2",nombre:"Impulso y cantidad de movimiento",objetivos:["Aplica conservaciÃ³n del momento lineal","Analiza colisiones 1D"],habilidades:["ModelaciÃ³n","ResoluciÃ³n de problemas"],horasSugeridas:10}]}}},quimica:{nombre:"QuÃ­mica",niveles:{"1M":{unidades:[{id:"U1",nombre:"Estructura atÃ³mica y tabla periÃ³dica",objetivos:["Explica modelos atÃ³micos y configuraciones electrÃ³nicas","Relaciona propiedades periÃ³dicas con estructura"],habilidades:["ArgumentaciÃ³n","AnÃ¡lisis"],horasSugeridas:8},{id:"U2",nombre:"Enlaces quÃ­micos y propiedades",objetivos:["Diferencia enlaces iÃ³nico, covalente y metÃ¡lico","Predice propiedades a partir del enlace"],habilidades:["ModelaciÃ³n quÃ­mica"],horasSugeridas:8}]},"2M":{unidades:[{id:"U1",nombre:"EstequiometrÃ­a",objetivos:["Balancea ecuaciones quÃ­micas","Resuelve cÃ¡lculos estequiomÃ©tricos simples"],habilidades:["CÃ¡lculo quÃ­mico"],horasSugeridas:10},{id:"U2",nombre:"Soluciones y concentraciones",objetivos:["Prepara soluciones de concentraciÃ³n dada","Aplica M, %m/m, %m/v en problemas"],habilidades:["Manejo experimental"],horasSugeridas:8}]}}},historia:{nombre:"Historia",niveles:{"1M":{unidades:[{id:"U1",nombre:"Mundo medieval y orÃ­genes de la modernidad",objetivos:["Caracteriza transformaciones polÃ­ticas y sociales","Relaciona renacimiento y cambios culturales"],habilidades:["AnÃ¡lisis histÃ³rico","Uso de fuentes"],horasSugeridas:8},{id:"U2",nombre:"FormaciÃ³n del Estado nacional en Chile",objetivos:["Reconoce hitos del siglo XIX en Chile","Analiza tensiones y consensos del periodo"],habilidades:["Pensamiento crÃ­tico"],horasSugeridas:8}]},"2M":{unidades:[{id:"U1",nombre:"Chile y el mundo en el siglo XX",objetivos:["Explica procesos globales y sus impactos en Chile","Contrasta distintas interpretaciones histÃ³ricas"],habilidades:["ArgumentaciÃ³n histÃ³rica"],horasSugeridas:10},{id:"U2",nombre:"CiudadanÃ­a y derechos humanos",objetivos:["Reconoce la evoluciÃ³n de los DD.HH.","Valora la participaciÃ³n democrÃ¡tica"],habilidades:["CiudadanÃ­a","Ã‰tica"],horasSugeridas:8}]}}},ingles:{nombre:"InglÃ©s",niveles:{"1M":{unidades:[{id:"U1",nombre:"Reading & Vocabulary: Daily Life",objetivos:["Understands short texts about routines and hobbies","Identifies main ideas and specific details"],habilidades:["Reading","Vocabulary building"],horasSugeridas:8},{id:"U2",nombre:"Writing & Speaking: Personal Experiences",objetivos:["Writes short paragraphs in past tense","Engages in simple conversations about experiences"],habilidades:["Writing","Speaking"],horasSugeridas:8}]},"2M":{unidades:[{id:"U1",nombre:"Listening & Grammar: Present Perfect",objetivos:["Recognizes use of present perfect in context","Understands gist and details in short audio"],habilidades:["Listening","Grammar"],horasSugeridas:8},{id:"U2",nombre:"Project: Describing My City",objetivos:["Produces a multimodal description of a city","Collaborates to create a short presentation"],habilidades:["Project work","Collaboration"],horasSugeridas:8}]}}}},ee=async()=>{await G("lenguaje",Z.lenguaje.nombre,Z.lenguaje.niveles),alert("âœ… Lenguaje 1Â° y 2Â° cargado")},fe=async()=>{await G("matematica",Z.matematica.nombre,Z.matematica.niveles),alert("âœ… MatemÃ¡tica 1Â° y 2Â° cargado")},ae=async()=>{await G("fisica",Z.fisica.nombre,Z.fisica.niveles),alert("âœ… FÃ­sica 1Â° y 2Â° cargado")},_e=async()=>{await G("quimica",Z.quimica.nombre,Z.quimica.niveles),alert("âœ… QuÃ­mica 1Â° y 2Â° cargado")},Qe=async()=>{await G("historia",Z.historia.nombre,Z.historia.niveles),alert("âœ… Historia 1Â° y 2Â° cargado")},Ye=async()=>{await G("ingles",Z.ingles.nombre,Z.ingles.niveles),alert("âœ… InglÃ©s 1Â° y 2Â° cargado")},gt=async()=>{try{await fe(),await ee(),await ae(),await _e(),await Qe(),await Ye(),alert("ðŸŽ‰ CatÃ¡logo DEMO (1Â° y 2Â°) de 6 asignaturas cargado")}catch(ie){console.error(ie),alert("âŒ Error al cargar el catÃ¡logo demo. Revisa la consola.")}};return m.createElement("div",{style:Cn.page},m.createElement("div",{style:Cn.tabs},m.createElement("button",{style:Cn.tab(s==="catalogo"),onClick:()=>o("catalogo")},"CatÃ¡logo"),m.createElement("button",{style:Cn.tab(s==="sugeridas"),onClick:()=>o("sugeridas")},"Sugeridas"),m.createElement("button",{style:Cn.tab(s==="explorar"),onClick:()=>o("explorar")},"Explorar Base Curricular")),s==="catalogo"&&m.createElement(m.Fragment,null,m.createElement("h2",null,"Planificaciones â€” CatÃ¡logo"),m.createElement("p",null,"Selecciona tus unidades (Priorizada, Seleccionada o Hecha). Luego continÃºa a editar tu horario."),m.createElement("div",{style:Cn.row2},m.createElement("div",{style:Cn.card},m.createElement("label",{style:{fontWeight:700,fontSize:12,color:"#475569"}},"Asignatura"),m.createElement("select",{value:A,onChange:ie=>T(ie.target.value),style:{width:"100%",marginTop:6,padding:"8px 10px",borderRadius:8,border:"1px solid #e5e7eb"}},m.createElement("option",{value:""},"â€” Selecciona â€”"),f.map(ie=>m.createElement("option",{key:ie.id,value:ie.id},ie.nombre||ie.id)))),m.createElement("div",{style:Cn.card},m.createElement("label",{style:{fontWeight:700,fontSize:12,color:"#475569"}},"Nivel/Curso"),m.createElement("select",{value:_,onChange:ie=>b(ie.target.value),style:{width:"100%",marginTop:6,padding:"8px 10px",borderRadius:8,border:"1px solid #e5e7eb"}},m.createElement("option",{value:""},"â€” Selecciona â€”"),w.map(ie=>m.createElement("option",{key:ie.id,value:ie.id},ie.id)))),m.createElement("button",{style:Cn.btnPrimary,onClick:L},"ðŸ’¾ Guardar"),m.createElement("a",{href:"/horario",style:{textDecoration:"none"}},m.createElement("button",{style:Cn.btnGhost},"ðŸ—“ï¸ Continuar a editar horario")))),s==="explorar"&&m.createElement(m.Fragment,null,m.createElement("h2",null,"Explorar Base Curricular"),m.createElement("p",{style:{color:"#475569"}},"Desde aquÃ­ puedes cargar/actualizar el ",m.createElement("b",null,"CatÃ¡logo Curricular")," en Firestore. Puedes cargar ",m.createElement("b",null,"1Â° Medio (demo)")," para pruebas rÃ¡pidas, o ",m.createElement("b",null,"1Â° Medio (completo)")," para el flujo real, ademÃ¡s de 2Â°, 3Â° y 4Â° completos."),m.createElement("div",{style:{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fit,minmax(260px,1fr))",marginTop:16}},m.createElement("div",{style:Cn.card},m.createElement("h3",{style:{marginTop:0}},"âš¡ Cargar DEMO (1Â° y 2Â°)"),m.createElement("p",{style:{color:"#475569",marginTop:6}},"Inserta ",m.createElement("b",null,"MatemÃ¡tica, Lenguaje, FÃ­sica, QuÃ­mica, Historia e InglÃ©s")," con 2 unidades por nivel (1M y 2M), incluyendo objetivos, habilidades y metadatos bÃ¡sicos."),m.createElement("button",{style:Cn.btnPrimary,onClick:gt},"ðŸš€ Cargar 6 asignaturas (1M+2M)")),m.createElement("div",{style:Cn.card},m.createElement("h4",{style:{marginTop:0}},"Semillas por asignatura"),m.createElement("div",{style:{display:"grid",gap:8}},m.createElement("button",{style:Cn.btnGhost,onClick:fe},"âž• MatemÃ¡tica 1Mâ€“2M"),m.createElement("button",{style:Cn.btnGhost,onClick:ee},"âž• Lenguaje 1Mâ€“2M"),m.createElement("button",{style:Cn.btnGhost,onClick:ae},"âž• FÃ­sica 1Mâ€“2M"),m.createElement("button",{style:Cn.btnGhost,onClick:_e},"âž• QuÃ­mica 1Mâ€“2M"),m.createElement("button",{style:Cn.btnGhost,onClick:Qe},"âž• Historia 1Mâ€“2M"),m.createElement("button",{style:Cn.btnGhost,onClick:Ye},"âž• InglÃ©s 1Mâ€“2M")))),m.createElement("div",{style:{marginTop:12,color:"#475569"}},"Luego ve a la pestaÃ±a ",m.createElement("b",null,"CatÃ¡logo"),", elige ",m.createElement("b",null,A||"tu asignatura")," y el nivel para ver y marcar unidades.")))}const ece=7,BT=24*60*60*1e3;function T6(){const[n,e]=D.useState({loading:!0,isTrial:!1,isPaid:!1,isExpired:!1,remainingDays:null,remainingHours:null,blocked:!1,planType:null,expireAt:null});return D.useEffect(()=>{let t;return(async()=>{var o;const i=((o=we.currentUser)==null?void 0:o.uid)||localStorage.getItem("uid");if(!i){e(a=>({...a,loading:!1}));return}const s=se(X,"usuarios",i);t=fa(s,a=>{var T,_,b,g,y,x;const l=a.data()||{},c=!!l.pagoRealizado,u=l.planType||(c?"paid":"trial"),h=((_=(T=l.trialStart)==null?void 0:T.toDate)==null?void 0:_.call(T))||((g=(b=l.fechaInicioPrueba)==null?void 0:b.toDate)==null?void 0:g.call(b))||((x=(y=l.createdAt)==null?void 0:y.toDate)==null?void 0:x.call(y))||null;let f=null;h&&(f=new Date(h.getTime()+ece*BT));const v=new Date,w=!c&&!!f&&v>f;let E=null,A=null;if(!c&&f&&v<=f){const S=f.getTime()-v.getTime();E=Math.floor(S/BT),A=Math.ceil(S%BT/(60*60*1e3))}e({loading:!1,isTrial:!c,isPaid:c,isExpired:w,remainingDays:E,remainingHours:A,blocked:!c&&w,planType:u,expireAt:f})})})(),()=>t&&t()},[]),n}function $f(n){const{show:e,data:t}=n;if(!e)return null;const r=(i,s)=>m.createElement("div",{key:i,style:{display:"flex",justifyContent:"space-between",gap:12}},m.createElement("span",{style:{opacity:.7}},i),m.createElement("b",{style:{fontVariantNumeric:"tabular-nums"}},String(s)));return m.createElement("div",{style:{position:"fixed",right:12,bottom:12,zIndex:9999,background:"#0b1020",color:"#e8eefc",padding:"10px 12px",borderRadius:10,boxShadow:"0 8px 24px rgba(0,0,0,.35)",width:250,fontFamily:"Segoe UI, system-ui, sans-serif",fontSize:12,lineHeight:1.25}},m.createElement("div",{style:{fontWeight:800,marginBottom:6,letterSpacing:.2}},"PlanGuard Â· debug"),m.createElement("div",{style:{display:"grid",gap:4}},Object.entries(t).map(([i,s])=>r(i,s))))}class cb extends m.Component{constructor(e){super(e),this.state={hasError:!1,err:null}}static getDerivedStateFromError(e){return{hasError:!0,err:e}}componentDidCatch(e){console.error("[PlanGuard child error]",e)}render(){return this.state.hasError?m.createElement("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(to right,#2193b0,#6dd5ed)",fontFamily:"Segoe UI, sans-serif"}},m.createElement("div",{style:{background:"#fff",color:"#0f172a",padding:"18px 20px",borderRadius:12,border:"1px solid #e5e7eb",boxShadow:"0 8px 24px rgba(0,0,0,.12)"}},m.createElement("div",{style:{fontWeight:800,marginBottom:6}},"OcurriÃ³ un error al renderizar la pantalla"),m.createElement("div",{style:{fontSize:12,opacity:.8,maxWidth:420}},"Esto evita la pantalla en blanco. Puedes recargar o volver al login."),m.createElement("div",{style:{marginTop:10,display:"flex",gap:8}},m.createElement("button",{onClick:()=>window.location.reload(),style:{padding:"6px 10px",borderRadius:8,border:"1px solid #d1d5db",cursor:"pointer"}},"ðŸ”„ Recargar"),m.createElement("a",{href:"/login",style:{padding:"6px 10px",borderRadius:8,border:"1px solid #d1d5db",textDecoration:"none"}},"ðŸ” Ir a login")))):this.props.children}}function tce({children:n,allowDuringTrial:e=!0}){const[t,r]=D.useState(!1),[i,s]=D.useState(!0),[o,a]=D.useState(null),[l,c]=D.useState(!1),{user:u=null,plan:h="FREE",caps:f=mi.FREE,loading:v=!1}=D.useContext(Af)||{user:null,plan:"FREE",caps:mi.FREE,loading:!1},{loading:w,isPaid:E,isExpired:A,blocked:T}=T6(),_=Hs(),b=_.pathname==="/login"||_.pathname==="/registro";let g=!1;try{g=new URLSearchParams(_.search).get("debug")==="1"}catch{}const[y,x]=D.useState(null),[S,I]=D.useState(null);D.useEffect(()=>{let $=!1;return(async()=>{var B;try{if(!o||o.isAnonymous){x(null),I(null);return}const G=se(X,"users",o.uid,"meta","limits"),Z=await Fe(G);if(!Z.exists()){x(null),I(null);return}const ee=Z.data()||{},fe=(B=ee==null?void 0:ee.period)==null?void 0:B.end,ae=fe!=null&&fe.toDate?fe.toDate():fe?new Date(fe):null;$||(x(ae),I((ee==null?void 0:ee.plan)||null))}catch(G){console.warn("[PlanGuard] no se pudo leer users/{uid}/meta/limits:",(G==null?void 0:G.message)||G)}})(),()=>{$=!0}},[o==null?void 0:o.uid,o==null?void 0:o.isAnonymous]);const P=y?Date.now()>y.getTime():!1,N=!!(A||P),M=!!(T||P);D.useEffect(()=>{if(!y)return;const $=y.getTime()-Date.now();if($<=0)return;const B=setTimeout(()=>{try{window.location.reload()}catch{}},$+1e3);return()=>clearTimeout(B)},[y]),D.useEffect(()=>{const $=ls(we,B=>{a(B||null);const G=!B||B.isAnonymous,Z=new Date().toISOString().slice(0,10),fe=localStorage.getItem("lastTeacherLoginDay")===Z,ae=sessionStorage.getItem("teacher.session.ok")==="1",_e=!fe,Qe=!ae;if(B&&!B.isAnonymous&&(_e||Qe)){try{localStorage.setItem("lastTeacherLoginDay",Z)}catch{}try{sessionStorage.setItem("teacher.session.ok","1")}catch{}s(!1),r(!0);return}s(G||_e||Qe),r(!0)});return()=>$()},[]),D.useEffect(()=>{if(t&&o&&!o.isAnonymous&&i){const $=setTimeout(()=>c(!0),2e3);return()=>clearTimeout($)}},[t,o,i]);let V=null;try{V=localStorage.getItem("nextAfterOnboard")||null}catch{}const j=["/planificaciones","/horario"].includes(_.pathname)||_.pathname.startsWith("/pago");D.useEffect(()=>{try{V==="/pago"&&!N&&E&&localStorage.removeItem("nextAfterOnboard")}catch{}},[V,E,N]);const oe={path:_.pathname,authReady:t,hasUser:!!o,isAnon:(o==null?void 0:o.isAnonymous)??null,mustLogin:i,watchdogOpen:l,planLoading:w,planCtxLoading:v,isPaid:E,isExpired:A,expiredByEnd:P,blocked:T,blockedFinal:M,limitsEndISO:y?y.toISOString():null,limitsPlan:S,nextAfter:V};try{window.__PG=oe}catch{}if(!t)return m.createElement(m.Fragment,null,m.createElement($f,{show:g,data:oe}),m.createElement("div",{style:{padding:24}},"Verificando sesiÃ³n y suscripciÃ³nâ€¦"));try{if(new URLSearchParams(_.search).get("bypass")==="1")return m.createElement(m.Fragment,null,m.createElement($f,{show:g,data:oe}),m.createElement(cb,null,n))}catch{}if(b)return m.createElement(m.Fragment,null,m.createElement($f,{show:g,data:oe}),m.createElement(cb,null,n));if(l)return m.createElement(m.Fragment,null,m.createElement($f,{show:g,data:oe}),m.createElement(cb,null,n));if(i){const $=`${_.pathname}${_.search||""}`;return m.createElement(Tu,{to:`/login?next=${encodeURIComponent($)}`,replace:!0})}return V==="/pago"&&!b&&!j?m.createElement(Tu,{to:"/pago",replace:!0,state:{from:_.pathname,reason:"onboard-next"}}):w||v?m.createElement(m.Fragment,null,m.createElement($f,{show:g,data:oe}),m.createElement("div",{style:{padding:24}},"Verificando suscripciÃ³nâ€¦")):M&&!b?m.createElement(Tu,{to:"/pago",replace:!0,state:{from:_.pathname,reason:"expired"}}):E||e&&!N?m.createElement(m.Fragment,null,m.createElement($f,{show:g,data:oe}),m.createElement(cb,null,n)):m.createElement(Tu,{to:"/pago",replace:!0,state:{from:_.pathname,reason:"not-allowed"}})}const nce={maxWidth:720,margin:"24px auto",padding:16,border:"1px solid #e5e7eb",borderRadius:12,background:"#fff",fontFamily:"Segoe UI, sans-serif"};function rce(){const[n,e]=D.useState({nombre:"",region:"",asignatura:""}),[t,r]=D.useState(""),{loading:i,plan:s,billingStatus:o,isTrial:a,isExpired:l,remainingDays:c,remainingHours:u}=T6();D.useEffect(()=>{(async()=>{var E;const v=((E=we.currentUser)==null?void 0:E.uid)||localStorage.getItem("uid");if(!v)return;const w=await Fe(se(X,"usuarios",v));if(w.exists()){const A=w.data();e({nombre:A.nombre||"",region:A.region||"",asignatura:A.asignatura||""})}})()},[]);const h=async f=>{var v;f.preventDefault();try{const w=((v=we.currentUser)==null?void 0:v.uid)||localStorage.getItem("uid");if(!w)throw new Error("sin uid");await xt(se(X,"usuarios",w),{...n,updatedAt:ut()},{merge:!0}),r("âœ… Perfil actualizado."),setTimeout(()=>r(""),1200)}catch(w){r("âŒ Error al guardar: "+(w.code||w.message))}};return m.createElement("div",{style:nce},m.createElement("h2",{style:{marginTop:0}},"ðŸ‘¤ Mi Perfil"),m.createElement("div",{style:{marginBottom:12,padding:12,border:"1px dashed #e5e7eb",borderRadius:10,background:"#f8fafc"}},m.createElement("div",null,m.createElement("b",null,"Plan:")," ",i?"...":s),m.createElement("div",null,m.createElement("b",null,"Estado de cobro:")," ",i?"...":o),a&&!l&&m.createElement("div",null,m.createElement("b",null,"Trial restante:")," ",c>1?`${c} dÃ­as`:`${Math.max(0,u)} h`),a&&l&&m.createElement("div",{style:{color:"#b91c1c"}},m.createElement("b",null,"Prueba vencida"))),m.createElement("form",{onSubmit:h,style:{display:"grid",gap:10}},m.createElement("input",{placeholder:"Nombre",value:n.nombre,onChange:f=>e({...n,nombre:f.target.value}),style:{padding:10,border:"1px solid #e5e7eb",borderRadius:8}}),m.createElement("input",{placeholder:"PaÃ­s / RegiÃ³n",value:n.region,onChange:f=>e({...n,region:f.target.value}),style:{padding:10,border:"1px solid #e5e7eb",borderRadius:8}}),m.createElement("input",{placeholder:"Asignatura principal",value:n.asignatura,onChange:f=>e({...n,asignatura:f.target.value}),style:{padding:10,border:"1px solid #e5e7eb",borderRadius:8}}),m.createElement("div",{style:{display:"flex",gap:8}},m.createElement("button",{type:"submit",style:{padding:"10px 14px",border:"none",borderRadius:8,background:"#2193b0",color:"#fff",fontWeight:800}},"ðŸ’¾ Guardar"),m.createElement("a",{href:"/pago"},m.createElement("button",{type:"button",style:{padding:"10px 14px",border:"1px solid #2193b0",borderRadius:8,background:"#fff",color:"#2193b0",fontWeight:800}},"ðŸ’³ Gestionar plan")))),t&&m.createElement("div",{style:{marginTop:10}},t))}const EO=async()=>{try{const n=await fetch("https://southamerica-east1-pragma-2c5d1.cloudfunctions.net/flowConfirm",{method:"POST"});if(!n.ok)throw new Error(`Error ${n.status}`);const e=await n.text();return console.log("[ConfirmacionPago] Respuesta flowConfirm:",e),e.trim()==="OK"}catch(n){return console.error("[ConfirmacionPago] Error consultando flowConfirm:",n),!1}};function ice(){const[n]=ck(),e=ji();return D.useEffect(()=>{(async()=>{var h;const i=localStorage.getItem("uid")||((h=we.currentUser)==null?void 0:h.uid)||null,s=n.get("commerceOrder")||n.get("order")||n.get("flowOrder")||"";let o=n.get("plan")||s&&String(s).split("-")[0]||localStorage.getItem("lastPlan")||"",a=n.get("modo")||localStorage.getItem("lastModo")||"mensual";const l=Number(localStorage.getItem("lastPrecio")||0),c=n.get("token")||"",u=n.get("status")||"";if(!(!i||!o))try{const f=await EO(),v=se(X,"profesores",i);await gy(v,{pagoRealizado:f,planSeleccionado:o,pagoModo:a,precioPagado:l||null,flowToken:c||null,flowStatus:u||null,commerceOrder:s||null,fechaPago:new Date().toISOString()});try{await PS()}catch(w){console.warn(w)}alert(f?"âœ… Â¡Pago confirmado exitosamente!":"âš  Pago no confirmado por Flow"),e("/")}catch(f){try{const v=await EO(),w=se(X,"profesores",i);await xt(w,{pagoRealizado:v,planSeleccionado:o,pagoModo:a,precioPagado:l||null,flowToken:c||null,flowStatus:u||null,commerceOrder:s||null,fechaPago:new Date().toISOString()},{merge:!0});try{await PS()}catch(E){console.warn(E)}alert(v?"âœ… Â¡Pago confirmado exitosamente!":"âš  Pago no confirmado por Flow"),e("/")}catch(v){console.error("Error al registrar el pago:",f,v),alert("âŒ OcurriÃ³ un error al confirmar el pago.")}}})()},[n,e]),m.createElement("div",{style:{padding:"3rem",textAlign:"center"}},m.createElement("h2",null,"ðŸ’³ Confirmando tu pago..."),m.createElement("p",null,"Un momento por favor..."))}function sce({nivel:n,grado:e,asignatura:t,unidadId:r,anio:i=2025}){var I,P,N;const[s,o]=D.useState(null),[a,l]=D.useState({oa:[],habilidades:[],contenidos:[]}),[c,u]=D.useState(""),[h,f]=D.useState(!0),v=D.useRef(null),w=D.useMemo(()=>`${i}-${e}-${t}-${r}`.replace(/[^\w-]/g,"_"),[i,e,t,r]);D.useEffect(()=>{(async()=>{var M;f(!0);try{const V=Bo(tn(X,"planificaciones"),fi("nivel","==",n),fi("grado","==",e),fi("asignatura","==",t),fi("unidadId","==",r),fi("anio","==",Number(i))),L=await $n(V);L.empty?o({unidadNombre:"(Unidad no encontrada)",oa:[],habilidades:[],contenidos:[]}):o({id:L.docs[0].id,...L.docs[0].data()});const j=(M=we==null?void 0:we.currentUser)==null?void 0:M.uid;if(j){const oe=se(X,"users",j,"planes",w),$=await Fe(oe);if($.exists()){const B=$.data();l((B==null?void 0:B.seleccion)||{oa:[],habilidades:[],contenidos:[]}),u((B==null?void 0:B.notas)||"")}}}catch(V){console.error("Error cargando plan:",V)}finally{f(!1)}})()},[n,e,t,r,i,w]);const E=(M,V)=>{l(L=>{var $;const oe=(($=L[M])==null?void 0:$.includes(V))?L[M].filter(B=>B!==V):[...L[M]||[],V];return{...L,[M]:oe.sort((B,G)=>B-G)}})},A=(M,V)=>{var L;return(L=a[M])==null?void 0:L.includes(V)},T=async()=>{var M;try{const V=(M=we==null?void 0:we.currentUser)==null?void 0:M.uid;if(!V){alert("Inicia sesiÃ³n para guardar tu planificaciÃ³n.");return}const L=se(X,"users",V,"planes",w);await xt(L,{nivel:n,grado:e,asignatura:t,unidadId:r,anio:Number(i),seleccion:a,notas:c,updatedAt:ut()},{merge:!0}),alert("PlanificaciÃ³n guardada âœ…")}catch(V){console.error(V),alert("No se pudo guardar. Reintenta.")}},_=()=>{var L;const M=window.open("","_blank");if(!M)return;const V=((L=v.current)==null?void 0:L.innerHTML)||"";M.document.write(`
      <!doctype html><html><head><meta charset="utf-8">
      <title>PlanificaciÃ³n - ${t} ${e} ${r}</title>
      <style>
        body{font-family:system-ui,-apple-system,Segoe UI,Roboto; padding:24px}
        h1,h2{margin:0 0 8px}
        .tag{display:inline-block; background:#e5f6ff; color:#055; padding:2px 8px; border-radius:8px; margin-right:6px; font-size:12px}
        ul{margin:6px 0 14px}
        li{margin:4px 0}
        .small{color:#475569; font-size:12px}
        .box{border:1px solid #e2e8f0; border-radius:12px; padding:16px; margin:12px 0}
      </style></head><body>${V}</body></html>
    `),M.document.close(),M.focus(),M.print(),setTimeout(()=>M.close(),300)},b=()=>{var j;const M=new Blob([((j=v.current)==null?void 0:j.innerHTML)||""],{type:"text/html;charset=utf-8"}),V=URL.createObjectURL(M),L=document.createElement("a");L.download=`Plan_${t}_${e}_${r}.html`,L.href=V,L.click(),URL.revokeObjectURL(V)};if(h)return m.createElement("div",{style:{padding:16}},"Cargandoâ€¦");if(!s)return m.createElement("div",{style:{padding:16}},"Sin datos");const{unidadNombre:g="",oa:y=[],habilidades:x=[],contenidos:S=[]}=s;return m.createElement("div",{style:{padding:16,maxWidth:980,margin:"0 auto"}},m.createElement("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,flexWrap:"wrap"}},m.createElement("div",null,m.createElement("h2",{style:{marginBottom:4}},"Planificador de Clase"),m.createElement("div",{className:"small"},n," Â· ",t," Â· ",e," Â· ",r," â€” ",m.createElement("b",null,g)," Â· ",i)),m.createElement("div",{style:{display:"flex",gap:8}},m.createElement("button",{onClick:T},"ðŸ’¾ Guardar"),m.createElement("button",{onClick:_},"ðŸ–¨ï¸ Imprimir"),m.createElement("button",{onClick:b},"â¬‡ï¸ Descargar (HTML)"))),m.createElement("section",{style:{display:"grid",gridTemplateColumns:"1fr",gap:12,marginTop:12}},m.createElement(ub,{title:`Objetivos de Aprendizaje (${y.length})`},y.length===0?m.createElement("i",{className:"small"},"Sin OA en catÃ¡logo"):m.createElement("ul",{style:{listStyle:"none",padding:0}},y.map((M,V)=>m.createElement("li",{key:`oa-${V}`},m.createElement("label",{style:{display:"flex",gap:8,alignItems:"flex-start"}},m.createElement("input",{type:"checkbox",checked:A("oa",V),onChange:()=>E("oa",V)}),m.createElement("span",null,M)))))),m.createElement(ub,{title:`Habilidades (${x.length})`},x.length===0?m.createElement("i",{className:"small"},"Sin habilidades en catÃ¡logo"):m.createElement("ul",{style:{listStyle:"none",padding:0}},x.map((M,V)=>m.createElement("li",{key:`hab-${V}`},m.createElement("label",{style:{display:"flex",gap:8,alignItems:"flex-start"}},m.createElement("input",{type:"checkbox",checked:A("habilidades",V),onChange:()=>E("habilidades",V)}),m.createElement("span",null,M)))))),m.createElement(ub,{title:`Contenidos (${S.length})`},S.length===0?m.createElement("i",{className:"small"},"Sin contenidos en catÃ¡logo"):m.createElement("ul",{style:{listStyle:"none",padding:0}},S.map((M,V)=>m.createElement("li",{key:`cont-${V}`},m.createElement("label",{style:{display:"flex",gap:8,alignItems:"flex-start"}},m.createElement("input",{type:"checkbox",checked:A("contenidos",V),onChange:()=>E("contenidos",V)}),m.createElement("span",null,M)))))),m.createElement(ub,{title:"Notas del profesor"},m.createElement("textarea",{value:c,onChange:M=>u(M.target.value),rows:5,placeholder:"Indicadores, actividades, evaluaciones, materialesâ€¦",style:{width:"100%"}}))),m.createElement("div",{ref:v,style:{display:"none"}},m.createElement("h1",null,"PlanificaciÃ³n â€” ",t," ",e," ",r),m.createElement("div",{className:"small"},n," Â· ",i),m.createElement("h2",null,"Unidad: ",g),m.createElement("div",{className:"box"},m.createElement("h3",null,"OA seleccionados"),m.createElement("ul",null,(I=a.oa)==null?void 0:I.map(M=>m.createElement("li",{key:`p-oa-${M}`},y[M])))),m.createElement("div",{className:"box"},m.createElement("h3",null,"Habilidades seleccionadas"),m.createElement("ul",null,(P=a.habilidades)==null?void 0:P.map(M=>m.createElement("li",{key:`p-h-${M}`},x[M])))),m.createElement("div",{className:"box"},m.createElement("h3",null,"Contenidos seleccionados"),m.createElement("ul",null,(N=a.contenidos)==null?void 0:N.map(M=>m.createElement("li",{key:`p-c-${M}`},S[M])))),c!=null&&c.trim()?m.createElement("div",{className:"box"},m.createElement("h3",null,"Notas del profesor"),m.createElement("div",null,c)):null))}function ub({title:n,children:e}){return m.createElement("div",{className:"box",style:{border:"1px solid #e2e8f0",borderRadius:12,padding:16}},m.createElement("div",{style:{fontWeight:700,marginBottom:8}},n),e)}const $T=X||fU();function oce(n=new Date){return new Date(n.getTime()-n.getTimezoneOffset()*6e4).toISOString().slice(0,10)}function ace(n=new Date){const e=t=>String(t).padStart(2,"0");return`${n.getFullYear()}${e(n.getMonth()+1)}${e(n.getDate())}`}function bO(n=new Date){const e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),t=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-t);const r=new Date(Date.UTC(e.getUTCFullYear(),0,1)),i=Math.ceil(((e-r)/864e5+1)/7),s=String(i).padStart(2,"0");return`${e.getUTCFullYear()}-${s}`}const lce={"7mo":"7","8mo":"8","1medio":"1M","2medio":"2M","3medio":"3M","4medio":"4M"};function db({title:n,children:e}){return m.createElement("div",{style:{background:"#ffffff",borderRadius:12,boxShadow:"0 8px 20px rgba(16,24,40,.08)",border:"1px solid #e5e7eb",padding:"14px 16px",marginBottom:16}},n&&m.createElement("h3",{style:{margin:0,marginBottom:8,color:"#0f172a"}},n),e)}function cce(){const[n,e]=D.useState("BÃ¡sico"),[t,r]=D.useState(""),[i,s]=D.useState(""),[o,a]=D.useState(""),[l,c]=D.useState(oce(new Date)),[u,h]=D.useState([]),[f,v]=D.useState([]),[w,E]=D.useState(!1),[A,T]=D.useState(!1),[_,b]=D.useState(new Set),[g,y]=D.useState(new Set),[x,S]=D.useState(""),I=D.useMemo(()=>{try{return bO(new Date(l))}catch{return bO(new Date)}},[l]),P=D.useMemo(()=>lce[t]||"",[t]);D.useEffect(()=>{(async()=>{E(!0),h([]);try{if(!P){E(!1);return}const $=tn($T,"planificaciones","matematica",I),B=await $n($),G=[];B.forEach(ee=>{const fe=ee.id||"";if(!fe.startsWith(`${P}-`))return;const ae=ee.data()||{},_e=ae.unidadNombre||ae.titulo||`Unidad ${fe.split("-")[1]||""}`,Qe=ae.eje||ae.axis||"",gt=(Array.isArray(ae.oa)?ae.oa:[]).map((ie,ot)=>typeof ie=="string"?{id:`${fe}-OA${String(ot+1).padStart(2,"0")}`,text:ie}:{id:(ie==null?void 0:ie.id)||`${fe}-OA${String(ot+1).padStart(2,"0")}`,text:(ie==null?void 0:ie.text)||(ie==null?void 0:ie.label)||""});gt.length||gt.push({id:`${fe}-OA01`,text:`Objetivos de ${_e}`}),G.push({id:fe,unidadNombre:_e,oa:gt,eje:Qe})});const Z=i?G.filter(ee=>(ee.eje||"").toLowerCase().includes(i.toLowerCase())):G;h(Z.sort((ee,fe)=>ee.id.localeCompare(fe.id)))}catch($){console.warn("[PlanClaseEditor] Error cargando OA:",$)}finally{E(!1)}})()},[P,I,i]),D.useEffect(()=>{(async()=>{T(!0);try{const $=await $n(tn($T,"habilidades_catalogo")),B=[];$.forEach(G=>{const Z=G.data()||{};B.push({id:G.id,label:Z.label||Z.titulo||G.id,grupo:Z.grupo||Z.group||"Habilidades",orden:Z.orden||999})}),B.sort((G,Z)=>(G.grupo||"").localeCompare(Z.grupo||"")||G.orden-Z.orden),v(B)}catch($){console.warn("[PlanClaseEditor] Error cargando habilidades:",$)}finally{T(!1)}})()},[]);const N=D.useMemo(()=>{const $=new Map;for(const B of f){const G=B.grupo||"Habilidades";$.has(G)||$.set(G,[]),$.get(G).push(B)}return $},[f]),M=$=>{b(B=>{const G=new Set(B);return G.has($)?G.delete($):G.add($),G})},V=$=>{y(B=>{const G=new Set(B);return G.has($)?G.delete($):G.add($),G})},L=async()=>{try{const $=we==null?void 0:we.currentUser;if(!$||$.isAnonymous){alert("Inicia sesiÃ³n para guardar el plan de clase.");return}if(!t||!o){alert("Completa grado y curso.");return}const B=new Date(l);if(isNaN(+B)){alert("Fecha invÃ¡lida.");return}const G=`${ace(B)}_${o.replace(/\s+/g,"")}`,Z=se($T,"clases_detalle",$.uid,"items",G),ee=Array.from(_),fe=Array.from(g);await xt(Z,{uid:$.uid,creadoEn:ut(),actualizadoEn:ut(),fecha:l,semanaId:I,nivel:n,grado:t,curso:o,asignatura:"MatemÃ¡tica",ejeFiltro:i||null,seleccion:{oa:ee,habilidades:fe},observaciones:x||""},{merge:!0}),alert("âœ… Clase guardada.")}catch($){console.error($),alert("No se pudo guardar. Revisa la consola.")}},j=()=>{const $=[];u.forEach(ee=>{ee.oa.forEach(fe=>{_.has(fe.id)&&$.push(`â€¢ ${fe.text||fe.id}`)})});const B=f.filter(ee=>g.has(ee.id)).map(ee=>`â€¢ ${ee.label}`),G=`
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Plan de Clase</title>
    <style>
      body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:24px;color:#111}
      h1{font-size:20px;margin:0 0 8px}
      h2{font-size:16px;margin:16px 0 6px}
      .box{border:1px solid #e5e7eb;border-radius:10px;padding:12px;margin:12px 0}
      ul{margin:8px 0 0 18px}
      .muted{color:#475569}
    </style>
  </head>
  <body>
    <h1>Plan de Clase â€” ${o||"-"}</h1>
    <div class="muted">${n} â€¢ ${t||"-"} â€¢ ${l} â€¢ Semana ${I}</div>

    <div class="box">
      <h2>Objetivos de Aprendizaje (seleccionados)</h2>
      ${$.length?`<ul>${$.map(ee=>`<li>${ee}</li>`).join("")}</ul>`:'<div class="muted">Sin selecciÃ³n</div>'}
    </div>

    <div class="box">
      <h2>Habilidades (seleccionadas)</h2>
      ${B.length?`<ul>${B.map(ee=>`<li>${ee}</li>`).join("")}</ul>`:'<div class="muted">Sin selecciÃ³n</div>'}
    </div>

    <div class="box">
      <h2>Observaciones</h2>
      <div>${(x||"").replace(/\n/g,"<br/>")||'<span class="muted">â€”</span>'}</div>
    </div>

    <script>window.print()<\/script>
  </body>
</html>
`,Z=window.open("","_blank");if(!Z)return alert("El navegador bloqueÃ³ el popup de impresiÃ³n.");Z.document.write(G),Z.document.close()},oe={minHeight:"100vh",background:"linear-gradient(to right, #2193b0, #6dd5ed)",padding:"18px",fontFamily:"Segoe UI, system-ui, sans-serif",color:"#0f172a"};return m.createElement("div",{style:oe},m.createElement("h2",{style:{color:"#fff",margin:"8px 0 18px"}},"ðŸ§‘â€ðŸ« Editor de Plan de Clase"),m.createElement(db,{title:"Filtros (catÃ¡logo de OA)"},m.createElement("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:12}},m.createElement("div",null,m.createElement("label",null,"Nivel"),m.createElement("select",{value:n,onChange:$=>e($.target.value),style:HC},m.createElement("option",null,"BÃ¡sico"),m.createElement("option",null,"Medio"))),m.createElement("div",null,m.createElement("label",null,"Grado"),m.createElement("select",{value:t,onChange:$=>r($.target.value),style:HC},m.createElement("option",{value:""},"â€” elige â€”"),m.createElement("option",{value:"7mo"},"7mo"),m.createElement("option",{value:"8mo"},"8mo"),m.createElement("option",{value:"1medio"},"1Â° medio"),m.createElement("option",{value:"2medio"},"2Â° medio"),m.createElement("option",{value:"3medio"},"3Â° medio"),m.createElement("option",{value:"4medio"},"4Â° medio"))),m.createElement("div",null,m.createElement("label",null,"Eje (opcional)"),m.createElement("input",{value:i,onChange:$=>s($.target.value),placeholder:"NÃºmeros / Ãlgebraâ€¦",style:jT})),m.createElement("div",null,m.createElement("label",null,"Curso (ej: 7Â°B)"),m.createElement("input",{value:o,onChange:$=>a($.target.value),placeholder:"7Â°B",style:jT})),m.createElement("div",null,m.createElement("label",null,"Fecha"),m.createElement("input",{type:"date",value:l,onChange:$=>c($.target.value),style:jT})),m.createElement("div",{style:{alignSelf:"end",opacity:.8}},m.createElement("div",null,"Semana (auto): ",m.createElement("b",null,I))))),m.createElement(db,{title:`OA disponibles ${w?"(cargandoâ€¦)":`(${u.length})`}`},(!P||u.length===0)&&!w?m.createElement("div",{style:{color:"#475569"}},"No hay OA para el filtro seleccionado."):m.createElement("div",{style:{display:"grid",gap:10}},u.map($=>m.createElement("div",{key:$.id,style:{border:"1px solid #e5e7eb",borderRadius:10,padding:10}},m.createElement("div",{style:{fontWeight:700,marginBottom:6}},$.id," â€” ",$.unidadNombre),m.createElement("div",{style:{display:"grid",gap:6}},$.oa.map(B=>m.createElement("label",{key:B.id,style:{display:"flex",gap:8,alignItems:"flex-start"}},m.createElement("input",{type:"checkbox",checked:_.has(B.id),onChange:()=>M(B.id)}),m.createElement("span",null,B.text||B.id)))))))),m.createElement(db,{title:`Habilidades ${A?"(cargandoâ€¦)":""}`},N.size===0&&!A?m.createElement("div",{style:{color:"#475569"}},"Carga primero el catÃ¡logo de habilidades."):Array.from(N.entries()).map(([$,B])=>m.createElement("div",{key:$,style:{marginBottom:10}},m.createElement("div",{style:{fontWeight:700,marginBottom:4}},$),m.createElement("div",{style:{display:"grid",gap:4,gridTemplateColumns:"repeat(auto-fill, minmax(260px, 1fr))"}},B.map(G=>m.createElement("label",{key:G.id,style:{display:"flex",gap:8,alignItems:"flex-start"}},m.createElement("input",{type:"checkbox",checked:g.has(G.id),onChange:()=>V(G.id)}),m.createElement("span",null,G.label))))))),m.createElement(db,{title:"Observaciones"},m.createElement("textarea",{style:{width:"100%",minHeight:120,borderRadius:8,border:"1px solid #e5e7eb",padding:10},value:x,onChange:$=>S($.target.value),placeholder:"Notas, actividades, materialesâ€¦"})),m.createElement("div",{style:{display:"flex",gap:10}},m.createElement("button",{onClick:L,style:uce},"ðŸ’¾ Guardar"),m.createElement("button",{onClick:j,style:dce},"ðŸ–¨ï¸ Imprimir / Exportar")))}const HC={width:"100%",padding:"10px 12px",borderRadius:8,border:"1px solid #e5e7eb",outline:"none"},jT=HC,uce={background:"#16a34a",color:"#fff",border:"none",padding:"10px 16px",borderRadius:10,cursor:"pointer",fontWeight:700,boxShadow:"0 6px 14px rgba(22,163,74,.2)"},dce={background:"#fff",color:"#0f172a",border:"1px solid #e5e7eb",padding:"10px 16px",borderRadius:10,cursor:"pointer",fontWeight:700};class hce extends m.Component{constructor(e){super(e),this.state={hasError:!1,err:null}}static getDerivedStateFromError(e){return{hasError:!0,err:e}}componentDidCatch(e,t){console.error("[App ErrorBoundary] render error:",e,t)}render(){var e;return this.state.hasError?m.createElement("div",{style:{padding:16,background:"#fff1f2",color:"#881337",fontFamily:"system-ui, sans-serif"}},m.createElement("h3",null,"âš ï¸ OcurriÃ³ un error renderizando la pÃ¡gina"),m.createElement("pre",{style:{whiteSpace:"pre-wrap"}},String(((e=this.state.err)==null?void 0:e.message)||this.state.err||"Error desconocido"))):this.props.children}}function fce(){const{pathname:n}=Hs();return m.useEffect(()=>{try{window.scrollTo(0,0)}catch{}},[n]),null}function pce(){const n=Hs(),[e,t]=m.useState(!1);return m.useEffect(()=>{const i=new URLSearchParams(window.location.search).get("debug")==="1"||localStorage.getItem("debugApp")==="1";t(!!i)},[n]),e?m.createElement("div",{style:{position:"fixed",top:8,right:8,zIndex:9999,background:"rgba(0,0,0,.75)",color:"#fff",padding:"6px 10px",borderRadius:8,fontSize:12,boxShadow:"0 4px 10px rgba(0,0,0,.2)"}},"âœ… App montada â€¢ ruta: ",m.createElement("code",null,n.pathname)):null}function I6(){const[n,e]=m.useState(!1),[t,r]=m.useState(null);return m.useEffect(()=>{let i=!1;const s=ls(we,a=>{i=!0,r(a||null),e(!0)}),o=setTimeout(()=>{i||e(!0)},1500);return()=>{clearTimeout(o),s()}},[]),{ready:n,user:t}}function GC({children:n}){const{ready:e,user:t}=I6();return e?!!t&&!t.isAnonymous?n:m.createElement(Tu,{to:"/login",replace:!0}):m.createElement("div",{style:{padding:16,fontFamily:"system-ui, sans-serif"}},"Cargando sesiÃ³nâ€¦")}function mce({children:n}){const{ready:e,user:t}=I6();let r=!1;try{r=new URLSearchParams(window.location.search).get("nolock")==="1"}catch{}return!e&&!r?null:!!t&&!t.isAnonymous?m.createElement(Tu,{to:"/inicio",replace:!0}):n}function gce(){return m.createElement(GC,null,m.createElement(tce,{allowDuringTrial:!0},m.createElement(GX,null)))}function yce(){const n=ji();return m.createElement($le,{duracion:30,onIrACierre:()=>n("/cierre")})}function vce(){if((window.location.search.includes("debug=1")||localStorage.getItem("debugApp")==="1")&&console.log("App.js estÃ¡ renderizando"),window.location.search.includes("ping"))return m.createElement("div",{style:{padding:40,fontSize:28,color:"lime",background:"#111"}},"âœ… App.js se montÃ³ correctamente");const t=new URLSearchParams(window.location.search).get("stub")==="1"||localStorage.getItem("stubApp")==="1",r=t?Roe:qse,i=t?koe:Zle;return m.createElement(tJ,null,m.createElement(hce,null,m.createElement(m.Suspense,{fallback:m.createElement("div",{style:{padding:16,fontFamily:"system-ui, sans-serif"}},"Cargando appâ€¦")},m.createElement(fce,null),m.createElement(pce,null),m.createElement(qX,null,m.createElement(gr,{path:"/",element:m.createElement(Tu,{to:"/inicio",replace:!0})}),m.createElement(gr,{path:"/home",element:m.createElement(Zse,null)}),m.createElement(gr,{path:"/plan-clase",element:m.createElement(cce,null)}),m.createElement(gr,{path:"/mineduc/:nivel",element:m.createElement(Uee,null)}),m.createElement(gr,{path:"/planificador/:grado/:unidadId",element:m.createElement(sce,{nivel:"BÃ¡sico",asignatura:"MatemÃ¡tica",anio:2025})}),m.createElement(gr,{path:"/registro",element:m.createElement(loe,null)}),m.createElement(gr,{path:"/participa",element:m.createElement(Poe,null)}),m.createElement(gr,{path:"/login",element:m.createElement(mce,null,m.createElement(yoe,null))}),m.createElement(gr,{path:"/perfil",element:m.createElement(GC,null,m.createElement(rce,null))}),m.createElement(gr,{element:m.createElement(gce,null)},m.createElement(gr,{path:"/horario",element:m.createElement(Jle,null)}),m.createElement(gr,{path:"/planificaciones",element:m.createElement(i,null)}),m.createElement(gr,{path:"/inicio",element:m.createElement(r,null)}),m.createElement(gr,{path:"/desarrollo",element:m.createElement(yce,null)}),m.createElement(gr,{path:"/cierre",element:m.createElement(_le,{duracion:10})})),!1,!1,!1,m.createElement(gr,{path:"/pago",element:m.createElement(GC,null,m.createElement(aoe,null))}),!1,m.createElement(gr,{path:"/confirmacion-pago",element:m.createElement(ice,null)}),m.createElement(gr,{path:"*",element:m.createElement(Tu,{to:"/inicio",replace:!0})})))))}const wce=window.location.search.includes("debug=1")||localStorage.getItem("debugApp")==="1";wce&&console.log("index.js cargado");const Ece=document.getElementById("root"),bce=u3(Ece);bce.render(m.createElement(m.StrictMode,null,m.createElement(Mse,null,m.createElement(vce,null))));export{we as a,X as b,c1 as c,se as d,Fe as g};
