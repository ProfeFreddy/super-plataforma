import{r,h as u,o as _,p as x,R as t,l as B,e as f,q as F,L as H,M as A,d as C,s as I,f as U}from"./index-BqLPJdMO.js";const P=(i="")=>i.toString().toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").replace(/[^a-z0-9]+/g,"").trim(),Q=(i="")=>{const v=i.toString().toLowerCase().replace(/\s+/g," ").replace(/[Â°Âº]/g,"").replace("bÃ¡sico","basico").trim();return P(v)},j={background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:"1rem",boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)"},J=i=>({padding:".45rem .85rem",borderRadius:8,border:"none",color:"#fff",background:i,cursor:"pointer"}),y={padding:".5rem .75rem",borderRadius:8,border:"1px solid #d1d5db"};function V(){const[i,v]=r.useState(u.currentUser),[E,b]=r.useState(!1),[o,z]=r.useState([]),[c,N]=r.useState(""),[m,k]=r.useState(""),[g,q]=r.useState(""),[p,M]=r.useState("");r.useEffect(()=>{const e=_(u,a=>v(a));return u.currentUser||x(u).catch(console.error),()=>e()},[]),r.useEffect(()=>{(async()=>{b(!0);try{const a=B(f,"curriculo");let n;if(c){const s=F(a,H("asignaturaId","==",c));n=await A(s)}else n=await A(a);const d=n.docs.map(s=>({id:s.id,...s.data()||{}}));z(d)}catch(a){console.error("Error leyendo curriculo:",a)}finally{b(!1)}})()},[c]);const D=r.useMemo(()=>{const e=new Set;return o.forEach(a=>a.asignaturaId&&e.add(a.asignaturaId)),Array.from(e).sort()},[o]),L=r.useMemo(()=>{const e=new Set;return o.forEach(a=>a.nivel&&e.add(a.nivel)),Array.from(e).sort()},[o]),R=r.useMemo(()=>{const e=new Set;return o.forEach(a=>a.grado&&e.add(a.grado)),Array.from(e).sort()},[o]),h=r.useMemo(()=>{const e=p.trim().toLowerCase();return o.filter(a=>c&&a.asignaturaId!==c||m&&(a.nivel||"")!==m||g&&(a.grado||"")!==g?!1:e?[a.titulo,a.codUnidad,a.nivel,a.grado,...Array.isArray(a.objetivos)?a.objetivos:[],...Array.isArray(a.habilidades)?a.habilidades:[]].join(" ").toLowerCase().includes(e):!0)},[o,c,m,g,p]),T=async e=>{var a;try{const n=((a=u.currentUser)==null?void 0:a.uid)||(i==null?void 0:i.uid);if(!n){alert("No hay usuario (auth anÃ³nima fallÃ³).");return}const d=(e.asignaturaId||"").toString().toLowerCase(),s=Q(e.nivel||""),l=(e.codUnidad||e.id||"SINID").toString(),$=C(f,"usuarios",n,"planificacion_usuario",`${d}_${s}`);await I($,{updatedAt:U(),unidades:{[l]:"seleccionada"}},{merge:!0});const W=C(f,"catalogo_curricular",d,"niveles",s,"unidades",l),O=Array.isArray(e.objetivos)?e.objetivos:Array.isArray(e.oas)?e.oas:[],G=Array.isArray(e.habilidades)?e.habilidades:[],S=e.titulo||e.codUnidad||l;await I(W,{nombre:S,objetivos:O,habilidades:G,horasSugeridas:e.horasSugeridas||null,grado:e.grado||"",oaClaves:e.oaClaves||e.oaCodigos||null,createdFrom:"curriculo",updatedAt:U()},{merge:!0}),alert(`âœ“ Agregada: ${S}
Asignatura: ${d} â€¢ Nivel: ${s} â€¢ Unidad: ${l}`)}catch(n){console.error("addToMyUnits error:",n),alert("No se pudo agregar. Revisa consola.")}};return t.createElement("div",{style:{padding:"2rem"}},t.createElement("h1",{style:{marginTop:0}},"ðŸ“š Planificaciones"),t.createElement("p",null,"(AquÃ­ verÃ¡s lo que viene de ",t.createElement("code",null,"curriculo"),". Agrega lo que usarÃ¡s y luego vuelve a Horario.)"),t.createElement("div",{style:{...j,marginBottom:"1rem"}},t.createElement("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"}},t.createElement("div",null,t.createElement("div",{style:{fontSize:12,color:"#475569"}},"Asignatura"),t.createElement("select",{value:c,onChange:e=>N(e.target.value),style:y},t.createElement("option",{value:""},"(todas)"),D.map(e=>t.createElement("option",{key:e,value:e},e)))),t.createElement("div",null,t.createElement("div",{style:{fontSize:12,color:"#475569"}},"Nivel"),t.createElement("select",{value:m,onChange:e=>k(e.target.value),style:y},t.createElement("option",{value:""},"(todos)"),L.map(e=>t.createElement("option",{key:e,value:e},e)))),t.createElement("div",null,t.createElement("div",{style:{fontSize:12,color:"#475569"}},"Grado/SecciÃ³n"),t.createElement("select",{value:g,onChange:e=>q(e.target.value),style:y},t.createElement("option",{value:""},"(todos)"),R.map(e=>t.createElement("option",{key:e,value:e},e)))),t.createElement("div",{style:{flex:1,minWidth:220}},t.createElement("div",{style:{fontSize:12,color:"#475569"}},"Buscar"),t.createElement("input",{value:p,onChange:e=>M(e.target.value),placeholder:"Unidad, objetivo u habilidadâ€¦",style:{...y,width:"100%"}})))),t.createElement("div",{style:{display:"grid",gap:12}},E&&t.createElement("div",{style:{color:"#64748b"}},"Cargando planificacionesâ€¦"),!E&&h.length===0&&t.createElement("div",{style:{color:"#64748b"}},"No hay resultados con esos filtros."),h.map(e=>{const a=Array.isArray(e.objetivos)?e.objetivos:Array.isArray(e.oas)?e.oas:[],n=Array.isArray(e.habilidades)?e.habilidades:[],d=e.titulo||e.codUnidad||e.id;return t.createElement("div",{key:e.id,style:{...j}},t.createElement("div",{style:{display:"flex",justifyContent:"space-between",gap:10,alignItems:"center"}},t.createElement("div",null,t.createElement("div",{style:{fontWeight:800}},d),t.createElement("div",{style:{color:"#64748b",fontSize:13}},t.createElement("b",null,"Unidad:")," ",e.codUnidad||e.id," â€¢ ",t.createElement("b",null,"Asignatura:")," ",e.asignaturaId," â€¢ ",t.createElement("b",null,"Nivel:")," ",e.nivel," â€¢ ",t.createElement("b",null,"Grado:")," ",e.grado)),t.createElement("button",{type:"button",onClick:()=>T(e),style:J("#2563eb")},"Agregar a Mis Unidades")),a.length>0&&t.createElement("div",{style:{marginTop:8}},t.createElement("div",{style:{fontWeight:700,fontSize:13}},"Objetivos"),t.createElement("ul",{style:{margin:"6px 0 0 1rem"}},a.slice(0,6).map((s,l)=>t.createElement("li",{key:l,style:{fontSize:13}},s)))),n.length>0&&t.createElement("div",{style:{marginTop:8}},t.createElement("div",{style:{fontWeight:700,fontSize:13}},"Habilidades"),t.createElement("ul",{style:{margin:"6px 0 0 1rem"}},n.slice(0,6).map((s,l)=>t.createElement("li",{key:l,style:{fontSize:13}},s)))))})))}export{V as default};
