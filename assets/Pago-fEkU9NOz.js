import{u as D,b as W,r as P,o as V,h,R as t,T as U,U as C,V as k,W as z,s as j,f as L,d as H,e as G}from"./index-BqLPJdMO.js";import{P as J}from"./planCaps-OxFxGX_F.js";const q={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE:"https://us-central1-pragma-2c5d1.cloudfunctions.net/api",VITE_FIREBASE_API_KEY:"AIzaSyC6uvGu9_9kNx1vInNy7X2ny2JPkE4M-YU",VITE_FIREBASE_APP_ID:"1:203232076035:web:1ed2a449ba619ac30b8936",VITE_FIREBASE_AUTH_DOMAIN:"pragma-2c5d1.firebaseapp.com",VITE_FIREBASE_MEASUREMENT_ID:"G-348TG6WKLE",VITE_FIREBASE_MESSAGING_SENDER_ID:"203232076035",VITE_FIREBASE_PROJECT_ID:"pragma-2c5d1",VITE_FIREBASE_STORAGE_BUCKET:"pragma-2c5d1.firebasestorage.app"};var R={};const S="https://us-central1-pragma-2c5d1.cloudfunctions.net/api",K=typeof import.meta<"u"&&q&&"https://us-central1-pragma-2c5d1.cloudfunctions.net/api"||typeof process<"u"&&R&&(R.VITE_API_BASE||R.REACT_APP_API_BASE)||"";function Y(e){var o,s;try{const r=typeof window<"u",n=((s=(o=e.hostname)==null?void 0:o.toLowerCase)==null?void 0:s.call(o))||"",i=r&&window.location&&window.location.hostname===n,l=n==="localhost"||n==="127.0.0.1",p=(e.pathname||"").trim(),d=p==="/"||p==="",m=/(cloudfunctions\.net|run\.app)$/i.test(e.host||"");return!!(!l&&i&&!m||d&&(!m||i))}catch{return!0}}const x=(()=>{try{const e=String(K||"").trim();if(!e||e.startsWith("/")||!/^https?:/i.test(e))return S;const o=new URL(e);return Y(o)?S:(o.origin+o.pathname).replace(/\/+$/,"")||S}catch{return S}})(),B="https://super-plataforma.web.app/pago/retorno";try{console.info("[Pago] API_BASE =",x,"| RETURN_URL =",B)}catch{}const I={BASICO:9990,PRO:19990,PREMIUM:29990};function T(){try{const e=[];for(let o=0;o<localStorage.length;o++){const s=localStorage.key(o);s&&(s==="inicioClase_countdown_end"||s.startsWith("ic_countdown_end:")||s.startsWith("crono:"))&&e.push(s)}e.forEach(o=>localStorage.removeItem(o))}catch{}}async function Q(e="BASICO",o=1){var s,r;try{const n=(r=(s=h)==null?void 0:s.currentUser)==null?void 0:r.uid;if(!n)throw new Error("Usuario no autenticado");const i=U(C,"southamerica-east1");return await k(i,"setPlanV2")({uid:n,plan:e,months:o}),console.log("[Pago] setPlan (Callable) OK"),!0}catch(n){console.warn("[Pago] setPlan (Callable) no disponible. Fallback local:",(n==null?void 0:n.message)||n);try{return await X(e,o),!1}catch(i){return console.error("[Pago] Fallback local tambi√©n fall√≥:",i),!1}}}async function X(e="BASICO",o=1){var i,l,p;const s=(l=(i=h)==null?void 0:i.currentUser)==null?void 0:l.uid;if(!s)throw new Error("Usuario no autenticado");const r=(p=J)==null?void 0:p[e];if(!r)throw new Error("Plan inv√°lido");const n=z.fromDate(new Date(Date.now()+o*30*24*60*60*1e3));await j(H(G,"users",s,"meta","limits"),{plan:e,...r,period:{start:L(),end:n},updatedAt:L()},{merge:!0}),console.log("[Pago] Activaci√≥n de plan (fallback local) escrita en Firestore")}function $(e="BASICO",o=1){localStorage.setItem("pendingPlan",e),localStorage.setItem("pendingMonths",String(o)),localStorage.setItem("pendingTS",String(Date.now()))}async function Z(){const e=localStorage.getItem("pendingPlan"),o=Number(localStorage.getItem("pendingMonths")||1);return e?(await Q(e,o),localStorage.removeItem("pendingPlan"),localStorage.removeItem("pendingMonths"),localStorage.removeItem("pendingTS"),!0):!1}const F=()=>{let e=null;try{e=window.open("","_blank"),e&&e.document&&(e.document.write(`
        <!doctype html>
        <html><head><meta charset="utf-8"><title>Abriendo Flow‚Ä¶</title>
        <style>
          html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto}
          .box{height:100%;display:flex;align-items:center;justify-content:center;gap:.75rem;flex-direction:column}
          .spinner{width:28px;height:28px;border:3px solid #e5e7eb;border-top-color:#22c55e;border-radius:50%;animation:spin 1s linear infinite}
          @keyframes spin{to{transform:rotate(360deg)}}
          .txt{color:#334155}
        </style></head>
        <body><div class="box">
          <div class="spinner"></div>
          <div class="txt">Redirigiendo a Flow‚Ä¶</div>
        </div></body></html>`),e.document.close())}catch{}return e},M=e=>{try{const o=new URL(e),s=o.searchParams.get("token");if(s)return`${/sandbox\.flow\.cl/i.test(o.hostname)||/sandbox\.flow\.cl/i.test(e)?"https://sandbox.flow.cl":"https://www.flow.cl"}/app/web/pay.php?token=${s}`}catch{}return e},ee=e=>{var s;const o=[e,e==null?void 0:e.url,(s=e==null?void 0:e.url)==null?void 0:s.url,e==null?void 0:e.paymentUrl,e==null?void 0:e.paymentURL];for(const r of o)if(typeof r=="string"&&r)return r;return null},te=async e=>{const o=r=>{try{const n=new URL(r),i=n.searchParams.get("token"),p=/sandbox\.flow\.cl/i.test(n.hostname)||/sandbox\.flow\.cl/i.test(r)?"https://sandbox.flow.cl":"https://www.flow.cl";return i?`${p}/app/web/pay.php?token=${i}`:r}catch{return r}},s=()=>`https://sandbox.flow.cl/app/web/pay.php?token=${encodeURIComponent("DUMMY-"+Date.now())}`;try{const r=U(C,"southamerica-east1"),i=await k(r,"flowCreateV2")(e),l=typeof(i==null?void 0:i.data)=="string"?{url:i.data}:(i==null?void 0:i.data)||{},p=(l==null?void 0:l.url)||(l==null?void 0:l.paymentUrl)||(l==null?void 0:l.paymentURL)||"",d=o(p||s());return console.log("[Pago][Callable] respuesta:",{url:d}),{url:d}}catch(r){return console.warn("[Pago] Callable flowCreate fall√≥, uso stub:",(r==null?void 0:r.code)||(r==null?void 0:r.message)||r),{url:s()}}},oe=`${x}/flow/init`;async function ne(e,o,s){console.log("üõ∞Ô∏è [DEBUG Pago] API_BASE =",x),console.log("üõ∞Ô∏è [DEBUG Pago] Intentando POST ‚Üí",`${x}/flow/init`);const r=await fetch(oe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan:e,email:s,amount:Number(o),returnUrl:B})});if(!r.ok){const m=await r.text().catch(()=>"");throw new Error(`HTTP ${r.status} ${m||""}`.trim())}const n=await r.json().catch(()=>({})),i=(n==null?void 0:n.payUrl)||(n==null?void 0:n.url)||null;let l=n==null?void 0:n.token;if(!l&&i)try{l=new URL(i).searchParams.get("token")}catch{}if(!l&&(n!=null&&n.paymentUrl))try{l=new URL(n.paymentUrl).searchParams.get("token")}catch{}if(!l){const m=M(i||"");try{l=new URL(m).searchParams.get("token")}catch{}}if(!l)throw new Error("No se recibi√≥ token (ni payUrl) desde /flow/init");return`${/sandbox/i.test(String(i||""))?"https://sandbox.flow.cl":"https://www.flow.cl"}/app/web/pay.php?token=${encodeURIComponent(l)}`}async function N(e,o=1){var s;try{const r=(s=h)==null?void 0:s.currentUser;if(!r)return;await fetch(`${x}/billing/schedule-reminders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:r.uid,plan:e,months:o,days_before:5})})}catch{}}async function A(e,o,s=1){var p;const r=(p=h)==null?void 0:p.currentUser;if(!r||r.isAnonymous){alert("Para suscribirte debes iniciar sesi√≥n.");try{T()}catch{}window.location.href="/inicio?checkout=1";return}$(String(e||"").toUpperCase(),Number(s)||1);const n=r.email||localStorage.getItem("email")||"",i=F();let l=!!i;try{N(e,s);const d=await ne(e,o,n);if(l&&i){try{i.document&&(i.document.body.innerHTML=`
            <div class="box" style="height:100%;display:flex;align-items:center;justify-content:center;gap:.75rem;flex-direction:column;font-family:system-ui,-apple-system,Segoe UI,Roboto">
              <div class="spinner" style="width:28px;height:28px;border:3px solid #e5e7eb;border-top-color:#22c55e;border-radius:50%;animation:spin 1s linear infinite"></div>
              <div style="color:#334155">Redirigiendo a Flow‚Ä¶</div>
              <a href="${d}" style="color:#16a34a;text-decoration:none;font-weight:600">Si no contin√∫a autom√°ticamente, haz clic aqu√≠</a>
              <meta http-equiv="refresh" content="0;url=${d}">
              <script>setTimeout(function(){ try{ location.href=${JSON.stringify(d)} }catch(e){} }, 60);<\/script>
            </div>`)}catch{}i.location.href=d}else l=!!window.open(d,"_blank");setTimeout(()=>{l||(window.location.href=d)},300),setTimeout(()=>{l&&(window.location.href="/registro")},600)}catch(d){try{i&&!i.closed&&i.close()}catch{}console.error("[Pago][HTTP] Error creando pago:",d),alert(`No se pudo iniciar el pago con Flow (HTTP).
Detalle: ${(d==null?void 0:d.message)||d}`)}}const se=async(e,o,s=1)=>{var l,p,d;const r=(l=h)==null?void 0:l.currentUser;if(!r||r.isAnonymous){alert("Para suscribirte debes iniciar sesi√≥n.");try{T()}catch{}window.location.href="/inicio?checkout=1";return}try{localStorage.setItem("uid",r.uid),r.email&&localStorage.setItem("email",r.email)}catch{}const n=F();let i=!!n;try{const m=(e||"").toString().trim().toUpperCase();let g=Number(o);(!Number.isFinite(g)||g<=0)&&(g=I[m]??I.BASICO),localStorage.setItem("lastPlan",m),localStorage.setItem("lastPrecio",String(g)),localStorage.setItem("lastModo",Number(s)===12?"anual":"mensual"),$(m,Number(s)||1),N(m,s);const y={plan:m,precio:g,uid:localStorage.getItem("uid")||null,email:((d=(p=h)==null?void 0:p.currentUser)==null?void 0:d.email)||localStorage.getItem("email")||""};console.log("[Pago] Enviar a flowCreate (callable):",y);const w=await te(y),c=ee(w);if(!c)throw new Error("Respuesta inv√°lida del servidor (sin URL)");let a=M(c);a=String(a||""),(!a||!a.includes("token="))&&console.warn("[Pago] URL de Flow sin token (continuo igual):",a);try{if(i&&n){try{n.document&&(n.document.body.innerHTML=`
              <div class="box" style="height:100%;display:flex;align-items:center;justify-content:center;gap:.75rem;flex-direction:column;font-family:system-ui,-apple-system,Segoe UI,Roboto">
                <div class="spinner" style="width:28px;height:28px;border:3px solid #e5e7eb;border-top-color:#22c55e;border-radius:50%;animation:spin 1s linear infinite"></div>
                <div style="color:#334155">Redirigiendo a Flow‚Ä¶</div>
                <a href="${a}" style="color:#16a34a;text-decoration:none;font-weight:600">Si no contin√∫a autom√°ticamente, haz clic aqu√≠</a>
                <meta http-equiv="refresh" content="0;url=${a}">
                <script>setTimeout(function(){ try{ location.href=${JSON.stringify(a)} }catch(e){} }, 50);<\/script>
              </div>`)}catch{}n.location.href=a}else i=!!window.open(a,"_blank")}catch(f){console.warn("[Pago] window.open bloqueado por el navegador:",f),i=!1}setTimeout(()=>{i||(window.location.href=a)},300),setTimeout(()=>{i&&(window.location.href="/registro")},600)}catch(m){try{n&&!n.closed&&n.close()}catch{}console.error("Flow error:",m),alert(`No se pudo iniciar el pago con Flow.
Detalle: ${(m==null?void 0:m.message)||m}`)}};function le(){const e=D(),o=W(),s=(c="")=>{try{T()}catch{}const a=typeof c=="string"&&c?c.startsWith("?")?c:`?${c}`:"";e(`/inicio${a}`,{replace:!0,state:{from:"pago",resetTimers:!0}})};P.useEffect(()=>{Z().then(c=>{c&&(console.log("[Pago] Plan activado autom√°ticamente al volver."),s("?paid=1"))}).catch(c=>console.warn("[Pago] No se pudo activar autom√°ticamente:",(c==null?void 0:c.message)||c))},[e]);const[r,n]=P.useState(!1),[i,l]=P.useState(null);P.useEffect(()=>{const c=V(h,a=>{l(a||null),n(!0);try{a!=null&&a.uid&&localStorage.setItem("uid",a.uid),a!=null&&a.email&&localStorage.setItem("email",a.email)}catch{}});return()=>c()},[]);const[p,d]=P.useState(""),m=P.useRef(!1);P.useEffect(()=>{const c=new URLSearchParams(o.search||""),a=(c.get("plan")||"").toUpperCase(),f=(c.get("billing")||"monthly").toLowerCase();if(!a||m.current||!["BASICO","PRO","PREMIUM"].includes(a))return;const u=I[a]||0,b=f==="annual"||f==="year",E=b?Math.round(a==="PREMIUM"?u*10:u*11):u,v=b?a==="PREMIUM"?14:13:1;m.current=!0,d(`Abriendo Flow para plan ${a} (${b?"anual":"mensual"})‚Ä¶`);try{$(a,v)}catch{}A(a,E,v)},[o.search]);const g={minHeight:"100vh",background:"linear-gradient(to right, #2193b0, #6dd5ed)",padding:"2rem",fontFamily:"Segoe UI, sans-serif",color:"#ffffff"},y={display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"2rem",marginBottom:"2rem",maxWidth:1200,marginInline:"auto"},w=r&&(!i||i.isAnonymous);return t.createElement("div",{style:g},t.createElement("h2",{style:{textAlign:"center",marginBottom:"2rem",color:"#ffffff"}},"‚îÇ Elige tu Plan"),w&&t.createElement("div",{style:{maxWidth:760,margin:"0 auto 1rem",background:"rgba(255,255,255,.92)",color:"#0f172a",padding:"0.9rem 1.1rem",borderRadius:10,boxShadow:"0 6px 18px rgba(16,24,40,.12)",textAlign:"center",fontWeight:600}},"Para pagar necesitar√°s iniciar sesi√≥n. Puedes mirar y comparar los planes ahora, y al pagar te pediremos que ingreses.",t.createElement("div",{style:{marginTop:8}},t.createElement("button",{onClick:()=>e("/login?next=/pago"),style:{padding:"0.6rem 1rem",background:"#ffffff",color:"#2193b0",border:"1px solid #2193b0",borderRadius:8,fontWeight:800,cursor:"pointer"}},"Iniciar sesi√≥n"))),p&&t.createElement("div",{style:{maxWidth:760,margin:"0 auto 1rem",background:"rgba(255,255,255,.9)",color:"#0f172a",padding:"0.9rem 1.1rem",borderRadius:10,boxShadow:"0 6px 18px rgba(16,24,40,.12)",textAlign:"center",fontWeight:600}},p),t.createElement("div",{style:y},t.createElement(ae,{color:"#64748b",fondo:"#f1f5f9",onUse:()=>e("/registro?plan=free"),descripcion:["1 curso","1 clase por d√≠a","Nube de palabras (10 respuestas)","Sin exportaciones","Sin sugerencias de curr√≠culo"]}),t.createElement(_,{color:"#0288d1",fondo:"#e3f2fd",titulo:"B√°sico ¬∑ 1 juego",precioCLP:9990,annualPriceCLP:9990*11,annualGiftMonths:1,descripcion:["Hasta 3 cursos","Curr√≠culo sugerido (unidad/objetivo)","QR de participaci√≥n","1 juego de cierre","Asistencia b√°sica","Soporte por correo (48h)"],flowPlan:"BASICO",flowPrecio:9990}),t.createElement(_,{color:"#7e57c2",fondo:"#ede7f6",titulo:"Pro ¬∑ 5 juegos",precioCLP:19990,annualPriceCLP:19990*11,annualGiftMonths:1,descripcion:["Cursos ilimitados","OA y curr√≠culo sugeridos","QR + carreras","5 juegos de cierre","Asistencia con CSV","Soporte prioritario (24h)"],flowPlan:"PRO",flowPrecio:19990}),t.createElement(_,{color:"#f59e0b",fondo:"#fff8e1",titulo:"Platinum ¬∑ 10 juegos",precioCLP:29990,annualPriceCLP:29990*10,annualGiftMonths:2,descripcion:["Todo en Pro","Grabaci√≥n de clase","Alarma anti-ruido","10 juegos de cierre","Panel de m√©tricas","Soporte dedicado"],flowPlan:"PREMIUM",flowPrecio:29990})),t.createElement("div",{style:{textAlign:"center",marginTop:"0.5rem"}},t.createElement("small",null,"En modalidad ",t.createElement("b",null,"anual")," regalamos ",t.createElement("b",null,"+1 mes")," adicional (se activan 13 meses). En ",t.createElement("b",null,"Platinum")," regalamos ",t.createElement("b",null,"+2 meses")," (14 meses). Se env√≠an recordatorios por correo 5 d√≠as antes del fin de la prueba y antes de cada renovaci√≥n.")),t.createElement("div",{style:{maxWidth:900,margin:"1.75rem auto 2rem",background:"rgba(255,255,255,.92)",color:"#0f172a",padding:"1.25rem",borderRadius:12,boxShadow:"0 6px 18px rgba(16,24,40,.12)"}},t.createElement("h3",{style:{marginTop:0}},"Planes para Colegios"),t.createElement("p",{style:{marginBottom:8}},"Descuentos por docente seg√∫n tama√±o:"),t.createElement("ul",{style:{marginTop:0}},t.createElement("li",null,"30 profes: ",t.createElement("b",null,"‚Äì$2.000")," por profe"),t.createElement("li",null,"50 profes: ",t.createElement("b",null,"‚Äì$3.000")," por profe"),t.createElement("li",null,"80 profes: ",t.createElement("b",null,"‚Äì$4.000")," por profe"),t.createElement("li",null,"100 profes: ",t.createElement("b",null,"‚Äì$5.000")," por profe")),t.createElement("p",null,"Todos los profesores que paguen anual reciben el mes de regalo correspondiente."),t.createElement("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"}},t.createElement("label",null,"Tama√±o:",t.createElement("select",{id:"colegio-size",defaultValue:"30",style:{marginLeft:8}},t.createElement("option",{value:"30"},"30 profes"),t.createElement("option",{value:"50"},"50 profes"),t.createElement("option",{value:"80"},"80 profes"),t.createElement("option",{value:"100"},"100 profes"))),t.createElement("label",null,"Plan base:",t.createElement("select",{id:"colegio-plan",defaultValue:"PRO",style:{marginLeft:8}},t.createElement("option",{value:"BASICO"},"B√°sico"),t.createElement("option",{value:"PRO"},"Pro (5 juegos)"),t.createElement("option",{value:"PREMIUM"},"Platinum"))),t.createElement("button",{onClick:()=>{const c=Number(document.getElementById("colegio-size").value),a=document.getElementById("colegio-plan").value,f=I[a],u=c>=100?5e3:c>=80?4e3:c>=50?3e3:2e3,E=Math.max(1e3,f-u)*c,v=encodeURIComponent(`Cotizaci√≥n Colegio ${c} profes ¬∑ Plan ${a}`),O=encodeURIComponent(`Hola, deseo cotizar ${c} licencias del plan ${a}.
Precio base: ${f.toLocaleString("es-CL")} CLP, descuento: ${u.toLocaleString("es-CL")} por profe.
Total mensual aprox: ${E.toLocaleString("es-CL")} CLP.
Datos del colegio: ...`);window.location.href=`mailto:contactocolegios@pragmaprofe.com?subject=${v}&body=${O}`},style:{padding:"0.6rem 1rem",borderRadius:8,border:"1px solid #0ea5e9",background:"#fff",color:"#0ea5e9",fontWeight:700,cursor:"pointer"}},"Solicitar cotizaci√≥n"))),t.createElement("div",{style:{textAlign:"center",marginTop:"1.25rem"}},t.createElement("button",{onClick:()=>e("/"),style:{padding:"0.8rem 1.5rem",backgroundColor:"#ffffff",color:"#2193b0",border:"none",borderRadius:"8px",fontSize:"1rem",fontWeight:"bold",cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,0.2)"}},"Volver al Inicio")))}function ae({color:e,fondo:o,descripcion:s,onUse:r}){const n={background:"#ffffff",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)",border:"1px solid #e5e7eb",textAlign:"center"};return t.createElement("div",{style:n},t.createElement("div",{style:{background:o,borderRadius:10,padding:"0.75rem 1rem",marginBottom:"0.75rem"}},t.createElement("h3",{style:{color:e,margin:0}},"Free")),t.createElement("p",{style:{marginTop:0,marginBottom:"0.5rem",fontSize:"1.15rem"}},t.createElement("strong",null,"Gratis / mes")),s.map((i,l)=>t.createElement("p",{key:l,style:{margin:"0.25rem 0",color:"#334155"}},i)),t.createElement("div",{style:{marginTop:"1rem"}},t.createElement("button",{onClick:r,style:{padding:"0.6rem 1rem",color:"#0ea5e9",border:"2px solid #0ea5e9",borderRadius:"6px",cursor:"pointer",fontWeight:"bold",background:"#ffffff"}},"Usar gratis")))}function _({color:e,fondo:o,titulo:s,precioCLP:r,annualPriceCLP:n,annualGiftMonths:i=1,descripcion:l,flowPlan:p,flowPrecio:d}){const m={background:"#ffffff",borderRadius:"12px",padding:"1.5rem",boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)",border:"1px solid #e5e7eb",textAlign:"center"},g=a=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(a),y={padding:"0.6rem 1rem",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"bold",background:"#43a047"},w={padding:"0.6rem 1rem",color:"#0ea5e9",border:"2px solid #0ea5e9",borderRadius:"6px",cursor:"pointer",fontWeight:"bold",background:"#ffffff"},c=12+(i||1);return t.createElement("div",{style:m},t.createElement("div",{style:{background:o,borderRadius:10,padding:"0.75rem 1rem",marginBottom:"0.75rem"}},t.createElement("h3",{style:{color:e,margin:0}},s)),t.createElement("p",{style:{marginTop:0,marginBottom:"0.25rem",fontSize:"1.15rem"}},t.createElement("strong",null,g(r)," / mes")),t.createElement("p",{style:{margin:0,fontSize:"0.85rem",color:"#64748b"}},n?`o anual ${g(n)} (${i===2?"+2 meses":"+1 mes"})`:""),l.map((a,f)=>t.createElement("p",{key:f,style:{margin:"0.25rem 0",color:"#334155"}},a)),t.createElement("div",{style:{marginTop:"1rem",display:"flex",flexDirection:"column",gap:"0.5rem"}},t.createElement("button",{style:y,onClick:()=>A(p,d,1),"aria-label":`Pagar plan ${s} mensual con Flow.cl`},"Pagar mensual ‚Äî ",g(d),t.createElement("div",{style:{fontSize:"0.75rem",color:"#e6ffe6",marginTop:"0.2rem"}},"Cuenta RUT o d√©bito (Chile)")),n?t.createElement("button",{style:w,onClick:()=>A(p,n,c),"aria-label":`Pagar plan ${s} anual con Flow.cl`},"Pagar anual ‚Äî ",g(n)):null))}function ce(e){try{const o=window.open("","_blank");if(o&&o.document){o.document.write(`<!doctype html><html><head><meta charset="utf-8">
        <title>Abriendo Flow‚Ä¶</title>
        <style>
          html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto}
          .box{height:100%;display:flex;align-items:center;justify-content:center;gap:.75rem;flex-direction:column}
          .s{width:28px;height:28px;border:3px solid #e5e7eb;border-top-color:#22c55e;border-radius:50%;animation:spin 1s linear infinite}
          @keyframes spin{to{transform:rotate(360deg)}}
        </style></head>
        <body><div class="box">
          <div class="s"></div>
          <div>Redirigiendo a Flow‚Ä¶</div>
          <a href="${e}" target="_self" rel="noreferrer">Ir a Flow</a>
          <meta http-equiv="refresh" content="0;url=${e}">
          <script>setTimeout(function(){ try{ location.href=${JSON.stringify(e)} }catch(e){} }, 60);<\/script>
        </div></body></html>`),o.document.close();try{o.location.href=e}catch{}return!0}}catch{}try{window.location.href=e}catch{}return!1}async function de(e,o,s={}){var g,y,w,c;const r=String(e||"").toUpperCase(),n=Number(o)>0?Number(o):0,i=((y=(g=h)==null?void 0:g.currentUser)==null?void 0:y.uid)||null,l=((c=(w=h)==null?void 0:w.currentUser)==null?void 0:c.email)||"",p={plan:r,precio:n,uid:i,email:l,...s},d=a=>{try{const f=new URL(a),u=f.searchParams.get("token"),E=/sandbox\.flow\.cl/i.test(f.hostname)||/sandbox\.flow\.cl/i.test(a)?"https://sandbox.flow.cl":"https://www.flow.cl";return u?`${E}/app/web/pay.php?token=${u}`:a}catch{return a}},m=()=>{const a="https://sandbox.flow.cl",f=`DUMMY-${Date.now()}`;return`${a}/app/web/pay.php?token=${encodeURIComponent(f)}`};try{const a=U(C,"southamerica-east1"),u=await k(a,"flowCreateV2")(p),b=typeof(u==null?void 0:u.data)=="string"?{url:u.data}:(u==null?void 0:u.data)||{},E=(b==null?void 0:b.url)||(b==null?void 0:b.paymentUrl)||(b==null?void 0:b.paymentURL)||"";return d(E||m())}catch(a){return console.warn("[__crearPagoConFallback] callable fall√≥, uso stub:",(a==null?void 0:a.message)||a),m()}}function me(){var e,o;return{now:new Date().toISOString(),uid:((o=(e=h)==null?void 0:e.currentUser)==null?void 0:o.uid)||null,region:"southamerica-east1",note:"Helpers opcionales; si quieres usarlas: const url = await __crearPagoConFallback('BASICO', 9990); __openFlowWindow(url);"}}export{de as __crearPagoConFallback,ce as __openFlowWindow,me as __pagoDebug,le as default,Z as intentarActivarSiPendiente,se as pagarConFlow,A as pagarConFlowHttp};
