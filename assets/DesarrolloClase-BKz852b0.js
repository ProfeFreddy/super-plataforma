import{r as d,R as o,t as H,v as ze,w as dt,x as he,y as An,z as kn,A as Mn,B as Fr,C as Ur,D as jr,E as Hr,F as Ve,G as Nr,H as _t,I as Xn,J as Je,K as qr,u as Vr,b as zr,c as Yr,o as Kr,h as lt,d as ve,e as be,i as Re,q as Xr,l as Zr,L as Jr,M as Qr,N as Ge,p as ei,k as ti}from"./index-BqLPJdMO.js";import{_ as g,P as ni,C as ri}from"./CronometroGlobal-CTnLldTF.js";import{P as ii}from"./planCaps-OxFxGX_F.js";var te=function(r,a,c){if(c||arguments.length===2)for(var i=0,h=a.length,w;i<h;i++)(w||!(i in a))&&(w||(w=Array.prototype.slice.call(a,0,i)),w[i]=a[i]);return r.concat(w||Array.prototype.slice.call(a))},si=["onCopy","onCut","onPaste"],oi=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],ai=["onFocus","onBlur"],ci=["onInput","onInvalid","onReset","onSubmit"],li=["onLoad","onError"],hi=["onKeyDown","onKeyPress","onKeyUp"],di=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],ui=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],gi=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],pi=["onSelect"],fi=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],mi=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],yi=["onScroll"],wi=["onWheel"],bi=["onAnimationStart","onAnimationEnd","onAnimationIteration"],xi=["onTransitionEnd"],Si=["onToggle"],Pi=["onChange"],Zn=te(te(te(te(te(te(te(te(te(te(te(te(te(te(te(te(te(te([],si,!0),oi,!0),ai,!0),ci,!0),li,!0),hi,!0),di,!0),ui,!0),gi,!0),pi,!0),fi,!0),mi,!0),yi,!0),wi,!0),bi,!0),xi,!0),Pi,!0),Si,!0);function Jn(r,a){var c={};return Zn.forEach(function(i){var h=r[i];h&&(a?c[i]=function(w){return h(w,a(i))}:c[i]=h)}),c}function pt(r){var a=!1,c=new Promise(function(i,h){r.then(function(w){return!a&&i(w)}).catch(function(w){return!a&&h(w)})});return{promise:c,cancel:function(){a=!0}}}function Qn(r){var a,c,i="";if(typeof r=="string"||typeof r=="number")i+=r;else if(typeof r=="object")if(Array.isArray(r)){var h=r.length;for(a=0;a<h;a++)r[a]&&(c=Qn(r[a]))&&(i&&(i+=" "),i+=c)}else for(c in r)r[c]&&(i&&(i+=" "),i+=c);return i}function $t(){for(var r,a,c=0,i="",h=arguments.length;c<h;c++)(r=arguments[c])&&(a=Qn(r))&&(i&&(i+=" "),i+=a);return i}var On=Object.prototype.hasOwnProperty;function _n(r,a,c){for(c of r.keys())if(ut(c,a))return c}function ut(r,a){var c,i,h;if(r===a)return!0;if(r&&a&&(c=r.constructor)===a.constructor){if(c===Date)return r.getTime()===a.getTime();if(c===RegExp)return r.toString()===a.toString();if(c===Array){if((i=r.length)===a.length)for(;i--&&ut(r[i],a[i]););return i===-1}if(c===Set){if(r.size!==a.size)return!1;for(i of r)if(h=i,h&&typeof h=="object"&&(h=_n(a,h),!h)||!a.has(h))return!1;return!0}if(c===Map){if(r.size!==a.size)return!1;for(i of r)if(h=i[0],h&&typeof h=="object"&&(h=_n(a,h),!h)||!ut(i[1],a.get(h)))return!1;return!0}if(c===ArrayBuffer)r=new Uint8Array(r),a=new Uint8Array(a);else if(c===DataView){if((i=r.byteLength)===a.byteLength)for(;i--&&r.getInt8(i)===a.getInt8(i););return i===-1}if(ArrayBuffer.isView(r)){if((i=r.byteLength)===a.byteLength)for(;i--&&r[i]===a[i];);return i===-1}if(!c||typeof r=="object"){i=0;for(c in r)if(On.call(r,c)&&++i&&!On.call(a,c)||!(c in a)||!ut(r[c],a[c]))return!1;return Object.keys(a).length===i}}return r!==r&&a!==a}const er=d.createContext(null);function gt({children:r,type:a}){return o.createElement("div",{className:`react-pdf__message react-pdf__message--${a}`},r)}const Ei="noopener noreferrer nofollow";class tr{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(a){this.pdfDocument=a}setViewer(a){this.pdfViewer=a}setExternalLinkRel(a){this.externalLinkRel=a}setExternalLinkTarget(a){this.externalLinkTarget=a}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return H(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(a){H(this.pdfViewer),this.pdfViewer.currentPageNumber=a}get rotation(){return 0}set rotation(a){}goToDestination(a){return new Promise(c=>{H(this.pdfDocument),H(a),typeof a=="string"?this.pdfDocument.getDestination(a).then(c):Array.isArray(a)?c(a):a.then(c)}).then(c=>{H(Array.isArray(c));const i=c[0];new Promise(h=>{H(this.pdfDocument),i instanceof Object?this.pdfDocument.getPageIndex(i).then(w=>{h(w)}).catch(()=>{H(!1)}):typeof i=="number"?h(i):H(!1)}).then(h=>{const w=h+1;H(this.pdfViewer),H(w>=1&&w<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:c,pageIndex:h,pageNumber:w})})})}navigateTo(a){this.goToDestination(a)}goToPage(a){const c=a-1;H(this.pdfViewer),H(a>=1&&a<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:c,pageNumber:a})}addLinkAttributes(a,c,i){a.href=c,a.rel=this.externalLinkRel||Ei,a.target=i?"_blank":this.externalLinkTarget||""}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}setHash(){}executeNamedAction(){}cachePageRef(){}isPageVisible(){return!0}isPageCached(){return!0}executeSetOCGState(){}}const $n={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};function vi(r,a){switch(a.type){case"RESOLVE":return{value:a.value,error:void 0};case"REJECT":return{value:!1,error:a.error};case"RESET":return{value:void 0,error:void 0};default:return r}}function tt(){return d.useReducer(vi,{value:void 0,error:void 0})}const{PDFDataRangeTransport:Ri}=ze,nr=(()=>{const r={};return Zn.forEach(a=>{r[a]=g.func}),r})(),Ci=g.oneOfType([g.instanceOf(Int8Array),g.instanceOf(Uint8Array),g.instanceOf(Uint8ClampedArray),g.instanceOf(Int16Array),g.instanceOf(Uint16Array),g.instanceOf(Int32Array),g.instanceOf(Uint32Array),g.instanceOf(Float32Array),g.instanceOf(Float64Array)]),rr=[g.string,g.instanceOf(ArrayBuffer),g.shape({data:g.oneOfType([g.string,g.instanceOf(ArrayBuffer),g.arrayOf(g.number.isRequired),Ci]).isRequired}),g.shape({range:g.instanceOf(Ri).isRequired}),g.shape({url:g.string.isRequired})];typeof Blob<"u"&&rr.push(g.instanceOf(Blob));const ir=g.oneOfType([g.string,g.arrayOf(g.string)]),Ti=g.oneOfType(rr);g.instanceOf(tr);g.oneOf(["_self","_blank","_parent","_top"]);g.shape({commonObjs:g.shape({}).isRequired,getAnnotations:g.func.isRequired,getTextContent:g.func.isRequired,getViewport:g.func.isRequired,render:g.func.isRequired});const Li=function(a,c,i){const{[c]:h,pageNumber:w,pdf:E}=a;if(!dt(E))return null;if(dt(h)){if(typeof h!="number")return new Error(`\`${c}\` of type \`${typeof h}\` supplied to \`${i}\`, expected \`number\`.`);if(h<0)return new Error(`Expected \`${c}\` to be greater or equal to 0.`);const{numPages:C}=E;if(h+1>C)return new Error(`Expected \`${c}\` to be less or equal to ${C-1}.`)}else if(!dt(w))return new Error(`\`${c}\` not supplied. Either pageIndex or pageNumber must be supplied to \`${i}\`.`);return null},Di=function(a,c,i){const{[c]:h,pageIndex:w,pdf:E}=a;if(!dt(E))return null;if(dt(h)){if(typeof h!="number")return new Error(`\`${c}\` of type \`${typeof h}\` supplied to \`${i}\`, expected \`number\`.`);if(h<1)return new Error(`Expected \`${c}\` to be greater or equal to 1.`);const{numPages:C}=E;if(h>C)return new Error(`Expected \`${c}\` to be less or equal to ${C}.`)}else if(!dt(w))return new Error(`\`${c}\` not supplied. Either pageIndex or pageNumber must be supplied to \`${i}\`.`);return null},Ii=g.oneOfType([g.any,g.oneOf([!1])]),sn=g.oneOfType([g.func,g.exact({current:g.any})]),Ai=g.oneOf(["canvas","custom","none","svg"]),ki=g.oneOf([0,90,180,270]);var Mi=function(r,a,c,i){function h(w){return w instanceof c?w:new c(function(E){E(w)})}return new(c||(c=Promise))(function(w,E){function C(I){try{v(i.next(I))}catch(D){E(D)}}function x(I){try{v(i.throw(I))}catch(D){E(D)}}function v(I){I.done?w(I.value):h(I.value).then(C,x)}v((i=i.apply(r,a||[])).next())})},Gn=function(r,a){var c={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&a.indexOf(i)<0&&(c[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,i=Object.getOwnPropertySymbols(r);h<i.length;h++)a.indexOf(i[h])<0&&Object.prototype.propertyIsEnumerable.call(r,i[h])&&(c[i[h]]=r[i[h]]);return c};const{PDFDataRangeTransport:Oi}=ze,_i=(r,a)=>{switch(a){case $n.NEED_PASSWORD:{const c=prompt("Enter the password to open this PDF file.");r(c);break}case $n.INCORRECT_PASSWORD:{const c=prompt("Invalid password. Please try again.");r(c);break}}};function Wn(r){return typeof r=="object"&&r!==null&&("data"in r||"range"in r||"url"in r)}const on=d.forwardRef(function(a,c){var{children:i,className:h,error:w="Failed to load PDF file.",externalLinkRel:E,externalLinkTarget:C,file:x,inputRef:v,imageResourcesPath:I,loading:D="Loading PDF…",noData:W="No PDF file specified.",onItemClick:L,onLoadError:M,onLoadProgress:$,onLoadSuccess:O,onPassword:F=_i,onSourceError:j,onSourceSuccess:m,options:e,renderMode:t,rotate:n}=a,l=Gn(a,["children","className","error","externalLinkRel","externalLinkTarget","file","inputRef","imageResourcesPath","loading","noData","onItemClick","onLoadError","onLoadProgress","onLoadSuccess","onPassword","onSourceError","onSourceSuccess","options","renderMode","rotate"]);const[u,p]=tt(),{value:P,error:y}=u,[A,k]=tt(),{value:_,error:K}=A,J=d.useRef(new tr),X=d.useRef([]),z=d.useRef(),ae=d.useRef();d.useEffect(()=>{x&&x!==z.current&&Wn(x)&&(he(!ut(x,z.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),z.current=x)},[x]),d.useEffect(()=>{e&&e!==ae.current&&(he(!ut(e,ae.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),ae.current=e)},[e]);const ge=d.useRef({scrollPageIntoView:N=>{const{dest:U,pageNumber:fe,pageIndex:Se=fe-1}=N;if(L){L({dest:U,pageIndex:Se,pageNumber:fe});return}const Y=X.current[Se];if(Y){Y.scrollIntoView();return}he(!1,`An internal link leading to page ${fe} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});d.useImperativeHandle(c,()=>({linkService:J,pages:X,viewer:ge}),[]);function Ce(){m&&m()}function Ye(){y&&(he(!1,y.toString()),j&&j(y))}function Ae(){p({type:"RESET"})}d.useEffect(Ae,[x,p]);const Fe=d.useCallback(()=>Mi(this,void 0,void 0,function*(){if(!x)return null;if(typeof x=="string")return An(x)?{data:kn(x)}:(Mn(),{url:x});if(x instanceof Oi)return{range:x};if(Fr(x))return{data:x};if(Ur&&jr(x))return{data:yield Hr(x)};if(H(typeof x=="object"),H(Wn(x)),"url"in x&&typeof x.url=="string"){if(An(x.url)){const{url:N}=x,U=Gn(x,["url"]),fe=kn(N);return Object.assign({data:fe},U)}Mn()}return x}),[x]);d.useEffect(()=>{const N=pt(Fe());return N.promise.then(U=>{p({type:"RESOLVE",value:U})}).catch(U=>{p({type:"REJECT",error:U})}),()=>{Ve(N)}},[Fe,p]),d.useEffect(()=>{if(!(typeof P>"u")){if(P===!1){Ye();return}Ce()}},[P]);function ke(){_&&(O&&O(_),X.current=new Array(_.numPages),J.current.setDocument(_))}function Ke(){K&&(he(!1,K.toString()),M&&M(K))}function Me(){k({type:"RESET"})}d.useEffect(Me,[k,P]);function nt(){if(!P)return;const N=Object.assign(Object.assign({},e),{isEvalSupported:!1}),U=Object.assign(Object.assign({},P),N),fe=ze.getDocument(U);$&&(fe.onProgress=$),F&&(fe.onPassword=F);const Se=fe;return Se.promise.then(Y=>{k({type:"RESOLVE",value:Y})}).catch(Y=>{Se.destroyed||k({type:"REJECT",error:Y})}),()=>{Se.destroy()}}d.useEffect(nt,[e,k,P]),d.useEffect(()=>{if(!(typeof _>"u")){if(_===!1){Ke();return}ke()}},[_]);function rt(){J.current.setViewer(ge.current),J.current.setExternalLinkRel(E),J.current.setExternalLinkTarget(C)}d.useEffect(rt,[E,C]);function ce(N,U){X.current[N]=U}function q(N){delete X.current[N]}const xe=d.useMemo(()=>({imageResourcesPath:I,linkService:J.current,onItemClick:L,pdf:_,registerPage:ce,renderMode:t,rotate:n,unregisterPage:q}),[I,L,_,t,n]),de=d.useMemo(()=>Jn(l,()=>_),[l,_]);function re(){return o.createElement(er.Provider,{value:xe},i)}function pe(){return x?_==null?o.createElement(gt,{type:"loading"},typeof D=="function"?D():D):_===!1?o.createElement(gt,{type:"error"},typeof w=="function"?w():w):re():o.createElement(gt,{type:"no-data"},typeof W=="function"?W():W)}return o.createElement("div",Object.assign({className:$t("react-pdf__Document",h),ref:v,style:{"--scale-factor":"1"}},de),pe())}),Jt=g.oneOfType([g.func,g.node]);on.propTypes=Object.assign(Object.assign({},nr),{children:g.node,className:ir,error:Jt,externalLinkRel:g.string,externalLinkTarget:g.oneOf(["_self","_blank","_parent","_top"]),file:Ti,imageResourcesPath:g.string,inputRef:sn,loading:Jt,noData:Jt,onItemClick:g.func,onLoadError:g.func,onLoadProgress:g.func,onLoadSuccess:g.func,onPassword:g.func,onSourceError:g.func,onSourceSuccess:g.func,options:g.shape({canvasFactory:g.any,canvasMaxAreaInBytes:g.number,cMapPacked:g.bool,CMapReaderFactory:g.any,cMapUrl:g.string,disableAutoFetch:g.bool,disableFontFace:g.bool,disableRange:g.bool,disableStream:g.bool,docBaseUrl:g.string,enableXfa:g.bool,filterFactory:g.any,fontExtraProperties:g.bool,httpHeaders:g.object,isEvalSupported:g.bool,isOffscreenCanvasSupported:g.bool,length:g.number,maxImageSize:g.number,ownerDocument:g.any,password:g.string,pdfBug:g.bool,rangeChunkSize:g.number,StandardFontDataFactory:g.any,standardFontDataUrl:g.string,stopAtErrors:g.bool,useSystemFonts:g.bool,useWorkerFetch:g.bool,verbosity:g.number,withCredentials:g.bool,worker:g.any}),rotate:g.number});function sr(){return d.useContext(er)}function or(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];var c=r.filter(Boolean);if(c.length<=1){var i=c[0];return i||null}return function(w){c.forEach(function(E){typeof E=="function"?E(w):E&&(E.current=w)})}}const ar=d.createContext(null),cr={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},$i=/^H(\d+)$/;function Gi(r){return r in cr}function Gt(r){return"children"in r}function lr(r){return Gt(r)?r.children.length===1&&0 in r.children&&"id"in r.children[0]:!1}function Wi(r){const a={};if(Gt(r)){const{role:c}=r,i=c.match($i);if(i)a.role="heading",a["aria-level"]=Number(i[1]);else if(Gi(c)){const h=cr[c];h&&(a.role=h)}}return a}function hr(r){const a={};if(Gt(r)){if(r.alt!==void 0&&(a["aria-label"]=r.alt),r.lang!==void 0&&(a.lang=r.lang),lr(r)){const[c]=r.children;if(c){const i=hr(c);return Object.assign(Object.assign({},a),i)}}}else"id"in r&&(a["aria-owns"]=r.id);return a}function Bi(r){return r?Object.assign(Object.assign({},Wi(r)),hr(r)):null}function dr({className:r,node:a}){const c=d.useMemo(()=>Bi(a),[a]),i=d.useMemo(()=>!Gt(a)||lr(a)?null:a.children.map((h,w)=>o.createElement(dr,{key:w,node:h})),[a]);return o.createElement("span",Object.assign({className:r},c),i)}function St(){return d.useContext(ar)}function Fi(){const r=St();H(r);const{onGetStructTreeError:a,onGetStructTreeSuccess:c}=r,[i,h]=tt(),{value:w,error:E}=i,{customTextRenderer:C,page:x}=r;function v(){w&&c&&c(w)}function I(){E&&(he(!1,E.toString()),a&&a(E))}function D(){h({type:"RESET"})}d.useEffect(D,[h,x]);function W(){if(C||!x)return;const L=pt(x.getStructTree()),M=L;return L.promise.then($=>{h({type:"RESOLVE",value:$})}).catch($=>{h({type:"REJECT",error:$})}),()=>Ve(M)}return d.useEffect(W,[C,x,h]),d.useEffect(()=>{if(w!==void 0){if(w===!1){I();return}v()}},[w]),w?o.createElement(dr,{className:"react-pdf__Page__structTree structTree",node:w}):null}const Bn=ze.AnnotationMode;function Ui(r){const a=St();H(a);const c=Object.assign(Object.assign({},a),r),{_className:i,canvasBackground:h,devicePixelRatio:w=Nr(),onRenderError:E,onRenderSuccess:C,page:x,renderForms:v,renderTextLayer:I,rotate:D,scale:W}=c,{canvasRef:L}=r;H(x);const M=d.useRef(null);function $(){x&&C&&C(_t(x,W))}function O(t){Xn(t)||(he(!1,t.toString()),E&&E(t))}const F=d.useMemo(()=>x.getViewport({scale:W*w,rotation:D}),[w,x,D,W]),j=d.useMemo(()=>x.getViewport({scale:W,rotation:D}),[x,D,W]);function m(){if(!x)return;x.cleanup();const{current:t}=M;if(!t)return;t.width=F.width,t.height=F.height,t.style.width=`${Math.floor(j.width)}px`,t.style.height=`${Math.floor(j.height)}px`,t.style.visibility="hidden";const n={annotationMode:v?Bn.ENABLE_FORMS:Bn.ENABLE,canvasContext:t.getContext("2d",{alpha:!1}),viewport:F};h&&(n.background=h);const l=x.render(n),u=l;return l.promise.then(()=>{t.style.visibility="",$()}).catch(O),()=>Ve(u)}d.useEffect(m,[h,M,w,x,v,F,j]);const e=d.useCallback(()=>{const{current:t}=M;t&&(t.width=0,t.height=0)},[M]);return d.useEffect(()=>e,[e]),o.createElement("canvas",{className:`${i}__canvas`,dir:"ltr",ref:or(L,M),style:{display:"block",userSelect:"none"}},I?o.createElement(Fi,null):null)}function ji(){const r=St();H(r);const{_className:a,onRenderSuccess:c,onRenderError:i,page:h,rotate:w,scale:E}=r;H(h);const[C,x]=tt(),{value:v,error:I}=C;function D(){h&&c&&c(_t(h,E))}function W(){I&&(Xn(I)||(he(!1,I.toString()),i&&i(I)))}const L=d.useMemo(()=>h.getViewport({scale:E,rotation:w}),[h,w,E]);function M(){x({type:"RESET"})}d.useEffect(M,[h,x,L]);function $(){if(!h)return;const m=pt(h.getOperatorList());return m.promise.then(e=>{new ze.SVGGraphics(h.commonObjs,h.objs).getSVG(e,L).then(n=>{if(!(n instanceof SVGElement))throw new Error("getSVG returned unexpected result.");x({type:"RESOLVE",value:n})}).catch(n=>{x({type:"REJECT",error:n})})}).catch(e=>{x({type:"REJECT",error:e})}),()=>Ve(m)}d.useEffect($,[h,x,L]),d.useEffect(()=>{if(v!==void 0){if(v===!1){W();return}D()}},[v]);function O(m){if(!m||!v)return;m.firstElementChild||m.appendChild(v);const{width:e,height:t}=L;v.setAttribute("width",`${e}`),v.setAttribute("height",`${t}`)}const{width:F,height:j}=L;return o.createElement("div",{className:`${a}__svg`,ref:m=>O(m),style:{display:"block",backgroundColor:"white",overflow:"hidden",width:F,height:j,userSelect:"none"}})}function Hi(r){return"str"in r}function Ni(){const r=St();H(r);const{customTextRenderer:a,onGetTextError:c,onGetTextSuccess:i,onRenderTextLayerError:h,onRenderTextLayerSuccess:w,page:E,pageIndex:C,pageNumber:x,rotate:v,scale:I}=r;H(E);const[D,W]=tt(),{value:L,error:M}=D,$=d.useRef(null),O=d.useRef();he(parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function F(){L&&i&&i(L)}function j(){M&&(he(!1,M.toString()),c&&c(M))}function m(){W({type:"RESET"})}d.useEffect(m,[E,W]);function e(){if(!E)return;const y=pt(E.getTextContent()),A=y;return y.promise.then(k=>{W({type:"RESOLVE",value:k})}).catch(k=>{W({type:"REJECT",error:k})}),()=>Ve(A)}d.useEffect(e,[E,W]),d.useEffect(()=>{if(L!==void 0){if(L===!1){j();return}F()}},[L]);const t=d.useCallback(()=>{w&&w()},[w]),n=d.useCallback(y=>{he(!1,y.toString()),h&&h(y)},[h]);function l(){const y=O.current;y&&y.classList.add("active")}function u(){const y=O.current;y&&y.classList.remove("active")}const p=d.useMemo(()=>E.getViewport({scale:I,rotation:v}),[E,v,I]);function P(){if(!E||!L)return;const{current:y}=$;if(!y)return;y.innerHTML="";const A=E.streamTextContent({includeMarkedContent:!0}),k={container:y,textContentSource:A,viewport:p},_=ze.renderTextLayer(k),K=_;return _.promise.then(()=>{const J=document.createElement("div");J.className="endOfContent",y.append(J),O.current=J;const X=y.querySelectorAll('[role="presentation"]');if(a){let z=0;L.items.forEach((ae,ge)=>{if(!Hi(ae))return;const Ce=X[z];if(!Ce)return;const Ye=a(Object.assign({pageIndex:C,pageNumber:x,itemIndex:ge},ae));Ce.innerHTML=Ye,z+=ae.str&&ae.hasEOL?2:1})}t()}).catch(n),()=>Ve(K)}return d.useLayoutEffect(P,[a,n,t,E,C,x,L,p]),o.createElement("div",{className:$t("react-pdf__Page__textContent","textLayer"),onMouseUp:u,onMouseDown:l,ref:$})}function qi(){const r=sr(),a=St();H(a);const c=Object.assign(Object.assign({},r),a),{imageResourcesPath:i,linkService:h,onGetAnnotationsError:w,onGetAnnotationsSuccess:E,onRenderAnnotationLayerError:C,onRenderAnnotationLayerSuccess:x,page:v,pdf:I,renderForms:D,rotate:W,scale:L=1}=c;H(I),H(v),H(h);const[M,$]=tt(),{value:O,error:F}=M,j=d.useRef(null);he(parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function m(){O&&E&&E(O)}function e(){F&&(he(!1,F.toString()),w&&w(F))}function t(){$({type:"RESET"})}d.useEffect(t,[$,v]);function n(){if(!v)return;const y=pt(v.getAnnotations()),A=y;return y.promise.then(k=>{$({type:"RESOLVE",value:k})}).catch(k=>{$({type:"REJECT",error:k})}),()=>{Ve(A)}}d.useEffect(n,[$,v,D]),d.useEffect(()=>{if(O!==void 0){if(O===!1){e();return}m()}},[O]);function l(){x&&x()}function u(y){he(!1,`${y}`),C&&C(y)}const p=d.useMemo(()=>v.getViewport({scale:L,rotation:W}),[v,W,L]);function P(){if(!I||!v||!h||!O)return;const{current:y}=j;if(!y)return;const A=p.clone({dontFlip:!0}),k={accessibilityManager:null,annotationCanvasMap:null,div:y,l10n:null,page:v,viewport:A},_={annotations:O,annotationStorage:I.annotationStorage,div:y,downloadManager:null,imageResourcesPath:i,linkService:h,page:v,renderForms:D,viewport:A};y.innerHTML="";try{new ze.AnnotationLayer(k).render(_),l()}catch(K){u(K)}return()=>{}}return d.useEffect(P,[O,i,h,v,D,p]),o.createElement("div",{className:$t("react-pdf__Page__annotations","annotationLayer"),ref:j})}var Vi=function(r,a){var c={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&a.indexOf(i)<0&&(c[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,i=Object.getOwnPropertySymbols(r);h<i.length;h++)a.indexOf(i[h])<0&&Object.prototype.propertyIsEnumerable.call(r,i[h])&&(c[i[h]]=r[i[h]]);return c};const Fn=1,an=function(a){const c=sr(),i=Object.assign(Object.assign({},c),a),{_className:h="react-pdf__Page",_enableRegisterUnregisterPage:w=!0,canvasBackground:E,canvasRef:C,children:x,className:v,customRenderer:I,customTextRenderer:D,devicePixelRatio:W,error:L="Failed to load the page.",height:M,inputRef:$,loading:O="Loading page…",noData:F="No page specified.",onGetAnnotationsError:j,onGetAnnotationsSuccess:m,onGetStructTreeError:e,onGetStructTreeSuccess:t,onGetTextError:n,onGetTextSuccess:l,onLoadError:u,onLoadSuccess:p,onRenderAnnotationLayerError:P,onRenderAnnotationLayerSuccess:y,onRenderError:A,onRenderSuccess:k,onRenderTextLayerError:_,onRenderTextLayerSuccess:K,pageIndex:J,pageNumber:X,pdf:z,registerPage:ae,renderAnnotationLayer:ge=!0,renderForms:Ce=!1,renderMode:Ye="canvas",renderTextLayer:Ae=!0,rotate:Fe,scale:ke=Fn,unregisterPage:Ke,width:Me}=i,nt=Vi(i,["_className","_enableRegisterUnregisterPage","canvasBackground","canvasRef","children","className","customRenderer","customTextRenderer","devicePixelRatio","error","height","inputRef","loading","noData","onGetAnnotationsError","onGetAnnotationsSuccess","onGetStructTreeError","onGetStructTreeSuccess","onGetTextError","onGetTextSuccess","onLoadError","onLoadSuccess","onRenderAnnotationLayerError","onRenderAnnotationLayerSuccess","onRenderError","onRenderSuccess","onRenderTextLayerError","onRenderTextLayerSuccess","pageIndex","pageNumber","pdf","registerPage","renderAnnotationLayer","renderForms","renderMode","renderTextLayer","rotate","scale","unregisterPage","width"]),[rt,ce]=tt(),{value:q,error:xe}=rt,de=d.useRef(null);H(z);const re=Je(X)?X-1:J??null,pe=X??(Je(J)?J+1:null),N=Fe??(q?q.rotate:null),U=d.useMemo(()=>{if(!q)return null;let Ue=1;const Le=ke??Fn;if(Me||M){const je=q.getViewport({scale:1,rotation:N});Me?Ue=Me/je.width:M&&(Ue=M/je.height)}return Le*Ue},[M,q,N,ke,Me]);function fe(){return()=>{Je(re)&&w&&Ke&&Ke(re)}}d.useEffect(fe,[w,z,re,Ke]);function Se(){if(p){if(!q||!U)return;p(_t(q,U))}if(w&&ae){if(!Je(re)||!de.current)return;ae(re,de.current)}}function Y(){xe&&(he(!1,xe.toString()),u&&u(xe))}function Wt(){ce({type:"RESET"})}d.useEffect(Wt,[ce,z,re]);function Xe(){if(!z||!pe)return;const Ue=pt(z.getPage(pe)),Le=Ue;return Ue.promise.then(je=>{ce({type:"RESOLVE",value:je})}).catch(je=>{ce({type:"REJECT",error:je})}),()=>Ve(Le)}d.useEffect(Xe,[ce,z,re,pe,ae]),d.useEffect(()=>{if(q!==void 0){if(q===!1){Y();return}Se()}},[q,U]);const Bt=d.useMemo(()=>q&&Je(re)&&pe&&Je(N)&&Je(U)?{_className:h,canvasBackground:E,customTextRenderer:D,devicePixelRatio:W,onGetAnnotationsError:j,onGetAnnotationsSuccess:m,onGetStructTreeError:e,onGetStructTreeSuccess:t,onGetTextError:n,onGetTextSuccess:l,onRenderAnnotationLayerError:P,onRenderAnnotationLayerSuccess:y,onRenderError:A,onRenderSuccess:k,onRenderTextLayerError:_,onRenderTextLayerSuccess:K,page:q,pageIndex:re,pageNumber:pe,renderForms:Ce,renderTextLayer:Ae,rotate:N,scale:U}:null,[h,E,D,W,j,m,e,t,n,l,P,y,A,k,_,K,q,re,pe,Ce,Ae,N,U]),Ft=d.useMemo(()=>Jn(nt,()=>q&&(U?_t(q,U):void 0)),[nt,q,U]),it=`${re}@${U}/${N}`,ft=`${re}/${N}`;function Te(){switch(Ye){case"custom":return H(I),o.createElement(I,{key:`${it}_custom`});case"none":return null;case"svg":return o.createElement(ji,{key:`${ft}_svg`});case"canvas":default:return o.createElement(Ui,{key:`${it}_canvas`,canvasRef:C})}}function se(){return Ae?o.createElement(Ni,{key:`${it}_text`}):null}function Ut(){return ge?o.createElement(qi,{key:`${it}_annotations`}):null}function jt(){return o.createElement(ar.Provider,{value:Bt},Te(),se(),Ut(),x)}function Ht(){return pe?z===null||q===void 0||q===null?o.createElement(gt,{type:"loading"},typeof O=="function"?O():O):z===!1||q===!1?o.createElement(gt,{type:"error"},typeof L=="function"?L():L):jt():o.createElement(gt,{type:"no-data"},typeof F=="function"?F():F)}return o.createElement("div",Object.assign({className:$t(h,v),"data-page-number":pe,ref:or($,de),style:{"--scale-factor":`${U}`,backgroundColor:E||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"}},Ft),Ht())},Qt=g.oneOfType([g.func,g.node]);an.propTypes=Object.assign(Object.assign({},nr),{canvasBackground:g.string,canvasRef:sn,children:g.node,className:ir,customRenderer:g.func,customTextRenderer:g.func,devicePixelRatio:g.number,error:Qt,height:g.number,imageResourcesPath:g.string,inputRef:sn,loading:Qt,noData:Qt,onGetTextError:g.func,onGetTextSuccess:g.func,onLoadError:g.func,onLoadSuccess:g.func,onRenderError:g.func,onRenderSuccess:g.func,onRenderTextLayerError:g.func,onRenderTextLayerSuccess:g.func,pageIndex:Li,pageNumber:Di,pdf:Ii,renderAnnotationLayer:g.bool,renderForms:g.bool,renderMode:Ai,renderTextLayer:g.bool,rotate:ki,scale:g.number,width:g.number});const zi="/assets/pdf.worker.min-DKQKFyKK.js";var cn={exports:{}};(function(r,a){(function(c,i){i(a)})(qr,function(c){class i{constructor(e,t){this.state={angle:0,area:[],position:{x:0,y:0},hardAngle:0,hardDrawingAngle:0},this.createdDensity=t,this.nowDrawingDensity=this.createdDensity,this.render=e}setDensity(e){this.createdDensity=e,this.nowDrawingDensity=e}setDrawingDensity(e){this.nowDrawingDensity=e}setPosition(e){this.state.position=e}setAngle(e){this.state.angle=e}setArea(e){this.state.area=e}setHardDrawingAngle(e){this.state.hardDrawingAngle=e}setHardAngle(e){this.state.hardAngle=e,this.state.hardDrawingAngle=e}setOrientation(e){this.orientation=e}getDrawingDensity(){return this.nowDrawingDensity}getDensity(){return this.createdDensity}getHardAngle(){return this.state.hardAngle}}class h extends i{constructor(e,t,n){super(e,n),this.image=null,this.isLoad=!1,this.loadingAngle=0,this.image=new Image,this.image.src=t}draw(e){const t=this.render.getContext(),n=this.render.convertToGlobal(this.state.position),l=this.render.getRect().pageWidth,u=this.render.getRect().height;t.save(),t.translate(n.x,n.y),t.beginPath();for(let p of this.state.area)p!==null&&(p=this.render.convertToGlobal(p),t.lineTo(p.x-n.x,p.y-n.y));t.rotate(this.state.angle),t.clip(),this.isLoad?t.drawImage(this.image,0,0,l,u):this.drawLoader(t,{x:0,y:0},l,u),t.restore()}simpleDraw(e){const t=this.render.getRect(),n=this.render.getContext(),l=t.pageWidth,u=t.height,p=e===1?t.left+t.pageWidth:t.left,P=t.top;this.isLoad?n.drawImage(this.image,p,P,l,u):this.drawLoader(n,{x:p,y:P},l,u)}drawLoader(e,t,n,l){e.beginPath(),e.strokeStyle="rgb(200, 200, 200)",e.fillStyle="rgb(255, 255, 255)",e.lineWidth=1,e.rect(t.x+1,t.y+1,n-1,l-1),e.stroke(),e.fill();const u={x:t.x+n/2,y:t.y+l/2};e.beginPath(),e.lineWidth=10,e.arc(u.x,u.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),e.stroke(),e.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}load(){this.isLoad||(this.image.onload=()=>{this.isLoad=!0})}newTemporaryCopy(){return this}getTemporaryCopy(){return this}hideTemporaryCopy(){}}class w{constructor(e,t){this.pages=[],this.currentPageIndex=0,this.currentSpreadIndex=0,this.landscapeSpread=[],this.portraitSpread=[],this.render=t,this.app=e,this.currentPageIndex=0,this.isShowCover=this.app.getSettings().showCover}destroy(){this.pages=[]}createSpread(){this.landscapeSpread=[],this.portraitSpread=[];for(let t=0;t<this.pages.length;t++)this.portraitSpread.push([t]);let e=0;this.isShowCover&&(this.pages[0].setDensity("hard"),this.landscapeSpread.push([e]),e++);for(let t=e;t<this.pages.length;t+=2)t<this.pages.length-1?this.landscapeSpread.push([t,t+1]):(this.landscapeSpread.push([t]),this.pages[t].setDensity("hard"))}getSpread(){return this.render.getOrientation()==="landscape"?this.landscapeSpread:this.portraitSpread}getSpreadIndexByPage(e){const t=this.getSpread();for(let n=0;n<t.length;n++)if(e===t[n][0]||e===t[n][1])return n;return null}getPageCount(){return this.pages.length}getPages(){return this.pages}getPage(e){if(e>=0&&e<this.pages.length)return this.pages[e];throw new Error("Invalid page number")}nextBy(e){const t=this.pages.indexOf(e);return t<this.pages.length-1?this.pages[t+1]:null}prevBy(e){const t=this.pages.indexOf(e);return t>0?this.pages[t-1]:null}getFlippingPage(e){const t=this.currentSpreadIndex;if(this.render.getOrientation()==="portrait")return e===0?this.pages[t].newTemporaryCopy():this.pages[t-1];{const n=e===0?this.getSpread()[t+1]:this.getSpread()[t-1];return n.length===1||e===0?this.pages[n[0]]:this.pages[n[1]]}}getBottomPage(e){const t=this.currentSpreadIndex;if(this.render.getOrientation()==="portrait")return e===0?this.pages[t+1]:this.pages[t-1];{const n=e===0?this.getSpread()[t+1]:this.getSpread()[t-1];return n.length===1?this.pages[n[0]]:e===0?this.pages[n[1]]:this.pages[n[0]]}}showNext(){this.currentSpreadIndex<this.getSpread().length&&(this.currentSpreadIndex++,this.showSpread())}showPrev(){this.currentSpreadIndex>0&&(this.currentSpreadIndex--,this.showSpread())}getCurrentPageIndex(){return this.currentPageIndex}show(e=null){if(e===null&&(e=this.currentPageIndex),e<0||e>=this.pages.length)return;const t=this.getSpreadIndexByPage(e);t!==null&&(this.currentSpreadIndex=t,this.showSpread())}getCurrentSpreadIndex(){return this.currentSpreadIndex}setCurrentSpreadIndex(e){if(!(e>=0&&e<this.getSpread().length))throw new Error("Invalid page");this.currentSpreadIndex=e}showSpread(){const e=this.getSpread()[this.currentSpreadIndex];e.length===2?(this.render.setLeftPage(this.pages[e[0]]),this.render.setRightPage(this.pages[e[1]])):this.render.getOrientation()==="landscape"&&e[0]===this.pages.length-1?(this.render.setLeftPage(this.pages[e[0]]),this.render.setRightPage(null)):(this.render.setLeftPage(null),this.render.setRightPage(this.pages[e[0]])),this.currentPageIndex=e[0],this.app.updatePageIndex(this.currentPageIndex)}}class E extends w{constructor(e,t,n){super(e,t),this.imagesHref=n}load(){for(const e of this.imagesHref){const t=new h(this.render,e,"soft");t.load(),this.pages.push(t)}this.createSpread()}}class C{static GetDistanceBetweenTwoPoint(e,t){return e===null||t===null?1/0:Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static GetSegmentLength(e){return C.GetDistanceBetweenTwoPoint(e[0],e[1])}static GetAngleBetweenTwoLine(e,t){const n=e[0].y-e[1].y,l=t[0].y-t[1].y,u=e[1].x-e[0].x,p=t[1].x-t[0].x;return Math.acos((n*l+u*p)/(Math.sqrt(n*n+u*u)*Math.sqrt(l*l+p*p)))}static PointInRect(e,t){return t===null?null:t.x>=e.left&&t.x<=e.width+e.left&&t.y>=e.top&&t.y<=e.top+e.height?t:null}static GetRotatedPoint(e,t,n){return{x:e.x*Math.cos(n)+e.y*Math.sin(n)+t.x,y:e.y*Math.cos(n)-e.x*Math.sin(n)+t.y}}static LimitPointToCircle(e,t,n){if(C.GetDistanceBetweenTwoPoint(e,n)<=t)return n;const l=e.x,u=e.y,p=n.x,P=n.y;let y=Math.sqrt(Math.pow(t,2)*Math.pow(l-p,2)/(Math.pow(l-p,2)+Math.pow(u-P,2)))+l;n.x<0&&(y*=-1);let A=(y-l)*(u-P)/(l-p)+u;return l-p+u===0&&(A=t),{x:y,y:A}}static GetIntersectBetweenTwoSegment(e,t,n){return C.PointInRect(e,C.GetIntersectBeetwenTwoLine(t,n))}static GetIntersectBeetwenTwoLine(e,t){const n=e[0].y-e[1].y,l=t[0].y-t[1].y,u=e[1].x-e[0].x,p=t[1].x-t[0].x,P=e[0].x*e[1].y-e[1].x*e[0].y,y=t[0].x*t[1].y-t[1].x*t[0].y,A=n*y-l*P,k=u*y-p*P,_=-(P*p-y*u)/(n*p-l*u),K=-(n*y-l*P)/(n*p-l*u);if(isFinite(_)&&isFinite(K))return{x:_,y:K};if(Math.abs(A-k)<.1)throw new Error("Segment included");return null}static GetCordsFromTwoPoint(e,t){const n=Math.abs(e.x-t.x),l=Math.abs(e.y-t.y),u=Math.max(n,l),p=[e];function P(y,A,k,_,K){return A>y?y+K*(k/_):A<y?y-K*(k/_):y}for(let y=1;y<=u;y+=1)p.push({x:P(e.x,t.x,n,u,y),y:P(e.y,t.y,l,u,y)});return p}}class x extends i{constructor(e,t,n){super(e,n),this.copiedElement=null,this.temporaryCopy=null,this.isLoad=!1,this.element=t,this.element.classList.add("stf__item"),this.element.classList.add("--"+n)}newTemporaryCopy(){return this.nowDrawingDensity==="hard"?this:(this.temporaryCopy===null&&(this.copiedElement=this.element.cloneNode(!0),this.element.parentElement.appendChild(this.copiedElement),this.temporaryCopy=new x(this.render,this.copiedElement,this.nowDrawingDensity)),this.getTemporaryCopy())}getTemporaryCopy(){return this.temporaryCopy}hideTemporaryCopy(){this.temporaryCopy!==null&&(this.copiedElement.remove(),this.copiedElement=null,this.temporaryCopy=null)}draw(e){const t=e||this.nowDrawingDensity,n=this.render.convertToGlobal(this.state.position),l=this.render.getRect().pageWidth,u=this.render.getRect().height;this.element.classList.remove("--simple");const p=`
            display: block;
            z-index: ${this.element.style.zIndex};
            left: 0;
            top: 0;
            width: ${l}px;
            height: ${u}px;
        `;t==="hard"?this.drawHard(p):this.drawSoft(n,p)}drawHard(e=""){const t=this.render.getRect().left+this.render.getRect().width/2,n=this.state.hardDrawingAngle,l=e+`
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
                clip-path: none;
                -webkit-clip-path: none;
            `+(this.orientation===0?`transform-origin: ${this.render.getRect().pageWidth}px 0; 
                   transform: translate3d(0, 0, 0) rotateY(${n}deg);`:`transform-origin: 0 0; 
                   transform: translate3d(${t}px, 0, 0) rotateY(${n}deg);`);this.element.style.cssText=l}drawSoft(e,t=""){let n="polygon( ";for(const u of this.state.area)if(u!==null){let p=this.render.getDirection()===1?{x:-u.x+this.state.position.x,y:u.y-this.state.position.y}:{x:u.x-this.state.position.x,y:u.y-this.state.position.y};p=C.GetRotatedPoint(p,{x:0,y:0},this.state.angle),n+=p.x+"px "+p.y+"px, "}n=n.slice(0,-2),n+=")";const l=t+`transform-origin: 0 0; clip-path: ${n}; -webkit-clip-path: ${n};`+(this.render.isSafari()&&this.state.angle===0?`transform: translate(${e.x}px, ${e.y}px);`:`transform: translate3d(${e.x}px, ${e.y}px, 0) rotate(${this.state.angle}rad);`);this.element.style.cssText=l}simpleDraw(e){const t=this.render.getRect(),n=t.pageWidth,l=t.height,u=e===1?t.left+t.pageWidth:t.left,p=t.top;this.element.classList.add("--simple"),this.element.style.cssText=`
            position: absolute; 
            display: block; 
            height: ${l}px; 
            left: ${u}px; 
            top: ${p}px; 
            width: ${n}px; 
            z-index: ${this.render.getSettings().startZIndex+1};`}getElement(){return this.element}load(){this.isLoad=!0}setOrientation(e){super.setOrientation(e),this.element.classList.remove("--left","--right"),this.element.classList.add(e===1?"--right":"--left")}setDrawingDensity(e){this.element.classList.remove("--soft","--hard"),this.element.classList.add("--"+e),super.setDrawingDensity(e)}}class v extends w{constructor(e,t,n,l){super(e,t),this.element=n,this.pagesElement=l}load(){for(const e of this.pagesElement){const t=new x(this.render,e,e.dataset.density==="hard"?"hard":"soft");t.load(),this.pages.push(t)}this.createSpread()}}class I{constructor(e,t,n,l){this.direction=e,this.corner=t,this.topIntersectPoint=null,this.sideIntersectPoint=null,this.bottomIntersectPoint=null,this.pageWidth=parseInt(n,10),this.pageHeight=parseInt(l,10)}calc(e){try{return this.position=this.calcAngleAndPosition(e),this.calculateIntersectPoint(this.position),!0}catch{return!1}}getFlippingClipArea(){const e=[];let t=!1;return e.push(this.rect.topLeft),e.push(this.topIntersectPoint),this.sideIntersectPoint===null?t=!0:(e.push(this.sideIntersectPoint),this.bottomIntersectPoint===null&&(t=!1)),e.push(this.bottomIntersectPoint),(t||this.corner==="bottom")&&e.push(this.rect.bottomLeft),e}getBottomClipArea(){const e=[];return e.push(this.topIntersectPoint),this.corner==="top"?e.push({x:this.pageWidth,y:0}):(this.topIntersectPoint!==null&&e.push({x:this.pageWidth,y:0}),e.push({x:this.pageWidth,y:this.pageHeight})),this.sideIntersectPoint!==null?C.GetDistanceBetweenTwoPoint(this.sideIntersectPoint,this.topIntersectPoint)>=10&&e.push(this.sideIntersectPoint):this.corner==="top"&&e.push({x:this.pageWidth,y:this.pageHeight}),e.push(this.bottomIntersectPoint),e.push(this.topIntersectPoint),e}getAngle(){return this.direction===0?-this.angle:this.angle}getRect(){return this.rect}getPosition(){return this.position}getActiveCorner(){return this.direction===0?this.rect.topLeft:this.rect.topRight}getDirection(){return this.direction}getFlippingProgress(){return Math.abs((this.position.x-this.pageWidth)/(2*this.pageWidth)*100)}getCorner(){return this.corner}getBottomPagePosition(){return this.direction===1?{x:this.pageWidth,y:0}:{x:0,y:0}}getShadowStartPoint(){return this.corner==="top"?this.topIntersectPoint:this.sideIntersectPoint!==null?this.sideIntersectPoint:this.topIntersectPoint}getShadowAngle(){const e=C.GetAngleBetweenTwoLine(this.getSegmentToShadowLine(),[{x:0,y:0},{x:this.pageWidth,y:0}]);return this.direction===0?e:Math.PI-e}calcAngleAndPosition(e){let t=e;if(this.updateAngleAndGeometry(t),t=this.corner==="top"?this.checkPositionAtCenterLine(t,{x:0,y:0},{x:0,y:this.pageHeight}):this.checkPositionAtCenterLine(t,{x:0,y:this.pageHeight},{x:0,y:0}),Math.abs(t.x-this.pageWidth)<1&&Math.abs(t.y)<1)throw new Error("Point is too small");return t}updateAngleAndGeometry(e){this.angle=this.calculateAngle(e),this.rect=this.getPageRect(e)}calculateAngle(e){const t=this.pageWidth-e.x+1,n=this.corner==="bottom"?this.pageHeight-e.y:e.y;let l=2*Math.acos(t/Math.sqrt(n*n+t*t));n<0&&(l=-l);const u=Math.PI-l;if(!isFinite(l)||u>=0&&u<.003)throw new Error("The G point is too small");return this.corner==="bottom"&&(l=-l),l}getPageRect(e){return this.corner==="top"?this.getRectFromBasePoint([{x:0,y:0},{x:this.pageWidth,y:0},{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}],e):this.getRectFromBasePoint([{x:0,y:-this.pageHeight},{x:this.pageWidth,y:-this.pageHeight},{x:0,y:0},{x:this.pageWidth,y:0}],e)}getRectFromBasePoint(e,t){return{topLeft:this.getRotatedPoint(e[0],t),topRight:this.getRotatedPoint(e[1],t),bottomLeft:this.getRotatedPoint(e[2],t),bottomRight:this.getRotatedPoint(e[3],t)}}getRotatedPoint(e,t){return{x:e.x*Math.cos(this.angle)+e.y*Math.sin(this.angle)+t.x,y:e.y*Math.cos(this.angle)-e.x*Math.sin(this.angle)+t.y}}calculateIntersectPoint(e){const t={left:-1,top:-1,width:this.pageWidth+2,height:this.pageHeight+2};this.corner==="top"?(this.topIntersectPoint=C.GetIntersectBetweenTwoSegment(t,[e,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=C.GetIntersectBetweenTwoSegment(t,[e,this.rect.bottomLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=C.GetIntersectBetweenTwoSegment(t,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}])):(this.topIntersectPoint=C.GetIntersectBetweenTwoSegment(t,[this.rect.topLeft,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=C.GetIntersectBetweenTwoSegment(t,[e,this.rect.topLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=C.GetIntersectBetweenTwoSegment(t,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}]))}checkPositionAtCenterLine(e,t,n){let l=e;const u=C.LimitPointToCircle(t,this.pageWidth,l);l!==u&&(l=u,this.updateAngleAndGeometry(l));const p=Math.sqrt(Math.pow(this.pageWidth,2)+Math.pow(this.pageHeight,2));let P=this.rect.bottomRight,y=this.rect.topLeft;if(this.corner==="bottom"&&(P=this.rect.topRight,y=this.rect.bottomLeft),P.x<=0){const A=C.LimitPointToCircle(n,p,y);A!==l&&(l=A,this.updateAngleAndGeometry(l))}return l}getSegmentToShadowLine(){const e=this.getShadowStartPoint();return[e,e!==this.sideIntersectPoint&&this.sideIntersectPoint!==null?this.sideIntersectPoint:this.bottomIntersectPoint]}}class D{constructor(e,t){this.flippingPage=null,this.bottomPage=null,this.calc=null,this.state="read",this.render=e,this.app=t}fold(e){this.setState("user_fold"),this.calc===null&&this.start(e),this.do(this.render.convertToPage(e))}flip(e){if(this.app.getSettings().disableFlipByClick&&!this.isPointOnCorners(e)||(this.calc!==null&&this.render.finishAnimation(),!this.start(e)))return;const t=this.getBoundsRect();this.setState("flipping");const n=t.height/10,l=this.calc.getCorner()==="bottom"?t.height-n:n,u=this.calc.getCorner()==="bottom"?t.height:0;this.calc.calc({x:t.pageWidth-n,y:l}),this.animateFlippingTo({x:t.pageWidth-n,y:l},{x:-t.pageWidth,y:u},!0)}start(e){this.reset();const t=this.render.convertToBook(e),n=this.getBoundsRect(),l=this.getDirectionByPoint(t),u=t.y>=n.height/2?"bottom":"top";if(!this.checkDirection(l))return!1;try{if(this.flippingPage=this.app.getPageCollection().getFlippingPage(l),this.bottomPage=this.app.getPageCollection().getBottomPage(l),this.render.getOrientation()==="landscape")if(l===1){const p=this.app.getPageCollection().nextBy(this.flippingPage);p!==null&&this.flippingPage.getDensity()!==p.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),p.setDrawingDensity("hard"))}else{const p=this.app.getPageCollection().prevBy(this.flippingPage);p!==null&&this.flippingPage.getDensity()!==p.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),p.setDrawingDensity("hard"))}return this.render.setDirection(l),this.calc=new I(l,u,n.pageWidth.toString(10),n.height.toString(10)),!0}catch{return!1}}do(e){if(this.calc!==null&&this.calc.calc(e)){const t=this.calc.getFlippingProgress();this.bottomPage.setArea(this.calc.getBottomClipArea()),this.bottomPage.setPosition(this.calc.getBottomPagePosition()),this.bottomPage.setAngle(0),this.bottomPage.setHardAngle(0),this.flippingPage.setArea(this.calc.getFlippingClipArea()),this.flippingPage.setPosition(this.calc.getActiveCorner()),this.flippingPage.setAngle(this.calc.getAngle()),this.calc.getDirection()===0?this.flippingPage.setHardAngle(90*(200-2*t)/100):this.flippingPage.setHardAngle(-90*(200-2*t)/100),this.render.setPageRect(this.calc.getRect()),this.render.setBottomPage(this.bottomPage),this.render.setFlippingPage(this.flippingPage),this.render.setShadowData(this.calc.getShadowStartPoint(),this.calc.getShadowAngle(),t,this.calc.getDirection())}}flipToPage(e,t){const n=this.app.getPageCollection().getCurrentSpreadIndex(),l=this.app.getPageCollection().getSpreadIndexByPage(e);try{l>n&&(this.app.getPageCollection().setCurrentSpreadIndex(l-1),this.flipNext(t)),l<n&&(this.app.getPageCollection().setCurrentSpreadIndex(l+1),this.flipPrev(t))}catch{}}flipNext(e){this.flip({x:this.render.getRect().left+2*this.render.getRect().pageWidth-10,y:e==="top"?1:this.render.getRect().height-2})}flipPrev(e){this.flip({x:10,y:e==="top"?1:this.render.getRect().height-2})}stopMove(){if(this.calc===null)return;const e=this.calc.getPosition(),t=this.getBoundsRect(),n=this.calc.getCorner()==="bottom"?t.height:0;e.x<=0?this.animateFlippingTo(e,{x:-t.pageWidth,y:n},!0):this.animateFlippingTo(e,{x:t.pageWidth,y:n},!1)}showCorner(e){if(!this.checkState("read","fold_corner"))return;const t=this.getBoundsRect(),n=t.pageWidth;if(this.isPointOnCorners(e))if(this.calc===null){if(!this.start(e))return;this.setState("fold_corner"),this.calc.calc({x:n-1,y:1});const l=50,u=this.calc.getCorner()==="bottom"?t.height-1:1,p=this.calc.getCorner()==="bottom"?t.height-l:l;this.animateFlippingTo({x:n-1,y:u},{x:n-l,y:p},!1,!1)}else this.do(this.render.convertToPage(e));else this.setState("read"),this.render.finishAnimation(),this.stopMove()}animateFlippingTo(e,t,n,l=!0){const u=C.GetCordsFromTwoPoint(e,t),p=[];for(const y of u)p.push(()=>this.do(y));const P=this.getAnimationDuration(u.length);this.render.startAnimation(p,P,()=>{this.calc&&(n&&(this.calc.getDirection()===1?this.app.turnToPrevPage():this.app.turnToNextPage()),l&&(this.render.setBottomPage(null),this.render.setFlippingPage(null),this.render.clearShadow(),this.setState("read"),this.reset()))})}getCalculation(){return this.calc}getState(){return this.state}setState(e){this.state!==e&&(this.app.updateState(e),this.state=e)}getDirectionByPoint(e){const t=this.getBoundsRect();if(this.render.getOrientation()==="portrait"){if(e.x-t.pageWidth<=t.width/5)return 1}else if(e.x<t.width/2)return 1;return 0}getAnimationDuration(e){const t=this.app.getSettings().flippingTime;return e>=1e3?t:e/1e3*t}checkDirection(e){return e===0?this.app.getCurrentPageIndex()<this.app.getPageCount()-1:this.app.getCurrentPageIndex()>=1}reset(){this.calc=null,this.flippingPage=null,this.bottomPage=null}getBoundsRect(){return this.render.getRect()}checkState(...e){for(const t of e)if(this.state===t)return!0;return!1}isPointOnCorners(e){const t=this.getBoundsRect(),n=t.pageWidth,l=Math.sqrt(Math.pow(n,2)+Math.pow(t.height,2))/5,u=this.render.convertToBook(e);return u.x>0&&u.y>0&&u.x<t.width&&u.y<t.height&&(u.x<l||u.x>t.width-l)&&(u.y<l||u.y>t.height-l)}}class W{constructor(e,t){this.leftPage=null,this.rightPage=null,this.flippingPage=null,this.bottomPage=null,this.direction=null,this.orientation=null,this.shadow=null,this.animation=null,this.pageRect=null,this.boundsRect=null,this.timer=0,this.safari=!1,this.setting=t,this.app=e;const n=new RegExp("Version\\/[\\d\\.]+.*Safari/");this.safari=n.exec(window.navigator.userAgent)!==null}render(e){if(this.animation!==null){const t=Math.round((e-this.animation.startedAt)/this.animation.durationFrame);t<this.animation.frames.length?this.animation.frames[t]():(this.animation.onAnimateEnd(),this.animation=null)}this.timer=e,this.drawFrame()}start(){this.update();const e=t=>{this.render(t),requestAnimationFrame(e)};requestAnimationFrame(e)}startAnimation(e,t,n){this.finishAnimation(),this.animation={frames:e,duration:t,durationFrame:t/e.length,onAnimateEnd:n,startedAt:this.timer}}finishAnimation(){this.animation!==null&&(this.animation.frames[this.animation.frames.length-1](),this.animation.onAnimateEnd!==null&&this.animation.onAnimateEnd()),this.animation=null}update(){this.boundsRect=null;const e=this.calculateBoundsRect();this.orientation!==e&&(this.orientation=e,this.app.updateOrientation(e))}calculateBoundsRect(){let e="landscape";const t=this.getBlockWidth(),n=t/2,l=this.getBlockHeight()/2,u=this.setting.width/this.setting.height;let p=this.setting.width,P=this.setting.height,y=n-p;return this.setting.size==="stretch"?(t<2*this.setting.minWidth&&this.app.getSettings().usePortrait&&(e="portrait"),p=e==="portrait"?this.getBlockWidth():this.getBlockWidth()/2,p>this.setting.maxWidth&&(p=this.setting.maxWidth),P=p/u,P>this.getBlockHeight()&&(P=this.getBlockHeight(),p=P*u),y=e==="portrait"?n-p/2-p:n-p):t<2*p&&this.app.getSettings().usePortrait&&(e="portrait",y=n-p/2-p),this.boundsRect={left:y,top:l-P/2,width:2*p,height:P,pageWidth:p},e}setShadowData(e,t,n,l){if(!this.app.getSettings().drawShadow)return;const u=100*this.getSettings().maxShadowOpacity;this.shadow={pos:e,angle:t,width:3*this.getRect().pageWidth/4*n/100,opacity:(100-n)*u/100/100,direction:l,progress:2*n}}clearShadow(){this.shadow=null}getBlockWidth(){return this.app.getUI().getDistElement().offsetWidth}getBlockHeight(){return this.app.getUI().getDistElement().offsetHeight}getDirection(){return this.direction}getRect(){return this.boundsRect===null&&this.calculateBoundsRect(),this.boundsRect}getSettings(){return this.app.getSettings()}getOrientation(){return this.orientation}setPageRect(e){this.pageRect=e}setDirection(e){this.direction=e}setRightPage(e){e!==null&&e.setOrientation(1),this.rightPage=e}setLeftPage(e){e!==null&&e.setOrientation(0),this.leftPage=e}setBottomPage(e){e!==null&&e.setOrientation(this.direction===1?0:1),this.bottomPage=e}setFlippingPage(e){e!==null&&e.setOrientation(this.direction===0&&this.orientation!=="portrait"?0:1),this.flippingPage=e}convertToBook(e){const t=this.getRect();return{x:e.x-t.left,y:e.y-t.top}}isSafari(){return this.safari}convertToPage(e,t){t||(t=this.direction);const n=this.getRect();return{x:t===0?e.x-n.left-n.width/2:n.width/2-e.x+n.left,y:e.y-n.top}}convertToGlobal(e,t){if(t||(t=this.direction),e==null)return null;const n=this.getRect();return{x:t===0?e.x+n.left+n.width/2:n.width/2-e.x+n.left,y:e.y+n.top}}convertRectToGlobal(e,t){return t||(t=this.direction),{topLeft:this.convertToGlobal(e.topLeft,t),topRight:this.convertToGlobal(e.topRight,t),bottomLeft:this.convertToGlobal(e.bottomLeft,t),bottomRight:this.convertToGlobal(e.bottomRight,t)}}}class L extends W{constructor(e,t,n){super(e,t),this.canvas=n,this.ctx=n.getContext("2d")}getContext(){return this.ctx}reload(){}drawFrame(){this.clear(),this.orientation!=="portrait"&&this.leftPage!=null&&this.leftPage.simpleDraw(0),this.rightPage!=null&&this.rightPage.simpleDraw(1),this.bottomPage!=null&&this.bottomPage.draw(),this.drawBookShadow(),this.flippingPage!=null&&this.flippingPage.draw(),this.shadow!=null&&(this.drawOuterShadow(),this.drawInnerShadow());const e=this.getRect();this.orientation==="portrait"&&(this.ctx.beginPath(),this.ctx.rect(e.left+e.pageWidth,e.top,e.width,e.height),this.ctx.clip())}drawBookShadow(){const e=this.getRect();this.ctx.save(),this.ctx.beginPath();const t=e.width/20;this.ctx.rect(e.left,e.top,e.width,e.height);const n={x:e.left+e.width/2-t/2,y:0};this.ctx.translate(n.x,n.y);const l=this.ctx.createLinearGradient(0,0,t,0);l.addColorStop(0,"rgba(0, 0, 0, 0)"),l.addColorStop(.4,"rgba(0, 0, 0, 0.2)"),l.addColorStop(.49,"rgba(0, 0, 0, 0.1)"),l.addColorStop(.5,"rgba(0, 0, 0, 0.5)"),l.addColorStop(.51,"rgba(0, 0, 0, 0.4)"),l.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.clip(),this.ctx.fillStyle=l,this.ctx.fillRect(0,0,t,2*e.height),this.ctx.restore()}drawOuterShadow(){const e=this.getRect();this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(e.left,e.top,e.width,e.height);const t=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.translate(t.x,t.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const n=this.ctx.createLinearGradient(0,0,this.shadow.width,0);this.shadow.direction===0?(this.ctx.translate(0,-100),n.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),n.addColorStop(1,"rgba(0, 0, 0, 0)")):(this.ctx.translate(-this.shadow.width,-100),n.addColorStop(0,"rgba(0, 0, 0, 0)"),n.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")")),this.ctx.clip(),this.ctx.fillStyle=n,this.ctx.fillRect(0,0,this.shadow.width,2*e.height),this.ctx.restore()}drawInnerShadow(){const e=this.getRect();this.ctx.save(),this.ctx.beginPath();const t=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),n=this.convertRectToGlobal(this.pageRect);this.ctx.moveTo(n.topLeft.x,n.topLeft.y),this.ctx.lineTo(n.topRight.x,n.topRight.y),this.ctx.lineTo(n.bottomRight.x,n.bottomRight.y),this.ctx.lineTo(n.bottomLeft.x,n.bottomLeft.y),this.ctx.translate(t.x,t.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const l=3*this.shadow.width/4,u=this.ctx.createLinearGradient(0,0,l,0);this.shadow.direction===0?(this.ctx.translate(-l,-100),u.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")"),u.addColorStop(.9,"rgba(0, 0, 0, 0.05)"),u.addColorStop(.7,"rgba(0, 0, 0, "+this.shadow.opacity+")"),u.addColorStop(0,"rgba(0, 0, 0, 0)")):(this.ctx.translate(0,-100),u.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),u.addColorStop(.1,"rgba(0, 0, 0, 0.05)"),u.addColorStop(.3,"rgba(0, 0, 0, "+this.shadow.opacity+")"),u.addColorStop(1,"rgba(0, 0, 0, 0)")),this.ctx.clip(),this.ctx.fillStyle=u,this.ctx.fillRect(0,0,l,2*e.height),this.ctx.restore()}clear(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}class M{constructor(e,t,n){this.touchPoint=null,this.swipeTimeout=250,this.onResize=()=>{this.update()},this.onMouseDown=u=>{if(this.checkTarget(u.target)){const p=this.getMousePos(u.clientX,u.clientY);this.app.startUserTouch(p),u.preventDefault()}},this.onTouchStart=u=>{if(this.checkTarget(u.target)&&u.changedTouches.length>0){const p=u.changedTouches[0],P=this.getMousePos(p.clientX,p.clientY);this.touchPoint={point:P,time:Date.now()},setTimeout(()=>{this.touchPoint!==null&&this.app.startUserTouch(P)},this.swipeTimeout),this.app.getSettings().mobileScrollSupport||u.preventDefault()}},this.onMouseUp=u=>{const p=this.getMousePos(u.clientX,u.clientY);this.app.userStop(p)},this.onMouseMove=u=>{const p=this.getMousePos(u.clientX,u.clientY);this.app.userMove(p,!1)},this.onTouchMove=u=>{if(u.changedTouches.length>0){const p=u.changedTouches[0],P=this.getMousePos(p.clientX,p.clientY);this.app.getSettings().mobileScrollSupport?(this.touchPoint!==null&&(Math.abs(this.touchPoint.point.x-P.x)>10||this.app.getState()!=="read")&&u.cancelable&&this.app.userMove(P,!0),this.app.getState()!=="read"&&u.preventDefault()):this.app.userMove(P,!0)}},this.onTouchEnd=u=>{if(u.changedTouches.length>0){const p=u.changedTouches[0],P=this.getMousePos(p.clientX,p.clientY);let y=!1;if(this.touchPoint!==null){const A=P.x-this.touchPoint.point.x,k=Math.abs(P.y-this.touchPoint.point.y);Math.abs(A)>this.swipeDistance&&k<2*this.swipeDistance&&Date.now()-this.touchPoint.time<this.swipeTimeout&&(A>0?this.app.flipPrev(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"):this.app.flipNext(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"),y=!0),this.touchPoint=null}this.app.userStop(P,y)}},this.parentElement=e,e.classList.add("stf__parent"),e.insertAdjacentHTML("afterbegin",'<div class="stf__wrapper"></div>'),this.wrapper=e.querySelector(".stf__wrapper"),this.app=t;const l=this.app.getSettings().usePortrait?1:2;e.style.minWidth=n.minWidth*l+"px",e.style.minHeight=n.minHeight+"px",n.size==="fixed"&&(e.style.minWidth=n.width*l+"px",e.style.minHeight=n.height+"px"),n.autoSize&&(e.style.width="100%",e.style.maxWidth=2*n.maxWidth+"px"),e.style.display="block",window.addEventListener("resize",this.onResize,!1),this.swipeDistance=n.swipeDistance}destroy(){this.app.getSettings().useMouseEvents&&this.removeHandlers(),this.distElement.remove(),this.wrapper.remove()}getDistElement(){return this.distElement}getWrapper(){return this.wrapper}setOrientationStyle(e){this.wrapper.classList.remove("--portrait","--landscape"),e==="portrait"?(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/this.app.getSettings().width*100+"%"),this.wrapper.classList.add("--portrait")):(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/(2*this.app.getSettings().width)*100+"%"),this.wrapper.classList.add("--landscape")),this.update()}removeHandlers(){window.removeEventListener("resize",this.onResize),this.distElement.removeEventListener("mousedown",this.onMouseDown),this.distElement.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}setHandlers(){window.addEventListener("resize",this.onResize,!1),this.app.getSettings().useMouseEvents&&(this.distElement.addEventListener("mousedown",this.onMouseDown),this.distElement.addEventListener("touchstart",this.onTouchStart),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!this.app.getSettings().mobileScrollSupport}),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd))}getMousePos(e,t){const n=this.distElement.getBoundingClientRect();return{x:e-n.left,y:t-n.top}}checkTarget(e){return!this.app.getSettings().clickEventForward||!["a","button"].includes(e.tagName.toLowerCase())}}class $ extends M{constructor(e,t,n,l){super(e,t,n),this.wrapper.insertAdjacentHTML("afterbegin",'<div class="stf__block"></div>'),this.distElement=e.querySelector(".stf__block"),this.items=l;for(const u of l)this.distElement.appendChild(u);this.setHandlers()}clear(){for(const e of this.items)this.parentElement.appendChild(e)}updateItems(e){this.removeHandlers(),this.distElement.innerHTML="";for(const t of e)this.distElement.appendChild(t);this.items=e,this.setHandlers()}update(){this.app.getRender().update()}}class O extends M{constructor(e,t,n){super(e,t,n),this.wrapper.innerHTML='<canvas class="stf__canvas"></canvas>',this.canvas=e.querySelectorAll("canvas")[0],this.distElement=this.canvas,this.resizeCanvas(),this.setHandlers()}resizeCanvas(){const e=getComputedStyle(this.canvas),t=parseInt(e.getPropertyValue("width"),10),n=parseInt(e.getPropertyValue("height"),10);this.canvas.width=t,this.canvas.height=n}getCanvas(){return this.canvas}update(){this.resizeCanvas(),this.app.getRender().update()}}class F extends W{constructor(e,t,n){super(e,t),this.outerShadow=null,this.innerShadow=null,this.hardShadow=null,this.hardInnerShadow=null,this.element=n,this.createShadows()}createShadows(){this.element.insertAdjacentHTML("beforeend",`<div class="stf__outerShadow"></div>
             <div class="stf__innerShadow"></div>
             <div class="stf__hardShadow"></div>
             <div class="stf__hardInnerShadow"></div>`),this.outerShadow=this.element.querySelector(".stf__outerShadow"),this.innerShadow=this.element.querySelector(".stf__innerShadow"),this.hardShadow=this.element.querySelector(".stf__hardShadow"),this.hardInnerShadow=this.element.querySelector(".stf__hardInnerShadow")}clearShadow(){super.clearShadow(),this.outerShadow.style.cssText="display: none",this.innerShadow.style.cssText="display: none",this.hardShadow.style.cssText="display: none",this.hardInnerShadow.style.cssText="display: none"}reload(){this.element.querySelector(".stf__outerShadow")||this.createShadows()}drawHardInnerShadow(){const e=this.getRect(),t=this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress;let n=(100-t)*(2.5*e.pageWidth)/100+20;n>e.pageWidth&&(n=e.pageWidth);let l=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+5).toString(10)};
            width: ${n}px;
            height: ${e.height}px;
            background: linear-gradient(to right,
                rgba(0, 0, 0, ${this.shadow.opacity*t/100}) 5%,
                rgba(0, 0, 0, 0) 100%);
            left: ${e.left+e.width/2}px;
            transform-origin: 0 0;
        `;l+=this.getDirection()===0&&this.shadow.progress>100||this.getDirection()===1&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0);":"transform: translate3d(0, 0, 0) rotateY(180deg);",this.hardInnerShadow.style.cssText=l}drawHardOuterShadow(){const e=this.getRect();let t=(100-(this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress))*(2.5*e.pageWidth)/100+20;t>e.pageWidth&&(t=e.pageWidth);let n=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+4).toString(10)};
            width: ${t}px;
            height: ${e.height}px;
            background: linear-gradient(to left, rgba(0, 0, 0, ${this.shadow.opacity}) 5%, rgba(0, 0, 0, 0) 100%);
            left: ${e.left+e.width/2}px;
            transform-origin: 0 0;
        `;n+=this.getDirection()===0&&this.shadow.progress>100||this.getDirection()===1&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0) rotateY(180deg);":"transform: translate3d(0, 0, 0);",this.hardShadow.style.cssText=n}drawInnerShadow(){const e=this.getRect(),t=3*this.shadow.width/4,n=this.getDirection()===0?t:0,l=this.getDirection()===0?"to left":"to right",u=this.convertToGlobal(this.shadow.pos),p=this.shadow.angle+3*Math.PI/2,P=[this.pageRect.topLeft,this.pageRect.topRight,this.pageRect.bottomRight,this.pageRect.bottomLeft];let y="polygon( ";for(const k of P){let _=this.getDirection()===1?{x:-k.x+this.shadow.pos.x,y:k.y-this.shadow.pos.y}:{x:k.x-this.shadow.pos.x,y:k.y-this.shadow.pos.y};_=C.GetRotatedPoint(_,{x:n,y:100},p),y+=_.x+"px "+_.y+"px, "}y=y.slice(0,-2),y+=")";const A=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${t}px;
            height: ${2*e.height}px;
            background: linear-gradient(${l},
                rgba(0, 0, 0, ${this.shadow.opacity}) 5%,
                rgba(0, 0, 0, 0.05) 15%,
                rgba(0, 0, 0, ${this.shadow.opacity}) 35%,
                rgba(0, 0, 0, 0) 100%);
            transform-origin: ${n}px 100px;
            transform: translate3d(${u.x-n}px, ${u.y-100}px, 0) rotate(${p}rad);
            clip-path: ${y};
            -webkit-clip-path: ${y};
        `;this.innerShadow.style.cssText=A}drawOuterShadow(){const e=this.getRect(),t=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),n=this.shadow.angle+3*Math.PI/2,l=this.getDirection()===1?this.shadow.width:0,u=this.getDirection()===0?"to right":"to left",p=[{x:0,y:0},{x:e.pageWidth,y:0},{x:e.pageWidth,y:e.height},{x:0,y:e.height}];let P="polygon( ";for(const A of p)if(A!==null){let k=this.getDirection()===1?{x:-A.x+this.shadow.pos.x,y:A.y-this.shadow.pos.y}:{x:A.x-this.shadow.pos.x,y:A.y-this.shadow.pos.y};k=C.GetRotatedPoint(k,{x:l,y:100},n),P+=k.x+"px "+k.y+"px, "}P=P.slice(0,-2),P+=")";const y=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${this.shadow.width}px;
            height: ${2*e.height}px;
            background: linear-gradient(${u}, rgba(0, 0, 0, ${this.shadow.opacity}), rgba(0, 0, 0, 0));
            transform-origin: ${l}px 100px;
            transform: translate3d(${t.x-l}px, ${t.y-100}px, 0) rotate(${n}rad);
            clip-path: ${P};
            -webkit-clip-path: ${P};
        `;this.outerShadow.style.cssText=y}drawLeftPage(){this.orientation!=="portrait"&&this.leftPage!==null&&(this.direction===1&&this.flippingPage!==null&&this.flippingPage.getDrawingDensity()==="hard"?(this.leftPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.leftPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.leftPage.draw(this.flippingPage.getDrawingDensity())):this.leftPage.simpleDraw(0))}drawRightPage(){this.rightPage!==null&&(this.direction===0&&this.flippingPage!==null&&this.flippingPage.getDrawingDensity()==="hard"?(this.rightPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.rightPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.rightPage.draw(this.flippingPage.getDrawingDensity())):this.rightPage.simpleDraw(1))}drawBottomPage(){if(this.bottomPage===null)return;const e=this.flippingPage!=null?this.flippingPage.getDrawingDensity():null;this.orientation==="portrait"&&this.direction===1||(this.bottomPage.getElement().style.zIndex=(this.getSettings().startZIndex+3).toString(10),this.bottomPage.draw(e))}drawFrame(){this.clear(),this.drawLeftPage(),this.drawRightPage(),this.drawBottomPage(),this.flippingPage!=null&&(this.flippingPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.flippingPage.draw()),this.shadow!=null&&this.flippingPage!==null&&(this.flippingPage.getDrawingDensity()==="soft"?(this.drawOuterShadow(),this.drawInnerShadow()):(this.drawHardOuterShadow(),this.drawHardInnerShadow()))}clear(){for(const e of this.app.getPageCollection().getPages())e!==this.leftPage&&e!==this.rightPage&&e!==this.flippingPage&&e!==this.bottomPage&&(e.getElement().style.cssText="display: none"),e.getTemporaryCopy()!==this.flippingPage&&e.hideTemporaryCopy()}update(){super.update(),this.rightPage!==null&&this.rightPage.setOrientation(1),this.leftPage!==null&&this.leftPage.setOrientation(0)}}class j{constructor(){this._default={startPage:0,size:"fixed",width:0,height:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,drawShadow:!0,flippingTime:1e3,usePortrait:!0,startZIndex:0,autoSize:!0,maxShadowOpacity:1,showCover:!1,mobileScrollSupport:!0,swipeDistance:30,clickEventForward:!0,useMouseEvents:!0,showPageCorners:!0,disableFlipByClick:!1}}getSettings(e){const t=this._default;if(Object.assign(t,e),t.size!=="stretch"&&t.size!=="fixed")throw new Error('Invalid size type. Available only "fixed" and "stretch" value');if(t.width<=0||t.height<=0)throw new Error("Invalid width or height");if(t.flippingTime<=0)throw new Error("Invalid flipping time");return t.size==="stretch"?(t.minWidth<=0&&(t.minWidth=100),t.maxWidth<t.minWidth&&(t.maxWidth=2e3),t.minHeight<=0&&(t.minHeight=100),t.maxHeight<t.minHeight&&(t.maxHeight=2e3)):(t.minWidth=t.width,t.maxWidth=t.width,t.minHeight=t.height,t.maxHeight=t.height),t}}(function(m,e){e===void 0&&(e={});var t=e.insertAt;if(typeof document<"u"){var n=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css",t==="top"&&n.firstChild?n.insertBefore(l,n.firstChild):n.appendChild(l),l.styleSheet?l.styleSheet.cssText=m:l.appendChild(document.createTextNode(m))}})(`.stf__parent {
  position: relative;
  display: block;
  box-sizing: border-box;
  transform: translateZ(0);

  -ms-touch-action: pan-y;
  touch-action: pan-y;
}

.sft__wrapper {
  position: relative;
  width: 100%;
  box-sizing: border-box;
}

.stf__parent canvas {
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
}

.stf__block {
  position: absolute;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  perspective: 2000px;
}

.stf__item {
  display: none;
  position: absolute;
  transform-style: preserve-3d;
}

.stf__outerShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__innerShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__hardShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__hardInnerShadow {
  position: absolute;
  left: 0;
  top: 0;
}`),c.PageFlip=class extends class{constructor(){this.events=new Map}on(m,e){return this.events.has(m)?this.events.get(m).push(e):this.events.set(m,[e]),this}off(m){this.events.delete(m)}trigger(m,e,t=null){if(this.events.has(m))for(const n of this.events.get(m))n({data:t,object:e})}}{constructor(m,e){super(),this.isUserTouch=!1,this.isUserMove=!1,this.setting=null,this.pages=null,this.setting=new j().getSettings(e),this.block=m}destroy(){this.ui.destroy(),this.block.remove()}update(){this.render.update(),this.pages.show()}loadFromImages(m){this.ui=new O(this.block,this,this.setting);const e=this.ui.getCanvas();this.render=new L(this,this.setting,e),this.flipController=new D(this.render,this),this.pages=new E(this,this.render,m),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}loadFromHTML(m){this.ui=new $(this.block,this,this.setting,m),this.render=new F(this,this.setting,this.ui.getDistElement()),this.flipController=new D(this.render,this),this.pages=new v(this,this.render,this.ui.getDistElement(),m),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}updateFromImages(m){const e=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new E(this,this.render,m),this.pages.load(),this.pages.show(e),this.trigger("update",this,{page:e,mode:this.render.getOrientation()})}updateFromHtml(m){const e=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new v(this,this.render,this.ui.getDistElement(),m),this.pages.load(),this.ui.updateItems(m),this.render.reload(),this.pages.show(e),this.trigger("update",this,{page:e,mode:this.render.getOrientation()})}clear(){this.pages.destroy(),this.ui.clear()}turnToPrevPage(){this.pages.showPrev()}turnToNextPage(){this.pages.showNext()}turnToPage(m){this.pages.show(m)}flipNext(m="top"){this.flipController.flipNext(m)}flipPrev(m="top"){this.flipController.flipPrev(m)}flip(m,e="top"){this.flipController.flipToPage(m,e)}updateState(m){this.trigger("changeState",this,m)}updatePageIndex(m){this.trigger("flip",this,m)}updateOrientation(m){this.ui.setOrientationStyle(m),this.update(),this.trigger("changeOrientation",this,m)}getPageCount(){return this.pages.getPageCount()}getCurrentPageIndex(){return this.pages.getCurrentPageIndex()}getPage(m){return this.pages.getPage(m)}getRender(){return this.render}getFlipController(){return this.flipController}getOrientation(){return this.render.getOrientation()}getBoundsRect(){return this.render.getRect()}getSettings(){return this.setting}getUI(){return this.ui}getState(){return this.flipController.getState()}getPageCollection(){return this.pages}startUserTouch(m){this.mousePosition=m,this.isUserTouch=!0,this.isUserMove=!1}userMove(m,e){this.isUserTouch||e||!this.setting.showPageCorners?this.isUserTouch&&C.GetDistanceBetweenTwoPoint(this.mousePosition,m)>5&&(this.isUserMove=!0,this.flipController.fold(m)):this.flipController.showCorner(m)}userStop(m,e=!1){this.isUserTouch&&(this.isUserTouch=!1,e||(this.isUserMove?this.flipController.stopMove():this.flipController.flip(m)))}},Object.defineProperty(c,"__esModule",{value:!0})})})(cn,cn.exports);var Yi=cn.exports;const Ki=o.forwardRef((r,a)=>{const c=d.useRef(null),i=d.useRef([]),h=d.useRef(),[w,E]=d.useState([]);d.useImperativeHandle(a,()=>({pageFlip:()=>h.current}));const C=d.useCallback(()=>{h.current&&h.current.clear()},[]),x=d.useCallback(()=>{const v=h.current;v&&(v.off("flip"),v.off("changeOrientation"),v.off("changeState"),v.off("init"),v.off("update"))},[]);return d.useEffect(()=>{if(i.current=[],r.children){const v=o.Children.map(r.children,I=>o.cloneElement(I,{ref:D=>{D&&i.current.push(D)}}));(!r.renderOnlyPageLengthChange||w.length!==v.length)&&(v.length<w.length&&C(),E(v))}},[r.children]),d.useEffect(()=>{const v=()=>{const I=h.current;I&&(r.onFlip&&I.on("flip",D=>r.onFlip(D)),r.onChangeOrientation&&I.on("changeOrientation",D=>r.onChangeOrientation(D)),r.onChangeState&&I.on("changeState",D=>r.onChangeState(D)),r.onInit&&I.on("init",D=>r.onInit(D)),r.onUpdate&&I.on("update",D=>r.onUpdate(D)))};w.length>0&&i.current.length>0&&(x(),c.current&&!h.current&&(h.current=new Yi.PageFlip(c.current,r)),h.current.getFlipController()?h.current.updateFromHtml(i.current):h.current.loadFromHTML(i.current),v())},[w]),o.createElement("div",{ref:c,className:r.className,style:r.style},w)}),Xi=o.memo(Ki),Un=typeof window<"u"&&window.location.hostname==="localhost"?"http://localhost:3001":"/api";var en={};ze.GlobalWorkerOptions.workerSrc=zi;const Zi=typeof process<"u"&&en&&(en.REACT_APP_PROXY_URL||en.VITE_PROXY_BASE)||(typeof window<"u"?`${window.location.origin}/api`:"http://localhost:8080"),{auth:Ji}=typeof useAuthX=="function"?useAuthX():{auth:null};var Kn;const tn=(Kn=Ji||lt)==null?void 0:Kn.currentUser;tn!=null&&tn.displayName||perfil!=null&&perfil.nombre;function ur(){const a=new URLSearchParams(window.location.search).get("at");if(a){const[c,i]=a.split(":").map(Number),h=new Date,w=Number.isFinite(c)?c:0,E=Number.isFinite(i)?i:0;return h.setHours(w),h.setMinutes(E),h.setSeconds(0),h.setMilliseconds(0),h}return new Date}function jn(){const r=new URLSearchParams(window.location.search),a=Number(r.get("dow")),c=a>=1&&a<=5?a:ur().getDay();return c>=1&&c<=5?c-1:0}function Hn(r=[]){const a=ur(),c=a.getHours()*60+a.getMinutes();for(let i=0;i<r.length-1;i++){const[h,w]=r[i],[E,C]=r[i+1],x=h*60+w,v=E*60+C;if(c>=x&&c<v)return i}return 0}function Nn(r={}){if(Array.isArray(r.marcas)&&Array.isArray(r.marcas[0]))return r.marcas;if(Array.isArray(r.marcas)&&r.marcas.length&&typeof r.marcas[0]=="object")return r.marcas.map(a=>[Number(a.h)||0,Number(a.m)||0]);if(Array.isArray(r.marcasStr))return r.marcasStr.map(a=>{const[c,i]=String(a).split(":").map(h=>Number(h)||0);return[c,i]});if(Array.isArray(r.bloquesGenerados)&&r.bloquesGenerados.length){const a=r.bloquesGenerados.map(i=>String(i).split(" - ")[0]),c=String(r.bloquesGenerados.at(-1)).split(" - ")[1];return[...a,c].map(i=>{const[h,w]=i.split(":").map(E=>Number(E)||0);return[h,w]})}return[]}const B={brandA:"#2193b0",brandB:"#6dd5ed",white:"#ffffff",textDark:"#1f2937",textMuted:"#475569",border:"#e5e7eb",btnText:"#2193b0"},Qi={minHeight:"100vh",background:`linear-gradient(to right, ${B.brandA}, ${B.brandB})`,padding:"2rem",fontFamily:"Segoe UI, sans-serif",color:B.white,boxSizing:"border-box"},es=(r="1rem")=>({display:"grid",gridTemplateColumns:"1fr 2fr 1fr",gap:r,alignItems:"stretch"}),We={background:B.white,color:B.textDark,borderRadius:12,padding:"1rem",boxShadow:"0 6px 18px rgba(16,24,40,.06), 0 2px 6px rgba(16,24,40,.03)",border:`1px solid ${B.border}`,maxWidth:"100%",overflow:"hidden"},xt={background:B.white,color:B.btnText,border:"none",borderRadius:10,padding:".6rem .9rem",fontWeight:700,cursor:"pointer",boxShadow:"0 4px 10px rgba(0,0,0,.15)"},ts={marginTop:12,paddingTop:10,borderTop:`1px dashed ${B.border}`},bt={display:"flex",flexWrap:"wrap",gap:8,justifyContent:"center",alignItems:"center"},et={padding:"8px 10px",border:`1px solid ${B.border}`,borderRadius:8,minWidth:220,outline:"none"},qn={...et,minWidth:160},ne={...xt,padding:".45rem .7rem",fontWeight:800},ns={display:"flex",flexWrap:"wrap",gap:10,justifyContent:"center",alignItems:"center",marginTop:10},Be={...xt,padding:6,borderRadius:12,display:"inline-flex",alignItems:"center",justifyContent:"center",width:56,height:56},nn={width:28,height:28},Ot=r=>`https://www.google.com/s2/favicons?sz=64&domain=${encodeURIComponent(r)}`;function ct({size:r=24}){return o.createElement("svg",{width:r,height:r,viewBox:"0 0 24 24","aria-hidden":"true"},o.createElement("path",{fill:"currentColor",d:"M3 5c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5v2h3a1 1 0 1 1 0 2H7a1 1 0 1 1 0-2h3v-2H5a2 2 0 0 1-2-2V5zm2 0v10h14V5H5zm7.7 2.3 3.6 3.6a1 1 0 0 1-1.4 1.4l-1.9-1.9V14a1 1 0 1 1-2 0V10.4l-1.9 1.9a1 1 0 0 1-1.4-1.4l3.6-3.6a1 1 0 0 1 1.4 0z"}))}const rs="https://huggingface.co/spaces/hysts/Shap-E",is="https://huggingface.co/spaces/Intel/TripoSR",ss="https://aframe.io/examples/showcase/helloworld/",Vn="inicioClase_countdown_end";function zn(r="0-0"){var i;const a=((i=lt.currentUser)==null?void 0:i.uid)||localStorage.getItem("uid")||"anon",c=ti();return`ic_countdown_end:${a}:${c}:${r}`}const ht=(r="")=>r.toString().toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim(),os={matematica:"matematica",matematicas:"matematica",lenguaje:"lenguaje","lenguaje y comunicacion":"lenguaje","lengua y literatura":"lenguaje",fisica:"fisica",quimica:"quimica",historia:"historia","historia y ciencias sociales":"historia",ingles:"ingles",biologia:"biologia",ciencias:"ciencias",tecnologia:"tecnologia"};function as(r=""){const a=ht(r);return os[a]||"matematica"}function cs(r="",a=""){const c=ht(r||a);return/basico|basica/i.test(c)?"basica":"media"}function Qe(r="",a=""){return[(r||"").replace(/º/g,"°"),a].filter(Boolean).join(" ").trim()}function rn(){try{const a=new URLSearchParams(window.location.search).get("slot");if(!a)return null;const[c,i]=a.split("-").map(h=>Number(h));if(Number.isInteger(c)&&Number.isInteger(i))return`${c}-${i}`}catch{}return null}const Yn={Generales:[{id:"youtube",name:"YouTube",url:"https://youtube.com",icon:"YT",embed:!0},{id:"google",name:"Google",url:"https://google.com",icon:"G",embed:!0},{id:"wikipedia",name:"Wikipedia",url:"https://wikipedia.org",icon:"W",embed:!0},{id:"drive",name:"Drive",url:"https://drive.google.com",icon:"D",embed:!1},{id:"flipbook",name:"Flipbook",url:"https://heyzine.com",icon:"FB",embed:!0},{id:"timer",name:"Timer",url:"https://timer.onlineclock.net",icon:"T",embed:!0},{id:"qr",name:"QR Generator",url:"https://qrcode-monkey.com",icon:"QR",embed:!0}],Matematica:[{id:"geogebra-graph",name:"GeoGebra · Graficadora",url:"https://www.geogebra.org/graphing",icon:"GG",embed:!0},{id:"geogebra-geom",name:"GeoGebra · Geometria",url:"https://www.geogebra.org/geometry",icon:"GG",embed:!0},{id:"desmos",name:"Desmos",url:"https://www.desmos.com/calculator",icon:"DS",embed:!0},{id:"phet-math",name:"PhET Matematicas",url:"https://phet.colorado.edu/es/simulations/filter?subjects=math",icon:"PH",embed:!1}],Lenguaje:[{id:"wordreference",name:"WordReference",url:"https://www.wordreference.com",icon:"WR",embed:!0},{id:"linguee",name:"Linguee",url:"https://www.linguee.es",icon:"LG",embed:!0},{id:"docs",name:"Google Docs",url:"https://docs.google.com",icon:"GD",embed:!1},{id:"padlet",name:"Padlet",url:"https://padlet.com",icon:"PD",embed:!1}],Ciencias:[{id:"phet-physics",name:"PhET Fisica",url:"https://phet.colorado.edu/es/simulations/filter?subjects=physics",icon:"PH",embed:!1},{id:"phet-chem",name:"PhET Quimica",url:"https://phet.colorado.edu/es/simulations/filter?subjects=chemistry",icon:"PH",embed:!1},{id:"phet-bio",name:"PhET Biologia",url:"https://phet.colorado.edu/es/simulations/filter?subjects=biology",icon:"PH",embed:!1}],Historia:[{id:"google-arts",name:"Google Arts & Culture",url:"https://artsandculture.google.com",icon:"AC",embed:!0},{id:"timeline",name:"KnightLab Timeline",url:"https://timeline.knightlab.com",icon:"TL",embed:!1}],Ingles:[{id:"cambridge",name:"Cambridge Dictionary",url:"https://dictionary.cambridge.org",icon:"CD",embed:!0},{id:"reverso",name:"Reverso Context",url:"https://context.reverso.net",icon:"RV",embed:!0}],Artes:[{id:"sketchpad",name:"Sketchpad",url:"https://sketch.io/sketchpad",icon:"SP",embed:!0},{id:"autodraw",name:"AutoDraw",url:"https://www.autodraw.com",icon:"AD",embed:!0}],Tecnologia:[{id:"scratch",name:"Scratch",url:"https://scratch.mit.edu",icon:"SC",embed:!1},{id:"w3schools",name:"W3Schools",url:"https://www.w3schools.com/tryit",icon:"W3",embed:!0}]},ls={marginTop:10,paddingTop:10,borderTop:`1px dashed ${B.border}`},hs={display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(160px, 1fr))",gap:10,marginTop:8},ds={background:"#ffffff",border:`1px solid ${B.border}`,borderRadius:12,padding:"10px",textAlign:"left",cursor:"pointer",display:"flex",gap:10,alignItems:"center",boxShadow:"0 3px 8px rgba(16,24,40,.06)"},us={width:28,height:28,flex:"0 0 28px",borderRadius:6},gs={fontWeight:800,fontSize:14,lineHeight:1.15,color:B.textDark},ps={fontSize:11,color:B.textMuted};function xs({duracion:r=30,onIrACierre:a}){var Cn,Tn;const c=Vr(),i=zr(),h=d.useContext(ni)||{},{user:w=null,plan:E="FREE",caps:C=ii.FREE,loading:x=!1}=h,[v,I]=d.useState(""),[D,W]=d.useState("Profesor"),[L,M]=d.useState("(sin asignatura)"),[$,O]=d.useState("(sin curso)"),[F,j]=d.useState(""),[m,e]=d.useState(null),[t,n]=d.useState(null),[l,u]=d.useState(""),[p,P]=d.useState(""),[y,A]=d.useState(""),[k,_]=d.useState("es"),[K,J]=d.useState(!1),[X,z]=d.useState(""),[ae,ge]=d.useState(""),[Ce,Ye]=d.useState(""),[Ae,Fe]=d.useState("calculator"),[ke,Ke]=d.useState(""),[Me,nt]=d.useState("https://www.youtube-nocookie.com/embed/Ibrj8pRX8Zg"),[rt,ce]=d.useState(""),[q,xe]=d.useState("iframe"),[de,re]=d.useState(null),pe=d.useRef(null),N=d.useRef(null),U=d.useRef(null),[fe,Se]=d.useState(!1),[Y,Wt]=d.useState(null);d.useEffect(()=>{(async()=>{try{const s=await Yr(new Date);Wt(s),s&&(s.unidad&&!F&&j(s.unidad),s.objetivo&&!X&&z(s.objetivo),s.habilidades&&!ae&&ge(s.habilidades),s.asignatura&&L==="(sin asignatura)"&&M(s.asignatura),(s.nivel||s.seccion)&&$==="(sin curso)"&&O(Qe(s.nivel,s.seccion)))}catch(s){console.error("[Desarrollo] getClaseVigente:",s)}})()},[]);const Xe=s=>/^https?:\/\//i.test(s)?s:`https://${s}`,Bt=s=>window.open(s,"_blank","noopener,noreferrer"),Ft=s=>{try{const f=Xe(s),b=new URL(f);return`https://r.jina.ai/${b.protocol.replace(":","")}://${b.host}${b.pathname}${b.search}`}catch{return s}},it=s=>{try{if(/youtu\.?be/.test(s)){const f=new URL(s);if(f.hostname.includes("youtu.be"))return f.pathname.replace("/","");const b=f.searchParams.get("v");if(b)return b}}catch{}return/^[\w-]{10,12}$/.test(s)?s.trim():null},ft=s=>{const f=it(s);return f?`https://www.youtube-nocookie.com/embed/${f}`:`https://www.youtube-nocookie.com/embed?listType=search&list=${encodeURIComponent(s||"matemática 1 medio")}`},Te=(s,f)=>{if(f==="youtube"){const S=(s||"").trim()||(F?`matemática ${F}`:"matemática 1 medio");return ft(S)}if(f==="geogebra"){let S="/calculator";return Ae==="geometry"&&(S="/geometry"),Ae==="3d"&&(S="/3d"),`https://www.geogebra.org${S}?embed`}if(f==="desmos")return"https://www.desmos.com/calculator?embed&lang=es";let b=Xe((s||"").trim());try{const S=new URL(b);if(S.hostname.includes("youtube")||S.hostname.includes("youtu.be"))return ft(b);if(S.hostname.endsWith("docs.google.com")){if(S.pathname.includes("/document/"))return b.replace(/\/edit.*$/i,"/preview");if(S.pathname.includes("/spreadsheets/"))return b.replace(/\/edit.*$/i,"/preview");if(S.pathname.includes("/presentation/"))return b.replace(/\/edit.*$/i,"/embed")}if(S.hostname.endsWith("onedrive.live.com")||S.hostname.endsWith("sharepoint.com"))return`https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(b)}`;if(S.hostname.includes("wikipedia.org"))return b}catch{return ft(s)}return b},se=s=>{ce(""),nt(s),xe("iframe"),/(^https?:\/\/)?(docs\.google\.com|drive\.google\.com|office\.com|onedrive\.live\.com|sharepoint\.com)/i.test(s)&&ce("Este sitio puede requerir inicio de sesión o bloquear funciones dentro del panel. Si no ves contenido, pega un enlace público/“embed”.")},Ut=()=>{var s;return(s=pe.current)==null?void 0:s.click()},jt=s=>{var S;const f=(S=s.target.files)==null?void 0:S[0];if(!f)return;const b=URL.createObjectURL(f);if(f.type==="application/pdf"){if(de)try{URL.revokeObjectURL(de)}catch{}re(b),xe("iframe"),se(b)}else if(f.type.startsWith("image/")){if(de)try{URL.revokeObjectURL(de)}catch{}re(b),xe("image"),ce("")}else URL.revokeObjectURL(b),alert("Para Word/Excel/PowerPoint, usa «Compartir pantalla». (El panel renderiza nativamente PDF e imágenes).");try{s.target.value=""}catch{}},Ht=async()=>{try{const s=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1});N.current&&(N.current.srcObject=s),U.current=s,xe("screen"),Se(!0);const[f]=s.getVideoTracks();f.addEventListener("ended",()=>Ue())}catch(s){console.warn("DisplayMedia cancelado/no disponible:",s)}},Ue=()=>{try{const s=U.current;s&&s.getTracks().forEach(f=>f.stop())}catch{}U.current=null,Se(!1),xe("iframe")},Le=()=>{window.confirm(`¿Compartir pantalla ahora?
Aceptar: Compartir pantalla
Cancelar: Presentar archivo (PDF o imagen) en el panel`)?Ht():Ut()};d.useEffect(()=>()=>{if(de)try{URL.revokeObjectURL(de)}catch{}if(U.current)try{U.current.getTracks().forEach(s=>s.stop())}catch{}},[]);const je=()=>se(Te(Ce,"youtube")),gr=()=>se(Te("","geogebra")),pr=()=>se(Te("","desmos")),fr=()=>{se("https://phet.colorado.edu/es/simulations/filter?subjects=math&type=html,prototype"),ce("Para ver una simulación dentro del panel, entra a la simulación → 'Compartir/Insertar' y pega ese enlace en 'Abrir en panel'.")},mr=()=>se(Ft("https://drive.google.com")),yr=()=>{const s=ke.trim();s&&se(Te(s,"custom"))};d.useEffect(()=>{I(new Date().toLocaleTimeString());const s=setInterval(()=>I(new Date().toLocaleTimeString()),1e3);return()=>clearInterval(s)},[]),d.useEffect(()=>{const s=Kr(lt,async f=>{try{if(f)localStorage.setItem("uid",f.uid),J(!0);else{const b=await ei(lt);localStorage.setItem("uid",b.user.uid),J(!0)}}catch(b){console.error("[Desarrollo] auth error:",b),J(!1)}});return()=>s()},[]),d.useEffect(()=>{const s=(i==null?void 0:i.state)||null;if(s)try{if(s.clase&&(j(f=>f||s.clase.unidad||""),z(f=>f||s.clase.objetivo||""),ge(f=>f||s.clase.habilidades||""),s.clase.asignatura&&M(s.clase.asignatura),s.clase.curso&&O(s.clase.curso),!s.clase.curso&&(s.clase.nivel||s.clase.seccion)&&O(Qe(s.clase.nivel,s.clase.seccion))),s.slotId)try{localStorage.setItem("__lastSlotId",s.slotId)}catch{}if(Number.isFinite(+s.endMs)&&+s.endMs>0){const f=zn(s.slotId||"0-0");try{localStorage.setItem(f,String(s.endMs)),localStorage.setItem(Vn,String(s.endMs))}catch{}}}catch{}},[i]),d.useLayoutEffect(()=>{var s;try{const f=((s=i==null?void 0:i.state)==null?void 0:s.slotId)||rn()||localStorage.getItem("__lastSlotId")||"0-0",b=zn(f),S=Vn,Z=Date.now();let Q=localStorage.getItem(b)||localStorage.getItem(S);if(!Q||+Q<=Z){const Pe=Z+r*60*1e3;localStorage.setItem(b,String(Pe)),localStorage.setItem(S,String(Pe))}}catch{}},[]),d.useEffect(()=>{if(!K)return;(async()=>{var f,b,S,Z,Q,Pe,Ze,Oe,_e,De,ee,me,le,ie,ye,yt,Dt,He,$e,It,At,Ln,Dn,In;try{const Ee=localStorage.getItem("uid")||((f=lt.currentUser)==null?void 0:f.uid);if(!Ee)return;try{const R=ve(be,"profesores",Ee),oe=await Re(R);if(oe.exists()){const G=oe.data()||{},T=G.nombre||G.nombreCompleto||G.profesorNombre||null;T&&W(T)}}catch(R){(R==null?void 0:R.code)!=="permission-denied"&&console.warn("[Desarrollo] profesores read:",(R==null?void 0:R.code)||R)}try{const R=ve(be,"usuarios",Ee),oe=await Re(R);if(oe.exists()){const G=oe.data()||{};if(D==="Profesor"){const T=G.nombre||G.nombreCompleto||null;T&&W(T)}}}catch(R){(R==null?void 0:R.code)!=="permission-denied"&&console.warn("[Desarrollo] usuarios read:",(R==null?void 0:R.code)||R)}let at="";try{const R=ve(be,"profesores",Ee),oe=await Re(R);if(oe.exists()){const G=oe.data()||{};at=(G.unidadInicial||"").trim(),j(T=>T||at),M(T=>T==="(sin asignatura)"?G.asignatura||"(sin asignatura)":T),O(T=>T==="(sin curso)"?G.curso||Qe(G.nivel,G.seccion)||"(sin curso)":T)}}catch(R){(R==null?void 0:R.code)!=="permission-denied"&&console.warn("[Desarrollo] profesores read:",(R==null?void 0:R.code)||R)}if(!at)try{const R=ve(be,"usuarios",Ee),oe=await Re(R);if(oe.exists()){const G=oe.data()||{};at=(G.unidadInicial||G.unidad||"").trim(),j(T=>T||at),G.asignatura&&L==="(sin asignatura)"&&M(G.asignatura),G.curso&&$==="(sin curso)"&&O(G.curso)}}catch(R){(R==null?void 0:R.code)!=="permission-denied"&&console.warn("[Desarrollo] usuarios fallback:",(R==null?void 0:R.code)||R)}try{const R=((b=i==null?void 0:i.state)==null?void 0:b.slotId)||rn()||localStorage.getItem("__lastSlotId")||"0-0",oe=ve(be,"clases_detalle",Ee,"slots",R),G=await Re(oe);if(G.exists()){const T=G.data()||{};if(j(V=>V||T.unidad||""),z(V=>V||T.objetivo||""),ge(V=>V||(Array.isArray(T.habilidades)?T.habilidades.join(", "):T.habilidades||"")),T.asignatura&&L==="(sin asignatura)"&&M(T.asignatura),$==="(sin curso)")if(T.curso||T.nivel||T.seccion)O(T.curso||Qe(T.nivel,T.seccion)||"(sin curso)");else try{const V=await Re(ve(be,"horarios",Ee,"celdas",R));if(V.exists()){const we=V.data()||{};we.curso&&O(we.curso),we.asignatura&&L==="(sin asignatura)"&&M(we.asignatura)}}catch{}}else{const T=ve(be,"usuarios",Ee),V=await Re(T),we=V.exists()?((S=V.data())==null?void 0:S.horarioConfig)||{}:{},ue=Nn(we);if(Array.isArray(ue)&&ue.length>1){const Xt=Hn(ue),Ne=jn(),qe=`${Xt}-${Ne}`,Zt=ve(be,"clases_detalle",Ee,"slots",qe),Mt=await Re(Zt);if(Mt.exists()){const Ie=Mt.data()||{};j(wt=>wt||Ie.unidad||""),z(wt=>wt||Ie.objetivo||""),ge(wt=>wt||(Array.isArray(Ie.habilidades)?Ie.habilidades.join(", "):Ie.habilidades||"")),Ie.asignatura&&L==="(sin asignatura)"&&M(Ie.asignatura),$==="(sin curso)"&&O(Ie.curso||Qe(Ie.nivel,Ie.seccion)||"(sin curso)")}}}}catch(R){(R==null?void 0:R.code)!=="permission-denied"&&console.warn("[Desarrollo] clases_detalle fallback:",(R==null?void 0:R.code)||R)}const kt=((Q=(Z=i==null?void 0:i.state)==null?void 0:Z.clase)==null?void 0:Q.unidad)||at||F||"",Wr=((Ze=(Pe=i==null?void 0:i.state)==null?void 0:Pe.clase)==null?void 0:Ze.asignatura)||L||"Matemática",Br=((_e=(Oe=i==null?void 0:i.state)==null?void 0:Oe.clase)==null?void 0:_e.curso)||$||"";if(kt){const R=as(Wr),oe=cs(Br,(Y==null?void 0:Y.nivel)||"");try{const G=`${Un}/mineduc?asignatura=${encodeURIComponent(R)}&nivel=${encodeURIComponent(oe)}&unidad=${encodeURIComponent(kt)}`,T=await Ge.get(G),V=Array.isArray(T.data)?T.data[0]:null;if(V)e(V);else throw new Error("Proxy sin resultados, intento directo")}catch{try{const T=`https://curriculumnacional.mineduc.cl/api/v1/oa/buscar?asignatura=${encodeURIComponent(R)}&nivel=${encodeURIComponent(oe)}&unidad=${encodeURIComponent(kt)}`,V=await Ge.get(T),we=Array.isArray(V.data)?V.data[0]:null;e(we||null)}catch(T){console.warn("[Desarrollo] OA ministerio no disponible (CORS/local):",(T==null?void 0:T.message)||T)}}try{const G=kt;let T="",V="es";const we=await Ge.get(`https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(G)}&format=json&origin=*`);if(T=((le=(me=(ee=(De=we==null?void 0:we.data)==null?void 0:De.query)==null?void 0:ee.search)==null?void 0:me[0])==null?void 0:le.title)||"",V="es",!T&&X){const ue=await Ge.get(`https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(X)}&format=json&origin=*`);T=((Dt=(yt=(ye=(ie=ue==null?void 0:ue.data)==null?void 0:ie.query)==null?void 0:ye.search)==null?void 0:yt[0])==null?void 0:Dt.title)||"",V="es"}if(!T){const ue=await Ge.get(`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(G)}&format=json&origin=*`);T=((At=(It=($e=(He=ue==null?void 0:ue.data)==null?void 0:He.query)==null?void 0:$e.search)==null?void 0:It[0])==null?void 0:At.title)||"",T&&(V="en")}if(T){const ue=V==="es"?"https://es.wikipedia.org":"https://en.wikipedia.org",Xt=`${ue}/wiki/${encodeURIComponent(T)}`;n(Xt),u(T),_(V);try{const Ne=`${ue}/api/rest_v1/page/summary/${encodeURIComponent(T)}?origin=*`,qe=await Ge.get(Ne),Zt=((Ln=qe==null?void 0:qe.data)==null?void 0:Ln.extract)||"",Mt=((In=(Dn=qe==null?void 0:qe.data)==null?void 0:Dn.thumbnail)==null?void 0:In.source)||"";P(Zt),A(Mt)}catch(Ne){console.warn("[Desarrollo] Wikipedia summary no disponible:",(Ne==null?void 0:Ne.message)||Ne),P(""),A("")}}}catch(G){console.warn("[Desarrollo] Wikipedia no disponible:",(G==null?void 0:G.message)||G)}}}catch(Ee){console.error("Error cargando datos de Desarrollo:",Ee)}})()},[K]),d.useEffect(()=>{K&&(async()=>{var s,f,b;try{const S=localStorage.getItem("uid")||((s=lt.currentUser)==null?void 0:s.uid);if(!S)return;const Z=((f=i==null?void 0:i.state)==null?void 0:f.slotId)||rn()||null;if(Z){const _e=ve(be,"clases_detalle",S,"slots",Z),De=await Re(_e);if(De.exists()){const ee=De.data()||{};j(me=>me||ee.unidad||""),z(me=>me||ee.objetivo||""),ge(me=>me||(Array.isArray(ee.habilidades)?ee.habilidades.join(", "):ee.habilidades||"")),ee.asignatura&&L==="(sin asignatura)"&&M(ee.asignatura),$==="(sin curso)"&&O(ee.curso||Qe(ee.nivel,ee.seccion)||"(sin curso)");return}}const Q=ve(be,"usuarios",S),Pe=await Re(Q),Ze=Pe.exists()?((b=Pe.data())==null?void 0:b.horarioConfig)||{}:{},Oe=Nn(Ze);if(Array.isArray(Oe)&&Oe.length>1){const _e=Hn(Oe),De=jn(),ee=`${_e}-${De}`,me=ve(be,"clases_detalle",S,"slots",ee),le=await Re(me);if(le.exists()){const ie=le.data()||{};j(ye=>ye||ie.unidad||""),z(ye=>ye||ie.objetivo||""),ge(ye=>ye||(Array.isArray(ie.habilidades)?ie.habilidades.join(", "):ie.habilidades||"")),ie.asignatura&&L==="(sin asignatura)"&&M(ie.asignatura),$==="(sin curso)"&&O(ie.curso||Qe(ie.nivel,ie.seccion)||"(sin curso)")}}}catch(S){console.warn("[Desarrollo] marcas–clases_detalle:",(S==null?void 0:S.code)||(S==null?void 0:S.message))}})()},[K]),d.useEffect(()=>{(async()=>{var b,S,Z,Q,Pe,Ze,Oe,_e,De,ee,me;const f=(X||"").trim();if(f)try{let le="",ie="es";const ye=await Ge.get(`https://es.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(f)}&format=json&origin=*`);if(le=((Q=(Z=(S=(b=ye==null?void 0:ye.data)==null?void 0:b.query)==null?void 0:S.search)==null?void 0:Z[0])==null?void 0:Q.title)||"",!le){const He=await Ge.get(`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(f)}&format=json&origin=*`);le=((_e=(Oe=(Ze=(Pe=He==null?void 0:He.data)==null?void 0:Pe.query)==null?void 0:Ze.search)==null?void 0:Oe[0])==null?void 0:_e.title)||"",le&&(ie="en")}if(!le)return;const yt=ie==="es"?"https://es.wikipedia.org":"https://en.wikipedia.org",Dt=`${yt}/wiki/${encodeURIComponent(le)}`;n(Dt),u(le),_(ie);try{const He=`${yt}/api/rest_v1/page/summary/${encodeURIComponent(le)}?origin=*`,$e=await Ge.get(He),It=((De=$e==null?void 0:$e.data)==null?void 0:De.extract)||"",At=((me=(ee=$e==null?void 0:$e.data)==null?void 0:ee.thumbnail)==null?void 0:me.source)||"";P(It),A(At)}catch{P(""),A("")}}catch{}})()},[X]);const wr=()=>{a?a():c("/cierre")},[Pt,br]=d.useState(""),[ln,Nt]=d.useState(""),[hn,Et]=d.useState(null),dn=d.useRef(null),vt=d.useRef(null);d.useEffect(()=>{var s,f;if(!window.customElements||!((f=(s=window.customElements).get)!=null&&f.call(s,"model-viewer"))){const b=document.createElement("script");b.type="module",b.src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js",b.crossOrigin="anonymous",document.head.appendChild(b)}},[]);const un=()=>{se(rs+(Pt?`?prompt=${encodeURIComponent(Pt)}`:"")),ce("Usa la Space para generar y descargar el GLB; luego pégalo abajo en 'URL GLB' o súbelo.")},gn=()=>{se(is),ce("Primero genera una imagen (p. ej., en Stable Diffusion) y súbela en la Space para obtener el GLB.")},xr=()=>{var f;const s=ln.trim();if(!s)return alert("Pega una URL .glb/.gltf primero o sube un archivo.");Et(s),(f=vt.current)==null||f.scrollIntoView({behavior:"smooth",block:"center"})},Sr=()=>{var s;return(s=dn.current)==null?void 0:s.click()},Pr=s=>{var S,Z;const f=(S=s.target.files)==null?void 0:S[0];if(!f)return;if(!/(\.glb|\.gltf)$/i.test(f.name)){alert("Sube un archivo .glb o .gltf.");return}const b=URL.createObjectURL(f);Et(b),(Z=vt.current)==null||Z.scrollIntoView({behavior:"smooth",block:"center"});try{s.target.value=""}catch{}},[pn,fn]=d.useState(!1),[mn,Rt]=d.useState(""),yn=async()=>{var f;const s=(Pt||"").trim();if(!s)return alert("Escribe un prompt 3D primero.");fn(!0),Rt("Generando modelo…");try{const b=await fetch(`${Un}/shape/generate`,{method:"POST",headers:{"Content-Type":"application/json"},mode:"cors",body:JSON.stringify({prompt:s,steps:32,size:1.2})});if(!b.ok)throw new Error(`HTTP ${b.status}`);const S=await b.json();if(S!=null&&S.url)Et(S.url),Nt(S.url);else if(S!=null&&S.blobBase64)Et(S.blobBase64),Nt(S.blobBase64);else throw new Error("Respuesta sin URL ni blobBase64");Rt("Listo ✓"),(f=vt.current)==null||f.scrollIntoView({behavior:"smooth",block:"center"})}catch(b){console.warn(b),Rt("No se pudo generar desde el servidor local. Abre Shap-E (botón) o verifica tu proxy en "+Zi),alert("Falló la generación local. Revisa el proxy o usa el botón de Shap-E.")}finally{fn(!1),setTimeout(()=>Rt(""),3500)}},[fs,ms]=d.useState(""),Er=()=>{se(ss),ce("Demo A-Frame. Para una sala propia, pega la URL de tu mundo (FrameVR/Spatial/etc.) y ábrela.")},[st,wn]=d.useState(()=>{var b,S;const s=((S=(b=i==null?void 0:i.state)==null?void 0:b.ficha)==null?void 0:S.programaUrl)||"",f=localStorage.getItem("programaPdfUrl")||"";return s||f||""}),[ot,bn]=d.useState(0),[Ct,qt]=d.useState(1),xn=d.useRef(null),[vr,Rr]=d.useState(900),[Vt,Sn]=d.useState("flip"),[zt,Tt]=d.useState(""),mt=(()=>{var S,Z;const s=((Z=(S=i==null?void 0:i.state)==null?void 0:S.ficha)==null?void 0:Z.nivel)||"",f=(Y==null?void 0:Y.nivel)||"";if(s)return s;if(f)return f;const b=String($||"").match(/(\d+)\s*[°º]?\s*(b[aá]sico|medio)/i);return b?`${b[1]}° ${b[2].toLowerCase().replace("basico","básico")}`:""})();d.useEffect(()=>{let s=!1;return(async()=>{try{if(st){Tt("");return}if(!mt){Tt("");return}const f=Xr(Zr(be,"mineduc_pdfs"),Jr("nivel","==",mt)),S=(await Qr(f)).docs.map(Q=>({id:Q.id,...Q.data()})),Z=S.find(Q=>Q.asignatura===L&&Q.unidad===F)||S.find(Q=>Q.asignatura===L)||S[0];s||Tt((Z==null?void 0:Z.url)||"")}catch(f){s||Tt(""),console.warn("[ProgramaPDF] mineduc_pdfs lookup:",(f==null?void 0:f.message)||f)}})(),()=>{s=!0}},[st,mt,L,F]),d.useEffect(()=>{const s=xn.current;if(!s||typeof ResizeObserver>"u")return;const f=new ResizeObserver(b=>{const S=Math.max(320,Math.floor(b[0].contentRect.width-24));Rr(Math.min(980,S))});return f.observe(s),()=>f.disconnect()},[]),d.useEffect(()=>{var s,f;if((f=(s=i==null?void 0:i.state)==null?void 0:s.ficha)!=null&&f.programaUrl)try{localStorage.setItem("programaPdfUrl",i.state.ficha.programaUrl)}catch{}},[(Tn=(Cn=i==null?void 0:i.state)==null?void 0:Cn.ficha)==null?void 0:Tn.programaUrl]);const Cr=({numPages:s})=>{bn(s||0),qt(1)},Tr=()=>qt(s=>Math.max(1,s-1)),Lr=()=>qt(s=>Math.min(ot||1,s+1)),Dr=()=>{const s=(st||"").trim();if(s)try{localStorage.setItem("programaPdfUrl",s)}catch{}},Yt=st||zt,Pn=d.useMemo(()=>Object.entries(Yn).flatMap(([s,f])=>(f||[]).map(b=>({...b,group:s}))),[]),[En,Ir]=d.useState(!0),[Lt,Ar]=d.useState("Todas"),[Kt,kr]=d.useState(""),Mr=d.useMemo(()=>["Todas",...Object.keys(Yn)],[]),vn=d.useMemo(()=>{const s=ht(Kt);return Pn.filter(f=>{const b=Lt==="Todas"||f.group===Lt,S=!s||ht(f.name).includes(s)||ht(f.id).includes(s)||ht(f.group).includes(s);return b&&S})},[Pn,Lt,Kt]),Or=s=>{const f=String(s.id||""),b=Xe(s.url||"");if(s.embed){if(f.startsWith("geogebra"))return se(Te(b,"geogebra"));if(f.includes("desmos"))return se(Te(b,"desmos"));if(f.includes("youtube"))return se(Te(b,"youtube"));const S=/wikipedia|drive\.google|docs\.google|office|sharepoint|onedrive/.test(b)?Te(b,"custom"):Xe(b);return se(S)}Bt(b)},_r={display:"grid",gridTemplateColumns:y?"88px 1fr":"1fr",gap:12,alignItems:"start"},$r={width:88,height:88,objectFit:"cover",borderRadius:8,border:`1px solid ${B.border}`,background:"#f8fafc"},Gr={display:"-webkit-box",WebkitLineClamp:4,WebkitBoxOrient:"vertical",overflow:"hidden"},Rn={fontSize:12,color:B.textMuted};return o.createElement("div",{style:Qi},Y&&o.createElement("div",{style:{...We,marginBottom:"1rem",background:Y.fuente==="calendario"?"rgba(124,58,237,.06)":"rgba(2,132,199,.06)"}},o.createElement("div",{style:{fontWeight:800}},Y.fuente==="calendario"?"Plan semanal (vigente)":Y.fuente==="slots"?"Horario (fallback)":"Sin clase planificada"),Y.unidad&&o.createElement("div",null,o.createElement("b",null,"Unidad:")," ",Y.unidad,Y.evaluacion?" · (Evaluación)":"")),o.createElement("div",{style:{...es("1rem"),marginBottom:"1rem"}},o.createElement("div",{style:We},o.createElement("div",{style:{fontWeight:800,fontSize:"1.1rem",marginBottom:6}},"Desarrollo"),o.createElement("div",{style:{color:B.textMuted,marginBottom:8}},v),o.createElement("div",{style:{display:"flex",alignItems:"center",gap:".5rem"}},o.createElement(ri,{duracion:r,onEnd:wr}))),o.createElement("div",{style:{...We,textAlign:"center"}},o.createElement("div",{style:{fontWeight:800,fontSize:"1.2rem",marginBottom:6}},"Unidad"),o.createElement("div",{style:{marginBottom:6}},o.createElement("strong",null,F||"(sin unidad)"," ")),o.createElement("div",{style:{marginBottom:6}},o.createElement("strong",null,"Objetivo:")," ",X||"(sin objetivo)"),o.createElement("div",null,o.createElement("strong",null,"Habilidades:")," ",ae||"(sin habilidades)"),m&&o.createElement("div",{style:{marginTop:8,color:B.textDark}},o.createElement("strong",null,"OA:")," ",m.descripcion),o.createElement("div",{style:{marginTop:10,color:B.textMuted}},o.createElement("strong",null,"Curso:")," ",$,"  |  ",o.createElement("strong",null,"Asignatura:")," ",L)),o.createElement("div",{style:{...We,display:"flex",flexDirection:"column",gap:".6rem"}},o.createElement("div",{style:{display:"flex",gap:".5rem"}},o.createElement("button",{style:xt},"‹"),o.createElement("button",{style:xt},"👍")),o.createElement("div",{style:{textAlign:"right"}},o.createElement("div",{style:{fontWeight:800}},D),o.createElement("div",{style:{color:B.textMuted}},L)))),o.createElement("div",{style:{...We,textAlign:"center",marginBottom:"1rem"}},o.createElement("h3",{style:{marginTop:0}},"🎬 Recurso de apoyo"),q==="screen"?o.createElement("video",{ref:N,autoPlay:!0,playsInline:!0,style:{width:"80%",height:420,borderRadius:8,border:`1px solid ${B.border}`,background:"#000",objectFit:"contain"}}):q==="image"&&de?o.createElement("img",{src:de,alt:"Imagen presentada",style:{width:"80%",height:420,borderRadius:8,border:`1px solid ${B.border}`,background:"#000",objectFit:"contain"}}):o.createElement("iframe",{key:Me,width:"80%",height:"420",src:Me,title:"Panel principal",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{borderRadius:8,border:`1px solid ${B.border}`,background:"#000"}}),rt&&o.createElement("div",{style:{marginTop:8,color:"#b45309"}},"⚠️ ",rt),o.createElement("div",{style:ts},o.createElement("h4",{style:{margin:"0 0 8px"}},"🧰 Herramientas rápidas"),o.createElement("div",{style:bt},o.createElement("input",{style:et,value:Ce,onChange:s=>Ye(s.target.value),placeholder:"Buscar o pegar enlace de YouTube… (ej: proporcionalidad o https://youtu.be/ID)"}),o.createElement("button",{style:ne,onClick:je},"▶️ Ver en panel"),o.createElement("select",{style:qn,value:Ae,onChange:s=>Fe(s.target.value),title:"Tipo de app GeoGebra"},o.createElement("option",{value:"calculator"},"GeoGebra · Graficadora"),o.createElement("option",{value:"geometry"},"GeoGebra · Geometría"),o.createElement("option",{value:"3d"},"GeoGebra · 3D")),o.createElement("button",{style:ne,onClick:gr},"📐 En panel"),o.createElement("button",{style:ne,onClick:pr},"🧮 Desmos en panel"),o.createElement("button",{style:ne,onClick:fr},"🧪 PhET (portal)"),o.createElement("button",{style:ne,onClick:mr},"📂 Drive"),o.createElement("input",{style:{...et,minWidth:280},value:ke,onChange:s=>Ke(s.target.value),placeholder:"Pega cualquier enlace (intentaremos mostrarlo aquí)"}),o.createElement("button",{style:ne,onClick:yr},"🔗 Abrir en panel")),o.createElement("div",{style:ns},o.createElement("button",{style:Be,onClick:Le,title:fe?"Compartiendo… (elige otra opción)":"Presentar (pantalla o archivo)"},o.createElement(ct,null)),o.createElement("button",{style:{...Be,display:"none"},onClick:Le},o.createElement(ct,null)),o.createElement("button",{style:{...Be,display:"none"},onClick:Le},o.createElement(ct,null)),o.createElement("button",{style:{...Be,display:"none"},onClick:Le},o.createElement(ct,null)),o.createElement("button",{style:{...Be,display:"none"},onClick:Le},o.createElement(ct,null)),o.createElement("button",{style:{...Be,display:"none"},onClick:Le},o.createElement(ct,null)),o.createElement("button",{style:Be,onClick:un,title:"Shap-E (texto→3D)"},o.createElement("img",{src:Ot("huggingface.co"),alt:"Shap-E",style:nn})),o.createElement("button",{style:Be,onClick:gn,title:"TripoSR (imagen→3D)"},o.createElement("img",{src:Ot("huggingface.co"),alt:"TripoSR",style:nn})),o.createElement("button",{style:Be,onClick:Er,title:"Escape Room (demo A-Frame)"},o.createElement("img",{src:Ot("aframe.io"),alt:"A-Frame",style:nn}))),o.createElement("div",{style:ls},o.createElement("div",{style:{...bt,justifyContent:"space-between"}},o.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}},o.createElement("h4",{style:{margin:0}},"⚙️ Apps rápidas"),o.createElement("button",{style:{...ne,padding:".3rem .6rem"},onClick:()=>Ir(s=>!s),title:"Mostrar/Ocultar catálogo"},En?"Ocultar":"Mostrar")),o.createElement("div",{style:{display:"flex",gap:8,flexWrap:"wrap"}},o.createElement("select",{style:qn,value:Lt,onChange:s=>Ar(s.target.value),title:"Filtrar por categoría"},Mr.map(s=>o.createElement("option",{key:s,value:s},s))),o.createElement("input",{style:{...et,minWidth:240},value:Kt,onChange:s=>kr(s.target.value),placeholder:"Buscar app por nombre/categoría…"}))),En&&o.createElement("div",{style:hs},vn.map(s=>{let f="example.com";try{f=new URL(Xe(s.url)).host}catch{}return o.createElement("div",{key:`${s.group}:${s.id}`,style:ds,onClick:()=>Or(s),title:s.embed?"Abrir dentro del panel":"Abrir en pestaña nueva"},o.createElement("img",{src:Ot(f),alt:s.name,style:us}),o.createElement("div",{style:{display:"flex",flexDirection:"column"}},o.createElement("span",{style:gs},s.name," ",s.embed?"":"—"),o.createElement("span",{style:ps},s.group)))}),vn.length===0&&o.createElement("div",{style:{gridColumn:"1/-1",color:B.textMuted,fontStyle:"italic",padding:6}},"Sin resultados para ese filtro/búsqueda."))),o.createElement("input",{ref:pe,type:"file",accept:"application/pdf,image/*",onChange:jt,style:{display:"none"}}))),o.createElement("div",{style:{...We,marginBottom:"1rem"}},o.createElement("h3",{style:{marginTop:0,textAlign:"center"}},"📑 Programa de Estudio (PDF)"),o.createElement("div",{style:{...bt,marginBottom:8}},o.createElement("input",{style:{...et,minWidth:420},value:st,onChange:s=>wn(s.target.value),placeholder:"Pega aquí la URL del PDF del programa (nivel + asignatura)"}),o.createElement("button",{style:ne,onClick:Dr},"💾 Guardar enlace"),o.createElement("div",{style:{display:"flex",gap:6}},o.createElement("button",{style:{...ne,opacity:Vt==="flip"?1:.6},onClick:()=>Sn("flip"),title:"Ver como Flipbook"},"📖 Flipbook"),o.createElement("button",{style:{...ne,opacity:Vt==="scroll"?1:.6},onClick:()=>Sn("scroll"),title:"Ver en modo paginado/scroll"},"📄 Scroll"),zt&&!st&&o.createElement("button",{style:ne,onClick:()=>wn(zt),title:"Usar URL encontrada en mineduc_pdfs"},"🏷️ Usar MINEDUC"))),Yt?Vt==="scroll"?o.createElement("div",{ref:xn,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8}},o.createElement("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6}},o.createElement("button",{style:ne,onClick:Tr,disabled:Ct<=1},"◀️ Anterior"),o.createElement("div",{style:{fontWeight:700}},"Página ",Ct," / ",ot||"…"),o.createElement("button",{style:ne,onClick:Lr,disabled:!ot||Ct>=ot},"Siguiente ▶️")),o.createElement("div",{style:{border:`1px solid ${B.border}`,borderRadius:8,overflow:"hidden",background:"#f8fafc"}},o.createElement(on,{file:{url:Yt},onLoadSuccess:Cr,loading:o.createElement("div",{style:{padding:12}},"Cargando PDF…")},o.createElement(an,{pageNumber:Ct,width:vr,renderAnnotationLayer:!0,renderTextLayer:!0})))):o.createElement("div",{style:{display:"flex",justifyContent:"center"}},o.createElement(on,{file:{url:Yt},onLoadError:s=>console.error("PDF error:",s),onLoadSuccess:({numPages:s})=>bn(s),loading:o.createElement("div",{style:{padding:12}},"Cargando PDF…")},ot?o.createElement(Xi,{width:800,height:1e3,className:"shadow-lg"},Array.from({length:ot}).map((s,f)=>o.createElement("div",{key:`pg-${f}`,className:"bg-white p-2"},o.createElement(an,{pageNumber:f+1,renderTextLayer:!1,renderAnnotationLayer:!1,width:800})))):null)):o.createElement("div",{style:{color:B.textMuted,textAlign:"center"}},"Pega la URL del PDF arriba. Si vienes desde ",o.createElement("em",null,"Inicio")," con ficha, uso automáticamente"," ",o.createElement("code",null,"ficha.programaUrl"),". Si está vacío, intentamos buscarlo en ",o.createElement("code",null,"mineduc_pdfs")," por tu"," ",mt?`nivel «${mt}»`:"nivel"," y asignatura.")),o.createElement("div",{style:{...We,marginBottom:"1rem"}},o.createElement("h3",{style:{marginTop:0,textAlign:"center"}},"🧪 Laboratorio 3D"),o.createElement("div",{style:{...bt,marginBottom:6}},o.createElement("input",{style:{...et,minWidth:360},value:Pt,onChange:s=>br(s.target.value),placeholder:"Prompt 3D (ej.: 'un prisma triangular low-poly de color azul')",onKeyDown:s=>{s.key==="Enter"&&yn()}}),o.createElement("button",{style:ne,onClick:un},"🧊 Abrir Shap-E (texto→3D)"),o.createElement("button",{style:ne,onClick:gn},"🖼️ Abrir TripoSR (imagen→3D)"),o.createElement("button",{style:{...ne,opacity:pn?.7:1},onClick:yn,disabled:pn,title:"Requiere proxy local en PROXY_BASE/shape/generate"},"✅ Generar (servidor)")),mn&&o.createElement("div",{style:{textAlign:"center",color:"#b45309",marginBottom:6}},mn),o.createElement("div",{style:{...bt,marginBottom:10}},o.createElement("input",{style:{...et,minWidth:360},value:ln,onChange:s=>Nt(s.target.value),placeholder:"URL .glb/.gltf (pégalo aquí para previsualizar)"}),o.createElement("button",{style:ne,onClick:xr},"👁️ Ver 3D"),o.createElement("button",{style:ne,onClick:Sr},"⤴️ Subir GLB"),o.createElement("input",{ref:dn,type:"file",accept:".glb,.gltf,model/gltf-binary,model/gltf+json",onChange:Pr,style:{display:"none"}})),o.createElement("div",{ref:vt,style:{display:"flex",justifyContent:"center"}},hn?o.createElement("model-viewer",{src:hn,alt:"Modelo 3D","camera-controls":!0,"auto-rotate":!0,exposure:"1.1",style:{width:"100%",maxWidth:720,height:420,borderRadius:12,border:`1px solid ${B.border}`},ar:!0}):o.createElement("div",{style:{color:B.textMuted,fontStyle:"italic"}},"Pega una URL .glb/.gltf o sube un GLB para previsualizarlo aquí."))),t&&(p||l)&&o.createElement("div",{style:{...We,marginBottom:"0.75rem"}},o.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:6}},o.createElement("h3",{style:{margin:0}},"📚 Introducción (Wikipedia)"),o.createElement("div",{style:Rn},"Relacionado con: ",o.createElement("strong",null,F||X||"la temática de la clase"))),o.createElement("div",{style:_r},y?o.createElement("img",{src:y,alt:l||"Wikipedia",style:$r}):null,o.createElement("div",null,l&&o.createElement("div",{style:{fontWeight:800,marginBottom:4}},o.createElement("a",{href:t,target:"_blank",rel:"noreferrer noopener",style:{color:B.textDark,textDecoration:"none"},title:"Abrir artículo"},l," —")),p?o.createElement("div",{style:Gr},p):o.createElement("div",{style:{color:B.textMuted,fontStyle:"italic"}},"No se pudo obtener el resumen. Puedes abrir el artículo completo abajo."),o.createElement("div",{style:{marginTop:8}},o.createElement("a",{href:t,target:"_blank",rel:"noreferrer noopener",style:{...Rn,textDecoration:"underline"}},"Abrir artículo completo →"))))),t&&o.createElement("div",{style:{...We}},o.createElement("h3",{style:{marginTop:0,textAlign:"center"}},"📚 Información complementaria"),o.createElement("iframe",{src:t,width:"100%",height:"420",title:"Contenido Wikipedia",style:{border:`1px solid ${B.border}`,borderRadius:"8px"}})),o.createElement("div",{style:{textAlign:"center",marginTop:"1rem"}},o.createElement("button",{onClick:()=>c("/cierre"),style:xt,title:"Ir al Cierre"},"⏭️ Ir al Cierre")))}export{xs as default};
